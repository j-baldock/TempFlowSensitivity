<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.7.32">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>5&nbsp; ModelTemp - Letcher et al.&nbsp;(2016) â€“ Stream Temperature by Flow</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
html { -webkit-text-size-adjust: 100%; }
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<link href="./ModelTemp-EcoDrought.html" rel="next">
<link href="./FormatData.html" rel="prev">
<script src="site_libs/quarto-html/quarto.js" type="module"></script>
<script src="site_libs/quarto-html/tabsets/tabsets.js" type="module"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting-37eea08aefeeee20ff55810ff984fec1.css" rel="stylesheet" class="quarto-color-scheme" id="quarto-text-highlighting-styles">
<link href="site_libs/quarto-html/quarto-syntax-highlighting-dark-2fef5ea3f8957b3e4ecc936fc74692ca.css" rel="stylesheet" class="quarto-color-scheme quarto-color-alternate" id="quarto-text-highlighting-styles">
<link href="site_libs/quarto-html/quarto-syntax-highlighting-37eea08aefeeee20ff55810ff984fec1.css" rel="stylesheet" class="quarto-color-scheme-extra" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap-c599ca7844cfd5ff950332d51a54001f.min.css" rel="stylesheet" append-hash="true" class="quarto-color-scheme" id="quarto-bootstrap" data-mode="light">
<link href="site_libs/bootstrap/bootstrap-dark-a0800d32663627e31cbe2a42d8010cbb.min.css" rel="stylesheet" append-hash="true" class="quarto-color-scheme quarto-color-alternate" id="quarto-bootstrap" data-mode="dark">
<link href="site_libs/bootstrap/bootstrap-c599ca7844cfd5ff950332d51a54001f.min.css" rel="stylesheet" append-hash="true" class="quarto-color-scheme-extra" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>
<script type="application/json" class="js-hypothesis-config">
{
  "theme": "clean"
}
</script>
<script async="" src="https://hypothes.is/embed.js"></script>
<script>
  window.document.addEventListener("DOMContentLoaded", function (_event) {
    document.body.classList.add('hypothesis-enabled');
  });
</script>
</head><body class="nav-sidebar floating quarto-light"><script id="quarto-html-before-body" type="application/javascript">
    const toggleBodyColorMode = (bsSheetEl) => {
      const mode = bsSheetEl.getAttribute("data-mode");
      const bodyEl = window.document.querySelector("body");
      if (mode === "dark") {
        bodyEl.classList.add("quarto-dark");
        bodyEl.classList.remove("quarto-light");
      } else {
        bodyEl.classList.add("quarto-light");
        bodyEl.classList.remove("quarto-dark");
      }
    }
    const toggleBodyColorPrimary = () => {
      const bsSheetEl = window.document.querySelector("link#quarto-bootstrap:not([rel=disabled-stylesheet])");
      if (bsSheetEl) {
        toggleBodyColorMode(bsSheetEl);
      }
    }
    const setColorSchemeToggle = (alternate) => {
      const toggles = window.document.querySelectorAll('.quarto-color-scheme-toggle');
      for (let i=0; i < toggles.length; i++) {
        const toggle = toggles[i];
        if (toggle) {
          if (alternate) {
            toggle.classList.add("alternate");
          } else {
            toggle.classList.remove("alternate");
          }
        }
      }
    };
    const toggleColorMode = (alternate) => {
      // Switch the stylesheets
      const primaryStylesheets = window.document.querySelectorAll('link.quarto-color-scheme:not(.quarto-color-alternate)');
      const alternateStylesheets = window.document.querySelectorAll('link.quarto-color-scheme.quarto-color-alternate');
      manageTransitions('#quarto-margin-sidebar .nav-link', false);
      if (alternate) {
        // note: dark is layered on light, we don't disable primary!
        enableStylesheet(alternateStylesheets);
        for (const sheetNode of alternateStylesheets) {
          if (sheetNode.id === "quarto-bootstrap") {
            toggleBodyColorMode(sheetNode);
          }
        }
      } else {
        disableStylesheet(alternateStylesheets);
        enableStylesheet(primaryStylesheets)
        toggleBodyColorPrimary();
      }
      manageTransitions('#quarto-margin-sidebar .nav-link', true);
      // Switch the toggles
      setColorSchemeToggle(alternate)
      // Hack to workaround the fact that safari doesn't
      // properly recolor the scrollbar when toggling (#1455)
      if (navigator.userAgent.indexOf('Safari') > 0 && navigator.userAgent.indexOf('Chrome') == -1) {
        manageTransitions("body", false);
        window.scrollTo(0, 1);
        setTimeout(() => {
          window.scrollTo(0, 0);
          manageTransitions("body", true);
        }, 40);
      }
    }
    const disableStylesheet = (stylesheets) => {
      for (let i=0; i < stylesheets.length; i++) {
        const stylesheet = stylesheets[i];
        stylesheet.rel = 'disabled-stylesheet';
      }
    }
    const enableStylesheet = (stylesheets) => {
      for (let i=0; i < stylesheets.length; i++) {
        const stylesheet = stylesheets[i];
        if(stylesheet.rel !== 'stylesheet') { // for Chrome, which will still FOUC without this check
          stylesheet.rel = 'stylesheet';
        }
      }
    }
    const manageTransitions = (selector, allowTransitions) => {
      const els = window.document.querySelectorAll(selector);
      for (let i=0; i < els.length; i++) {
        const el = els[i];
        if (allowTransitions) {
          el.classList.remove('notransition');
        } else {
          el.classList.add('notransition');
        }
      }
    }
    const isFileUrl = () => {
      return window.location.protocol === 'file:';
    }
    const hasAlternateSentinel = () => {
      let styleSentinel = getColorSchemeSentinel();
      if (styleSentinel !== null) {
        return styleSentinel === "alternate";
      } else {
        return false;
      }
    }
    const setStyleSentinel = (alternate) => {
      const value = alternate ? "alternate" : "default";
      if (!isFileUrl()) {
        window.localStorage.setItem("quarto-color-scheme", value);
      } else {
        localAlternateSentinel = value;
      }
    }
    const getColorSchemeSentinel = () => {
      if (!isFileUrl()) {
        const storageValue = window.localStorage.getItem("quarto-color-scheme");
        return storageValue != null ? storageValue : localAlternateSentinel;
      } else {
        return localAlternateSentinel;
      }
    }
    const toggleGiscusIfUsed = (isAlternate, darkModeDefault) => {
      const baseTheme = document.querySelector('#giscus-base-theme')?.value ?? 'light';
      const alternateTheme = document.querySelector('#giscus-alt-theme')?.value ?? 'dark';
      let newTheme = '';
      if(authorPrefersDark) {
        newTheme = isAlternate ? baseTheme : alternateTheme;
      } else {
        newTheme = isAlternate ? alternateTheme : baseTheme;
      }
      const changeGiscusTheme = () => {
        // From: https://github.com/giscus/giscus/issues/336
        const sendMessage = (message) => {
          const iframe = document.querySelector('iframe.giscus-frame');
          if (!iframe) return;
          iframe.contentWindow.postMessage({ giscus: message }, 'https://giscus.app');
        }
        sendMessage({
          setConfig: {
            theme: newTheme
          }
        });
      }
      const isGiscussLoaded = window.document.querySelector('iframe.giscus-frame') !== null;
      if (isGiscussLoaded) {
        changeGiscusTheme();
      }
    };
    const authorPrefersDark = false;
    const darkModeDefault = authorPrefersDark;
      document.querySelector('link#quarto-text-highlighting-styles.quarto-color-scheme-extra').rel = 'disabled-stylesheet';
      document.querySelector('link#quarto-bootstrap.quarto-color-scheme-extra').rel = 'disabled-stylesheet';
    let localAlternateSentinel = darkModeDefault ? 'alternate' : 'default';
    // Dark / light mode switch
    window.quartoToggleColorScheme = () => {
      // Read the current dark / light value
      let toAlternate = !hasAlternateSentinel();
      toggleColorMode(toAlternate);
      setStyleSentinel(toAlternate);
      toggleGiscusIfUsed(toAlternate, darkModeDefault);
      window.dispatchEvent(new Event('resize'));
    };
    // Switch to dark mode if need be
    if (hasAlternateSentinel()) {
      toggleColorMode(true);
    } else {
      toggleColorMode(false);
    }
  </script><a href="https://github.com/j-baldock/TempFlowSensitivity" class="github-corner" aria-label="View source on GitHub"><svg width="80" height="80" viewbox="0 0 250 250" style="fill:#69b3a2; color:#fff; position: 

absolute; top: 0; border: 0; right: 0;" aria-hidden="true"><path d="M0,0 L115,115 L130,115 

L142,142 L250,250 L250,0 Z"></path><path d="M128.3,109.0 C113.8,99.7 119.0,89.6 119.0,89.6 

C122.0,82.7 120.5,78.6 120.5,78.6 C119.2,72.0 123.4,76.3 123.4,76.3 C127.3,80.9 125.5,87.3 

125.5,87.3 C122.9,97.6 130.6,101.9 134.4,103.2" fill="currentColor" style="transform-origin: 

130px 106px;" class="octo-arm"></path><path d="M115.0,115.0 C114.9,115.1 118.7,116.5 

119.8,115.4 L133.7,101.6 C136.9,99.2 139.9,98.4 142.2,98.6 C133.8,88.0 127.5,74.4 143.8,58.0 

C148.5,53.4 154.0,51.2 159.7,51.0 C160.3,49.4 163.2,43.6 171.4,40.1 C171.4,40.1 176.1,42.5 

178.8,56.2 C183.1,58.6 187.2,61.8 190.9,65.4 C194.5,69.0 197.7,73.2 200.1,77.6 C213.8,80.2 

216.3,84.9 216.3,84.9 C212.7,93.1 206.9,96.0 205.4,96.6 C205.1,102.4 203.0,107.8 198.3,112.5 

C181.9,128.9 168.3,122.5 157.7,114.1 C157.9,116.9 156.7,120.9 152.7,124.9 L141.0,136.5 

C139.8,137.7 141.6,141.9 141.8,141.8 Z" fill="currentColor" class="octo-body"></path></svg></a><style>.github-corner:hover 

.octo-arm{animation:octocat-wave 560ms ease-in-out}@keyframes 

octocat-wave{0%,100%{transform:rotate(0)}20%,60%{transform:rotate(-25deg)}40%,80%{transform:rotate(10deg)}}@media 

(max-width:500px){.github-corner:hover .octo-arm{animation:none}.github-corner 

  .octo-arm{animation:octocat-wave 560ms ease-in-out}}</style>






<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" role="button" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./ModelTemp-Letcher.html"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">ModelTemp - Letcher et al.&nbsp;(2016)</span></a></li></ol></nav>
        <a class="flex-grow-1" role="navigation" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
      <button type="button" class="btn quarto-search-button" aria-label="Search" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation floating overflow-auto">
    <div class="pt-lg-2 mt-2 text-left sidebar-header">
    <div class="sidebar-title mb-0 py-0">
      <a href="./">Stream Temperature by Flow</a> 
        <div class="sidebar-tools-main">
  <a href="" class="quarto-color-scheme-toggle quarto-navigation-tool  px-1" onclick="window.quartoToggleColorScheme(); return false;" title="Toggle dark mode"><i class="bi"></i></a>
</div>
    </div>
      </div>
        <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
        </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">Introduction</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./DataViz.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">Visualize Data</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./Breakpoints.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Breakpoints</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./FormatData.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">Format Data</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./ModelTemp-Letcher.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">ModelTemp - Letcher et al.&nbsp;(2016)</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./ModelTemp-EcoDrought.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">ModelTemp - EcoDrought</span></span></a>
  </div>
</li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table of contents</h2>
   
  <ul>
  <li><a href="#repeat-letcher-et-al." id="toc-repeat-letcher-et-al." class="nav-link active" data-scroll-target="#repeat-letcher-et-al."><span class="header-section-number">5.1</span> Repeat Letcher et al.</a>
  <ul class="collapse">
  <li><a href="#load-data" id="toc-load-data" class="nav-link" data-scroll-target="#load-data"><span class="header-section-number">5.1.1</span> Load data</a></li>
  <li><a href="#specify-model" id="toc-specify-model" class="nav-link" data-scroll-target="#specify-model"><span class="header-section-number">5.1.2</span> Specify model</a></li>
  <li><a href="#organize-objects" id="toc-organize-objects" class="nav-link" data-scroll-target="#organize-objects"><span class="header-section-number">5.1.3</span> Organize objects</a></li>
  <li><a href="#fit-model" id="toc-fit-model" class="nav-link" data-scroll-target="#fit-model"><span class="header-section-number">5.1.4</span> Fit model</a></li>
  <li><a href="#goodness-of-fit" id="toc-goodness-of-fit" class="nav-link" data-scroll-target="#goodness-of-fit"><span class="header-section-number">5.1.5</span> Goodness of fit</a></li>
  <li><a href="#plot-model-output" id="toc-plot-model-output" class="nav-link" data-scroll-target="#plot-model-output"><span class="header-section-number">5.1.6</span> Plot model output</a></li>
  </ul></li>
  <li><a href="#hierarchical" id="toc-hierarchical" class="nav-link" data-scroll-target="#hierarchical"><span class="header-section-number">5.2</span> Hierarchical</a>
  <ul class="collapse">
  <li><a href="#specify-model-1" id="toc-specify-model-1" class="nav-link" data-scroll-target="#specify-model-1"><span class="header-section-number">5.2.1</span> Specify model</a></li>
  <li><a href="#organize-objects-1" id="toc-organize-objects-1" class="nav-link" data-scroll-target="#organize-objects-1"><span class="header-section-number">5.2.2</span> Organize objects</a></li>
  <li><a href="#fit-model-1" id="toc-fit-model-1" class="nav-link" data-scroll-target="#fit-model-1"><span class="header-section-number">5.2.3</span> Fit model</a></li>
  <li><a href="#goodness-of-fit-1" id="toc-goodness-of-fit-1" class="nav-link" data-scroll-target="#goodness-of-fit-1"><span class="header-section-number">5.2.4</span> Goodness of fit</a></li>
  <li><a href="#plot-model-output-1" id="toc-plot-model-output-1" class="nav-link" data-scroll-target="#plot-model-output-1"><span class="header-section-number">5.2.5</span> Plot model output</a></li>
  </ul></li>
  <li><a href="#hierarchical-flow-var." id="toc-hierarchical-flow-var." class="nav-link" data-scroll-target="#hierarchical-flow-var."><span class="header-section-number">5.3</span> Hierarchical, flow var.</a>
  <ul class="collapse">
  <li><a href="#organize-objects-2" id="toc-organize-objects-2" class="nav-link" data-scroll-target="#organize-objects-2"><span class="header-section-number">5.3.1</span> Organize objects</a></li>
  <li><a href="#fit-model-2" id="toc-fit-model-2" class="nav-link" data-scroll-target="#fit-model-2"><span class="header-section-number">5.3.2</span> Fit model</a></li>
  <li><a href="#goodness-of-fit-2" id="toc-goodness-of-fit-2" class="nav-link" data-scroll-target="#goodness-of-fit-2"><span class="header-section-number">5.3.3</span> Goodness of fit</a></li>
  <li><a href="#plot-model-output-2" id="toc-plot-model-output-2" class="nav-link" data-scroll-target="#plot-model-output-2"><span class="header-section-number">5.3.4</span> Plot model output</a></li>
  </ul></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">


<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<div class="quarto-title-block"><div><h1 class="title"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">ModelTemp - Letcher et al.&nbsp;(2016)</span></h1><button type="button" class="btn code-tools-button dropdown-toggle" id="quarto-code-tools-menu" data-bs-toggle="dropdown" aria-expanded="false"><i class="bi"></i> Code</button><ul class="dropdown-menu dropdown-menu-end" aria-labelelledby="quarto-code-tools-menu"><li><a id="quarto-show-all-code" class="dropdown-item" href="javascript:void(0)" role="button">Show All Code</a></li><li><a id="quarto-hide-all-code" class="dropdown-item" href="javascript:void(0)" role="button">Hide All Code</a></li><li><hr class="dropdown-divider"></li><li><a id="quarto-view-source" class="dropdown-item" href="javascript:void(0)" role="button">View Source</a></li></ul></div></div>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header>


<p><strong>Purpose:</strong> fit stream temp model as in Letcher et al.&nbsp;(2016); modify JAGS model to estimate parameters hierarchically and check to make sure output matches.</p>
<section id="repeat-letcher-et-al." class="level2" data-number="5.1">
<h2 data-number="5.1" class="anchored" data-anchor-id="repeat-letcher-et-al."><span class="header-section-number">5.1</span> Repeat Letcher et al.</h2>
<section id="load-data" class="level3" data-number="5.1.1">
<h3 data-number="5.1.1" class="anchored" data-anchor-id="load-data"><span class="header-section-number">5.1.1</span> Load data</h3>
<p>Load fully formatted data used in Letcher et al.&nbsp;(2016) PeerJ</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">load</span>(<span class="st">"data/tempDataSyncSUsed.RData"</span>)</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(tempDataSyncS)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>  agency       date AgencyID year fyear            site           fsite
1 MAUSGS 2003-04-15 WB JIMMY 2003  2003 MAUSGS_WB_JIMMY MAUSGS_WB_JIMMY
2 MAUSGS 2003-04-17 WB JIMMY 2003  2003 MAUSGS_WB_JIMMY MAUSGS_WB_JIMMY
3 MAUSGS 2003-04-18 WB JIMMY 2003  2003 MAUSGS_WB_JIMMY MAUSGS_WB_JIMMY
4 MAUSGS 2003-04-19 WB JIMMY 2003  2003 MAUSGS_WB_JIMMY MAUSGS_WB_JIMMY
5 MAUSGS 2003-04-20 WB JIMMY 2003  2003 MAUSGS_WB_JIMMY MAUSGS_WB_JIMMY
6 MAUSGS 2003-04-21 WB JIMMY 2003  2003 MAUSGS_WB_JIMMY MAUSGS_WB_JIMMY
      date.1 finalSpringBP finalFallBP     temp Latitude  Longitude    airTemp
1 2003-04-15           102         290 7.807917 1.048017 -0.7477016 -0.9020338
2 2003-04-17           102         290 5.607500 1.048017 -0.7477016 -0.4415435
3 2003-04-18           102         290 4.758333 1.048017 -0.7477016 -1.9231208
4 2003-04-19           102         290 6.387500 1.048017 -0.7477016 -1.6428224
5 2003-04-20           102         290 7.113333 1.048017 -0.7477016 -0.8820125
6 2003-04-21           102         290 7.880000 1.048017 -0.7477016 -0.6017140
  airTempLagged1 airTempLagged2      prcp prcpLagged1 prcpLagged2 prcpLagged3
1     -1.6630011     -0.9826831 -0.431969   -0.431943  -0.4321001   1.5183177
2     -0.9021355     -1.6637155 -0.431969   -0.431943  -0.4321001  -0.4320896
3     -0.4416116     -0.9025616 -0.431969   -0.431943  -0.4321001  -0.4320896
4     -1.9232972     -0.4418633 -0.431969   -0.431943  -0.4321001  -0.4320896
5     -1.6429783     -1.9241102 -0.431969   -0.431943  -0.4321001  -0.4320896
6     -0.8821128     -1.6436851 -0.431969   -0.431943  -0.4321001  -0.4320896
        dOY     srad         dayl      swe    river riverOrdered       flow
1 -1.415528 1.991316 -0.131945293 5.473538 WB JIMMY     WB JIMMY 0.08426817
2 -1.384749 2.653903 -0.069753841 5.201804 WB JIMMY     WB JIMMY 0.07151272
3 -1.369360 1.461245 -0.007563092 5.201804 WB JIMMY     WB JIMMY 0.06206147
4 -1.353970 1.567260 -0.007563092 5.065937 WB JIMMY     WB JIMMY 0.05891408
5 -1.338580 2.309357  0.054628359 5.065937 WB JIMMY     WB JIMMY 0.05542324
6 -1.323191 2.362365  0.054628359 4.930070 WB JIMMY     WB JIMMY 0.05365359
       dA     flowL     sweL     flowS    flowLS    sweLS     swe0 dOYInt
1 0.02175 -2.473751 1.867723 1.1818051 1.4198486 3.597025 5.473538    105
2 0.02175 -2.637880 1.824840 0.8600836 1.2196572 3.520450 5.201804    107
3 0.02175 -2.779630 1.824840 0.6217015 1.0467618 3.520450 5.201804    108
4 0.02175 -2.831675 1.802689 0.5423169 0.9832809 3.480896 5.065937    109
5 0.02175 -2.892756 1.802689 0.4542700 0.9087791 3.480896 5.065937    110
6 0.02175 -2.925207 1.780036 0.4096354 0.8691984 3.440445 4.930070    111
  dOYYear river0 river1 river2 river3 site0 site1 site2 site3 site4 site5 site6
1   -1070      0      1      0      0     0     0     0     1     0     0     0
2   -1068      0      1      0      0     0     0     0     1     0     0     0
3   -1067      0      1      0      0     0     0     0     1     0     0     0
4   -1066      0      1      0      0     0     0     0     1     0     0     0
5   -1065      0      1      0      0     0     0     0     1     0     0     0
6   -1064      0      1      0      0     0     0     0     1     0     0     0
  rowNum HUC8 sitef huc8f siteShift dateShift newSite newDate  isNA isNAShift
1      1   NA     1    NA         1         1   FALSE    TRUE FALSE     FALSE
2      2   NA     1    NA         1     12157   FALSE    TRUE FALSE     FALSE
3      3   NA     1    NA         1     12159   FALSE   FALSE FALSE     FALSE
4      4   NA     1    NA         1     12160   FALSE   FALSE FALSE     FALSE
5      5   NA     1    NA         1     12161   FALSE   FALSE FALSE     FALSE
6      6   NA     1    NA         1     12162   FALSE   FALSE FALSE     FALSE
  newDeploy deployID month meanByMonthRiverYear nMonthRiverYear
1         1        1     4             7.330028              15
2         1        2     4             7.330028              15
3         0        2     4             7.330028              15
4         0        2     4             7.330028              15
5         0        2     4             7.330028              15
6         0        2     4             7.330028              15
  meanByMonthRiver nMonthRiver meanByMonth nMonth riverMS    resid.wb  pred.wb
1         7.174471         260    7.656617   1146      OL  0.00000000 5.890803
2         7.174471         260    7.656617   1146      OL -1.16836024 6.775860
3         7.174471         260    7.656617   1146      OL  1.01697121 3.741362
4         7.174471         260    7.656617   1146      OL  1.36486877 5.022631
5         7.174471         260    7.656617   1146      OL -0.05961997 7.172953
6         7.174471         260    7.656617   1146      OL  0.27705812 7.602942</code></pre>
</div>
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="fu">unique</span>(tempDataSyncS<span class="sc">$</span>river)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "WB JIMMY"    "WB MITCHELL" "WB OBEAR"    "WEST BROOK" </code></pre>
</div>
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a>tempDataSyncS <span class="ot">&lt;-</span> tempDataSyncS <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="at">siteYear =</span> <span class="fu">paste</span>(site, year, <span class="at">sep =</span> <span class="st">"_"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>Any missing data?</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="fu">any</span>(<span class="fu">is.na</span>(tempDataSyncS<span class="sc">$</span>airTemp))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>[1] FALSE</code></pre>
</div>
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="fu">any</span>(<span class="fu">is.na</span>(tempDataSyncS<span class="sc">$</span>airTempLagged1))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>[1] FALSE</code></pre>
</div>
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="fu">any</span>(<span class="fu">is.na</span>(tempDataSyncS<span class="sc">$</span>airTempLagged2))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>[1] FALSE</code></pre>
</div>
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="fu">any</span>(<span class="fu">is.na</span>(tempDataSyncS<span class="sc">$</span>flowLS))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>[1] FALSE</code></pre>
</div>
</div>
<p>Visualize data. Note that air temp is standardized. By site? Or among sites?</p>
<div class="tabset-margin-container"></div><div class="panel-tabset">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-1-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-1-1" role="tab" aria-controls="tabset-1-1" aria-selected="true">Air temp</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-1-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-1-2" role="tab" aria-controls="tabset-1-2" aria-selected="false">Water temp</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-1-3-tab" data-bs-toggle="tab" data-bs-target="#tabset-1-3" role="tab" aria-controls="tabset-1-3" aria-selected="false">Flow (log and std)</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-1-4-tab" data-bs-toggle="tab" data-bs-target="#tabset-1-4" role="tab" aria-controls="tabset-1-4" aria-selected="false">Tw ~ Ta + F</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-1-5-tab" data-bs-toggle="tab" data-bs-target="#tabset-1-5" role="tab" aria-controls="tabset-1-5" aria-selected="false">Ta ~ F</a></li></ul>
<div class="tab-content">
<div id="tabset-1-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-1-1-tab">
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(tempDataSyncS,<span class="fu">aes</span>(dOY,airTemp))<span class="sc">+</span></span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">color=</span><span class="fu">factor</span>(year))) <span class="sc">+</span></span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_grid</span>(year<span class="sc">~</span>riverOrdered)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="ModelTemp-Letcher_files/figure-html/unnamed-chunk-4-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</div>
<div id="tabset-1-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-1-2-tab">
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(tempDataSyncS,<span class="fu">aes</span>(dOY,temp))<span class="sc">+</span></span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">color=</span><span class="fu">factor</span>(year)))<span class="sc">+</span></span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_grid</span>(year<span class="sc">~</span>riverOrdered)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="ModelTemp-Letcher_files/figure-html/unnamed-chunk-5-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</div>
<div id="tabset-1-3" class="tab-pane" role="tabpanel" aria-labelledby="tabset-1-3-tab">
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(tempDataSyncS,<span class="fu">aes</span>(dOY,flowLS))<span class="sc">+</span></span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">color=</span><span class="fu">factor</span>(year)))<span class="sc">+</span></span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_grid</span>(year<span class="sc">~</span>riverOrdered)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="ModelTemp-Letcher_files/figure-html/unnamed-chunk-6-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</div>
<div id="tabset-1-4" class="tab-pane" role="tabpanel" aria-labelledby="tabset-1-4-tab">
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a>tempDataSyncS <span class="sc">%&gt;%</span> <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> airTemp, <span class="at">y =</span> temp, <span class="at">color =</span> flowLS)) <span class="sc">+</span> <span class="fu">geom_point</span>(<span class="at">size =</span> <span class="fl">0.2</span>) <span class="sc">+</span> <span class="fu">facet_wrap</span>(<span class="sc">~</span>riverOrdered) <span class="sc">+</span> <span class="fu">theme_bw</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="ModelTemp-Letcher_files/figure-html/unnamed-chunk-7-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</div>
<div id="tabset-1-5" class="tab-pane" role="tabpanel" aria-labelledby="tabset-1-5-tab">
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a>tempDataSyncS <span class="sc">%&gt;%</span> <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> airTemp, <span class="at">y =</span> flowLS, <span class="at">colour =</span> temp)) <span class="sc">+</span> <span class="fu">geom_point</span>(<span class="at">size =</span> <span class="fl">0.2</span>) <span class="sc">+</span> <span class="fu">facet_wrap</span>(<span class="sc">~</span>riverOrdered) <span class="sc">+</span> <span class="fu">theme_bw</span>() <span class="sc">+</span> ggpubr<span class="sc">::</span><span class="fu">stat_cor</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="ModelTemp-Letcher_files/figure-html/unnamed-chunk-8-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</div>
</div>
</div>
</section>
<section id="specify-model" class="level3" data-number="5.1.2">
<h3 data-number="5.1.2" class="anchored" data-anchor-id="specify-model"><span class="header-section-number">5.1.2</span> Specify model</h3>
<p>Straight from Letcher et al (2016)</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"model {</span></span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-3"><a href="#cb19-3" aria-hidden="true" tabindex="-1"></a><span class="st">    ###----------------- LIKELIHOOD -----------------###</span></span>
<span id="cb19-4"><a href="#cb19-4" aria-hidden="true" tabindex="-1"></a><span class="st">    </span></span>
<span id="cb19-5"><a href="#cb19-5" aria-hidden="true" tabindex="-1"></a><span class="st">    # Days without an observation on the previous day (first observation in a series)</span></span>
<span id="cb19-6"><a href="#cb19-6" aria-hidden="true" tabindex="-1"></a><span class="st">    # No autoregressive term</span></span>
<span id="cb19-7"><a href="#cb19-7" aria-hidden="true" tabindex="-1"></a><span class="st">    </span></span>
<span id="cb19-8"><a href="#cb19-8" aria-hidden="true" tabindex="-1"></a><span class="st">    for (i in 1:nFirstObsRows){</span></span>
<span id="cb19-9"><a href="#cb19-9" aria-hidden="true" tabindex="-1"></a><span class="st">      temp[firstObsRows[i]] ~ dnorm(stream.mu[firstObsRows[i]], pow(sigma, -2)) </span></span>
<span id="cb19-10"><a href="#cb19-10" aria-hidden="true" tabindex="-1"></a><span class="st">      stream.mu[firstObsRows[i]] &lt;- trend[firstObsRows[i]]</span></span>
<span id="cb19-11"><a href="#cb19-11" aria-hidden="true" tabindex="-1"></a><span class="st">      trend[firstObsRows[i]] &lt;- inprod(B.0[], X.0[firstObsRows[i], ]) + inprod(B.year[year[firstObsRows[i]], ], X.year[firstObsRows[i], ])</span></span>
<span id="cb19-12"><a href="#cb19-12" aria-hidden="true" tabindex="-1"></a><span class="st">      }</span></span>
<span id="cb19-13"><a href="#cb19-13" aria-hidden="true" tabindex="-1"></a><span class="st">    </span></span>
<span id="cb19-14"><a href="#cb19-14" aria-hidden="true" tabindex="-1"></a><span class="st">    # Days with an observation on the previous dat (all days following the first day)</span></span>
<span id="cb19-15"><a href="#cb19-15" aria-hidden="true" tabindex="-1"></a><span class="st">    # Includes autoregressive term (ar1)</span></span>
<span id="cb19-16"><a href="#cb19-16" aria-hidden="true" tabindex="-1"></a><span class="st">    </span></span>
<span id="cb19-17"><a href="#cb19-17" aria-hidden="true" tabindex="-1"></a><span class="st">    for (i in 1:nEvalRows){ </span></span>
<span id="cb19-18"><a href="#cb19-18" aria-hidden="true" tabindex="-1"></a><span class="st">      temp[evalRows[i]] ~ dnorm(stream.mu[evalRows[i]], pow(sigma, -2))</span></span>
<span id="cb19-19"><a href="#cb19-19" aria-hidden="true" tabindex="-1"></a><span class="st">      stream.mu[evalRows[i]] &lt;- trend[evalRows[i]] + ar1[river[evalRows[i]]] * (temp[evalRows[i]-1] - trend[ evalRows[i]-1 ])</span></span>
<span id="cb19-20"><a href="#cb19-20" aria-hidden="true" tabindex="-1"></a><span class="st">      trend[evalRows[i]]  &lt;- inprod(B.0[], X.0[evalRows[i], ]) + inprod(B.year[year[evalRows[i]], ], X.year[evalRows[i], ])</span></span>
<span id="cb19-21"><a href="#cb19-21" aria-hidden="true" tabindex="-1"></a><span class="st">      }</span></span>
<span id="cb19-22"><a href="#cb19-22" aria-hidden="true" tabindex="-1"></a><span class="st">    </span></span>
<span id="cb19-23"><a href="#cb19-23" aria-hidden="true" tabindex="-1"></a><span class="st">    </span></span>
<span id="cb19-24"><a href="#cb19-24" aria-hidden="true" tabindex="-1"></a><span class="st">    ###----------------- PRIORS ---------------------###</span></span>
<span id="cb19-25"><a href="#cb19-25" aria-hidden="true" tabindex="-1"></a><span class="st">    </span></span>
<span id="cb19-26"><a href="#cb19-26" aria-hidden="true" tabindex="-1"></a><span class="st">    # ar1, hierarchical by site</span></span>
<span id="cb19-27"><a href="#cb19-27" aria-hidden="true" tabindex="-1"></a><span class="st">    for (i in 1:nRiver){</span></span>
<span id="cb19-28"><a href="#cb19-28" aria-hidden="true" tabindex="-1"></a><span class="st">      ar1[i] ~ dnorm(ar1Mean, pow(ar1SD,-2) ) T(-1,1)       </span></span>
<span id="cb19-29"><a href="#cb19-29" aria-hidden="true" tabindex="-1"></a><span class="st">    }</span></span>
<span id="cb19-30"><a href="#cb19-30" aria-hidden="true" tabindex="-1"></a><span class="st">    ar1Mean ~ dunif( -1,1 ) </span></span>
<span id="cb19-31"><a href="#cb19-31" aria-hidden="true" tabindex="-1"></a><span class="st">    ar1SD ~ dunif( 0, 2 )</span></span>
<span id="cb19-32"><a href="#cb19-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-33"><a href="#cb19-33" aria-hidden="true" tabindex="-1"></a><span class="st">    # model variance</span></span>
<span id="cb19-34"><a href="#cb19-34" aria-hidden="true" tabindex="-1"></a><span class="st">    sigma ~ dunif(0, 100)</span></span>
<span id="cb19-35"><a href="#cb19-35" aria-hidden="true" tabindex="-1"></a><span class="st">    </span></span>
<span id="cb19-36"><a href="#cb19-36" aria-hidden="true" tabindex="-1"></a><span class="st">    </span></span>
<span id="cb19-37"><a href="#cb19-37" aria-hidden="true" tabindex="-1"></a><span class="st">    # fixed effect coefficients</span></span>
<span id="cb19-38"><a href="#cb19-38" aria-hidden="true" tabindex="-1"></a><span class="st">    for (k in 1:K.0) {</span></span>
<span id="cb19-39"><a href="#cb19-39" aria-hidden="true" tabindex="-1"></a><span class="st">      B.0[k] ~ dnorm(0, 0.001)</span></span>
<span id="cb19-40"><a href="#cb19-40" aria-hidden="true" tabindex="-1"></a><span class="st">      }</span></span>
<span id="cb19-41"><a href="#cb19-41" aria-hidden="true" tabindex="-1"></a><span class="st">      </span></span>
<span id="cb19-42"><a href="#cb19-42" aria-hidden="true" tabindex="-1"></a><span class="st">      </span></span>
<span id="cb19-43"><a href="#cb19-43" aria-hidden="true" tabindex="-1"></a><span class="st">    # YEAR EFFECTS</span></span>
<span id="cb19-44"><a href="#cb19-44" aria-hidden="true" tabindex="-1"></a><span class="st">    # Priors for random effects of year</span></span>
<span id="cb19-45"><a href="#cb19-45" aria-hidden="true" tabindex="-1"></a><span class="st">    for (t in 1:Ti) { # Ti years</span></span>
<span id="cb19-46"><a href="#cb19-46" aria-hidden="true" tabindex="-1"></a><span class="st">      B.year[t, 1:L] ~ dmnorm(mu.year[ ], tau.B.year[ , ])</span></span>
<span id="cb19-47"><a href="#cb19-47" aria-hidden="true" tabindex="-1"></a><span class="st">      }</span></span>
<span id="cb19-48"><a href="#cb19-48" aria-hidden="true" tabindex="-1"></a><span class="st">      </span></span>
<span id="cb19-49"><a href="#cb19-49" aria-hidden="true" tabindex="-1"></a><span class="st">    mu.year[1] &lt;- 0</span></span>
<span id="cb19-50"><a href="#cb19-50" aria-hidden="true" tabindex="-1"></a><span class="st">    </span></span>
<span id="cb19-51"><a href="#cb19-51" aria-hidden="true" tabindex="-1"></a><span class="st">    for (l in 2:L) {</span></span>
<span id="cb19-52"><a href="#cb19-52" aria-hidden="true" tabindex="-1"></a><span class="st">      mu.year[l] ~ dnorm(0, 0.0001)</span></span>
<span id="cb19-53"><a href="#cb19-53" aria-hidden="true" tabindex="-1"></a><span class="st">      }</span></span>
<span id="cb19-54"><a href="#cb19-54" aria-hidden="true" tabindex="-1"></a><span class="st">      </span></span>
<span id="cb19-55"><a href="#cb19-55" aria-hidden="true" tabindex="-1"></a><span class="st">    # Prior on multivariate normal std deviation</span></span>
<span id="cb19-56"><a href="#cb19-56" aria-hidden="true" tabindex="-1"></a><span class="st">    tau.B.year[1:L, 1:L] ~ dwish(W.year[ , ], df.year)</span></span>
<span id="cb19-57"><a href="#cb19-57" aria-hidden="true" tabindex="-1"></a><span class="st">    df.year &lt;- L + 1</span></span>
<span id="cb19-58"><a href="#cb19-58" aria-hidden="true" tabindex="-1"></a><span class="st">    sigma.B.year[1:L, 1:L] &lt;- inverse(tau.B.year[ , ])</span></span>
<span id="cb19-59"><a href="#cb19-59" aria-hidden="true" tabindex="-1"></a><span class="st">    for (l in 1:L) {</span></span>
<span id="cb19-60"><a href="#cb19-60" aria-hidden="true" tabindex="-1"></a><span class="st">      for (l.prime in 1:L) {</span></span>
<span id="cb19-61"><a href="#cb19-61" aria-hidden="true" tabindex="-1"></a><span class="st">        rho.B.year[l, l.prime] &lt;- sigma.B.year[l, l.prime]/sqrt(sigma.B.year[l, l]*sigma.B.year[l.prime, l.prime])</span></span>
<span id="cb19-62"><a href="#cb19-62" aria-hidden="true" tabindex="-1"></a><span class="st">        }</span></span>
<span id="cb19-63"><a href="#cb19-63" aria-hidden="true" tabindex="-1"></a><span class="st">      sigma.b.year[l] &lt;- sqrt(sigma.B.year[l, l])</span></span>
<span id="cb19-64"><a href="#cb19-64" aria-hidden="true" tabindex="-1"></a><span class="st">    }</span></span>
<span id="cb19-65"><a href="#cb19-65" aria-hidden="true" tabindex="-1"></a><span class="st">    </span></span>
<span id="cb19-66"><a href="#cb19-66" aria-hidden="true" tabindex="-1"></a><span class="st">    </span></span>
<span id="cb19-67"><a href="#cb19-67" aria-hidden="true" tabindex="-1"></a><span class="st">    ###----------------- DERIVED VALUES -------------###</span></span>
<span id="cb19-68"><a href="#cb19-68" aria-hidden="true" tabindex="-1"></a><span class="st">    residuals[1] &lt;- 0 # hold the place. Not sure if this is necessary...</span></span>
<span id="cb19-69"><a href="#cb19-69" aria-hidden="true" tabindex="-1"></a><span class="st">    for (i in 2:n) {</span></span>
<span id="cb19-70"><a href="#cb19-70" aria-hidden="true" tabindex="-1"></a><span class="st">      residuals[i] &lt;- temp[i] - stream.mu[i]</span></span>
<span id="cb19-71"><a href="#cb19-71" aria-hidden="true" tabindex="-1"></a><span class="st">    }</span></span>
<span id="cb19-72"><a href="#cb19-72" aria-hidden="true" tabindex="-1"></a><span class="st">    </span></span>
<span id="cb19-73"><a href="#cb19-73" aria-hidden="true" tabindex="-1"></a><span class="st">    }"</span>, <span class="at">file =</span> <span class="st">"JAGS models/DailyTempModelJAGS_Letcher.txt"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="organize-objects" class="level3" data-number="5.1.3">
<h3 data-number="5.1.3" class="anchored" data-anchor-id="organize-objects"><span class="header-section-number">5.1.3</span> Organize objects</h3>
<p>Get first observation indices and check that nFirstRowObs equals the number of unique site-years: <strong>must be TRUE!</strong></p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a><span class="co"># row indices for first observation in each site-year</span></span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a>firstObsRows <span class="ot">&lt;-</span> <span class="fu">unlist</span>(tempDataSyncS <span class="sc">%&gt;%</span> </span>
<span id="cb20-3"><a href="#cb20-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(siteYear) <span class="sc">%&gt;%</span></span>
<span id="cb20-4"><a href="#cb20-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="at">index =</span> rowNum[<span class="fu">min</span>(<span class="fu">which</span>(<span class="sc">!</span><span class="fu">is.na</span>(temp)))]) <span class="sc">%&gt;%</span></span>
<span id="cb20-5"><a href="#cb20-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb20-6"><a href="#cb20-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(index))</span>
<span id="cb20-7"><a href="#cb20-7" aria-hidden="true" tabindex="-1"></a>nFirstObsRows <span class="ot">&lt;-</span> <span class="fu">length</span>(firstObsRows)</span>
<span id="cb20-8"><a href="#cb20-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-9"><a href="#cb20-9" aria-hidden="true" tabindex="-1"></a><span class="co"># does the number of first observations match the number of site years?</span></span>
<span id="cb20-10"><a href="#cb20-10" aria-hidden="true" tabindex="-1"></a>nFirstObsRows <span class="sc">==</span> <span class="fu">length</span>(<span class="fu">unique</span>(tempDataSyncS<span class="sc">$</span>siteYear))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>[1] TRUE</code></pre>
</div>
</div>
<p>Get row indices for all other observations</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a>evalRows <span class="ot">&lt;-</span> <span class="fu">unlist</span>(tempDataSyncS <span class="sc">%&gt;%</span> <span class="fu">filter</span>(<span class="sc">!</span>rowNum <span class="sc">%in%</span> firstObsRows) <span class="sc">%&gt;%</span> <span class="fu">select</span>(rowNum))</span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a>nEvalRows <span class="ot">&lt;-</span> <span class="fu">length</span>(evalRows)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>Fixed and random effect data</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a>data.fixed <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">intercept =</span> <span class="dv">1</span></span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a>                         ,<span class="at">airTemp =</span> tempDataSyncS<span class="sc">$</span>airTemp </span>
<span id="cb23-3"><a href="#cb23-3" aria-hidden="true" tabindex="-1"></a>                         ,<span class="at">airTempLag1 =</span> tempDataSyncS<span class="sc">$</span>airTempLagged1</span>
<span id="cb23-4"><a href="#cb23-4" aria-hidden="true" tabindex="-1"></a>                         ,<span class="at">airTempLag2 =</span> tempDataSyncS<span class="sc">$</span>airTempLagged2</span>
<span id="cb23-5"><a href="#cb23-5" aria-hidden="true" tabindex="-1"></a>                         </span>
<span id="cb23-6"><a href="#cb23-6" aria-hidden="true" tabindex="-1"></a>                         ,<span class="at">flow =</span>  tempDataSyncS<span class="sc">$</span>flowLS</span>
<span id="cb23-7"><a href="#cb23-7" aria-hidden="true" tabindex="-1"></a>                         </span>
<span id="cb23-8"><a href="#cb23-8" aria-hidden="true" tabindex="-1"></a>                         ,<span class="at">airFlow =</span> tempDataSyncS<span class="sc">$</span>airTemp <span class="sc">*</span> tempDataSyncS<span class="sc">$</span>flowLS</span>
<span id="cb23-9"><a href="#cb23-9" aria-hidden="true" tabindex="-1"></a><span class="co">#                         ,air1Flow = tempDataSyncS$airTempLagged1 * tempDataSyncS$flowLS</span></span>
<span id="cb23-10"><a href="#cb23-10" aria-hidden="true" tabindex="-1"></a><span class="co">#                         ,air2Flow = tempDataSyncS$airTempLagged2 * tempDataSyncS$flowLS</span></span>
<span id="cb23-11"><a href="#cb23-11" aria-hidden="true" tabindex="-1"></a>                         </span>
<span id="cb23-12"><a href="#cb23-12" aria-hidden="true" tabindex="-1"></a>                         <span class="co">#main river effects</span></span>
<span id="cb23-13"><a href="#cb23-13" aria-hidden="true" tabindex="-1"></a>                         ,<span class="at">river1 =</span> tempDataSyncS<span class="sc">$</span>river1</span>
<span id="cb23-14"><a href="#cb23-14" aria-hidden="true" tabindex="-1"></a>                         ,<span class="at">river2 =</span> tempDataSyncS<span class="sc">$</span>river2</span>
<span id="cb23-15"><a href="#cb23-15" aria-hidden="true" tabindex="-1"></a>                         ,<span class="at">river3 =</span> tempDataSyncS<span class="sc">$</span>river3</span>
<span id="cb23-16"><a href="#cb23-16" aria-hidden="true" tabindex="-1"></a>                         </span>
<span id="cb23-17"><a href="#cb23-17" aria-hidden="true" tabindex="-1"></a>                         <span class="co">#river interaction with air temp</span></span>
<span id="cb23-18"><a href="#cb23-18" aria-hidden="true" tabindex="-1"></a>                         ,<span class="at">river1Air =</span> tempDataSyncS<span class="sc">$</span>river1 <span class="sc">*</span> tempDataSyncS<span class="sc">$</span>airTemp</span>
<span id="cb23-19"><a href="#cb23-19" aria-hidden="true" tabindex="-1"></a>                         ,<span class="at">river2Air =</span> tempDataSyncS<span class="sc">$</span>river2 <span class="sc">*</span> tempDataSyncS<span class="sc">$</span>airTemp</span>
<span id="cb23-20"><a href="#cb23-20" aria-hidden="true" tabindex="-1"></a>                         ,<span class="at">river3Air =</span> tempDataSyncS<span class="sc">$</span>river3 <span class="sc">*</span> tempDataSyncS<span class="sc">$</span>airTemp</span>
<span id="cb23-21"><a href="#cb23-21" aria-hidden="true" tabindex="-1"></a>                         </span>
<span id="cb23-22"><a href="#cb23-22" aria-hidden="true" tabindex="-1"></a>                          ) </span>
<span id="cb23-23"><a href="#cb23-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-24"><a href="#cb23-24" aria-hidden="true" tabindex="-1"></a>data.random.years <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">intercept.year =</span> <span class="dv">1</span>, </span>
<span id="cb23-25"><a href="#cb23-25" aria-hidden="true" tabindex="-1"></a>                     <span class="at">dOY  =</span> tempDataSyncS<span class="sc">$</span>dOY, </span>
<span id="cb23-26"><a href="#cb23-26" aria-hidden="true" tabindex="-1"></a>                     <span class="at">dOY2 =</span> tempDataSyncS<span class="sc">$</span>dOY<span class="sc">^</span><span class="dv">2</span>,</span>
<span id="cb23-27"><a href="#cb23-27" aria-hidden="true" tabindex="-1"></a>                     <span class="at">dOY3 =</span> tempDataSyncS<span class="sc">$</span>dOY<span class="sc">^</span><span class="dv">3</span></span>
<span id="cb23-28"><a href="#cb23-28" aria-hidden="true" tabindex="-1"></a>                     )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>Misc. objects</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a>Ti <span class="ot">&lt;-</span> <span class="fu">length</span>(<span class="fu">unique</span>(tempDataSyncS<span class="sc">$</span>year))</span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a>L <span class="ot">&lt;-</span> <span class="fu">dim</span>(data.random.years)[<span class="dv">2</span>]</span>
<span id="cb24-3"><a href="#cb24-3" aria-hidden="true" tabindex="-1"></a>W.year <span class="ot">&lt;-</span> <span class="fu">diag</span>(L)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>Combine data in list</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a><span class="co"># combine data in a list</span></span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a>jags.data <span class="ot">&lt;-</span> <span class="fu">list</span>(<span class="st">"temp"</span> <span class="ot">=</span> tempDataSyncS<span class="sc">$</span>temp,</span>
<span id="cb25-3"><a href="#cb25-3" aria-hidden="true" tabindex="-1"></a>                  <span class="st">"nFirstObsRows"</span> <span class="ot">=</span> nFirstObsRows,</span>
<span id="cb25-4"><a href="#cb25-4" aria-hidden="true" tabindex="-1"></a>                  <span class="st">"firstObsRows"</span> <span class="ot">=</span> firstObsRows,</span>
<span id="cb25-5"><a href="#cb25-5" aria-hidden="true" tabindex="-1"></a>                  <span class="st">"nEvalRows"</span> <span class="ot">=</span> nEvalRows,</span>
<span id="cb25-6"><a href="#cb25-6" aria-hidden="true" tabindex="-1"></a>                  <span class="st">"evalRows"</span> <span class="ot">=</span> evalRows,</span>
<span id="cb25-7"><a href="#cb25-7" aria-hidden="true" tabindex="-1"></a>                  <span class="st">"X.0"</span> <span class="ot">=</span> data.fixed,</span>
<span id="cb25-8"><a href="#cb25-8" aria-hidden="true" tabindex="-1"></a>                  <span class="st">"X.year"</span> <span class="ot">=</span> data.random.years,</span>
<span id="cb25-9"><a href="#cb25-9" aria-hidden="true" tabindex="-1"></a>                  <span class="st">"K.0"</span> <span class="ot">=</span> <span class="fu">dim</span>(data.fixed)[<span class="dv">2</span>],</span>
<span id="cb25-10"><a href="#cb25-10" aria-hidden="true" tabindex="-1"></a>                  <span class="st">"nRiver"</span> <span class="ot">=</span> <span class="fu">length</span>(<span class="fu">unique</span>(tempDataSyncS<span class="sc">$</span>site)),</span>
<span id="cb25-11"><a href="#cb25-11" aria-hidden="true" tabindex="-1"></a>                  <span class="st">"Ti"</span> <span class="ot">=</span> Ti,</span>
<span id="cb25-12"><a href="#cb25-12" aria-hidden="true" tabindex="-1"></a>                  <span class="st">"L"</span> <span class="ot">=</span> L,</span>
<span id="cb25-13"><a href="#cb25-13" aria-hidden="true" tabindex="-1"></a>                  <span class="st">"W.year"</span> <span class="ot">=</span> W.year,</span>
<span id="cb25-14"><a href="#cb25-14" aria-hidden="true" tabindex="-1"></a>                  <span class="st">"n"</span> <span class="ot">=</span> <span class="fu">dim</span>(tempDataSyncS)[<span class="dv">1</span>],</span>
<span id="cb25-15"><a href="#cb25-15" aria-hidden="true" tabindex="-1"></a>                  <span class="st">"year"</span> <span class="ot">=</span> <span class="fu">as.factor</span>(tempDataSyncS<span class="sc">$</span>year),</span>
<span id="cb25-16"><a href="#cb25-16" aria-hidden="true" tabindex="-1"></a>                  <span class="st">"river"</span> <span class="ot">=</span> <span class="fu">as.factor</span>(tempDataSyncS<span class="sc">$</span>riverOrdered)</span>
<span id="cb25-17"><a href="#cb25-17" aria-hidden="true" tabindex="-1"></a>                  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>Parameters to monitor</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a>jags.params <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"residuals"</span>,</span>
<span id="cb26-2"><a href="#cb26-2" aria-hidden="true" tabindex="-1"></a>            <span class="st">"deviance"</span>,</span>
<span id="cb26-3"><a href="#cb26-3" aria-hidden="true" tabindex="-1"></a> <span class="co">#           "pD",</span></span>
<span id="cb26-4"><a href="#cb26-4" aria-hidden="true" tabindex="-1"></a>            <span class="st">"sigma"</span>,</span>
<span id="cb26-5"><a href="#cb26-5" aria-hidden="true" tabindex="-1"></a>            <span class="st">"B.0"</span>,</span>
<span id="cb26-6"><a href="#cb26-6" aria-hidden="true" tabindex="-1"></a>            <span class="st">"B.year"</span>,</span>
<span id="cb26-7"><a href="#cb26-7" aria-hidden="true" tabindex="-1"></a>            <span class="st">"rho.B.year"</span>,</span>
<span id="cb26-8"><a href="#cb26-8" aria-hidden="true" tabindex="-1"></a>            <span class="st">"mu.year"</span>,</span>
<span id="cb26-9"><a href="#cb26-9" aria-hidden="true" tabindex="-1"></a>            <span class="st">"sigma.b.year"</span>,</span>
<span id="cb26-10"><a href="#cb26-10" aria-hidden="true" tabindex="-1"></a>            <span class="st">"stream.mu"</span>,</span>
<span id="cb26-11"><a href="#cb26-11" aria-hidden="true" tabindex="-1"></a>            <span class="st">"ar1"</span> ,</span>
<span id="cb26-12"><a href="#cb26-12" aria-hidden="true" tabindex="-1"></a>            <span class="st">"ar1Mean"</span>,</span>
<span id="cb26-13"><a href="#cb26-13" aria-hidden="true" tabindex="-1"></a>            <span class="st">"ar1SD"</span>,</span>
<span id="cb26-14"><a href="#cb26-14" aria-hidden="true" tabindex="-1"></a>            <span class="st">"temp"</span></span>
<span id="cb26-15"><a href="#cb26-15" aria-hidden="true" tabindex="-1"></a>            )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="fit-model" class="level3" data-number="5.1.4">
<h3 data-number="5.1.4" class="anchored" data-anchor-id="fit-model"><span class="header-section-number">5.1.4</span> Fit model</h3>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a>fit0 <span class="ot">&lt;-</span> <span class="fu">jags.parallel</span>(<span class="at">data =</span> jags.data, <span class="at">inits =</span> <span class="cn">NULL</span>, <span class="at">parameters.to.save =</span> jags.params, <span class="at">model.file =</span> <span class="st">"JAGS models/DailyTempModelJAGS_Letcher.txt"</span>,</span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a>            <span class="at">n.chains =</span> <span class="dv">10</span>, <span class="at">n.thin =</span> <span class="dv">5</span>, <span class="at">n.burnin =</span> <span class="dv">500</span>, <span class="at">n.iter =</span> <span class="dv">1500</span>, <span class="at">DIC =</span> <span class="cn">TRUE</span>)</span>
<span id="cb27-3"><a href="#cb27-3" aria-hidden="true" tabindex="-1"></a><span class="fu">beep</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<section id="save-model-output" class="level4" data-number="5.1.4.1">
<h4 data-number="5.1.4.1" class="anchored" data-anchor-id="save-model-output"><span class="header-section-number">5.1.4.1</span> Save model output</h4>
<p>Save to file</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a><span class="fu">saveRDS</span>(fit0, <span class="st">"Model objects/LetcherTempModel_PeerJ2016.RDS"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>Read in fitted model object</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a>fit0 <span class="ot">&lt;-</span> <span class="fu">readRDS</span>(<span class="st">"Model objects/LetcherTempModel_PeerJ2016.RDS"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>Get MCMC samples and summary</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a>top_mod <span class="ot">&lt;-</span> fit0</span>
<span id="cb30-2"><a href="#cb30-2" aria-hidden="true" tabindex="-1"></a><span class="co"># generate MCMC samples and store as an array</span></span>
<span id="cb30-3"><a href="#cb30-3" aria-hidden="true" tabindex="-1"></a>modelout <span class="ot">&lt;-</span> top_mod<span class="sc">$</span>BUGSoutput</span>
<span id="cb30-4"><a href="#cb30-4" aria-hidden="true" tabindex="-1"></a>McmcList <span class="ot">&lt;-</span> <span class="fu">vector</span>(<span class="st">"list"</span>, <span class="at">length =</span> <span class="fu">dim</span>(modelout<span class="sc">$</span>sims.array)[<span class="dv">2</span>])</span>
<span id="cb30-5"><a href="#cb30-5" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(McmcList)) { McmcList[[i]] <span class="ot">=</span> <span class="fu">as.mcmc</span>(modelout<span class="sc">$</span>sims.array[,i,]) }</span>
<span id="cb30-6"><a href="#cb30-6" aria-hidden="true" tabindex="-1"></a><span class="co"># rbind MCMC samples from 10 chains </span></span>
<span id="cb30-7"><a href="#cb30-7" aria-hidden="true" tabindex="-1"></a>Mcmcdat <span class="ot">&lt;-</span> <span class="fu">rbind</span>(McmcList[[<span class="dv">1</span>]], McmcList[[<span class="dv">2</span>]], McmcList[[<span class="dv">3</span>]], McmcList[[<span class="dv">4</span>]], McmcList[[<span class="dv">5</span>]], McmcList[[<span class="dv">6</span>]], McmcList[[<span class="dv">7</span>]], McmcList[[<span class="dv">8</span>]], McmcList[[<span class="dv">9</span>]], McmcList[[<span class="dv">10</span>]])</span>
<span id="cb30-8"><a href="#cb30-8" aria-hidden="true" tabindex="-1"></a>param.summary <span class="ot">&lt;-</span> modelout<span class="sc">$</span>summary</span>
<span id="cb30-9"><a href="#cb30-9" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(param.summary)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>             mean         sd       2.5%        25%        50%        75%
B.0[1] 15.0942825 0.17271642 14.7510778 14.9831293 15.0931367 15.2073322
B.0[2]  1.5201578 0.02723257  1.4673158  1.5016734  1.5199031  1.5390533
B.0[3]  0.1955279 0.01619090  0.1631752  0.1845110  0.1954986  0.2069212
B.0[4]  0.1545523 0.01642121  0.1208057  0.1442824  0.1542702  0.1647775
B.0[5]  0.3629916 0.01520228  0.3334788  0.3523900  0.3635001  0.3730769
B.0[6] -0.1292206 0.01180889 -0.1523336 -0.1368216 -0.1290627 -0.1214532
            97.5%      Rhat n.eff
B.0[1] 15.4398786 1.0038273  1000
B.0[2]  1.5732813 1.0034739  1100
B.0[3]  0.2254210 0.9999951  2000
B.0[4]  0.1871898 1.0028484  1300
B.0[5]  0.3919732 1.0006563  2000
B.0[6] -0.1065415 0.9998802  2000</code></pre>
</div>
</div>
</section>
<section id="check-convergence" class="level4" data-number="5.1.4.2">
<h4 data-number="5.1.4.2" class="anchored" data-anchor-id="check-convergence"><span class="header-section-number">5.1.4.2</span> Check convergence</h4>
<p>Any problematic R-hat values (&gt;1.05)?</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb32"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a>top_mod<span class="sc">$</span>BUGSoutput<span class="sc">$</span>summary[,<span class="dv">8</span>][top_mod<span class="sc">$</span>BUGSoutput<span class="sc">$</span>summary[,<span class="dv">8</span>] <span class="sc">&gt;</span> <span class="fl">1.05</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>named numeric(0)</code></pre>
</div>
</div>
<p>View traceplots</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb34"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a><span class="fu">MCMCtrace</span>(top_mod, <span class="at">ind =</span> <span class="cn">TRUE</span>, </span>
<span id="cb34-2"><a href="#cb34-2" aria-hidden="true" tabindex="-1"></a>          <span class="at">params =</span> <span class="fu">c</span>(<span class="st">"B.0"</span>, <span class="st">"mu.year"</span>, </span>
<span id="cb34-3"><a href="#cb34-3" aria-hidden="true" tabindex="-1"></a>                     <span class="st">"ar1"</span>, </span>
<span id="cb34-4"><a href="#cb34-4" aria-hidden="true" tabindex="-1"></a>                     <span class="st">"sigma"</span>), <span class="at">pdf =</span> <span class="cn">FALSE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="ModelTemp-Letcher_files/figure-html/unnamed-chunk-21-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="ModelTemp-Letcher_files/figure-html/unnamed-chunk-21-2.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="ModelTemp-Letcher_files/figure-html/unnamed-chunk-21-3.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="ModelTemp-Letcher_files/figure-html/unnamed-chunk-21-4.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="ModelTemp-Letcher_files/figure-html/unnamed-chunk-21-5.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="ModelTemp-Letcher_files/figure-html/unnamed-chunk-21-6.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="ModelTemp-Letcher_files/figure-html/unnamed-chunk-21-7.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>Convert to ggs object</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb35"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a>ggfit <span class="ot">&lt;-</span> <span class="fu">ggs</span>(<span class="fu">as.mcmc</span>(top_mod), <span class="at">keep_original_order =</span> <span class="cn">TRUE</span>)</span>
<span id="cb35-2"><a href="#cb35-2" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(ggfit)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 6 Ã— 4
  Iteration Chain Parameter value
      &lt;int&gt; &lt;int&gt; &lt;fct&gt;     &lt;dbl&gt;
1         1     1 ar1[1]    0.773
2         2     1 ar1[1]    0.799
3         3     1 ar1[1]    0.817
4         4     1 ar1[1]    0.796
5         5     1 ar1[1]    0.811
6         6     1 ar1[1]    0.801</code></pre>
</div>
</div>
</section>
</section>
<section id="goodness-of-fit" class="level3" data-number="5.1.5">
<h3 data-number="5.1.5" class="anchored" data-anchor-id="goodness-of-fit"><span class="header-section-number">5.1.5</span> Goodness of fit</h3>
<p>Format observed and predicted values</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb37"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a>Mcmcdat <span class="ot">&lt;-</span> <span class="fu">as_tibble</span>(Mcmcdat)</span>
<span id="cb37-2"><a href="#cb37-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-3"><a href="#cb37-3" aria-hidden="true" tabindex="-1"></a><span class="co"># subset expected and observed MCMC samples</span></span>
<span id="cb37-4"><a href="#cb37-4" aria-hidden="true" tabindex="-1"></a>ppdat_exp <span class="ot">&lt;-</span> <span class="fu">as.matrix</span>(Mcmcdat[,<span class="fu">startsWith</span>(<span class="fu">names</span>(Mcmcdat), <span class="st">"stream.mu["</span>)])</span>
<span id="cb37-5"><a href="#cb37-5" aria-hidden="true" tabindex="-1"></a>ppdat_obs <span class="ot">&lt;-</span> <span class="fu">as.matrix</span>(Mcmcdat[,<span class="fu">startsWith</span>(<span class="fu">names</span>(Mcmcdat), <span class="st">"temp["</span>)])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>Bayesian p-value</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb38"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a><span class="fu">sum</span>(ppdat_exp <span class="sc">&gt;</span> ppdat_obs) <span class="sc">/</span> (<span class="fu">dim</span>(ppdat_obs)[<span class="dv">1</span>]<span class="sc">*</span><span class="fu">dim</span>(ppdat_obs)[<span class="dv">2</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.4975728</code></pre>
</div>
</div>
<p>PP-check, global</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb40"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb40-1"><a href="#cb40-1" aria-hidden="true" tabindex="-1"></a>ppdat_obs_mean <span class="ot">&lt;-</span> <span class="fu">apply</span>(ppdat_obs, <span class="dv">2</span>, mean)</span>
<span id="cb40-2"><a href="#cb40-2" aria-hidden="true" tabindex="-1"></a>ppdat_exp_mean <span class="ot">&lt;-</span> <span class="fu">apply</span>(ppdat_exp, <span class="dv">2</span>, mean)</span>
<span id="cb40-3"><a href="#cb40-3" aria-hidden="true" tabindex="-1"></a><span class="fu">tibble</span>(<span class="at">obs =</span> ppdat_obs_mean, <span class="at">exp =</span> ppdat_exp_mean) <span class="sc">%&gt;%</span> </span>
<span id="cb40-4"><a href="#cb40-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> obs, <span class="at">y =</span> exp)) <span class="sc">+</span> </span>
<span id="cb40-5"><a href="#cb40-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">alpha =</span> <span class="fl">0.1</span>) <span class="sc">+</span> </span>
<span id="cb40-6"><a href="#cb40-6" aria-hidden="true" tabindex="-1"></a>  <span class="co"># geom_smooth(method = "lm") +</span></span>
<span id="cb40-7"><a href="#cb40-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_abline</span>(<span class="at">intercept =</span> <span class="dv">0</span>, <span class="at">slope =</span> <span class="dv">1</span>, <span class="at">color =</span> <span class="st">"red"</span>) <span class="sc">+</span> </span>
<span id="cb40-8"><a href="#cb40-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>() <span class="sc">+</span> <span class="fu">theme</span>(<span class="at">panel.grid =</span> <span class="fu">element_blank</span>()) <span class="sc">+</span></span>
<span id="cb40-9"><a href="#cb40-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="st">"Observed"</span>) <span class="sc">+</span> <span class="fu">ylab</span>(<span class="st">"Predicted (mean)"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="ModelTemp-Letcher_files/figure-html/unnamed-chunk-25-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>PP-check by river and year</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb41"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb41-1"><a href="#cb41-1" aria-hidden="true" tabindex="-1"></a><span class="fu">tibble</span>(<span class="at">obs =</span> ppdat_obs_mean, <span class="at">exp =</span> ppdat_exp_mean, <span class="at">river =</span> tempDataSyncS<span class="sc">$</span>riverOrdered, <span class="at">year =</span> tempDataSyncS<span class="sc">$</span>year) <span class="sc">%&gt;%</span> </span>
<span id="cb41-2"><a href="#cb41-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> obs, <span class="at">y =</span> exp)) <span class="sc">+</span> </span>
<span id="cb41-3"><a href="#cb41-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">alpha =</span> <span class="fl">0.1</span>) <span class="sc">+</span> </span>
<span id="cb41-4"><a href="#cb41-4" aria-hidden="true" tabindex="-1"></a>  <span class="co"># geom_smooth(method = "lm") +</span></span>
<span id="cb41-5"><a href="#cb41-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_abline</span>(<span class="at">intercept =</span> <span class="dv">0</span>, <span class="at">slope =</span> <span class="dv">1</span>, <span class="at">color =</span> <span class="st">"red"</span>) <span class="sc">+</span> </span>
<span id="cb41-6"><a href="#cb41-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>() <span class="sc">+</span> <span class="fu">theme</span>(<span class="at">panel.grid =</span> <span class="fu">element_blank</span>()) <span class="sc">+</span></span>
<span id="cb41-7"><a href="#cb41-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="st">"Observed"</span>) <span class="sc">+</span> <span class="fu">ylab</span>(<span class="st">"Predicted (mean)"</span>) <span class="sc">+</span></span>
<span id="cb41-8"><a href="#cb41-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_grid</span>(year <span class="sc">~</span> river)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="ModelTemp-Letcher_files/figure-html/unnamed-chunk-26-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="plot-model-output" class="level3" data-number="5.1.6">
<h3 data-number="5.1.6" class="anchored" data-anchor-id="plot-model-output"><span class="header-section-number">5.1.6</span> Plot model output</h3>
<p><em>Output is identical to Letcher et al.&nbsp;(2016), as expected</em></p>
<section id="dot-plots" class="level4" data-number="5.1.6.1">
<h4 data-number="5.1.6.1" class="anchored" data-anchor-id="dot-plots"><span class="header-section-number">5.1.6.1</span> Dot plots</h4>
<div class="tabset-margin-container"></div><div class="panel-tabset">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-2-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-2-1" role="tab" aria-controls="tabset-2-1" aria-selected="true">Intercept</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-2-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-2-2" role="tab" aria-controls="tabset-2-2" aria-selected="false">Betas</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-2-3-tab" data-bs-toggle="tab" data-bs-target="#tabset-2-3" role="tab" aria-controls="tabset-2-3" aria-selected="false">Autoregressive terms</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-2-4-tab" data-bs-toggle="tab" data-bs-target="#tabset-2-4" role="tab" aria-controls="tabset-2-4" aria-selected="false">Within year trends</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-2-5-tab" data-bs-toggle="tab" data-bs-target="#tabset-2-5" role="tab" aria-controls="tabset-2-5" aria-selected="false">Site-specific intercepts</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-2-6-tab" data-bs-toggle="tab" data-bs-target="#tabset-2-6" role="tab" aria-controls="tabset-2-6" aria-selected="false">Site specific slopes</a></li></ul>
<div class="tab-content">
<div id="tabset-2-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-2-1-tab">
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb42"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb42-1"><a href="#cb42-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggs_caterpillar</span>(ggfit <span class="sc">%&gt;%</span> <span class="fu">filter</span>(Parameter <span class="sc">==</span> <span class="st">"B.0[1]"</span>), <span class="at">sort =</span> <span class="cn">FALSE</span>) <span class="sc">+</span> <span class="fu">scale_y_discrete</span>(<span class="at">labels =</span> <span class="st">"Intercept"</span>) <span class="sc">+</span> <span class="fu">theme_bw</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="ModelTemp-Letcher_files/figure-html/unnamed-chunk-27-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</div>
<div id="tabset-2-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-2-2-tab">
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb43"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb43-1"><a href="#cb43-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggs_caterpillar</span>(ggfit <span class="sc">%&gt;%</span> <span class="fu">filter</span>(Parameter <span class="sc">%in%</span> <span class="fu">grep</span>(<span class="st">"B.0"</span>, <span class="fu">unique</span>(ggfit<span class="sc">$</span>Parameter), <span class="at">value =</span> <span class="cn">TRUE</span>)[<span class="sc">-</span><span class="dv">1</span>]) <span class="sc">%&gt;%</span></span>
<span id="cb43-2"><a href="#cb43-2" aria-hidden="true" tabindex="-1"></a>                  <span class="fu">mutate</span>(<span class="at">Parameter =</span> <span class="fu">factor</span>(Parameter, <span class="at">levels =</span> <span class="fu">c</span>(<span class="st">"B.0[2]"</span>, <span class="st">"B.0[3]"</span>, <span class="st">"B.0[4]"</span>, <span class="st">"B.0[5]"</span>, <span class="st">"B.0[6]"</span>, </span>
<span id="cb43-3"><a href="#cb43-3" aria-hidden="true" tabindex="-1"></a>                                                                  <span class="st">"B.0[7]"</span>, <span class="st">"B.0[8]"</span>, <span class="st">"B.0[9]"</span>, <span class="st">"B.0[10]"</span>, <span class="st">"B.0[11]"</span>, <span class="st">"B.0[12]"</span>))),</span>
<span id="cb43-4"><a href="#cb43-4" aria-hidden="true" tabindex="-1"></a>                <span class="at">sort =</span> <span class="cn">FALSE</span>) <span class="sc">+</span> <span class="fu">scale_y_discrete</span>(<span class="at">labels =</span> <span class="fu">rev</span>(<span class="fu">c</span>(<span class="st">"T"</span>, <span class="st">"T(d-1)"</span>, <span class="st">"T(d-2)"</span>, <span class="st">"F"</span>, <span class="st">"T*F"</span>, <span class="st">"OL"</span>, <span class="st">"OS"</span>, <span class="st">"IS"</span>, <span class="st">"OL*T"</span>, <span class="st">"OS*T"</span>, <span class="st">"IS*T"</span>)), <span class="at">limits =</span> rev) <span class="sc">+</span> <span class="fu">theme_bw</span>() <span class="sc">+</span> <span class="fu">geom_vline</span>(<span class="at">xintercept =</span> <span class="dv">0</span>, <span class="at">linetype =</span> <span class="st">"dashed"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="ModelTemp-Letcher_files/figure-html/unnamed-chunk-28-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</div>
<div id="tabset-2-3" class="tab-pane" role="tabpanel" aria-labelledby="tabset-2-3-tab">
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb44"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb44-1"><a href="#cb44-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggs_caterpillar</span>(ggfit <span class="sc">%&gt;%</span> <span class="fu">filter</span>(Parameter <span class="sc">%in%</span> <span class="fu">grep</span>(<span class="st">"ar1"</span>, <span class="fu">unique</span>(ggfit<span class="sc">$</span>Parameter), <span class="at">value =</span> <span class="cn">TRUE</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb44-2"><a href="#cb44-2" aria-hidden="true" tabindex="-1"></a>                  <span class="fu">mutate</span>(<span class="at">Parameter =</span> <span class="fu">factor</span>(Parameter, <span class="at">levels =</span> <span class="fu">c</span>(<span class="st">"ar1Mean"</span>, <span class="st">"ar1SD"</span>, <span class="st">"ar1[1]"</span>, <span class="st">"ar1[2]"</span>, <span class="st">"ar1[3]"</span>, <span class="st">"ar1[4]"</span>))),</span>
<span id="cb44-3"><a href="#cb44-3" aria-hidden="true" tabindex="-1"></a>                <span class="at">sort =</span> <span class="cn">FALSE</span>) <span class="sc">+</span> <span class="fu">scale_y_discrete</span>(<span class="at">labels =</span> <span class="fu">rev</span>(<span class="fu">c</span>(<span class="st">"ar1Mean"</span>, <span class="st">"ar1SD"</span>, <span class="st">"ar1[WB]"</span>, <span class="st">"ar1[OL]"</span>, <span class="st">"ar1[OS]"</span>, <span class="st">"ar1[IL]"</span>)), <span class="at">limits =</span> rev) <span class="sc">+</span> <span class="fu">theme_bw</span>() <span class="sc">+</span> <span class="fu">xlim</span>(<span class="dv">0</span>,<span class="dv">1</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="ModelTemp-Letcher_files/figure-html/unnamed-chunk-29-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</div>
<div id="tabset-2-4" class="tab-pane" role="tabpanel" aria-labelledby="tabset-2-4-tab">
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb45"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb45-1"><a href="#cb45-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggs_caterpillar</span>(ggfit, <span class="at">family =</span> <span class="st">"mu.year"</span>, <span class="at">sort =</span> <span class="cn">FALSE</span>) <span class="sc">+</span> <span class="fu">scale_y_discrete</span>(<span class="at">labels =</span> <span class="fu">rev</span>(<span class="fu">c</span>(<span class="st">"Intercept"</span>, <span class="st">"Linear"</span>, <span class="st">"Quadratic"</span>, <span class="st">"Cubic"</span>)), <span class="at">limits =</span> rev) <span class="sc">+</span> <span class="fu">theme_bw</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="ModelTemp-Letcher_files/figure-html/unnamed-chunk-30-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</div>
<div id="tabset-2-5" class="tab-pane" role="tabpanel" aria-labelledby="tabset-2-5-tab">
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb46"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb46-1"><a href="#cb46-1" aria-hidden="true" tabindex="-1"></a>ggfit <span class="sc">%&gt;%</span> </span>
<span id="cb46-2"><a href="#cb46-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(Parameter <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"B.0[1]"</span>, <span class="st">"B.0[7]"</span>, <span class="st">"B.0[8]"</span>, <span class="st">"B.0[9]"</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb46-3"><a href="#cb46-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">spread</span>(<span class="at">key =</span> Parameter, <span class="at">value =</span> value) <span class="sc">%&gt;%</span></span>
<span id="cb46-4"><a href="#cb46-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">int_WB =</span> <span class="dv">3</span>, <span class="at">os_OL =</span> <span class="dv">4</span>, <span class="at">os_OS =</span> <span class="dv">5</span>, <span class="at">os_IS =</span> <span class="dv">6</span>) <span class="sc">%&gt;%</span></span>
<span id="cb46-5"><a href="#cb46-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">int_OL =</span> int_WB <span class="sc">+</span> os_OL,</span>
<span id="cb46-6"><a href="#cb46-6" aria-hidden="true" tabindex="-1"></a>         <span class="at">int_OS =</span> int_WB <span class="sc">+</span> os_OS,</span>
<span id="cb46-7"><a href="#cb46-7" aria-hidden="true" tabindex="-1"></a>         <span class="at">int_IS =</span> int_WB <span class="sc">+</span> os_IS) <span class="sc">%&gt;%</span></span>
<span id="cb46-8"><a href="#cb46-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span><span class="fu">c</span>(os_OL, os_OS, os_IS)) <span class="sc">%&gt;%</span></span>
<span id="cb46-9"><a href="#cb46-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">gather</span>(int_WB<span class="sc">:</span>int_IS, <span class="at">key =</span> <span class="st">"Parameter"</span>, <span class="at">value =</span> <span class="st">"value"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb46-10"><a href="#cb46-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Parameter =</span> <span class="fu">factor</span>(Parameter, <span class="at">levels =</span> <span class="fu">c</span>(<span class="st">"int_WB"</span>, <span class="st">"int_OL"</span>, <span class="st">"int_OS"</span>, <span class="st">"int_IS"</span>))) <span class="sc">%&gt;%</span></span>
<span id="cb46-11"><a href="#cb46-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggs_caterpillar</span>(<span class="at">sort =</span> <span class="cn">FALSE</span>) <span class="sc">+</span></span>
<span id="cb46-12"><a href="#cb46-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_discrete</span>(<span class="at">limits =</span> rev) <span class="sc">+</span> </span>
<span id="cb46-13"><a href="#cb46-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylab</span>(<span class="st">"Intercepts"</span>) <span class="sc">+</span></span>
<span id="cb46-14"><a href="#cb46-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="ModelTemp-Letcher_files/figure-html/unnamed-chunk-31-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</div>
<div id="tabset-2-6" class="tab-pane" role="tabpanel" aria-labelledby="tabset-2-6-tab">
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb47"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb47-1"><a href="#cb47-1" aria-hidden="true" tabindex="-1"></a>ggfit <span class="sc">%&gt;%</span> </span>
<span id="cb47-2"><a href="#cb47-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(Parameter <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"B.0[2]"</span>, <span class="st">"B.0[10]"</span>, <span class="st">"B.0[11]"</span>, <span class="st">"B.0[12]"</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb47-3"><a href="#cb47-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">spread</span>(<span class="at">key =</span> Parameter, <span class="at">value =</span> value) <span class="sc">%&gt;%</span></span>
<span id="cb47-4"><a href="#cb47-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">slo_WB =</span> <span class="dv">6</span>, <span class="at">os_OL =</span> <span class="dv">3</span>, <span class="at">os_OS =</span> <span class="dv">4</span>, <span class="at">os_IS =</span> <span class="dv">5</span>) <span class="sc">%&gt;%</span></span>
<span id="cb47-5"><a href="#cb47-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">slo_OL =</span> slo_WB <span class="sc">+</span> os_OL,</span>
<span id="cb47-6"><a href="#cb47-6" aria-hidden="true" tabindex="-1"></a>         <span class="at">slo_OS =</span> slo_WB <span class="sc">+</span> os_OS,</span>
<span id="cb47-7"><a href="#cb47-7" aria-hidden="true" tabindex="-1"></a>         <span class="at">slo_IS =</span> slo_WB <span class="sc">+</span> os_IS) <span class="sc">%&gt;%</span></span>
<span id="cb47-8"><a href="#cb47-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span><span class="fu">c</span>(os_OL, os_OS, os_IS)) <span class="sc">%&gt;%</span></span>
<span id="cb47-9"><a href="#cb47-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">gather</span>(slo_WB<span class="sc">:</span>slo_IS, <span class="at">key =</span> <span class="st">"Parameter"</span>, <span class="at">value =</span> <span class="st">"value"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb47-10"><a href="#cb47-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Parameter =</span> <span class="fu">factor</span>(Parameter, <span class="at">levels =</span> <span class="fu">c</span>(<span class="st">"slo_WB"</span>, <span class="st">"slo_OL"</span>, <span class="st">"slo_OS"</span>, <span class="st">"slo_IS"</span>))) <span class="sc">%&gt;%</span></span>
<span id="cb47-11"><a href="#cb47-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggs_caterpillar</span>(<span class="at">sort =</span> <span class="cn">FALSE</span>) <span class="sc">+</span></span>
<span id="cb47-12"><a href="#cb47-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_discrete</span>(<span class="at">limits =</span> rev) <span class="sc">+</span> </span>
<span id="cb47-13"><a href="#cb47-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylab</span>(<span class="st">"Slopes, temperature effect"</span>) <span class="sc">+</span></span>
<span id="cb47-14"><a href="#cb47-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="ModelTemp-Letcher_files/figure-html/unnamed-chunk-32-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</div>
</div>
</div>
</section>
<section id="marginal-efffects" class="level4" data-number="5.1.6.2">
<h4 data-number="5.1.6.2" class="anchored" data-anchor-id="marginal-efffects"><span class="header-section-number">5.1.6.2</span> Marginal efffects</h4>
<p>Marginal effects of air temperature x flow interaction, not accounting for lagged temperature effects, temporal autocorrelation,</p>
<div class="tabset-margin-container"></div><div class="panel-tabset">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-3-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-3-1" role="tab" aria-controls="tabset-3-1" aria-selected="true">West Brook</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-3-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-3-2" role="tab" aria-controls="tabset-3-2" aria-selected="false">Jimmy</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-3-3-tab" data-bs-toggle="tab" data-bs-target="#tabset-3-3" role="tab" aria-controls="tabset-3-3" aria-selected="false">Mitchell</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-3-4-tab" data-bs-toggle="tab" data-bs-target="#tabset-3-4" role="tab" aria-controls="tabset-3-4" aria-selected="false">Obear</a></li></ul>
<div class="tab-content">
<div id="tabset-3-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-3-1-tab">
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb48"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb48-1"><a href="#cb48-1" aria-hidden="true" tabindex="-1"></a><span class="co"># set up</span></span>
<span id="cb48-2"><a href="#cb48-2" aria-hidden="true" tabindex="-1"></a>np <span class="ot">&lt;-</span> <span class="dv">100</span></span>
<span id="cb48-3"><a href="#cb48-3" aria-hidden="true" tabindex="-1"></a>myriv <span class="ot">&lt;-</span> <span class="st">"WEST BROOK"</span></span>
<span id="cb48-4"><a href="#cb48-4" aria-hidden="true" tabindex="-1"></a>x_temp <span class="ot">&lt;-</span> <span class="fu">seq</span>(<span class="at">from =</span> <span class="fu">min</span>(tempDataSyncS<span class="sc">$</span>airTemp[tempDataSyncS<span class="sc">$</span>riverOrdered <span class="sc">==</span> myriv]),</span>
<span id="cb48-5"><a href="#cb48-5" aria-hidden="true" tabindex="-1"></a>              <span class="at">to =</span> <span class="fu">max</span>(tempDataSyncS<span class="sc">$</span>airTemp[tempDataSyncS<span class="sc">$</span>riverOrdered <span class="sc">==</span> myriv]),</span>
<span id="cb48-6"><a href="#cb48-6" aria-hidden="true" tabindex="-1"></a>              <span class="at">length.out =</span> np)</span>
<span id="cb48-7"><a href="#cb48-7" aria-hidden="true" tabindex="-1"></a>x_flow <span class="ot">&lt;-</span> <span class="fu">seq</span>(<span class="at">from =</span> <span class="fu">min</span>(tempDataSyncS<span class="sc">$</span>flowLS[tempDataSyncS<span class="sc">$</span>riverOrdered <span class="sc">==</span> myriv]),</span>
<span id="cb48-8"><a href="#cb48-8" aria-hidden="true" tabindex="-1"></a>              <span class="at">to =</span> <span class="fu">max</span>(tempDataSyncS<span class="sc">$</span>flowLS[tempDataSyncS<span class="sc">$</span>riverOrdered <span class="sc">==</span> myriv]),</span>
<span id="cb48-9"><a href="#cb48-9" aria-hidden="true" tabindex="-1"></a>              <span class="at">length.out =</span> np)</span>
<span id="cb48-10"><a href="#cb48-10" aria-hidden="true" tabindex="-1"></a>pred_df <span class="ot">&lt;-</span> <span class="fu">expand_grid</span>(x_temp, x_flow)</span>
<span id="cb48-11"><a href="#cb48-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-12"><a href="#cb48-12" aria-hidden="true" tabindex="-1"></a><span class="co"># predict from model</span></span>
<span id="cb48-13"><a href="#cb48-13" aria-hidden="true" tabindex="-1"></a>pred_df<span class="sc">$</span>pred <span class="ot">&lt;-</span> param.summary[<span class="st">"B.0[1]"</span>,<span class="dv">1</span>] <span class="sc">+</span> param.summary[<span class="st">"B.0[2]"</span>,<span class="dv">1</span>]<span class="sc">*</span>pred_df<span class="sc">$</span>x_temp <span class="sc">+</span> param.summary[<span class="st">"B.0[5]"</span>,<span class="dv">1</span>]<span class="sc">*</span>pred_df<span class="sc">$</span>x_flow <span class="sc">+</span> param.summary[<span class="st">"B.0[6]"</span>,<span class="dv">1</span>]<span class="sc">*</span>pred_df<span class="sc">$</span>x_temp<span class="sc">*</span>pred_df<span class="sc">$</span>x_flow</span>
<span id="cb48-14"><a href="#cb48-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-15"><a href="#cb48-15" aria-hidden="true" tabindex="-1"></a><span class="co"># lines </span></span>
<span id="cb48-16"><a href="#cb48-16" aria-hidden="true" tabindex="-1"></a>p1 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(pred_df, <span class="fu">aes</span>(<span class="at">x =</span> x_temp, <span class="at">y =</span> pred, <span class="at">color =</span> x_flow, <span class="at">group =</span> x_flow)) <span class="sc">+</span></span>
<span id="cb48-17"><a href="#cb48-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>() <span class="sc">+</span></span>
<span id="cb48-18"><a href="#cb48-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_distiller</span>(<span class="at">palette =</span> <span class="st">"BrBG"</span>, <span class="at">direction =</span> <span class="sc">+</span><span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb48-19"><a href="#cb48-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>() <span class="sc">+</span> <span class="fu">theme</span>(<span class="at">panel.grid =</span> <span class="fu">element_blank</span>()) <span class="sc">+</span></span>
<span id="cb48-20"><a href="#cb48-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">color =</span> <span class="st">"Flow"</span>) <span class="sc">+</span> <span class="fu">xlab</span>(<span class="st">"Air temperature"</span>) <span class="sc">+</span> <span class="fu">ylab</span>(<span class="st">"Water temperature"</span>) <span class="sc">+</span> <span class="fu">ylim</span>(<span class="fl">6.5</span>,<span class="dv">20</span>)</span>
<span id="cb48-21"><a href="#cb48-21" aria-hidden="true" tabindex="-1"></a><span class="co"># heatmap</span></span>
<span id="cb48-22"><a href="#cb48-22" aria-hidden="true" tabindex="-1"></a>p2 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(pred_df, <span class="fu">aes</span>(<span class="at">x =</span> x_temp, <span class="at">y =</span> x_flow)) <span class="sc">+</span></span>
<span id="cb48-23"><a href="#cb48-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_tile</span>(<span class="fu">aes</span>(<span class="at">fill =</span> pred)) <span class="sc">+</span></span>
<span id="cb48-24"><a href="#cb48-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_distiller</span>(<span class="at">palette =</span> <span class="st">"Spectral"</span>, <span class="at">limits =</span> <span class="fu">c</span>(<span class="fl">6.5</span>,<span class="dv">20</span>)) <span class="sc">+</span></span>
<span id="cb48-25"><a href="#cb48-25" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>() <span class="sc">+</span> <span class="fu">theme</span>(<span class="at">panel.grid =</span> <span class="fu">element_blank</span>()) <span class="sc">+</span></span>
<span id="cb48-26"><a href="#cb48-26" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(<span class="at">expand =</span> <span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">0</span>)) <span class="sc">+</span> <span class="fu">scale_y_continuous</span>(<span class="at">expand =</span> <span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">0</span>)) <span class="sc">+</span></span>
<span id="cb48-27"><a href="#cb48-27" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">fill =</span> <span class="st">"Water</span><span class="sc">\n</span><span class="st">temp."</span>) <span class="sc">+</span> <span class="fu">xlab</span>(<span class="st">"Air temperature"</span>) <span class="sc">+</span> <span class="fu">ylab</span>(<span class="st">"Flow"</span>) <span class="co">#+ </span></span>
<span id="cb48-28"><a href="#cb48-28" aria-hidden="true" tabindex="-1"></a>  <span class="co">#geom_point(data = tempDataSyncS %&gt;% filter(riverOrdered == myriv), aes(x = airTemp, y = flowLS, color = temp)) +</span></span>
<span id="cb48-29"><a href="#cb48-29" aria-hidden="true" tabindex="-1"></a>  <span class="co">#scale_color_distiller(palette = "Spectral", limits = c(0,23)) </span></span>
<span id="cb48-30"><a href="#cb48-30" aria-hidden="true" tabindex="-1"></a><span class="co"># combine</span></span>
<span id="cb48-31"><a href="#cb48-31" aria-hidden="true" tabindex="-1"></a>egg<span class="sc">::</span><span class="fu">ggarrange</span>(p1, p2, <span class="at">nrow =</span> <span class="dv">1</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="ModelTemp-Letcher_files/figure-html/unnamed-chunk-33-1.png" class="img-fluid figure-img" width="864"></p>
</figure>
</div>
</div>
</div>
</div>
<div id="tabset-3-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-3-2-tab">
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb49"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb49-1"><a href="#cb49-1" aria-hidden="true" tabindex="-1"></a><span class="co"># set up</span></span>
<span id="cb49-2"><a href="#cb49-2" aria-hidden="true" tabindex="-1"></a>np <span class="ot">&lt;-</span> <span class="dv">100</span></span>
<span id="cb49-3"><a href="#cb49-3" aria-hidden="true" tabindex="-1"></a>myriv <span class="ot">&lt;-</span> <span class="st">"WB JIMMY"</span></span>
<span id="cb49-4"><a href="#cb49-4" aria-hidden="true" tabindex="-1"></a>x_temp <span class="ot">&lt;-</span> <span class="fu">seq</span>(<span class="at">from =</span> <span class="fu">min</span>(tempDataSyncS<span class="sc">$</span>airTemp[tempDataSyncS<span class="sc">$</span>riverOrdered <span class="sc">==</span> myriv]),</span>
<span id="cb49-5"><a href="#cb49-5" aria-hidden="true" tabindex="-1"></a>              <span class="at">to =</span> <span class="fu">max</span>(tempDataSyncS<span class="sc">$</span>airTemp[tempDataSyncS<span class="sc">$</span>riverOrdered <span class="sc">==</span> myriv]),</span>
<span id="cb49-6"><a href="#cb49-6" aria-hidden="true" tabindex="-1"></a>              <span class="at">length.out =</span> np)</span>
<span id="cb49-7"><a href="#cb49-7" aria-hidden="true" tabindex="-1"></a>x_flow <span class="ot">&lt;-</span> <span class="fu">seq</span>(<span class="at">from =</span> <span class="fu">min</span>(tempDataSyncS<span class="sc">$</span>airTemp[tempDataSyncS<span class="sc">$</span>riverOrdered <span class="sc">==</span> myriv]),</span>
<span id="cb49-8"><a href="#cb49-8" aria-hidden="true" tabindex="-1"></a>              <span class="at">to =</span> <span class="fu">max</span>(tempDataSyncS<span class="sc">$</span>airTemp[tempDataSyncS<span class="sc">$</span>riverOrdered <span class="sc">==</span> myriv]),</span>
<span id="cb49-9"><a href="#cb49-9" aria-hidden="true" tabindex="-1"></a>              <span class="at">length.out =</span> np)</span>
<span id="cb49-10"><a href="#cb49-10" aria-hidden="true" tabindex="-1"></a>pred_df <span class="ot">&lt;-</span> <span class="fu">expand_grid</span>(x_temp, x_flow)</span>
<span id="cb49-11"><a href="#cb49-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-12"><a href="#cb49-12" aria-hidden="true" tabindex="-1"></a><span class="co"># predict from model</span></span>
<span id="cb49-13"><a href="#cb49-13" aria-hidden="true" tabindex="-1"></a>pred_df<span class="sc">$</span>pred <span class="ot">&lt;-</span> param.summary[<span class="st">"B.0[1]"</span>,<span class="dv">1</span>] <span class="sc">+</span> param.summary[<span class="st">"B.0[2]"</span>,<span class="dv">1</span>]<span class="sc">*</span>pred_df<span class="sc">$</span>x_temp <span class="sc">+</span> param.summary[<span class="st">"B.0[5]"</span>,<span class="dv">1</span>]<span class="sc">*</span>pred_df<span class="sc">$</span>x_flow <span class="sc">+</span> param.summary[<span class="st">"B.0[6]"</span>,<span class="dv">1</span>]<span class="sc">*</span>pred_df<span class="sc">$</span>x_temp<span class="sc">*</span>pred_df<span class="sc">$</span>x_flow <span class="sc">+</span> param.summary[<span class="st">"B.0[7]"</span>,<span class="dv">1</span>] <span class="sc">+</span> param.summary[<span class="st">"B.0[10]"</span>,<span class="dv">1</span>]<span class="sc">*</span>pred_df<span class="sc">$</span>x_temp</span>
<span id="cb49-14"><a href="#cb49-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-15"><a href="#cb49-15" aria-hidden="true" tabindex="-1"></a><span class="co"># lines </span></span>
<span id="cb49-16"><a href="#cb49-16" aria-hidden="true" tabindex="-1"></a>p1 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(pred_df, <span class="fu">aes</span>(<span class="at">x =</span> x_temp, <span class="at">y =</span> pred, <span class="at">color =</span> x_flow, <span class="at">group =</span> x_flow)) <span class="sc">+</span></span>
<span id="cb49-17"><a href="#cb49-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>() <span class="sc">+</span></span>
<span id="cb49-18"><a href="#cb49-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_distiller</span>(<span class="at">palette =</span> <span class="st">"BrBG"</span>, <span class="at">direction =</span> <span class="sc">+</span><span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb49-19"><a href="#cb49-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>() <span class="sc">+</span> <span class="fu">theme</span>(<span class="at">panel.grid =</span> <span class="fu">element_blank</span>()) <span class="sc">+</span></span>
<span id="cb49-20"><a href="#cb49-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">color =</span> <span class="st">"Flow"</span>) <span class="sc">+</span> <span class="fu">xlab</span>(<span class="st">"Air temperature"</span>) <span class="sc">+</span> <span class="fu">ylab</span>(<span class="st">"Water temperature"</span>) <span class="sc">+</span> <span class="fu">ylim</span>(<span class="fl">6.5</span>,<span class="dv">20</span>)</span>
<span id="cb49-21"><a href="#cb49-21" aria-hidden="true" tabindex="-1"></a><span class="co"># heatmap</span></span>
<span id="cb49-22"><a href="#cb49-22" aria-hidden="true" tabindex="-1"></a>p2 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(pred_df, <span class="fu">aes</span>(<span class="at">x =</span> x_temp, <span class="at">y =</span> x_flow)) <span class="sc">+</span></span>
<span id="cb49-23"><a href="#cb49-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_tile</span>(<span class="fu">aes</span>(<span class="at">fill =</span> pred)) <span class="sc">+</span></span>
<span id="cb49-24"><a href="#cb49-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_distiller</span>(<span class="at">palette =</span> <span class="st">"Spectral"</span>, <span class="at">limits =</span> <span class="fu">c</span>(<span class="fl">6.5</span>,<span class="dv">20</span>)) <span class="sc">+</span></span>
<span id="cb49-25"><a href="#cb49-25" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>() <span class="sc">+</span> <span class="fu">theme</span>(<span class="at">panel.grid =</span> <span class="fu">element_blank</span>()) <span class="sc">+</span></span>
<span id="cb49-26"><a href="#cb49-26" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(<span class="at">expand =</span> <span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">0</span>)) <span class="sc">+</span> <span class="fu">scale_y_continuous</span>(<span class="at">expand =</span> <span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">0</span>)) <span class="sc">+</span></span>
<span id="cb49-27"><a href="#cb49-27" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">fill =</span> <span class="st">"Water</span><span class="sc">\n</span><span class="st">temp."</span>) <span class="sc">+</span> <span class="fu">xlab</span>(<span class="st">"Air temperature"</span>) <span class="sc">+</span> <span class="fu">ylab</span>(<span class="st">"Flow"</span>)</span>
<span id="cb49-28"><a href="#cb49-28" aria-hidden="true" tabindex="-1"></a><span class="co"># combine</span></span>
<span id="cb49-29"><a href="#cb49-29" aria-hidden="true" tabindex="-1"></a>egg<span class="sc">::</span><span class="fu">ggarrange</span>(p1, p2, <span class="at">nrow =</span> <span class="dv">1</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="ModelTemp-Letcher_files/figure-html/unnamed-chunk-34-1.png" class="img-fluid figure-img" width="864"></p>
</figure>
</div>
</div>
</div>
</div>
<div id="tabset-3-3" class="tab-pane" role="tabpanel" aria-labelledby="tabset-3-3-tab">
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb50"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb50-1"><a href="#cb50-1" aria-hidden="true" tabindex="-1"></a><span class="co"># set up</span></span>
<span id="cb50-2"><a href="#cb50-2" aria-hidden="true" tabindex="-1"></a>np <span class="ot">&lt;-</span> <span class="dv">100</span></span>
<span id="cb50-3"><a href="#cb50-3" aria-hidden="true" tabindex="-1"></a>myriv <span class="ot">&lt;-</span> <span class="st">"WB MITCHELL"</span></span>
<span id="cb50-4"><a href="#cb50-4" aria-hidden="true" tabindex="-1"></a>x_temp <span class="ot">&lt;-</span> <span class="fu">seq</span>(<span class="at">from =</span> <span class="fu">min</span>(tempDataSyncS<span class="sc">$</span>airTemp[tempDataSyncS<span class="sc">$</span>riverOrdered <span class="sc">==</span> myriv]),</span>
<span id="cb50-5"><a href="#cb50-5" aria-hidden="true" tabindex="-1"></a>              <span class="at">to =</span> <span class="fu">max</span>(tempDataSyncS<span class="sc">$</span>airTemp[tempDataSyncS<span class="sc">$</span>riverOrdered <span class="sc">==</span> myriv]),</span>
<span id="cb50-6"><a href="#cb50-6" aria-hidden="true" tabindex="-1"></a>              <span class="at">length.out =</span> np)</span>
<span id="cb50-7"><a href="#cb50-7" aria-hidden="true" tabindex="-1"></a>x_flow <span class="ot">&lt;-</span> <span class="fu">seq</span>(<span class="at">from =</span> <span class="fu">min</span>(tempDataSyncS<span class="sc">$</span>airTemp[tempDataSyncS<span class="sc">$</span>riverOrdered <span class="sc">==</span> myriv]),</span>
<span id="cb50-8"><a href="#cb50-8" aria-hidden="true" tabindex="-1"></a>              <span class="at">to =</span> <span class="fu">max</span>(tempDataSyncS<span class="sc">$</span>airTemp[tempDataSyncS<span class="sc">$</span>riverOrdered <span class="sc">==</span> myriv]),</span>
<span id="cb50-9"><a href="#cb50-9" aria-hidden="true" tabindex="-1"></a>              <span class="at">length.out =</span> np)</span>
<span id="cb50-10"><a href="#cb50-10" aria-hidden="true" tabindex="-1"></a>pred_df <span class="ot">&lt;-</span> <span class="fu">expand_grid</span>(x_temp, x_flow)</span>
<span id="cb50-11"><a href="#cb50-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-12"><a href="#cb50-12" aria-hidden="true" tabindex="-1"></a><span class="co"># predict from model</span></span>
<span id="cb50-13"><a href="#cb50-13" aria-hidden="true" tabindex="-1"></a>pred_df<span class="sc">$</span>pred <span class="ot">&lt;-</span> param.summary[<span class="st">"B.0[1]"</span>,<span class="dv">1</span>] <span class="sc">+</span> param.summary[<span class="st">"B.0[2]"</span>,<span class="dv">1</span>]<span class="sc">*</span>pred_df<span class="sc">$</span>x_temp <span class="sc">+</span> param.summary[<span class="st">"B.0[5]"</span>,<span class="dv">1</span>]<span class="sc">*</span>pred_df<span class="sc">$</span>x_flow <span class="sc">+</span> param.summary[<span class="st">"B.0[6]"</span>,<span class="dv">1</span>]<span class="sc">*</span>pred_df<span class="sc">$</span>x_temp<span class="sc">*</span>pred_df<span class="sc">$</span>x_flow <span class="sc">+</span> param.summary[<span class="st">"B.0[8]"</span>,<span class="dv">1</span>] <span class="sc">+</span> param.summary[<span class="st">"B.0[11]"</span>,<span class="dv">1</span>]<span class="sc">*</span>pred_df<span class="sc">$</span>x_temp</span>
<span id="cb50-14"><a href="#cb50-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-15"><a href="#cb50-15" aria-hidden="true" tabindex="-1"></a><span class="co"># lines </span></span>
<span id="cb50-16"><a href="#cb50-16" aria-hidden="true" tabindex="-1"></a>p1 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(pred_df, <span class="fu">aes</span>(<span class="at">x =</span> x_temp, <span class="at">y =</span> pred, <span class="at">color =</span> x_flow, <span class="at">group =</span> x_flow)) <span class="sc">+</span></span>
<span id="cb50-17"><a href="#cb50-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>() <span class="sc">+</span></span>
<span id="cb50-18"><a href="#cb50-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_distiller</span>(<span class="at">palette =</span> <span class="st">"BrBG"</span>, <span class="at">direction =</span> <span class="sc">+</span><span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb50-19"><a href="#cb50-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>() <span class="sc">+</span> <span class="fu">theme</span>(<span class="at">panel.grid =</span> <span class="fu">element_blank</span>()) <span class="sc">+</span></span>
<span id="cb50-20"><a href="#cb50-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">color =</span> <span class="st">"Flow"</span>) <span class="sc">+</span> <span class="fu">xlab</span>(<span class="st">"Air temperature"</span>) <span class="sc">+</span> <span class="fu">ylab</span>(<span class="st">"Water temperature"</span>) <span class="sc">+</span> <span class="fu">ylim</span>(<span class="fl">6.5</span>,<span class="dv">20</span>)</span>
<span id="cb50-21"><a href="#cb50-21" aria-hidden="true" tabindex="-1"></a><span class="co"># heatmap</span></span>
<span id="cb50-22"><a href="#cb50-22" aria-hidden="true" tabindex="-1"></a>p2 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(pred_df, <span class="fu">aes</span>(<span class="at">x =</span> x_temp, <span class="at">y =</span> x_flow)) <span class="sc">+</span></span>
<span id="cb50-23"><a href="#cb50-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_tile</span>(<span class="fu">aes</span>(<span class="at">fill =</span> pred)) <span class="sc">+</span></span>
<span id="cb50-24"><a href="#cb50-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_distiller</span>(<span class="at">palette =</span> <span class="st">"Spectral"</span>, <span class="at">limits =</span> <span class="fu">c</span>(<span class="fl">6.5</span>,<span class="dv">20</span>)) <span class="sc">+</span></span>
<span id="cb50-25"><a href="#cb50-25" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>() <span class="sc">+</span> <span class="fu">theme</span>(<span class="at">panel.grid =</span> <span class="fu">element_blank</span>()) <span class="sc">+</span></span>
<span id="cb50-26"><a href="#cb50-26" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(<span class="at">expand =</span> <span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">0</span>)) <span class="sc">+</span> <span class="fu">scale_y_continuous</span>(<span class="at">expand =</span> <span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">0</span>)) <span class="sc">+</span></span>
<span id="cb50-27"><a href="#cb50-27" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">fill =</span> <span class="st">"Water</span><span class="sc">\n</span><span class="st">temp."</span>) <span class="sc">+</span> <span class="fu">xlab</span>(<span class="st">"Air temperature"</span>) <span class="sc">+</span> <span class="fu">ylab</span>(<span class="st">"Flow"</span>)</span>
<span id="cb50-28"><a href="#cb50-28" aria-hidden="true" tabindex="-1"></a><span class="co"># combine</span></span>
<span id="cb50-29"><a href="#cb50-29" aria-hidden="true" tabindex="-1"></a>egg<span class="sc">::</span><span class="fu">ggarrange</span>(p1, p2, <span class="at">nrow =</span> <span class="dv">1</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="ModelTemp-Letcher_files/figure-html/unnamed-chunk-35-1.png" class="img-fluid figure-img" width="864"></p>
</figure>
</div>
</div>
</div>
</div>
<div id="tabset-3-4" class="tab-pane" role="tabpanel" aria-labelledby="tabset-3-4-tab">
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb51"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb51-1"><a href="#cb51-1" aria-hidden="true" tabindex="-1"></a><span class="co"># set up</span></span>
<span id="cb51-2"><a href="#cb51-2" aria-hidden="true" tabindex="-1"></a>np <span class="ot">&lt;-</span> <span class="dv">100</span></span>
<span id="cb51-3"><a href="#cb51-3" aria-hidden="true" tabindex="-1"></a>myriv <span class="ot">&lt;-</span> <span class="st">"WB OBEAR"</span></span>
<span id="cb51-4"><a href="#cb51-4" aria-hidden="true" tabindex="-1"></a>x_temp <span class="ot">&lt;-</span> <span class="fu">seq</span>(<span class="at">from =</span> <span class="fu">min</span>(tempDataSyncS<span class="sc">$</span>airTemp[tempDataSyncS<span class="sc">$</span>riverOrdered <span class="sc">==</span> myriv]),</span>
<span id="cb51-5"><a href="#cb51-5" aria-hidden="true" tabindex="-1"></a>              <span class="at">to =</span> <span class="fu">max</span>(tempDataSyncS<span class="sc">$</span>airTemp[tempDataSyncS<span class="sc">$</span>riverOrdered <span class="sc">==</span> myriv]),</span>
<span id="cb51-6"><a href="#cb51-6" aria-hidden="true" tabindex="-1"></a>              <span class="at">length.out =</span> np)</span>
<span id="cb51-7"><a href="#cb51-7" aria-hidden="true" tabindex="-1"></a>x_flow <span class="ot">&lt;-</span> <span class="fu">seq</span>(<span class="at">from =</span> <span class="fu">min</span>(tempDataSyncS<span class="sc">$</span>airTemp[tempDataSyncS<span class="sc">$</span>riverOrdered <span class="sc">==</span> myriv]),</span>
<span id="cb51-8"><a href="#cb51-8" aria-hidden="true" tabindex="-1"></a>              <span class="at">to =</span> <span class="fu">max</span>(tempDataSyncS<span class="sc">$</span>airTemp[tempDataSyncS<span class="sc">$</span>riverOrdered <span class="sc">==</span> myriv]),</span>
<span id="cb51-9"><a href="#cb51-9" aria-hidden="true" tabindex="-1"></a>              <span class="at">length.out =</span> np)</span>
<span id="cb51-10"><a href="#cb51-10" aria-hidden="true" tabindex="-1"></a>pred_df <span class="ot">&lt;-</span> <span class="fu">expand_grid</span>(x_temp, x_flow)</span>
<span id="cb51-11"><a href="#cb51-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-12"><a href="#cb51-12" aria-hidden="true" tabindex="-1"></a><span class="co"># predict from model</span></span>
<span id="cb51-13"><a href="#cb51-13" aria-hidden="true" tabindex="-1"></a>pred_df<span class="sc">$</span>pred <span class="ot">&lt;-</span> param.summary[<span class="st">"B.0[1]"</span>,<span class="dv">1</span>] <span class="sc">+</span> param.summary[<span class="st">"B.0[2]"</span>,<span class="dv">1</span>]<span class="sc">*</span>pred_df<span class="sc">$</span>x_temp <span class="sc">+</span> param.summary[<span class="st">"B.0[5]"</span>,<span class="dv">1</span>]<span class="sc">*</span>pred_df<span class="sc">$</span>x_flow <span class="sc">+</span> param.summary[<span class="st">"B.0[6]"</span>,<span class="dv">1</span>]<span class="sc">*</span>pred_df<span class="sc">$</span>x_temp<span class="sc">*</span>pred_df<span class="sc">$</span>x_flow <span class="sc">+</span> param.summary[<span class="st">"B.0[9]"</span>,<span class="dv">1</span>] <span class="sc">+</span> param.summary[<span class="st">"B.0[12]"</span>,<span class="dv">1</span>]<span class="sc">*</span>pred_df<span class="sc">$</span>x_temp</span>
<span id="cb51-14"><a href="#cb51-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-15"><a href="#cb51-15" aria-hidden="true" tabindex="-1"></a><span class="co"># lines </span></span>
<span id="cb51-16"><a href="#cb51-16" aria-hidden="true" tabindex="-1"></a>p1 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(pred_df, <span class="fu">aes</span>(<span class="at">x =</span> x_temp, <span class="at">y =</span> pred, <span class="at">color =</span> x_flow, <span class="at">group =</span> x_flow)) <span class="sc">+</span></span>
<span id="cb51-17"><a href="#cb51-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>() <span class="sc">+</span></span>
<span id="cb51-18"><a href="#cb51-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_distiller</span>(<span class="at">palette =</span> <span class="st">"BrBG"</span>, <span class="at">direction =</span> <span class="sc">+</span><span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb51-19"><a href="#cb51-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>() <span class="sc">+</span> <span class="fu">theme</span>(<span class="at">panel.grid =</span> <span class="fu">element_blank</span>()) <span class="sc">+</span></span>
<span id="cb51-20"><a href="#cb51-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">color =</span> <span class="st">"Flow"</span>) <span class="sc">+</span> <span class="fu">xlab</span>(<span class="st">"Air temperature"</span>) <span class="sc">+</span> <span class="fu">ylab</span>(<span class="st">"Water temperature"</span>) <span class="sc">+</span> <span class="fu">ylim</span>(<span class="fl">6.5</span>,<span class="dv">20</span>)</span>
<span id="cb51-21"><a href="#cb51-21" aria-hidden="true" tabindex="-1"></a><span class="co"># heatmap</span></span>
<span id="cb51-22"><a href="#cb51-22" aria-hidden="true" tabindex="-1"></a>p2 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(pred_df, <span class="fu">aes</span>(<span class="at">x =</span> x_temp, <span class="at">y =</span> x_flow)) <span class="sc">+</span></span>
<span id="cb51-23"><a href="#cb51-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_tile</span>(<span class="fu">aes</span>(<span class="at">fill =</span> pred)) <span class="sc">+</span></span>
<span id="cb51-24"><a href="#cb51-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_distiller</span>(<span class="at">palette =</span> <span class="st">"Spectral"</span>, <span class="at">limits =</span> <span class="fu">c</span>(<span class="fl">6.5</span>,<span class="dv">20</span>)) <span class="sc">+</span></span>
<span id="cb51-25"><a href="#cb51-25" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>() <span class="sc">+</span> <span class="fu">theme</span>(<span class="at">panel.grid =</span> <span class="fu">element_blank</span>()) <span class="sc">+</span></span>
<span id="cb51-26"><a href="#cb51-26" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(<span class="at">expand =</span> <span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">0</span>)) <span class="sc">+</span> <span class="fu">scale_y_continuous</span>(<span class="at">expand =</span> <span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">0</span>)) <span class="sc">+</span></span>
<span id="cb51-27"><a href="#cb51-27" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">fill =</span> <span class="st">"Water</span><span class="sc">\n</span><span class="st">temp."</span>) <span class="sc">+</span> <span class="fu">xlab</span>(<span class="st">"Air temperature"</span>) <span class="sc">+</span> <span class="fu">ylab</span>(<span class="st">"Flow"</span>)</span>
<span id="cb51-28"><a href="#cb51-28" aria-hidden="true" tabindex="-1"></a><span class="co"># combine</span></span>
<span id="cb51-29"><a href="#cb51-29" aria-hidden="true" tabindex="-1"></a>egg<span class="sc">::</span><span class="fu">ggarrange</span>(p1, p2, <span class="at">nrow =</span> <span class="dv">1</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="ModelTemp-Letcher_files/figure-html/unnamed-chunk-36-1.png" class="img-fluid figure-img" width="864"></p>
</figure>
</div>
</div>
</div>
</div>
</div>
</div>
</section>
</section>
</section>
<section id="hierarchical" class="level2" data-number="5.2">
<h2 data-number="5.2" class="anchored" data-anchor-id="hierarchical"><span class="header-section-number">5.2</span> Hierarchical</h2>
<p>Fit the same model as above, but draw the intercepts and temperature effects hierarchically and check that the output matches</p>
<section id="specify-model-1" class="level3" data-number="5.2.1">
<h3 data-number="5.2.1" class="anchored" data-anchor-id="specify-model-1"><span class="header-section-number">5.2.1</span> Specify model</h3>
<p>Modify Letcher model to estimate intercepts and slopes hierarchically</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb52"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb52-1"><a href="#cb52-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"model {</span></span>
<span id="cb52-2"><a href="#cb52-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-3"><a href="#cb52-3" aria-hidden="true" tabindex="-1"></a><span class="st">    ###----------------- LIKELIHOOD -----------------###</span></span>
<span id="cb52-4"><a href="#cb52-4" aria-hidden="true" tabindex="-1"></a><span class="st">    </span></span>
<span id="cb52-5"><a href="#cb52-5" aria-hidden="true" tabindex="-1"></a><span class="st">    # Days without an observation on the previous day (first observation in a series)</span></span>
<span id="cb52-6"><a href="#cb52-6" aria-hidden="true" tabindex="-1"></a><span class="st">    # No autoregressive term</span></span>
<span id="cb52-7"><a href="#cb52-7" aria-hidden="true" tabindex="-1"></a><span class="st">    </span></span>
<span id="cb52-8"><a href="#cb52-8" aria-hidden="true" tabindex="-1"></a><span class="st">    for (i in 1:nFirstObsRows){</span></span>
<span id="cb52-9"><a href="#cb52-9" aria-hidden="true" tabindex="-1"></a><span class="st">      temp[firstObsRows[i]] ~ dnorm(stream.mu[firstObsRows[i]], pow(sigma, -2)) </span></span>
<span id="cb52-10"><a href="#cb52-10" aria-hidden="true" tabindex="-1"></a><span class="st">      stream.mu[firstObsRows[i]] &lt;- trend[firstObsRows[i]]</span></span>
<span id="cb52-11"><a href="#cb52-11" aria-hidden="true" tabindex="-1"></a><span class="st">      trend[firstObsRows[i]] &lt;- inprod(B.0[], X.0[firstObsRows[i], ]) + </span></span>
<span id="cb52-12"><a href="#cb52-12" aria-hidden="true" tabindex="-1"></a><span class="st">                                inprod(B.site[site[firstObsRows[i]], ], X.site[firstObsRows[i], ]) + </span></span>
<span id="cb52-13"><a href="#cb52-13" aria-hidden="true" tabindex="-1"></a><span class="st">                                inprod(B.year[year[firstObsRows[i]], ], X.year[firstObsRows[i], ])</span></span>
<span id="cb52-14"><a href="#cb52-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-15"><a href="#cb52-15" aria-hidden="true" tabindex="-1"></a><span class="st">      }</span></span>
<span id="cb52-16"><a href="#cb52-16" aria-hidden="true" tabindex="-1"></a><span class="st">    </span></span>
<span id="cb52-17"><a href="#cb52-17" aria-hidden="true" tabindex="-1"></a><span class="st">    # Days with an observation on the previous dat (all days following the first day)</span></span>
<span id="cb52-18"><a href="#cb52-18" aria-hidden="true" tabindex="-1"></a><span class="st">    # Includes autoregressive term (ar1)</span></span>
<span id="cb52-19"><a href="#cb52-19" aria-hidden="true" tabindex="-1"></a><span class="st">    </span></span>
<span id="cb52-20"><a href="#cb52-20" aria-hidden="true" tabindex="-1"></a><span class="st">    for (i in 1:nEvalRows){ </span></span>
<span id="cb52-21"><a href="#cb52-21" aria-hidden="true" tabindex="-1"></a><span class="st">      temp[evalRows[i]] ~ dnorm(stream.mu[evalRows[i]], pow(sigma, -2))</span></span>
<span id="cb52-22"><a href="#cb52-22" aria-hidden="true" tabindex="-1"></a><span class="st">      stream.mu[evalRows[i]] &lt;- trend[evalRows[i]] + ar1[site[evalRows[i]]] * (temp[evalRows[i]-1] - trend[ evalRows[i]-1 ])</span></span>
<span id="cb52-23"><a href="#cb52-23" aria-hidden="true" tabindex="-1"></a><span class="st">      trend[evalRows[i]] &lt;- inprod(B.0[], X.0[evalRows[i], ]) + </span></span>
<span id="cb52-24"><a href="#cb52-24" aria-hidden="true" tabindex="-1"></a><span class="st">                            inprod(B.site[site[evalRows[i]], ], X.site[evalRows[i], ]) + </span></span>
<span id="cb52-25"><a href="#cb52-25" aria-hidden="true" tabindex="-1"></a><span class="st">                            inprod(B.year[year[evalRows[i]], ], X.year[evalRows[i], ])</span></span>
<span id="cb52-26"><a href="#cb52-26" aria-hidden="true" tabindex="-1"></a><span class="st">      }</span></span>
<span id="cb52-27"><a href="#cb52-27" aria-hidden="true" tabindex="-1"></a><span class="st">    </span></span>
<span id="cb52-28"><a href="#cb52-28" aria-hidden="true" tabindex="-1"></a><span class="st">    </span></span>
<span id="cb52-29"><a href="#cb52-29" aria-hidden="true" tabindex="-1"></a><span class="st">    ###----------------- PRIORS ---------------------###</span></span>
<span id="cb52-30"><a href="#cb52-30" aria-hidden="true" tabindex="-1"></a><span class="st">    </span></span>
<span id="cb52-31"><a href="#cb52-31" aria-hidden="true" tabindex="-1"></a><span class="st">    # ar1, hierarchical by site</span></span>
<span id="cb52-32"><a href="#cb52-32" aria-hidden="true" tabindex="-1"></a><span class="st">    for (i in 1:nsites){</span></span>
<span id="cb52-33"><a href="#cb52-33" aria-hidden="true" tabindex="-1"></a><span class="st">      ar1[i] ~ dnorm(ar1Mean, pow(ar1SD,-2) ) T(-1,1)       </span></span>
<span id="cb52-34"><a href="#cb52-34" aria-hidden="true" tabindex="-1"></a><span class="st">    }</span></span>
<span id="cb52-35"><a href="#cb52-35" aria-hidden="true" tabindex="-1"></a><span class="st">    ar1Mean ~ dunif( -1,1 ) </span></span>
<span id="cb52-36"><a href="#cb52-36" aria-hidden="true" tabindex="-1"></a><span class="st">    ar1SD ~ dunif( 0, 2 )</span></span>
<span id="cb52-37"><a href="#cb52-37" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-38"><a href="#cb52-38" aria-hidden="true" tabindex="-1"></a><span class="st">    # model variance</span></span>
<span id="cb52-39"><a href="#cb52-39" aria-hidden="true" tabindex="-1"></a><span class="st">    sigma ~ dunif(0, 100)</span></span>
<span id="cb52-40"><a href="#cb52-40" aria-hidden="true" tabindex="-1"></a><span class="st">    </span></span>
<span id="cb52-41"><a href="#cb52-41" aria-hidden="true" tabindex="-1"></a><span class="st">    </span></span>
<span id="cb52-42"><a href="#cb52-42" aria-hidden="true" tabindex="-1"></a><span class="st">    # fixed effect coefficients</span></span>
<span id="cb52-43"><a href="#cb52-43" aria-hidden="true" tabindex="-1"></a><span class="st">    for (k in 1:Kfixed) {</span></span>
<span id="cb52-44"><a href="#cb52-44" aria-hidden="true" tabindex="-1"></a><span class="st">      B.0[k] ~ dnorm(0, 0.001)</span></span>
<span id="cb52-45"><a href="#cb52-45" aria-hidden="true" tabindex="-1"></a><span class="st">      }</span></span>
<span id="cb52-46"><a href="#cb52-46" aria-hidden="true" tabindex="-1"></a><span class="st">      </span></span>
<span id="cb52-47"><a href="#cb52-47" aria-hidden="true" tabindex="-1"></a><span class="st">    # random effect coefficients (by site)</span></span>
<span id="cb52-48"><a href="#cb52-48" aria-hidden="true" tabindex="-1"></a><span class="st">    for (k in 1:Krandom) {</span></span>
<span id="cb52-49"><a href="#cb52-49" aria-hidden="true" tabindex="-1"></a><span class="st">      sigma.B.site[k] ~ dunif(0, 100)</span></span>
<span id="cb52-50"><a href="#cb52-50" aria-hidden="true" tabindex="-1"></a><span class="st">      for (i in 1:nsites) {</span></span>
<span id="cb52-51"><a href="#cb52-51" aria-hidden="true" tabindex="-1"></a><span class="st">        B.site[i,k] ~ dnorm(0, pow(sigma.B.site[k], -2))</span></span>
<span id="cb52-52"><a href="#cb52-52" aria-hidden="true" tabindex="-1"></a><span class="st">      }</span></span>
<span id="cb52-53"><a href="#cb52-53" aria-hidden="true" tabindex="-1"></a><span class="st">    }</span></span>
<span id="cb52-54"><a href="#cb52-54" aria-hidden="true" tabindex="-1"></a><span class="st">    </span></span>
<span id="cb52-55"><a href="#cb52-55" aria-hidden="true" tabindex="-1"></a><span class="st">    # YEAR EFFECTS</span></span>
<span id="cb52-56"><a href="#cb52-56" aria-hidden="true" tabindex="-1"></a><span class="st">    # Priors for random effects of year</span></span>
<span id="cb52-57"><a href="#cb52-57" aria-hidden="true" tabindex="-1"></a><span class="st">    for (t in 1:Ti) { # Ti years</span></span>
<span id="cb52-58"><a href="#cb52-58" aria-hidden="true" tabindex="-1"></a><span class="st">      B.year[t, 1:L] ~ dmnorm(mu.year[ ], tau.B.year[ , ])</span></span>
<span id="cb52-59"><a href="#cb52-59" aria-hidden="true" tabindex="-1"></a><span class="st">      }</span></span>
<span id="cb52-60"><a href="#cb52-60" aria-hidden="true" tabindex="-1"></a><span class="st">      </span></span>
<span id="cb52-61"><a href="#cb52-61" aria-hidden="true" tabindex="-1"></a><span class="st">    mu.year[1] &lt;- 0</span></span>
<span id="cb52-62"><a href="#cb52-62" aria-hidden="true" tabindex="-1"></a><span class="st">    </span></span>
<span id="cb52-63"><a href="#cb52-63" aria-hidden="true" tabindex="-1"></a><span class="st">    for (l in 2:L) {</span></span>
<span id="cb52-64"><a href="#cb52-64" aria-hidden="true" tabindex="-1"></a><span class="st">      mu.year[l] ~ dnorm(0, 0.0001)</span></span>
<span id="cb52-65"><a href="#cb52-65" aria-hidden="true" tabindex="-1"></a><span class="st">      }</span></span>
<span id="cb52-66"><a href="#cb52-66" aria-hidden="true" tabindex="-1"></a><span class="st">      </span></span>
<span id="cb52-67"><a href="#cb52-67" aria-hidden="true" tabindex="-1"></a><span class="st">    # Prior on multivariate normal std deviation</span></span>
<span id="cb52-68"><a href="#cb52-68" aria-hidden="true" tabindex="-1"></a><span class="st">    tau.B.year[1:L, 1:L] ~ dwish(W.year[ , ], df.year)</span></span>
<span id="cb52-69"><a href="#cb52-69" aria-hidden="true" tabindex="-1"></a><span class="st">    df.year &lt;- L + 1</span></span>
<span id="cb52-70"><a href="#cb52-70" aria-hidden="true" tabindex="-1"></a><span class="st">    sigma.B.year[1:L, 1:L] &lt;- inverse(tau.B.year[ , ])</span></span>
<span id="cb52-71"><a href="#cb52-71" aria-hidden="true" tabindex="-1"></a><span class="st">    for (l in 1:L) {</span></span>
<span id="cb52-72"><a href="#cb52-72" aria-hidden="true" tabindex="-1"></a><span class="st">      for (l.prime in 1:L) {</span></span>
<span id="cb52-73"><a href="#cb52-73" aria-hidden="true" tabindex="-1"></a><span class="st">        rho.B.year[l, l.prime] &lt;- sigma.B.year[l, l.prime]/sqrt(sigma.B.year[l, l]*sigma.B.year[l.prime, l.prime])</span></span>
<span id="cb52-74"><a href="#cb52-74" aria-hidden="true" tabindex="-1"></a><span class="st">        }</span></span>
<span id="cb52-75"><a href="#cb52-75" aria-hidden="true" tabindex="-1"></a><span class="st">      sigma.b.year[l] &lt;- sqrt(sigma.B.year[l, l])</span></span>
<span id="cb52-76"><a href="#cb52-76" aria-hidden="true" tabindex="-1"></a><span class="st">    }</span></span>
<span id="cb52-77"><a href="#cb52-77" aria-hidden="true" tabindex="-1"></a><span class="st">    </span></span>
<span id="cb52-78"><a href="#cb52-78" aria-hidden="true" tabindex="-1"></a><span class="st">    </span></span>
<span id="cb52-79"><a href="#cb52-79" aria-hidden="true" tabindex="-1"></a><span class="st">    ###----------------- DERIVED VALUES -------------###</span></span>
<span id="cb52-80"><a href="#cb52-80" aria-hidden="true" tabindex="-1"></a><span class="st">    residuals[1] &lt;- 0 # hold the place. Not sure if this is necessary...</span></span>
<span id="cb52-81"><a href="#cb52-81" aria-hidden="true" tabindex="-1"></a><span class="st">    for (i in 2:n) {</span></span>
<span id="cb52-82"><a href="#cb52-82" aria-hidden="true" tabindex="-1"></a><span class="st">      residuals[i] &lt;- temp[i] - stream.mu[i]</span></span>
<span id="cb52-83"><a href="#cb52-83" aria-hidden="true" tabindex="-1"></a><span class="st">    }</span></span>
<span id="cb52-84"><a href="#cb52-84" aria-hidden="true" tabindex="-1"></a><span class="st">    </span></span>
<span id="cb52-85"><a href="#cb52-85" aria-hidden="true" tabindex="-1"></a><span class="st">    }"</span>, <span class="at">file =</span> <span class="st">"JAGS models/DailyTempModelJAGS_Letcher_hierarchical.txt"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="organize-objects-1" class="level3" data-number="5.2.2">
<h3 data-number="5.2.2" class="anchored" data-anchor-id="organize-objects-1"><span class="header-section-number">5.2.2</span> Organize objects</h3>
<p>Get first observation indices and check that nFirstRowObs equals the number of unique site-years: <strong>must be TRUE!</strong></p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb53"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb53-1"><a href="#cb53-1" aria-hidden="true" tabindex="-1"></a><span class="co"># row indices for first observation in each site-year</span></span>
<span id="cb53-2"><a href="#cb53-2" aria-hidden="true" tabindex="-1"></a>firstObsRows <span class="ot">&lt;-</span> <span class="fu">unlist</span>(tempDataSyncS <span class="sc">%&gt;%</span> </span>
<span id="cb53-3"><a href="#cb53-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(siteYear) <span class="sc">%&gt;%</span></span>
<span id="cb53-4"><a href="#cb53-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="at">index =</span> rowNum[<span class="fu">min</span>(<span class="fu">which</span>(<span class="sc">!</span><span class="fu">is.na</span>(temp)))]) <span class="sc">%&gt;%</span></span>
<span id="cb53-5"><a href="#cb53-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb53-6"><a href="#cb53-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(index))</span>
<span id="cb53-7"><a href="#cb53-7" aria-hidden="true" tabindex="-1"></a>nFirstObsRows <span class="ot">&lt;-</span> <span class="fu">length</span>(firstObsRows)</span>
<span id="cb53-8"><a href="#cb53-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-9"><a href="#cb53-9" aria-hidden="true" tabindex="-1"></a><span class="co"># does the number of first observations match the number of site years?</span></span>
<span id="cb53-10"><a href="#cb53-10" aria-hidden="true" tabindex="-1"></a>nFirstObsRows <span class="sc">==</span> <span class="fu">length</span>(<span class="fu">unique</span>(tempDataSyncS<span class="sc">$</span>siteYear))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>[1] TRUE</code></pre>
</div>
</div>
<p>Get row indices for all other observations</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb55"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb55-1"><a href="#cb55-1" aria-hidden="true" tabindex="-1"></a>evalRows <span class="ot">&lt;-</span> <span class="fu">unlist</span>(tempDataSyncS <span class="sc">%&gt;%</span> <span class="fu">filter</span>(<span class="sc">!</span>rowNum <span class="sc">%in%</span> firstObsRows) <span class="sc">%&gt;%</span> <span class="fu">select</span>(rowNum))</span>
<span id="cb55-2"><a href="#cb55-2" aria-hidden="true" tabindex="-1"></a>nEvalRows <span class="ot">&lt;-</span> <span class="fu">length</span>(evalRows)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>Fixed and random effect data</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb56"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb56-1"><a href="#cb56-1" aria-hidden="true" tabindex="-1"></a>data.random <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">intercept =</span> <span class="dv">1</span>,</span>
<span id="cb56-2"><a href="#cb56-2" aria-hidden="true" tabindex="-1"></a>                          <span class="at">airTemp =</span> tempDataSyncS<span class="sc">$</span>airTemp )</span>
<span id="cb56-3"><a href="#cb56-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb56-4"><a href="#cb56-4" aria-hidden="true" tabindex="-1"></a>data.fixed <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="co">#intercept = 1</span></span>
<span id="cb56-5"><a href="#cb56-5" aria-hidden="true" tabindex="-1"></a>                         <span class="co">#,airTemp = tempDataSyncS$airTemp </span></span>
<span id="cb56-6"><a href="#cb56-6" aria-hidden="true" tabindex="-1"></a>                         <span class="at">airTempLag1 =</span> tempDataSyncS<span class="sc">$</span>airTempLagged1</span>
<span id="cb56-7"><a href="#cb56-7" aria-hidden="true" tabindex="-1"></a>                         ,<span class="at">airTempLag2 =</span> tempDataSyncS<span class="sc">$</span>airTempLagged2</span>
<span id="cb56-8"><a href="#cb56-8" aria-hidden="true" tabindex="-1"></a>                         </span>
<span id="cb56-9"><a href="#cb56-9" aria-hidden="true" tabindex="-1"></a>                         ,<span class="at">flow =</span>  tempDataSyncS<span class="sc">$</span>flowLS</span>
<span id="cb56-10"><a href="#cb56-10" aria-hidden="true" tabindex="-1"></a>                         </span>
<span id="cb56-11"><a href="#cb56-11" aria-hidden="true" tabindex="-1"></a>                         ,<span class="at">airFlow =</span> tempDataSyncS<span class="sc">$</span>airTemp <span class="sc">*</span> tempDataSyncS<span class="sc">$</span>flowLS</span>
<span id="cb56-12"><a href="#cb56-12" aria-hidden="true" tabindex="-1"></a><span class="co">#                         ,air1Flow = tempDataSyncS$airTempLagged1 * tempDataSyncS$flowLS</span></span>
<span id="cb56-13"><a href="#cb56-13" aria-hidden="true" tabindex="-1"></a><span class="co">#                         ,air2Flow = tempDataSyncS$airTempLagged2 * tempDataSyncS$flowLS</span></span>
<span id="cb56-14"><a href="#cb56-14" aria-hidden="true" tabindex="-1"></a>                         </span>
<span id="cb56-15"><a href="#cb56-15" aria-hidden="true" tabindex="-1"></a>                         <span class="co">#main river effects</span></span>
<span id="cb56-16"><a href="#cb56-16" aria-hidden="true" tabindex="-1"></a>                         <span class="co"># ,river1 = tempDataSyncS$river1</span></span>
<span id="cb56-17"><a href="#cb56-17" aria-hidden="true" tabindex="-1"></a>                         <span class="co"># ,river2 = tempDataSyncS$river2</span></span>
<span id="cb56-18"><a href="#cb56-18" aria-hidden="true" tabindex="-1"></a>                         <span class="co"># ,river3 = tempDataSyncS$river3</span></span>
<span id="cb56-19"><a href="#cb56-19" aria-hidden="true" tabindex="-1"></a>                         <span class="co"># </span></span>
<span id="cb56-20"><a href="#cb56-20" aria-hidden="true" tabindex="-1"></a>                         <span class="co"># #river interaction with air temp</span></span>
<span id="cb56-21"><a href="#cb56-21" aria-hidden="true" tabindex="-1"></a>                         <span class="co"># ,river1Air = tempDataSyncS$river1 * tempDataSyncS$airTemp</span></span>
<span id="cb56-22"><a href="#cb56-22" aria-hidden="true" tabindex="-1"></a>                         <span class="co"># ,river2Air = tempDataSyncS$river2 * tempDataSyncS$airTemp</span></span>
<span id="cb56-23"><a href="#cb56-23" aria-hidden="true" tabindex="-1"></a>                         <span class="co"># ,river3Air = tempDataSyncS$river3 * tempDataSyncS$airTemp</span></span>
<span id="cb56-24"><a href="#cb56-24" aria-hidden="true" tabindex="-1"></a>                         </span>
<span id="cb56-25"><a href="#cb56-25" aria-hidden="true" tabindex="-1"></a>                          ) </span>
<span id="cb56-26"><a href="#cb56-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb56-27"><a href="#cb56-27" aria-hidden="true" tabindex="-1"></a>data.random.years <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">intercept.year =</span> <span class="dv">1</span>, </span>
<span id="cb56-28"><a href="#cb56-28" aria-hidden="true" tabindex="-1"></a>                     <span class="at">dOY  =</span> tempDataSyncS<span class="sc">$</span>dOY, </span>
<span id="cb56-29"><a href="#cb56-29" aria-hidden="true" tabindex="-1"></a>                     <span class="at">dOY2 =</span> tempDataSyncS<span class="sc">$</span>dOY<span class="sc">^</span><span class="dv">2</span>,</span>
<span id="cb56-30"><a href="#cb56-30" aria-hidden="true" tabindex="-1"></a>                     <span class="at">dOY3 =</span> tempDataSyncS<span class="sc">$</span>dOY<span class="sc">^</span><span class="dv">3</span></span>
<span id="cb56-31"><a href="#cb56-31" aria-hidden="true" tabindex="-1"></a>                     )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>Misc. objects</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb57"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb57-1"><a href="#cb57-1" aria-hidden="true" tabindex="-1"></a>Ti <span class="ot">&lt;-</span> <span class="fu">length</span>(<span class="fu">unique</span>(tempDataSyncS<span class="sc">$</span>year))</span>
<span id="cb57-2"><a href="#cb57-2" aria-hidden="true" tabindex="-1"></a>L <span class="ot">&lt;-</span> <span class="fu">dim</span>(data.random.years)[<span class="dv">2</span>]</span>
<span id="cb57-3"><a href="#cb57-3" aria-hidden="true" tabindex="-1"></a>W.year <span class="ot">&lt;-</span> <span class="fu">diag</span>(L)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>Combine data in list</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb58"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb58-1"><a href="#cb58-1" aria-hidden="true" tabindex="-1"></a><span class="co"># combine data in a list</span></span>
<span id="cb58-2"><a href="#cb58-2" aria-hidden="true" tabindex="-1"></a>jags.data <span class="ot">&lt;-</span> <span class="fu">list</span>(<span class="st">"temp"</span> <span class="ot">=</span> tempDataSyncS<span class="sc">$</span>temp,</span>
<span id="cb58-3"><a href="#cb58-3" aria-hidden="true" tabindex="-1"></a>                  <span class="st">"nFirstObsRows"</span> <span class="ot">=</span> nFirstObsRows,</span>
<span id="cb58-4"><a href="#cb58-4" aria-hidden="true" tabindex="-1"></a>                  <span class="st">"firstObsRows"</span> <span class="ot">=</span> firstObsRows,</span>
<span id="cb58-5"><a href="#cb58-5" aria-hidden="true" tabindex="-1"></a>                  <span class="st">"nEvalRows"</span> <span class="ot">=</span> nEvalRows,</span>
<span id="cb58-6"><a href="#cb58-6" aria-hidden="true" tabindex="-1"></a>                  <span class="st">"evalRows"</span> <span class="ot">=</span> evalRows,</span>
<span id="cb58-7"><a href="#cb58-7" aria-hidden="true" tabindex="-1"></a>                  <span class="st">"X.0"</span> <span class="ot">=</span> <span class="fu">as.matrix</span>(data.fixed),</span>
<span id="cb58-8"><a href="#cb58-8" aria-hidden="true" tabindex="-1"></a>                  <span class="st">"X.site"</span> <span class="ot">=</span> <span class="fu">as.matrix</span>(data.random),</span>
<span id="cb58-9"><a href="#cb58-9" aria-hidden="true" tabindex="-1"></a>                  <span class="st">"X.year"</span> <span class="ot">=</span> <span class="fu">as.matrix</span>(data.random.years),</span>
<span id="cb58-10"><a href="#cb58-10" aria-hidden="true" tabindex="-1"></a>                  <span class="st">"Kfixed"</span> <span class="ot">=</span> <span class="fu">dim</span>(data.fixed)[<span class="dv">2</span>],</span>
<span id="cb58-11"><a href="#cb58-11" aria-hidden="true" tabindex="-1"></a>                  <span class="st">"Krandom"</span> <span class="ot">=</span> <span class="fu">dim</span>(data.random)[<span class="dv">2</span>],</span>
<span id="cb58-12"><a href="#cb58-12" aria-hidden="true" tabindex="-1"></a>                  <span class="st">"nsites"</span> <span class="ot">=</span> <span class="fu">length</span>(<span class="fu">unique</span>(tempDataSyncS<span class="sc">$</span>site)),</span>
<span id="cb58-13"><a href="#cb58-13" aria-hidden="true" tabindex="-1"></a>                  <span class="st">"Ti"</span> <span class="ot">=</span> Ti,</span>
<span id="cb58-14"><a href="#cb58-14" aria-hidden="true" tabindex="-1"></a>                  <span class="st">"L"</span> <span class="ot">=</span> L,</span>
<span id="cb58-15"><a href="#cb58-15" aria-hidden="true" tabindex="-1"></a>                  <span class="st">"W.year"</span> <span class="ot">=</span> W.year,</span>
<span id="cb58-16"><a href="#cb58-16" aria-hidden="true" tabindex="-1"></a>                  <span class="st">"n"</span> <span class="ot">=</span> <span class="fu">dim</span>(tempDataSyncS)[<span class="dv">1</span>],</span>
<span id="cb58-17"><a href="#cb58-17" aria-hidden="true" tabindex="-1"></a>                  <span class="st">"year"</span> <span class="ot">=</span> <span class="fu">as.factor</span>(tempDataSyncS<span class="sc">$</span>year),</span>
<span id="cb58-18"><a href="#cb58-18" aria-hidden="true" tabindex="-1"></a>                  <span class="st">"site"</span> <span class="ot">=</span> <span class="fu">as.numeric</span>(tempDataSyncS<span class="sc">$</span>riverOrdered)</span>
<span id="cb58-19"><a href="#cb58-19" aria-hidden="true" tabindex="-1"></a>                  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>Parameters to monitor</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb59"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb59-1"><a href="#cb59-1" aria-hidden="true" tabindex="-1"></a>jags.params <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"residuals"</span>,</span>
<span id="cb59-2"><a href="#cb59-2" aria-hidden="true" tabindex="-1"></a>            <span class="st">"deviance"</span>,</span>
<span id="cb59-3"><a href="#cb59-3" aria-hidden="true" tabindex="-1"></a>            <span class="co">#"pD",</span></span>
<span id="cb59-4"><a href="#cb59-4" aria-hidden="true" tabindex="-1"></a>            <span class="st">"sigma"</span>,</span>
<span id="cb59-5"><a href="#cb59-5" aria-hidden="true" tabindex="-1"></a>            <span class="st">"B.0"</span>,</span>
<span id="cb59-6"><a href="#cb59-6" aria-hidden="true" tabindex="-1"></a>            <span class="st">"B.site"</span>,</span>
<span id="cb59-7"><a href="#cb59-7" aria-hidden="true" tabindex="-1"></a>            <span class="st">"B.year"</span>,</span>
<span id="cb59-8"><a href="#cb59-8" aria-hidden="true" tabindex="-1"></a>            <span class="co">#"mu.B.river",</span></span>
<span id="cb59-9"><a href="#cb59-9" aria-hidden="true" tabindex="-1"></a>            <span class="st">"rho.B.year"</span>,</span>
<span id="cb59-10"><a href="#cb59-10" aria-hidden="true" tabindex="-1"></a>            <span class="st">"mu.year"</span>,</span>
<span id="cb59-11"><a href="#cb59-11" aria-hidden="true" tabindex="-1"></a>            <span class="st">"sigma.b.year"</span>,</span>
<span id="cb59-12"><a href="#cb59-12" aria-hidden="true" tabindex="-1"></a>            <span class="st">"stream.mu"</span>,</span>
<span id="cb59-13"><a href="#cb59-13" aria-hidden="true" tabindex="-1"></a>            <span class="st">"ar1"</span> ,</span>
<span id="cb59-14"><a href="#cb59-14" aria-hidden="true" tabindex="-1"></a>            <span class="st">"ar1Mean"</span>,</span>
<span id="cb59-15"><a href="#cb59-15" aria-hidden="true" tabindex="-1"></a>            <span class="st">"ar1SD"</span>,</span>
<span id="cb59-16"><a href="#cb59-16" aria-hidden="true" tabindex="-1"></a>            <span class="st">"temp"</span>,</span>
<span id="cb59-17"><a href="#cb59-17" aria-hidden="true" tabindex="-1"></a>            <span class="st">"sigma.B.site"</span></span>
<span id="cb59-18"><a href="#cb59-18" aria-hidden="true" tabindex="-1"></a>            )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="fit-model-1" class="level3" data-number="5.2.3">
<h3 data-number="5.2.3" class="anchored" data-anchor-id="fit-model-1"><span class="header-section-number">5.2.3</span> Fit model</h3>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb60"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb60-1"><a href="#cb60-1" aria-hidden="true" tabindex="-1"></a>fit0_h <span class="ot">&lt;-</span> <span class="fu">jags.parallel</span>(<span class="at">data =</span> jags.data, <span class="at">inits =</span> <span class="cn">NULL</span>, <span class="at">parameters.to.save =</span> jags.params, </span>
<span id="cb60-2"><a href="#cb60-2" aria-hidden="true" tabindex="-1"></a>                        <span class="at">model.file =</span> <span class="st">"JAGS models/DailyTempModelJAGS_Letcher_hierarchical.txt"</span>,</span>
<span id="cb60-3"><a href="#cb60-3" aria-hidden="true" tabindex="-1"></a>                        <span class="at">n.chains =</span> <span class="dv">10</span>, <span class="at">n.thin =</span> <span class="dv">10</span>, <span class="at">n.burnin =</span> <span class="dv">1000</span>, <span class="at">n.iter =</span> <span class="dv">3000</span>, <span class="at">DIC =</span> <span class="cn">TRUE</span>)</span>
<span id="cb60-4"><a href="#cb60-4" aria-hidden="true" tabindex="-1"></a><span class="fu">beep</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<section id="save-model-output-1" class="level4" data-number="5.2.3.1">
<h4 data-number="5.2.3.1" class="anchored" data-anchor-id="save-model-output-1"><span class="header-section-number">5.2.3.1</span> Save model output</h4>
<p>Save to file</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb61"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb61-1"><a href="#cb61-1" aria-hidden="true" tabindex="-1"></a><span class="fu">saveRDS</span>(fit0_h, <span class="st">"Model objects/LetcherTempModel_PeerJ2016_hierarchical.RDS"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>Read in fitted model object</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb62"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb62-1"><a href="#cb62-1" aria-hidden="true" tabindex="-1"></a>fit0_h <span class="ot">&lt;-</span> <span class="fu">readRDS</span>(<span class="st">"Model objects/LetcherTempModel_PeerJ2016_hierarchical.RDS"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>Get MCMC samples and summary</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb63"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb63-1"><a href="#cb63-1" aria-hidden="true" tabindex="-1"></a>top_mod <span class="ot">&lt;-</span> fit0_h</span>
<span id="cb63-2"><a href="#cb63-2" aria-hidden="true" tabindex="-1"></a><span class="co"># generate MCMC samples and store as an array</span></span>
<span id="cb63-3"><a href="#cb63-3" aria-hidden="true" tabindex="-1"></a>modelout <span class="ot">&lt;-</span> top_mod<span class="sc">$</span>BUGSoutput</span>
<span id="cb63-4"><a href="#cb63-4" aria-hidden="true" tabindex="-1"></a>McmcList <span class="ot">&lt;-</span> <span class="fu">vector</span>(<span class="st">"list"</span>, <span class="at">length =</span> <span class="fu">dim</span>(modelout<span class="sc">$</span>sims.array)[<span class="dv">2</span>])</span>
<span id="cb63-5"><a href="#cb63-5" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(McmcList)) { McmcList[[i]] <span class="ot">=</span> <span class="fu">as.mcmc</span>(modelout<span class="sc">$</span>sims.array[,i,]) }</span>
<span id="cb63-6"><a href="#cb63-6" aria-hidden="true" tabindex="-1"></a><span class="co"># rbind MCMC samples from 10 chains </span></span>
<span id="cb63-7"><a href="#cb63-7" aria-hidden="true" tabindex="-1"></a>Mcmcdat <span class="ot">&lt;-</span> <span class="fu">rbind</span>(McmcList[[<span class="dv">1</span>]], McmcList[[<span class="dv">2</span>]], McmcList[[<span class="dv">3</span>]], McmcList[[<span class="dv">4</span>]], McmcList[[<span class="dv">5</span>]], McmcList[[<span class="dv">6</span>]], McmcList[[<span class="dv">7</span>]], McmcList[[<span class="dv">8</span>]], McmcList[[<span class="dv">9</span>]], McmcList[[<span class="dv">10</span>]])</span>
<span id="cb63-8"><a href="#cb63-8" aria-hidden="true" tabindex="-1"></a>param.summary <span class="ot">&lt;-</span> modelout<span class="sc">$</span>summary</span>
<span id="cb63-9"><a href="#cb63-9" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(param.summary)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>                  mean         sd       2.5%        25%        50%        75%
B.0[1]       0.1996561 0.01588663  0.1684552  0.1886198  0.1996409  0.2104592
B.0[2]       0.1601317 0.01647412  0.1274510  0.1493978  0.1605079  0.1708984
B.site[1,1] 15.0877438 0.17053466 14.7339107 14.9767446 15.0888867 15.2033860
B.site[2,1] 14.5154004 0.17175886 14.1691837 14.4035158 14.5196452 14.6311073
B.site[3,1] 15.6480333 0.17548672 15.3041803 15.5293132 15.6508855 15.7645190
B.site[4,1] 14.5004781 0.16993161 14.1586293 14.3871769 14.5034804 14.6162630
                 97.5%     Rhat n.eff
B.0[1]       0.2306411 1.001439  1900
B.0[2]       0.1926820 1.002371  1400
B.site[1,1] 15.4179276 1.000438  2000
B.site[2,1] 14.8386405 1.001710  1700
B.site[3,1] 15.9918072 1.000590  2000
B.site[4,1] 14.8276109 1.001154  2000</code></pre>
</div>
</div>
</section>
<section id="check-convergence-1" class="level4" data-number="5.2.3.2">
<h4 data-number="5.2.3.2" class="anchored" data-anchor-id="check-convergence-1"><span class="header-section-number">5.2.3.2</span> Check convergence</h4>
<p>Any problematic R-hat values (&gt;1.05)?</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb65"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb65-1"><a href="#cb65-1" aria-hidden="true" tabindex="-1"></a>top_mod<span class="sc">$</span>BUGSoutput<span class="sc">$</span>summary[,<span class="dv">8</span>][top_mod<span class="sc">$</span>BUGSoutput<span class="sc">$</span>summary[,<span class="dv">8</span>] <span class="sc">&gt;</span> <span class="fl">1.05</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>residuals[7152] 
       1.056715 </code></pre>
</div>
</div>
<p>View traceplots</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb67"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb67-1"><a href="#cb67-1" aria-hidden="true" tabindex="-1"></a><span class="fu">MCMCtrace</span>(top_mod, <span class="at">ind =</span> <span class="cn">TRUE</span>, </span>
<span id="cb67-2"><a href="#cb67-2" aria-hidden="true" tabindex="-1"></a>          <span class="at">params =</span> <span class="fu">c</span>(<span class="st">"B.0"</span>, <span class="st">"B.site"</span>, <span class="st">"mu.year"</span>,</span>
<span id="cb67-3"><a href="#cb67-3" aria-hidden="true" tabindex="-1"></a>                     <span class="st">"ar1"</span>, </span>
<span id="cb67-4"><a href="#cb67-4" aria-hidden="true" tabindex="-1"></a>                     <span class="st">"sigma"</span>), <span class="at">pdf =</span> <span class="cn">FALSE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="ModelTemp-Letcher_files/figure-html/unnamed-chunk-49-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="ModelTemp-Letcher_files/figure-html/unnamed-chunk-49-2.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="ModelTemp-Letcher_files/figure-html/unnamed-chunk-49-3.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="ModelTemp-Letcher_files/figure-html/unnamed-chunk-49-4.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="ModelTemp-Letcher_files/figure-html/unnamed-chunk-49-5.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="ModelTemp-Letcher_files/figure-html/unnamed-chunk-49-6.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="ModelTemp-Letcher_files/figure-html/unnamed-chunk-49-7.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="ModelTemp-Letcher_files/figure-html/unnamed-chunk-49-8.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="ModelTemp-Letcher_files/figure-html/unnamed-chunk-49-9.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>Convert to ggs object</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb68"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb68-1"><a href="#cb68-1" aria-hidden="true" tabindex="-1"></a>ggfit <span class="ot">&lt;-</span> <span class="fu">ggs</span>(<span class="fu">as.mcmc</span>(top_mod), <span class="at">keep_original_order =</span> <span class="cn">TRUE</span>)</span>
<span id="cb68-2"><a href="#cb68-2" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(ggfit)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 6 Ã— 4
  Iteration Chain Parameter value
      &lt;int&gt; &lt;int&gt; &lt;fct&gt;     &lt;dbl&gt;
1         1     1 ar1[1]    0.794
2         2     1 ar1[1]    0.777
3         3     1 ar1[1]    0.784
4         4     1 ar1[1]    0.805
5         5     1 ar1[1]    0.789
6         6     1 ar1[1]    0.785</code></pre>
</div>
</div>
</section>
</section>
<section id="goodness-of-fit-1" class="level3" data-number="5.2.4">
<h3 data-number="5.2.4" class="anchored" data-anchor-id="goodness-of-fit-1"><span class="header-section-number">5.2.4</span> Goodness of fit</h3>
<p>Format observed and predicted values</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb70"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb70-1"><a href="#cb70-1" aria-hidden="true" tabindex="-1"></a>Mcmcdat <span class="ot">&lt;-</span> <span class="fu">as_tibble</span>(Mcmcdat)</span>
<span id="cb70-2"><a href="#cb70-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-3"><a href="#cb70-3" aria-hidden="true" tabindex="-1"></a><span class="co"># subset expected and observed MCMC samples</span></span>
<span id="cb70-4"><a href="#cb70-4" aria-hidden="true" tabindex="-1"></a>ppdat_exp <span class="ot">&lt;-</span> <span class="fu">as.matrix</span>(Mcmcdat[,<span class="fu">startsWith</span>(<span class="fu">names</span>(Mcmcdat), <span class="st">"stream.mu["</span>)])</span>
<span id="cb70-5"><a href="#cb70-5" aria-hidden="true" tabindex="-1"></a>ppdat_obs <span class="ot">&lt;-</span> <span class="fu">as.matrix</span>(Mcmcdat[,<span class="fu">startsWith</span>(<span class="fu">names</span>(Mcmcdat), <span class="st">"temp["</span>)])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>Bayesian p-value</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb71"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb71-1"><a href="#cb71-1" aria-hidden="true" tabindex="-1"></a><span class="fu">sum</span>(ppdat_exp <span class="sc">&gt;</span> ppdat_obs) <span class="sc">/</span> (<span class="fu">dim</span>(ppdat_obs)[<span class="dv">1</span>]<span class="sc">*</span><span class="fu">dim</span>(ppdat_obs)[<span class="dv">2</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.4987867</code></pre>
</div>
</div>
<p>PP-check</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb73"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb73-1"><a href="#cb73-1" aria-hidden="true" tabindex="-1"></a>ppdat_obs_mean <span class="ot">&lt;-</span> <span class="fu">apply</span>(ppdat_obs, <span class="dv">2</span>, mean)</span>
<span id="cb73-2"><a href="#cb73-2" aria-hidden="true" tabindex="-1"></a>ppdat_exp_mean <span class="ot">&lt;-</span> <span class="fu">apply</span>(ppdat_exp, <span class="dv">2</span>, mean)</span>
<span id="cb73-3"><a href="#cb73-3" aria-hidden="true" tabindex="-1"></a><span class="fu">tibble</span>(<span class="at">obs =</span> ppdat_obs_mean, <span class="at">exp =</span> ppdat_exp_mean) <span class="sc">%&gt;%</span> </span>
<span id="cb73-4"><a href="#cb73-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> obs, <span class="at">y =</span> exp)) <span class="sc">+</span> </span>
<span id="cb73-5"><a href="#cb73-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">alpha =</span> <span class="fl">0.1</span>) <span class="sc">+</span> </span>
<span id="cb73-6"><a href="#cb73-6" aria-hidden="true" tabindex="-1"></a>  <span class="co"># geom_smooth(method = "lm") +</span></span>
<span id="cb73-7"><a href="#cb73-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_abline</span>(<span class="at">intercept =</span> <span class="dv">0</span>, <span class="at">slope =</span> <span class="dv">1</span>, <span class="at">color =</span> <span class="st">"red"</span>) <span class="sc">+</span> </span>
<span id="cb73-8"><a href="#cb73-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>() <span class="sc">+</span> <span class="fu">theme</span>(<span class="at">panel.grid =</span> <span class="fu">element_blank</span>()) <span class="sc">+</span></span>
<span id="cb73-9"><a href="#cb73-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="st">"Observed"</span>) <span class="sc">+</span> <span class="fu">ylab</span>(<span class="st">"Predicted (mean)"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="ModelTemp-Letcher_files/figure-html/unnamed-chunk-53-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="plot-model-output-1" class="level3" data-number="5.2.5">
<h3 data-number="5.2.5" class="anchored" data-anchor-id="plot-model-output-1"><span class="header-section-number">5.2.5</span> Plot model output</h3>
<section id="dot-plots-1" class="level4" data-number="5.2.5.1">
<h4 data-number="5.2.5.1" class="anchored" data-anchor-id="dot-plots-1"><span class="header-section-number">5.2.5.1</span> Dot plots</h4>
<p><em>Output is the same! Good!</em></p>
<p>Intercepts</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb74"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb74-1"><a href="#cb74-1" aria-hidden="true" tabindex="-1"></a>ggfit <span class="sc">%&gt;%</span></span>
<span id="cb74-2"><a href="#cb74-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(Parameter <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"B.site[1,1]"</span>, <span class="st">"B.site[2,1]"</span>, <span class="st">"B.site[3,1]"</span>, <span class="st">"B.site[4,1]"</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb74-3"><a href="#cb74-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Parameter =</span> <span class="fu">factor</span>(Parameter, <span class="at">levels =</span> <span class="fu">c</span>(<span class="st">"B.site[1,1]"</span>, <span class="st">"B.site[2,1]"</span>, <span class="st">"B.site[3,1]"</span>, <span class="st">"B.site[4,1]"</span>))) <span class="sc">%&gt;%</span></span>
<span id="cb74-4"><a href="#cb74-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggs_caterpillar</span>(<span class="at">sort =</span> <span class="cn">FALSE</span>) <span class="sc">+</span></span>
<span id="cb74-5"><a href="#cb74-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_discrete</span>(<span class="at">labels =</span> <span class="fu">rev</span>(<span class="fu">c</span>(<span class="st">"int_WB"</span>, <span class="st">"int_OL"</span>, <span class="st">"int_OS"</span>, <span class="st">"int_IS"</span>)), <span class="at">limits =</span> rev) <span class="sc">+</span> </span>
<span id="cb74-6"><a href="#cb74-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylab</span>(<span class="st">"Intercepts"</span>) <span class="sc">+</span></span>
<span id="cb74-7"><a href="#cb74-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="ModelTemp-Letcher_files/figure-html/unnamed-chunk-54-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>Slopes, temperature effect</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb75"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb75-1"><a href="#cb75-1" aria-hidden="true" tabindex="-1"></a>ggfit <span class="sc">%&gt;%</span></span>
<span id="cb75-2"><a href="#cb75-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(Iteration <span class="sc">&gt;</span> <span class="dv">125</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb75-3"><a href="#cb75-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(Parameter <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"B.site[1,2]"</span>, <span class="st">"B.site[2,2]"</span>, <span class="st">"B.site[3,2]"</span>, <span class="st">"B.site[4,2]"</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb75-4"><a href="#cb75-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Parameter =</span> <span class="fu">factor</span>(Parameter, <span class="at">levels =</span> <span class="fu">c</span>(<span class="st">"B.site[1,2]"</span>, <span class="st">"B.site[2,2]"</span>, <span class="st">"B.site[3,2]"</span>, <span class="st">"B.site[4,2]"</span>))) <span class="sc">%&gt;%</span></span>
<span id="cb75-5"><a href="#cb75-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggs_caterpillar</span>(<span class="at">sort =</span> <span class="cn">FALSE</span>) <span class="sc">+</span></span>
<span id="cb75-6"><a href="#cb75-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_discrete</span>(<span class="at">labels =</span> <span class="fu">rev</span>(<span class="fu">c</span>(<span class="st">"slo_WB"</span>, <span class="st">"slo_OL"</span>, <span class="st">"slo_OS"</span>, <span class="st">"slo_IS"</span>)), <span class="at">limits =</span> rev) <span class="sc">+</span> </span>
<span id="cb75-7"><a href="#cb75-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylab</span>(<span class="st">"Slopes, temperature effect"</span>) <span class="sc">+</span></span>
<span id="cb75-8"><a href="#cb75-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="ModelTemp-Letcher_files/figure-html/unnamed-chunk-55-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
</section>
</section>
<section id="hierarchical-flow-var." class="level2" data-number="5.3">
<h2 data-number="5.3" class="anchored" data-anchor-id="hierarchical-flow-var."><span class="header-section-number">5.3</span> Hierarchical, flow var.</h2>
<p>Use the same hierarchical model as above, but allow effect of flow and flow-temp interaction to vary by site.</p>
<section id="organize-objects-2" class="level3" data-number="5.3.1">
<h3 data-number="5.3.1" class="anchored" data-anchor-id="organize-objects-2"><span class="header-section-number">5.3.1</span> Organize objects</h3>
<p>Get first observation indices and check that nFirstRowObs equals the number of unique site-years: <strong>must be TRUE!</strong></p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb76"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb76-1"><a href="#cb76-1" aria-hidden="true" tabindex="-1"></a><span class="co"># row indices for first observation in each site-year</span></span>
<span id="cb76-2"><a href="#cb76-2" aria-hidden="true" tabindex="-1"></a>firstObsRows <span class="ot">&lt;-</span> <span class="fu">unlist</span>(tempDataSyncS <span class="sc">%&gt;%</span> </span>
<span id="cb76-3"><a href="#cb76-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(siteYear) <span class="sc">%&gt;%</span></span>
<span id="cb76-4"><a href="#cb76-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="at">index =</span> rowNum[<span class="fu">min</span>(<span class="fu">which</span>(<span class="sc">!</span><span class="fu">is.na</span>(temp)))]) <span class="sc">%&gt;%</span></span>
<span id="cb76-5"><a href="#cb76-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb76-6"><a href="#cb76-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(index))</span>
<span id="cb76-7"><a href="#cb76-7" aria-hidden="true" tabindex="-1"></a>nFirstObsRows <span class="ot">&lt;-</span> <span class="fu">length</span>(firstObsRows)</span>
<span id="cb76-8"><a href="#cb76-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb76-9"><a href="#cb76-9" aria-hidden="true" tabindex="-1"></a><span class="co"># does the number of first observations match the number of site years?</span></span>
<span id="cb76-10"><a href="#cb76-10" aria-hidden="true" tabindex="-1"></a>nFirstObsRows <span class="sc">==</span> <span class="fu">length</span>(<span class="fu">unique</span>(tempDataSyncS<span class="sc">$</span>siteYear))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>[1] TRUE</code></pre>
</div>
</div>
<p>Get row indices for all other observations</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb78"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb78-1"><a href="#cb78-1" aria-hidden="true" tabindex="-1"></a>evalRows <span class="ot">&lt;-</span> <span class="fu">unlist</span>(tempDataSyncS <span class="sc">%&gt;%</span> <span class="fu">filter</span>(<span class="sc">!</span>rowNum <span class="sc">%in%</span> firstObsRows) <span class="sc">%&gt;%</span> <span class="fu">select</span>(rowNum))</span>
<span id="cb78-2"><a href="#cb78-2" aria-hidden="true" tabindex="-1"></a>nEvalRows <span class="ot">&lt;-</span> <span class="fu">length</span>(evalRows)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>Fixed and random effect data</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb79"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb79-1"><a href="#cb79-1" aria-hidden="true" tabindex="-1"></a>data.random <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">intercept =</span> <span class="dv">1</span>,</span>
<span id="cb79-2"><a href="#cb79-2" aria-hidden="true" tabindex="-1"></a>                          <span class="at">airTemp =</span> tempDataSyncS<span class="sc">$</span>airTemp, </span>
<span id="cb79-3"><a href="#cb79-3" aria-hidden="true" tabindex="-1"></a>                          <span class="at">flow =</span>  tempDataSyncS<span class="sc">$</span>flowLS,</span>
<span id="cb79-4"><a href="#cb79-4" aria-hidden="true" tabindex="-1"></a>                          <span class="at">airFlow =</span> tempDataSyncS<span class="sc">$</span>airTemp <span class="sc">*</span> tempDataSyncS<span class="sc">$</span>flowLS)</span>
<span id="cb79-5"><a href="#cb79-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb79-6"><a href="#cb79-6" aria-hidden="true" tabindex="-1"></a>data.fixed <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="co">#intercept = 1</span></span>
<span id="cb79-7"><a href="#cb79-7" aria-hidden="true" tabindex="-1"></a>                         <span class="co">#,airTemp = tempDataSyncS$airTemp </span></span>
<span id="cb79-8"><a href="#cb79-8" aria-hidden="true" tabindex="-1"></a>                         <span class="at">airTempLag1 =</span> tempDataSyncS<span class="sc">$</span>airTempLagged1</span>
<span id="cb79-9"><a href="#cb79-9" aria-hidden="true" tabindex="-1"></a>                         ,<span class="at">airTempLag2 =</span> tempDataSyncS<span class="sc">$</span>airTempLagged2</span>
<span id="cb79-10"><a href="#cb79-10" aria-hidden="true" tabindex="-1"></a>                         </span>
<span id="cb79-11"><a href="#cb79-11" aria-hidden="true" tabindex="-1"></a>                         <span class="co"># ,flow =  tempDataSyncS$flowLS</span></span>
<span id="cb79-12"><a href="#cb79-12" aria-hidden="true" tabindex="-1"></a>                         <span class="co"># </span></span>
<span id="cb79-13"><a href="#cb79-13" aria-hidden="true" tabindex="-1"></a>                         <span class="co"># ,airFlow = tempDataSyncS$airTemp * tempDataSyncS$flowLS</span></span>
<span id="cb79-14"><a href="#cb79-14" aria-hidden="true" tabindex="-1"></a><span class="co">#                         ,air1Flow = tempDataSyncS$airTempLagged1 * tempDataSyncS$flowLS</span></span>
<span id="cb79-15"><a href="#cb79-15" aria-hidden="true" tabindex="-1"></a><span class="co">#                         ,air2Flow = tempDataSyncS$airTempLagged2 * tempDataSyncS$flowLS</span></span>
<span id="cb79-16"><a href="#cb79-16" aria-hidden="true" tabindex="-1"></a>                         </span>
<span id="cb79-17"><a href="#cb79-17" aria-hidden="true" tabindex="-1"></a>                         <span class="co">#main river effects</span></span>
<span id="cb79-18"><a href="#cb79-18" aria-hidden="true" tabindex="-1"></a>                         <span class="co"># ,river1 = tempDataSyncS$river1</span></span>
<span id="cb79-19"><a href="#cb79-19" aria-hidden="true" tabindex="-1"></a>                         <span class="co"># ,river2 = tempDataSyncS$river2</span></span>
<span id="cb79-20"><a href="#cb79-20" aria-hidden="true" tabindex="-1"></a>                         <span class="co"># ,river3 = tempDataSyncS$river3</span></span>
<span id="cb79-21"><a href="#cb79-21" aria-hidden="true" tabindex="-1"></a>                         <span class="co"># </span></span>
<span id="cb79-22"><a href="#cb79-22" aria-hidden="true" tabindex="-1"></a>                         <span class="co"># #river interaction with air temp</span></span>
<span id="cb79-23"><a href="#cb79-23" aria-hidden="true" tabindex="-1"></a>                         <span class="co"># ,river1Air = tempDataSyncS$river1 * tempDataSyncS$airTemp</span></span>
<span id="cb79-24"><a href="#cb79-24" aria-hidden="true" tabindex="-1"></a>                         <span class="co"># ,river2Air = tempDataSyncS$river2 * tempDataSyncS$airTemp</span></span>
<span id="cb79-25"><a href="#cb79-25" aria-hidden="true" tabindex="-1"></a>                         <span class="co"># ,river3Air = tempDataSyncS$river3 * tempDataSyncS$airTemp</span></span>
<span id="cb79-26"><a href="#cb79-26" aria-hidden="true" tabindex="-1"></a>                         </span>
<span id="cb79-27"><a href="#cb79-27" aria-hidden="true" tabindex="-1"></a>                          ) </span>
<span id="cb79-28"><a href="#cb79-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb79-29"><a href="#cb79-29" aria-hidden="true" tabindex="-1"></a>data.random.years <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">intercept.year =</span> <span class="dv">1</span>, </span>
<span id="cb79-30"><a href="#cb79-30" aria-hidden="true" tabindex="-1"></a>                     <span class="at">dOY  =</span> tempDataSyncS<span class="sc">$</span>dOY, </span>
<span id="cb79-31"><a href="#cb79-31" aria-hidden="true" tabindex="-1"></a>                     <span class="at">dOY2 =</span> tempDataSyncS<span class="sc">$</span>dOY<span class="sc">^</span><span class="dv">2</span>,</span>
<span id="cb79-32"><a href="#cb79-32" aria-hidden="true" tabindex="-1"></a>                     <span class="at">dOY3 =</span> tempDataSyncS<span class="sc">$</span>dOY<span class="sc">^</span><span class="dv">3</span></span>
<span id="cb79-33"><a href="#cb79-33" aria-hidden="true" tabindex="-1"></a>                     )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>Misc. objects</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb80"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb80-1"><a href="#cb80-1" aria-hidden="true" tabindex="-1"></a>Ti <span class="ot">&lt;-</span> <span class="fu">length</span>(<span class="fu">unique</span>(tempDataSyncS<span class="sc">$</span>year))</span>
<span id="cb80-2"><a href="#cb80-2" aria-hidden="true" tabindex="-1"></a>L <span class="ot">&lt;-</span> <span class="fu">dim</span>(data.random.years)[<span class="dv">2</span>]</span>
<span id="cb80-3"><a href="#cb80-3" aria-hidden="true" tabindex="-1"></a>W.year <span class="ot">&lt;-</span> <span class="fu">diag</span>(L)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>Combine data in list</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb81"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb81-1"><a href="#cb81-1" aria-hidden="true" tabindex="-1"></a><span class="co"># combine data in a list</span></span>
<span id="cb81-2"><a href="#cb81-2" aria-hidden="true" tabindex="-1"></a>jags.data <span class="ot">&lt;-</span> <span class="fu">list</span>(<span class="st">"temp"</span> <span class="ot">=</span> tempDataSyncS<span class="sc">$</span>temp,</span>
<span id="cb81-3"><a href="#cb81-3" aria-hidden="true" tabindex="-1"></a>                  <span class="st">"nFirstObsRows"</span> <span class="ot">=</span> nFirstObsRows,</span>
<span id="cb81-4"><a href="#cb81-4" aria-hidden="true" tabindex="-1"></a>                  <span class="st">"firstObsRows"</span> <span class="ot">=</span> firstObsRows,</span>
<span id="cb81-5"><a href="#cb81-5" aria-hidden="true" tabindex="-1"></a>                  <span class="st">"nEvalRows"</span> <span class="ot">=</span> nEvalRows,</span>
<span id="cb81-6"><a href="#cb81-6" aria-hidden="true" tabindex="-1"></a>                  <span class="st">"evalRows"</span> <span class="ot">=</span> evalRows,</span>
<span id="cb81-7"><a href="#cb81-7" aria-hidden="true" tabindex="-1"></a>                  <span class="st">"X.0"</span> <span class="ot">=</span> <span class="fu">as.matrix</span>(data.fixed),</span>
<span id="cb81-8"><a href="#cb81-8" aria-hidden="true" tabindex="-1"></a>                  <span class="st">"X.site"</span> <span class="ot">=</span> <span class="fu">as.matrix</span>(data.random),</span>
<span id="cb81-9"><a href="#cb81-9" aria-hidden="true" tabindex="-1"></a>                  <span class="st">"X.year"</span> <span class="ot">=</span> <span class="fu">as.matrix</span>(data.random.years),</span>
<span id="cb81-10"><a href="#cb81-10" aria-hidden="true" tabindex="-1"></a>                  <span class="st">"Kfixed"</span> <span class="ot">=</span> <span class="fu">dim</span>(data.fixed)[<span class="dv">2</span>],</span>
<span id="cb81-11"><a href="#cb81-11" aria-hidden="true" tabindex="-1"></a>                  <span class="st">"Krandom"</span> <span class="ot">=</span> <span class="fu">dim</span>(data.random)[<span class="dv">2</span>],</span>
<span id="cb81-12"><a href="#cb81-12" aria-hidden="true" tabindex="-1"></a>                  <span class="st">"nsites"</span> <span class="ot">=</span> <span class="fu">length</span>(<span class="fu">unique</span>(tempDataSyncS<span class="sc">$</span>site)),</span>
<span id="cb81-13"><a href="#cb81-13" aria-hidden="true" tabindex="-1"></a>                  <span class="st">"Ti"</span> <span class="ot">=</span> Ti,</span>
<span id="cb81-14"><a href="#cb81-14" aria-hidden="true" tabindex="-1"></a>                  <span class="st">"L"</span> <span class="ot">=</span> L,</span>
<span id="cb81-15"><a href="#cb81-15" aria-hidden="true" tabindex="-1"></a>                  <span class="st">"W.year"</span> <span class="ot">=</span> W.year,</span>
<span id="cb81-16"><a href="#cb81-16" aria-hidden="true" tabindex="-1"></a>                  <span class="st">"n"</span> <span class="ot">=</span> <span class="fu">dim</span>(tempDataSyncS)[<span class="dv">1</span>],</span>
<span id="cb81-17"><a href="#cb81-17" aria-hidden="true" tabindex="-1"></a>                  <span class="st">"year"</span> <span class="ot">=</span> <span class="fu">as.factor</span>(tempDataSyncS<span class="sc">$</span>year),</span>
<span id="cb81-18"><a href="#cb81-18" aria-hidden="true" tabindex="-1"></a>                  <span class="st">"site"</span> <span class="ot">=</span> <span class="fu">as.numeric</span>(tempDataSyncS<span class="sc">$</span>riverOrdered)</span>
<span id="cb81-19"><a href="#cb81-19" aria-hidden="true" tabindex="-1"></a>                  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>Parameters to monitor</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb82"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb82-1"><a href="#cb82-1" aria-hidden="true" tabindex="-1"></a>jags.params <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"residuals"</span>,</span>
<span id="cb82-2"><a href="#cb82-2" aria-hidden="true" tabindex="-1"></a>            <span class="st">"deviance"</span>,</span>
<span id="cb82-3"><a href="#cb82-3" aria-hidden="true" tabindex="-1"></a>            <span class="co">#"pD",</span></span>
<span id="cb82-4"><a href="#cb82-4" aria-hidden="true" tabindex="-1"></a>            <span class="st">"sigma"</span>,</span>
<span id="cb82-5"><a href="#cb82-5" aria-hidden="true" tabindex="-1"></a>            <span class="st">"B.0"</span>,</span>
<span id="cb82-6"><a href="#cb82-6" aria-hidden="true" tabindex="-1"></a>            <span class="st">"B.site"</span>,</span>
<span id="cb82-7"><a href="#cb82-7" aria-hidden="true" tabindex="-1"></a>            <span class="st">"B.year"</span>,</span>
<span id="cb82-8"><a href="#cb82-8" aria-hidden="true" tabindex="-1"></a>            <span class="co">#"mu.B.river",</span></span>
<span id="cb82-9"><a href="#cb82-9" aria-hidden="true" tabindex="-1"></a>            <span class="st">"rho.B.year"</span>,</span>
<span id="cb82-10"><a href="#cb82-10" aria-hidden="true" tabindex="-1"></a>            <span class="st">"mu.year"</span>,</span>
<span id="cb82-11"><a href="#cb82-11" aria-hidden="true" tabindex="-1"></a>            <span class="st">"sigma.b.year"</span>,</span>
<span id="cb82-12"><a href="#cb82-12" aria-hidden="true" tabindex="-1"></a>            <span class="st">"stream.mu"</span>,</span>
<span id="cb82-13"><a href="#cb82-13" aria-hidden="true" tabindex="-1"></a>            <span class="st">"ar1"</span> ,</span>
<span id="cb82-14"><a href="#cb82-14" aria-hidden="true" tabindex="-1"></a>            <span class="st">"ar1Mean"</span>,</span>
<span id="cb82-15"><a href="#cb82-15" aria-hidden="true" tabindex="-1"></a>            <span class="st">"ar1SD"</span>,</span>
<span id="cb82-16"><a href="#cb82-16" aria-hidden="true" tabindex="-1"></a>            <span class="st">"temp"</span>,</span>
<span id="cb82-17"><a href="#cb82-17" aria-hidden="true" tabindex="-1"></a>            <span class="st">"sigma.B.site"</span></span>
<span id="cb82-18"><a href="#cb82-18" aria-hidden="true" tabindex="-1"></a>            )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="fit-model-2" class="level3" data-number="5.3.2">
<h3 data-number="5.3.2" class="anchored" data-anchor-id="fit-model-2"><span class="header-section-number">5.3.2</span> Fit model</h3>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb83"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb83-1"><a href="#cb83-1" aria-hidden="true" tabindex="-1"></a>fit0_h2 <span class="ot">&lt;-</span> <span class="fu">jags.parallel</span>(<span class="at">data =</span> jags.data, <span class="at">inits =</span> <span class="cn">NULL</span>, <span class="at">parameters.to.save =</span> jags.params, </span>
<span id="cb83-2"><a href="#cb83-2" aria-hidden="true" tabindex="-1"></a>                         <span class="at">model.file =</span> <span class="st">"JAGS models/DailyTempModelJAGS_Letcher_hierarchical.txt"</span>,</span>
<span id="cb83-3"><a href="#cb83-3" aria-hidden="true" tabindex="-1"></a>                         <span class="at">n.chains =</span> <span class="dv">10</span>, <span class="at">n.thin =</span> <span class="dv">10</span>, <span class="at">n.burnin =</span> <span class="dv">1000</span>, <span class="at">n.iter =</span> <span class="dv">3000</span>, <span class="at">DIC =</span> <span class="cn">TRUE</span>)</span>
<span id="cb83-4"><a href="#cb83-4" aria-hidden="true" tabindex="-1"></a><span class="fu">beep</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<section id="save-model-ouput" class="level4" data-number="5.3.2.1">
<h4 data-number="5.3.2.1" class="anchored" data-anchor-id="save-model-ouput"><span class="header-section-number">5.3.2.1</span> Save model ouput</h4>
<p>Save to file</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb84"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb84-1"><a href="#cb84-1" aria-hidden="true" tabindex="-1"></a><span class="fu">saveRDS</span>(fit0_h2, <span class="st">"Model objects/LetcherTempModel_PeerJ2016_hierarchical.RDS"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>Read in fitted model object</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb85"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb85-1"><a href="#cb85-1" aria-hidden="true" tabindex="-1"></a>fit0_h2 <span class="ot">&lt;-</span> <span class="fu">readRDS</span>(<span class="st">"Model objects/LetcherTempModel_PeerJ2016_hierarchical.RDS"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>Get MCMC samples and summary</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb86"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb86-1"><a href="#cb86-1" aria-hidden="true" tabindex="-1"></a>top_mod <span class="ot">&lt;-</span> fit0_h2</span>
<span id="cb86-2"><a href="#cb86-2" aria-hidden="true" tabindex="-1"></a><span class="co"># generate MCMC samples and store as an array</span></span>
<span id="cb86-3"><a href="#cb86-3" aria-hidden="true" tabindex="-1"></a>modelout <span class="ot">&lt;-</span> top_mod<span class="sc">$</span>BUGSoutput</span>
<span id="cb86-4"><a href="#cb86-4" aria-hidden="true" tabindex="-1"></a>McmcList <span class="ot">&lt;-</span> <span class="fu">vector</span>(<span class="st">"list"</span>, <span class="at">length =</span> <span class="fu">dim</span>(modelout<span class="sc">$</span>sims.array)[<span class="dv">2</span>])</span>
<span id="cb86-5"><a href="#cb86-5" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(McmcList)) { McmcList[[i]] <span class="ot">=</span> <span class="fu">as.mcmc</span>(modelout<span class="sc">$</span>sims.array[,i,]) }</span>
<span id="cb86-6"><a href="#cb86-6" aria-hidden="true" tabindex="-1"></a><span class="co"># rbind MCMC samples from 10 chains </span></span>
<span id="cb86-7"><a href="#cb86-7" aria-hidden="true" tabindex="-1"></a>Mcmcdat <span class="ot">&lt;-</span> <span class="fu">rbind</span>(McmcList[[<span class="dv">1</span>]], McmcList[[<span class="dv">2</span>]], McmcList[[<span class="dv">3</span>]], McmcList[[<span class="dv">4</span>]], McmcList[[<span class="dv">5</span>]], McmcList[[<span class="dv">6</span>]], McmcList[[<span class="dv">7</span>]], McmcList[[<span class="dv">8</span>]], McmcList[[<span class="dv">9</span>]], McmcList[[<span class="dv">10</span>]])</span>
<span id="cb86-8"><a href="#cb86-8" aria-hidden="true" tabindex="-1"></a>param.summary <span class="ot">&lt;-</span> modelout<span class="sc">$</span>summary</span>
<span id="cb86-9"><a href="#cb86-9" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(param.summary)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>                  mean         sd       2.5%        25%        50%        75%
B.0[1]       0.1996561 0.01588663  0.1684552  0.1886198  0.1996409  0.2104592
B.0[2]       0.1601317 0.01647412  0.1274510  0.1493978  0.1605079  0.1708984
B.site[1,1] 15.0877438 0.17053466 14.7339107 14.9767446 15.0888867 15.2033860
B.site[2,1] 14.5154004 0.17175886 14.1691837 14.4035158 14.5196452 14.6311073
B.site[3,1] 15.6480333 0.17548672 15.3041803 15.5293132 15.6508855 15.7645190
B.site[4,1] 14.5004781 0.16993161 14.1586293 14.3871769 14.5034804 14.6162630
                 97.5%     Rhat n.eff
B.0[1]       0.2306411 1.001439  1900
B.0[2]       0.1926820 1.002371  1400
B.site[1,1] 15.4179276 1.000438  2000
B.site[2,1] 14.8386405 1.001710  1700
B.site[3,1] 15.9918072 1.000590  2000
B.site[4,1] 14.8276109 1.001154  2000</code></pre>
</div>
</div>
</section>
<section id="check-convergence-2" class="level4" data-number="5.3.2.2">
<h4 data-number="5.3.2.2" class="anchored" data-anchor-id="check-convergence-2"><span class="header-section-number">5.3.2.2</span> Check convergence</h4>
<p>Any problematic R-hat values (&gt;1.05)?</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb88"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb88-1"><a href="#cb88-1" aria-hidden="true" tabindex="-1"></a>top_mod<span class="sc">$</span>BUGSoutput<span class="sc">$</span>summary[,<span class="dv">8</span>][top_mod<span class="sc">$</span>BUGSoutput<span class="sc">$</span>summary[,<span class="dv">8</span>] <span class="sc">&gt;</span> <span class="fl">1.05</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>residuals[7152] 
       1.056715 </code></pre>
</div>
</div>
<p>View traceplots</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb90"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb90-1"><a href="#cb90-1" aria-hidden="true" tabindex="-1"></a><span class="fu">MCMCtrace</span>(top_mod, <span class="at">ind =</span> <span class="cn">TRUE</span>, </span>
<span id="cb90-2"><a href="#cb90-2" aria-hidden="true" tabindex="-1"></a>          <span class="at">params =</span> <span class="fu">c</span>(<span class="st">"B.0"</span>, <span class="st">"B.site"</span>, <span class="st">"mu.year"</span>, </span>
<span id="cb90-3"><a href="#cb90-3" aria-hidden="true" tabindex="-1"></a>                     <span class="st">"ar1"</span>, </span>
<span id="cb90-4"><a href="#cb90-4" aria-hidden="true" tabindex="-1"></a>                     <span class="st">"sigma"</span>), <span class="at">pdf =</span> <span class="cn">FALSE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="ModelTemp-Letcher_files/figure-html/unnamed-chunk-67-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="ModelTemp-Letcher_files/figure-html/unnamed-chunk-67-2.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="ModelTemp-Letcher_files/figure-html/unnamed-chunk-67-3.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="ModelTemp-Letcher_files/figure-html/unnamed-chunk-67-4.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="ModelTemp-Letcher_files/figure-html/unnamed-chunk-67-5.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="ModelTemp-Letcher_files/figure-html/unnamed-chunk-67-6.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="ModelTemp-Letcher_files/figure-html/unnamed-chunk-67-7.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="ModelTemp-Letcher_files/figure-html/unnamed-chunk-67-8.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="ModelTemp-Letcher_files/figure-html/unnamed-chunk-67-9.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>Convert to ggs object</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb91"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb91-1"><a href="#cb91-1" aria-hidden="true" tabindex="-1"></a>ggfit <span class="ot">&lt;-</span> <span class="fu">ggs</span>(<span class="fu">as.mcmc</span>(top_mod), <span class="at">keep_original_order =</span> <span class="cn">TRUE</span>)</span>
<span id="cb91-2"><a href="#cb91-2" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(ggfit)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 6 Ã— 4
  Iteration Chain Parameter value
      &lt;int&gt; &lt;int&gt; &lt;fct&gt;     &lt;dbl&gt;
1         1     1 ar1[1]    0.794
2         2     1 ar1[1]    0.777
3         3     1 ar1[1]    0.784
4         4     1 ar1[1]    0.805
5         5     1 ar1[1]    0.789
6         6     1 ar1[1]    0.785</code></pre>
</div>
</div>
</section>
</section>
<section id="goodness-of-fit-2" class="level3" data-number="5.3.3">
<h3 data-number="5.3.3" class="anchored" data-anchor-id="goodness-of-fit-2"><span class="header-section-number">5.3.3</span> Goodness of fit</h3>
<p>Format observed and predicted values</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb93"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb93-1"><a href="#cb93-1" aria-hidden="true" tabindex="-1"></a>Mcmcdat <span class="ot">&lt;-</span> <span class="fu">as_tibble</span>(Mcmcdat)</span>
<span id="cb93-2"><a href="#cb93-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb93-3"><a href="#cb93-3" aria-hidden="true" tabindex="-1"></a><span class="co"># subset expected and observed MCMC samples</span></span>
<span id="cb93-4"><a href="#cb93-4" aria-hidden="true" tabindex="-1"></a>ppdat_exp <span class="ot">&lt;-</span> <span class="fu">as.matrix</span>(Mcmcdat[,<span class="fu">startsWith</span>(<span class="fu">names</span>(Mcmcdat), <span class="st">"stream.mu["</span>)])</span>
<span id="cb93-5"><a href="#cb93-5" aria-hidden="true" tabindex="-1"></a>ppdat_obs <span class="ot">&lt;-</span> <span class="fu">as.matrix</span>(Mcmcdat[,<span class="fu">startsWith</span>(<span class="fu">names</span>(Mcmcdat), <span class="st">"temp["</span>)])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>Bayesian p-value</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb94"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb94-1"><a href="#cb94-1" aria-hidden="true" tabindex="-1"></a><span class="fu">sum</span>(ppdat_exp <span class="sc">&gt;</span> ppdat_obs) <span class="sc">/</span> (<span class="fu">dim</span>(ppdat_obs)[<span class="dv">1</span>]<span class="sc">*</span><span class="fu">dim</span>(ppdat_obs)[<span class="dv">2</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.4987867</code></pre>
</div>
</div>
<p>PP-check</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb96"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb96-1"><a href="#cb96-1" aria-hidden="true" tabindex="-1"></a>ppdat_obs_mean <span class="ot">&lt;-</span> <span class="fu">apply</span>(ppdat_obs, <span class="dv">2</span>, mean)</span>
<span id="cb96-2"><a href="#cb96-2" aria-hidden="true" tabindex="-1"></a>ppdat_exp_mean <span class="ot">&lt;-</span> <span class="fu">apply</span>(ppdat_exp, <span class="dv">2</span>, mean)</span>
<span id="cb96-3"><a href="#cb96-3" aria-hidden="true" tabindex="-1"></a><span class="fu">tibble</span>(<span class="at">obs =</span> ppdat_obs_mean, <span class="at">exp =</span> ppdat_exp_mean) <span class="sc">%&gt;%</span> </span>
<span id="cb96-4"><a href="#cb96-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> obs, <span class="at">y =</span> exp)) <span class="sc">+</span> </span>
<span id="cb96-5"><a href="#cb96-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">alpha =</span> <span class="fl">0.1</span>) <span class="sc">+</span> </span>
<span id="cb96-6"><a href="#cb96-6" aria-hidden="true" tabindex="-1"></a>  <span class="co"># geom_smooth(method = "lm") +</span></span>
<span id="cb96-7"><a href="#cb96-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_abline</span>(<span class="at">intercept =</span> <span class="dv">0</span>, <span class="at">slope =</span> <span class="dv">1</span>, <span class="at">color =</span> <span class="st">"red"</span>) <span class="sc">+</span> </span>
<span id="cb96-8"><a href="#cb96-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>() <span class="sc">+</span> <span class="fu">theme</span>(<span class="at">panel.grid =</span> <span class="fu">element_blank</span>()) <span class="sc">+</span></span>
<span id="cb96-9"><a href="#cb96-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="st">"Observed"</span>) <span class="sc">+</span> <span class="fu">ylab</span>(<span class="st">"Predicted (mean)"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="ModelTemp-Letcher_files/figure-html/unnamed-chunk-71-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="plot-model-output-2" class="level3" data-number="5.3.4">
<h3 data-number="5.3.4" class="anchored" data-anchor-id="plot-model-output-2"><span class="header-section-number">5.3.4</span> Plot model output</h3>
<section id="dot-plots-2" class="level4" data-number="5.3.4.1">
<h4 data-number="5.3.4.1" class="anchored" data-anchor-id="dot-plots-2"><span class="header-section-number">5.3.4.1</span> Dot plots</h4>
<div class="tabset-margin-container"></div><div class="panel-tabset">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-4-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-4-1" role="tab" aria-controls="tabset-4-1" aria-selected="true">Site intercepts</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-4-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-4-2" role="tab" aria-controls="tabset-4-2" aria-selected="false">Site slopes - temp</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-4-3-tab" data-bs-toggle="tab" data-bs-target="#tabset-4-3" role="tab" aria-controls="tabset-4-3" aria-selected="false">Site slopes - flow</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-4-4-tab" data-bs-toggle="tab" data-bs-target="#tabset-4-4" role="tab" aria-controls="tabset-4-4" aria-selected="false">Site slopes - temp x flow</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-4-5-tab" data-bs-toggle="tab" data-bs-target="#tabset-4-5" role="tab" aria-controls="tabset-4-5" aria-selected="false">Autoregressive terms</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-4-6-tab" data-bs-toggle="tab" data-bs-target="#tabset-4-6" role="tab" aria-controls="tabset-4-6" aria-selected="false">Within year trends</a></li></ul>
<div class="tab-content">
<div id="tabset-4-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-4-1-tab">
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb97"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb97-1"><a href="#cb97-1" aria-hidden="true" tabindex="-1"></a>ggfit <span class="sc">%&gt;%</span></span>
<span id="cb97-2"><a href="#cb97-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(Parameter <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"B.site[1,1]"</span>, <span class="st">"B.site[2,1]"</span>, <span class="st">"B.site[3,1]"</span>, <span class="st">"B.site[4,1]"</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb97-3"><a href="#cb97-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Parameter =</span> <span class="fu">factor</span>(Parameter, <span class="at">levels =</span> <span class="fu">c</span>(<span class="st">"B.site[1,1]"</span>, <span class="st">"B.site[2,1]"</span>, <span class="st">"B.site[3,1]"</span>, <span class="st">"B.site[4,1]"</span>))) <span class="sc">%&gt;%</span></span>
<span id="cb97-4"><a href="#cb97-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggs_caterpillar</span>(<span class="at">sort =</span> <span class="cn">FALSE</span>) <span class="sc">+</span></span>
<span id="cb97-5"><a href="#cb97-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_discrete</span>(<span class="at">labels =</span> <span class="fu">rev</span>(<span class="fu">c</span>(<span class="st">"int_WB"</span>, <span class="st">"int_OL"</span>, <span class="st">"int_OS"</span>, <span class="st">"int_IS"</span>)), <span class="at">limits =</span> rev) <span class="sc">+</span> </span>
<span id="cb97-6"><a href="#cb97-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylab</span>(<span class="st">"Intercepts"</span>) <span class="sc">+</span></span>
<span id="cb97-7"><a href="#cb97-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="ModelTemp-Letcher_files/figure-html/unnamed-chunk-72-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</div>
<div id="tabset-4-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-4-2-tab">
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb98"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb98-1"><a href="#cb98-1" aria-hidden="true" tabindex="-1"></a>ggfit <span class="sc">%&gt;%</span></span>
<span id="cb98-2"><a href="#cb98-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(Parameter <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"B.site[1,2]"</span>, <span class="st">"B.site[2,2]"</span>, <span class="st">"B.site[3,2]"</span>, <span class="st">"B.site[4,2]"</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb98-3"><a href="#cb98-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Parameter =</span> <span class="fu">factor</span>(Parameter, <span class="at">levels =</span> <span class="fu">c</span>(<span class="st">"B.site[1,2]"</span>, <span class="st">"B.site[2,2]"</span>, <span class="st">"B.site[3,2]"</span>, <span class="st">"B.site[4,2]"</span>))) <span class="sc">%&gt;%</span></span>
<span id="cb98-4"><a href="#cb98-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggs_caterpillar</span>(<span class="at">sort =</span> <span class="cn">FALSE</span>) <span class="sc">+</span></span>
<span id="cb98-5"><a href="#cb98-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_discrete</span>(<span class="at">labels =</span> <span class="fu">rev</span>(<span class="fu">c</span>(<span class="st">"slo_WB"</span>, <span class="st">"slo_OL"</span>, <span class="st">"slo_OS"</span>, <span class="st">"slo_IS"</span>)), <span class="at">limits =</span> rev) <span class="sc">+</span> </span>
<span id="cb98-6"><a href="#cb98-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylab</span>(<span class="st">"Slopes, temperature effect"</span>) <span class="sc">+</span></span>
<span id="cb98-7"><a href="#cb98-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="ModelTemp-Letcher_files/figure-html/unnamed-chunk-73-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</div>
<div id="tabset-4-3" class="tab-pane" role="tabpanel" aria-labelledby="tabset-4-3-tab">
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb99"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb99-1"><a href="#cb99-1" aria-hidden="true" tabindex="-1"></a>ggfit <span class="sc">%&gt;%</span></span>
<span id="cb99-2"><a href="#cb99-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(Parameter <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"B.site[1,3]"</span>, <span class="st">"B.site[2,3]"</span>, <span class="st">"B.site[3,3]"</span>, <span class="st">"B.site[4,3]"</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb99-3"><a href="#cb99-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Parameter =</span> <span class="fu">factor</span>(Parameter, <span class="at">levels =</span> <span class="fu">c</span>(<span class="st">"B.site[1,3]"</span>, <span class="st">"B.site[2,3]"</span>, <span class="st">"B.site[3,3]"</span>, <span class="st">"B.site[4,3]"</span>))) <span class="sc">%&gt;%</span></span>
<span id="cb99-4"><a href="#cb99-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggs_caterpillar</span>(<span class="at">sort =</span> <span class="cn">FALSE</span>) <span class="sc">+</span></span>
<span id="cb99-5"><a href="#cb99-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_discrete</span>(<span class="at">labels =</span> <span class="fu">rev</span>(<span class="fu">c</span>(<span class="st">"slo_WB"</span>, <span class="st">"slo_OL"</span>, <span class="st">"slo_OS"</span>, <span class="st">"slo_IS"</span>)), <span class="at">limits =</span> rev) <span class="sc">+</span> </span>
<span id="cb99-6"><a href="#cb99-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylab</span>(<span class="st">"Slopes, flow effect"</span>) <span class="sc">+</span></span>
<span id="cb99-7"><a href="#cb99-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="ModelTemp-Letcher_files/figure-html/unnamed-chunk-74-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</div>
<div id="tabset-4-4" class="tab-pane" role="tabpanel" aria-labelledby="tabset-4-4-tab">
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb100"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb100-1"><a href="#cb100-1" aria-hidden="true" tabindex="-1"></a>ggfit <span class="sc">%&gt;%</span></span>
<span id="cb100-2"><a href="#cb100-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(Parameter <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"B.site[1,4]"</span>, <span class="st">"B.site[2,4]"</span>, <span class="st">"B.site[3,4]"</span>, <span class="st">"B.site[4,4]"</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb100-3"><a href="#cb100-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Parameter =</span> <span class="fu">factor</span>(Parameter, <span class="at">levels =</span> <span class="fu">c</span>(<span class="st">"B.site[1,4]"</span>, <span class="st">"B.site[2,4]"</span>, <span class="st">"B.site[3,4]"</span>, <span class="st">"B.site[4,4]"</span>))) <span class="sc">%&gt;%</span></span>
<span id="cb100-4"><a href="#cb100-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggs_caterpillar</span>(<span class="at">sort =</span> <span class="cn">FALSE</span>) <span class="sc">+</span></span>
<span id="cb100-5"><a href="#cb100-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_discrete</span>(<span class="at">labels =</span> <span class="fu">rev</span>(<span class="fu">c</span>(<span class="st">"slo_WB"</span>, <span class="st">"slo_OL"</span>, <span class="st">"slo_OS"</span>, <span class="st">"slo_IS"</span>)), <span class="at">limits =</span> rev) <span class="sc">+</span> </span>
<span id="cb100-6"><a href="#cb100-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylab</span>(<span class="st">"Slopes, temp-flow interaction"</span>) <span class="sc">+</span></span>
<span id="cb100-7"><a href="#cb100-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="ModelTemp-Letcher_files/figure-html/unnamed-chunk-75-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</div>
<div id="tabset-4-5" class="tab-pane" role="tabpanel" aria-labelledby="tabset-4-5-tab">
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb101"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb101-1"><a href="#cb101-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggs_caterpillar</span>(ggfit <span class="sc">%&gt;%</span> <span class="fu">filter</span>(Parameter <span class="sc">%in%</span> <span class="fu">grep</span>(<span class="st">"ar1"</span>, <span class="fu">unique</span>(ggfit<span class="sc">$</span>Parameter), <span class="at">value =</span> <span class="cn">TRUE</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb101-2"><a href="#cb101-2" aria-hidden="true" tabindex="-1"></a>                  <span class="fu">mutate</span>(<span class="at">Parameter =</span> <span class="fu">factor</span>(Parameter, <span class="at">levels =</span> <span class="fu">c</span>(<span class="st">"ar1Mean"</span>, <span class="st">"ar1SD"</span>, <span class="st">"ar1[1]"</span>, <span class="st">"ar1[2]"</span>, <span class="st">"ar1[3]"</span>, <span class="st">"ar1[4]"</span>))),</span>
<span id="cb101-3"><a href="#cb101-3" aria-hidden="true" tabindex="-1"></a>                <span class="at">sort =</span> <span class="cn">FALSE</span>) <span class="sc">+</span> <span class="fu">scale_y_discrete</span>(<span class="at">labels =</span> <span class="fu">rev</span>(<span class="fu">c</span>(<span class="st">"ar1Mean"</span>, <span class="st">"ar1SD"</span>, <span class="st">"ar1[WB]"</span>, <span class="st">"ar1[OL]"</span>, <span class="st">"ar1[OS]"</span>, <span class="st">"ar1[IL]"</span>)), <span class="at">limits =</span> rev) <span class="sc">+</span> <span class="fu">theme_bw</span>() <span class="sc">+</span> <span class="fu">xlim</span>(<span class="dv">0</span>,<span class="dv">1</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="ModelTemp-Letcher_files/figure-html/unnamed-chunk-76-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</div>
<div id="tabset-4-6" class="tab-pane" role="tabpanel" aria-labelledby="tabset-4-6-tab">
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb102"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb102-1"><a href="#cb102-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggs_caterpillar</span>(ggfit, <span class="at">family =</span> <span class="st">"mu.year"</span>, <span class="at">sort =</span> <span class="cn">FALSE</span>) <span class="sc">+</span> <span class="fu">scale_y_discrete</span>(<span class="at">labels =</span> <span class="fu">rev</span>(<span class="fu">c</span>(<span class="st">"Intercept"</span>, <span class="st">"Linear"</span>, <span class="st">"Quadratic"</span>, <span class="st">"Cubic"</span>)), <span class="at">limits =</span> rev) <span class="sc">+</span> <span class="fu">theme_bw</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="ModelTemp-Letcher_files/figure-html/unnamed-chunk-77-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</div>
</div>
</div>
</section>
<section id="marginal-efffects-1" class="level4" data-number="5.3.4.2">
<h4 data-number="5.3.4.2" class="anchored" data-anchor-id="marginal-efffects-1"><span class="header-section-number">5.3.4.2</span> Marginal efffects</h4>
<p>Marginal effects of air temperature x flow interaction, not accounting for lagged temperature effects, temporal autocorrelation,</p>
<div class="tabset-margin-container"></div><div class="panel-tabset">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-5-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-5-1" role="tab" aria-controls="tabset-5-1" aria-selected="true">West Brook</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-5-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-5-2" role="tab" aria-controls="tabset-5-2" aria-selected="false">Jimmy</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-5-3-tab" data-bs-toggle="tab" data-bs-target="#tabset-5-3" role="tab" aria-controls="tabset-5-3" aria-selected="false">Mitchell</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-5-4-tab" data-bs-toggle="tab" data-bs-target="#tabset-5-4" role="tab" aria-controls="tabset-5-4" aria-selected="false">Obear</a></li></ul>
<div class="tab-content">
<div id="tabset-5-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-5-1-tab">
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb103"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb103-1"><a href="#cb103-1" aria-hidden="true" tabindex="-1"></a><span class="co"># set up</span></span>
<span id="cb103-2"><a href="#cb103-2" aria-hidden="true" tabindex="-1"></a>np <span class="ot">&lt;-</span> <span class="dv">100</span></span>
<span id="cb103-3"><a href="#cb103-3" aria-hidden="true" tabindex="-1"></a>myriv <span class="ot">&lt;-</span> <span class="st">"WEST BROOK"</span></span>
<span id="cb103-4"><a href="#cb103-4" aria-hidden="true" tabindex="-1"></a>x_temp <span class="ot">&lt;-</span> <span class="fu">seq</span>(<span class="at">from =</span> <span class="fu">min</span>(tempDataSyncS<span class="sc">$</span>airTemp[tempDataSyncS<span class="sc">$</span>riverOrdered <span class="sc">==</span> myriv]),</span>
<span id="cb103-5"><a href="#cb103-5" aria-hidden="true" tabindex="-1"></a>              <span class="at">to =</span> <span class="fu">max</span>(tempDataSyncS<span class="sc">$</span>airTemp[tempDataSyncS<span class="sc">$</span>riverOrdered <span class="sc">==</span> myriv]),</span>
<span id="cb103-6"><a href="#cb103-6" aria-hidden="true" tabindex="-1"></a>              <span class="at">length.out =</span> np)</span>
<span id="cb103-7"><a href="#cb103-7" aria-hidden="true" tabindex="-1"></a>x_flow <span class="ot">&lt;-</span> <span class="fu">seq</span>(<span class="at">from =</span> <span class="fu">min</span>(tempDataSyncS<span class="sc">$</span>flowLS[tempDataSyncS<span class="sc">$</span>riverOrdered <span class="sc">==</span> myriv]),</span>
<span id="cb103-8"><a href="#cb103-8" aria-hidden="true" tabindex="-1"></a>              <span class="at">to =</span> <span class="fu">max</span>(tempDataSyncS<span class="sc">$</span>flowLS[tempDataSyncS<span class="sc">$</span>riverOrdered <span class="sc">==</span> myriv]),</span>
<span id="cb103-9"><a href="#cb103-9" aria-hidden="true" tabindex="-1"></a>              <span class="at">length.out =</span> np)</span>
<span id="cb103-10"><a href="#cb103-10" aria-hidden="true" tabindex="-1"></a>pred_df <span class="ot">&lt;-</span> <span class="fu">expand_grid</span>(x_temp, x_flow)</span>
<span id="cb103-11"><a href="#cb103-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb103-12"><a href="#cb103-12" aria-hidden="true" tabindex="-1"></a><span class="co"># predict from model</span></span>
<span id="cb103-13"><a href="#cb103-13" aria-hidden="true" tabindex="-1"></a>pred_df<span class="sc">$</span>pred <span class="ot">&lt;-</span> param.summary[<span class="st">"B.site[1,1]"</span>,<span class="dv">1</span>] <span class="sc">+</span> param.summary[<span class="st">"B.site[1,2]"</span>,<span class="dv">1</span>]<span class="sc">*</span>pred_df<span class="sc">$</span>x_temp <span class="sc">+</span> param.summary[<span class="st">"B.site[1,3]"</span>,<span class="dv">1</span>]<span class="sc">*</span>pred_df<span class="sc">$</span>x_flow <span class="sc">+</span> param.summary[<span class="st">"B.site[1,4]"</span>,<span class="dv">1</span>]<span class="sc">*</span>pred_df<span class="sc">$</span>x_temp<span class="sc">*</span>pred_df<span class="sc">$</span>x_flow</span>
<span id="cb103-14"><a href="#cb103-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb103-15"><a href="#cb103-15" aria-hidden="true" tabindex="-1"></a><span class="co"># lines </span></span>
<span id="cb103-16"><a href="#cb103-16" aria-hidden="true" tabindex="-1"></a>p1 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(pred_df, <span class="fu">aes</span>(<span class="at">x =</span> x_temp, <span class="at">y =</span> pred, <span class="at">color =</span> x_flow, <span class="at">group =</span> x_flow)) <span class="sc">+</span></span>
<span id="cb103-17"><a href="#cb103-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>() <span class="sc">+</span></span>
<span id="cb103-18"><a href="#cb103-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_distiller</span>(<span class="at">palette =</span> <span class="st">"BrBG"</span>, <span class="at">direction =</span> <span class="sc">+</span><span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb103-19"><a href="#cb103-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>() <span class="sc">+</span> <span class="fu">theme</span>(<span class="at">panel.grid =</span> <span class="fu">element_blank</span>()) <span class="sc">+</span></span>
<span id="cb103-20"><a href="#cb103-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">color =</span> <span class="st">"Flow"</span>) <span class="sc">+</span> <span class="fu">xlab</span>(<span class="st">"Air temperature"</span>) <span class="sc">+</span> <span class="fu">ylab</span>(<span class="st">"Water temperature"</span>) <span class="sc">+</span> <span class="fu">ylim</span>(<span class="fl">6.5</span>,<span class="dv">20</span>)</span>
<span id="cb103-21"><a href="#cb103-21" aria-hidden="true" tabindex="-1"></a><span class="co"># heatmap</span></span>
<span id="cb103-22"><a href="#cb103-22" aria-hidden="true" tabindex="-1"></a>p2 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(pred_df, <span class="fu">aes</span>(<span class="at">x =</span> x_temp, <span class="at">y =</span> x_flow)) <span class="sc">+</span></span>
<span id="cb103-23"><a href="#cb103-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_tile</span>(<span class="fu">aes</span>(<span class="at">fill =</span> pred)) <span class="sc">+</span></span>
<span id="cb103-24"><a href="#cb103-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_distiller</span>(<span class="at">palette =</span> <span class="st">"Spectral"</span>, <span class="at">limits =</span> <span class="fu">c</span>(<span class="fl">6.5</span>,<span class="dv">20</span>)) <span class="sc">+</span></span>
<span id="cb103-25"><a href="#cb103-25" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>() <span class="sc">+</span> <span class="fu">theme</span>(<span class="at">panel.grid =</span> <span class="fu">element_blank</span>()) <span class="sc">+</span></span>
<span id="cb103-26"><a href="#cb103-26" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(<span class="at">expand =</span> <span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">0</span>)) <span class="sc">+</span> <span class="fu">scale_y_continuous</span>(<span class="at">expand =</span> <span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">0</span>)) <span class="sc">+</span></span>
<span id="cb103-27"><a href="#cb103-27" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">fill =</span> <span class="st">"Water</span><span class="sc">\n</span><span class="st">temp."</span>) <span class="sc">+</span> <span class="fu">xlab</span>(<span class="st">"Air temperature"</span>) <span class="sc">+</span> <span class="fu">ylab</span>(<span class="st">"Flow"</span>) <span class="co">#+ </span></span>
<span id="cb103-28"><a href="#cb103-28" aria-hidden="true" tabindex="-1"></a>  <span class="co">#geom_point(data = tempDataSyncS %&gt;% filter(riverOrdered == myriv), aes(x = airTemp, y = flowLS, color = temp)) +</span></span>
<span id="cb103-29"><a href="#cb103-29" aria-hidden="true" tabindex="-1"></a>  <span class="co">#scale_color_distiller(palette = "Spectral", limits = c(0,23)) </span></span>
<span id="cb103-30"><a href="#cb103-30" aria-hidden="true" tabindex="-1"></a><span class="co"># combine</span></span>
<span id="cb103-31"><a href="#cb103-31" aria-hidden="true" tabindex="-1"></a>egg<span class="sc">::</span><span class="fu">ggarrange</span>(p1, p2, <span class="at">nrow =</span> <span class="dv">1</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="ModelTemp-Letcher_files/figure-html/unnamed-chunk-78-1.png" class="img-fluid figure-img" width="864"></p>
</figure>
</div>
</div>
</div>
</div>
<div id="tabset-5-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-5-2-tab">
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb104"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb104-1"><a href="#cb104-1" aria-hidden="true" tabindex="-1"></a><span class="co"># set up</span></span>
<span id="cb104-2"><a href="#cb104-2" aria-hidden="true" tabindex="-1"></a>np <span class="ot">&lt;-</span> <span class="dv">100</span></span>
<span id="cb104-3"><a href="#cb104-3" aria-hidden="true" tabindex="-1"></a>myriv <span class="ot">&lt;-</span> <span class="st">"WB JIMMY"</span></span>
<span id="cb104-4"><a href="#cb104-4" aria-hidden="true" tabindex="-1"></a>x_temp <span class="ot">&lt;-</span> <span class="fu">seq</span>(<span class="at">from =</span> <span class="fu">min</span>(tempDataSyncS<span class="sc">$</span>airTemp[tempDataSyncS<span class="sc">$</span>riverOrdered <span class="sc">==</span> myriv]),</span>
<span id="cb104-5"><a href="#cb104-5" aria-hidden="true" tabindex="-1"></a>              <span class="at">to =</span> <span class="fu">max</span>(tempDataSyncS<span class="sc">$</span>airTemp[tempDataSyncS<span class="sc">$</span>riverOrdered <span class="sc">==</span> myriv]),</span>
<span id="cb104-6"><a href="#cb104-6" aria-hidden="true" tabindex="-1"></a>              <span class="at">length.out =</span> np)</span>
<span id="cb104-7"><a href="#cb104-7" aria-hidden="true" tabindex="-1"></a>x_flow <span class="ot">&lt;-</span> <span class="fu">seq</span>(<span class="at">from =</span> <span class="fu">min</span>(tempDataSyncS<span class="sc">$</span>airTemp[tempDataSyncS<span class="sc">$</span>riverOrdered <span class="sc">==</span> myriv]),</span>
<span id="cb104-8"><a href="#cb104-8" aria-hidden="true" tabindex="-1"></a>              <span class="at">to =</span> <span class="fu">max</span>(tempDataSyncS<span class="sc">$</span>airTemp[tempDataSyncS<span class="sc">$</span>riverOrdered <span class="sc">==</span> myriv]),</span>
<span id="cb104-9"><a href="#cb104-9" aria-hidden="true" tabindex="-1"></a>              <span class="at">length.out =</span> np)</span>
<span id="cb104-10"><a href="#cb104-10" aria-hidden="true" tabindex="-1"></a>pred_df <span class="ot">&lt;-</span> <span class="fu">expand_grid</span>(x_temp, x_flow)</span>
<span id="cb104-11"><a href="#cb104-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb104-12"><a href="#cb104-12" aria-hidden="true" tabindex="-1"></a><span class="co"># predict from model</span></span>
<span id="cb104-13"><a href="#cb104-13" aria-hidden="true" tabindex="-1"></a>pred_df<span class="sc">$</span>pred <span class="ot">&lt;-</span> param.summary[<span class="st">"B.site[2,1]"</span>,<span class="dv">1</span>] <span class="sc">+</span> param.summary[<span class="st">"B.site[2,2]"</span>,<span class="dv">1</span>]<span class="sc">*</span>pred_df<span class="sc">$</span>x_temp <span class="sc">+</span> param.summary[<span class="st">"B.site[2,3]"</span>,<span class="dv">1</span>]<span class="sc">*</span>pred_df<span class="sc">$</span>x_flow <span class="sc">+</span> param.summary[<span class="st">"B.site[2,4]"</span>,<span class="dv">1</span>]<span class="sc">*</span>pred_df<span class="sc">$</span>x_temp<span class="sc">*</span>pred_df<span class="sc">$</span>x_flow</span>
<span id="cb104-14"><a href="#cb104-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb104-15"><a href="#cb104-15" aria-hidden="true" tabindex="-1"></a><span class="co"># lines </span></span>
<span id="cb104-16"><a href="#cb104-16" aria-hidden="true" tabindex="-1"></a>p1 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(pred_df, <span class="fu">aes</span>(<span class="at">x =</span> x_temp, <span class="at">y =</span> pred, <span class="at">color =</span> x_flow, <span class="at">group =</span> x_flow)) <span class="sc">+</span></span>
<span id="cb104-17"><a href="#cb104-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>() <span class="sc">+</span></span>
<span id="cb104-18"><a href="#cb104-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_distiller</span>(<span class="at">palette =</span> <span class="st">"BrBG"</span>, <span class="at">direction =</span> <span class="sc">+</span><span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb104-19"><a href="#cb104-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>() <span class="sc">+</span> <span class="fu">theme</span>(<span class="at">panel.grid =</span> <span class="fu">element_blank</span>()) <span class="sc">+</span></span>
<span id="cb104-20"><a href="#cb104-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">color =</span> <span class="st">"Flow"</span>) <span class="sc">+</span> <span class="fu">xlab</span>(<span class="st">"Air temperature"</span>) <span class="sc">+</span> <span class="fu">ylab</span>(<span class="st">"Water temperature"</span>) <span class="sc">+</span> <span class="fu">ylim</span>(<span class="fl">6.5</span>,<span class="dv">20</span>)</span>
<span id="cb104-21"><a href="#cb104-21" aria-hidden="true" tabindex="-1"></a><span class="co"># heatmap</span></span>
<span id="cb104-22"><a href="#cb104-22" aria-hidden="true" tabindex="-1"></a>p2 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(pred_df, <span class="fu">aes</span>(<span class="at">x =</span> x_temp, <span class="at">y =</span> x_flow)) <span class="sc">+</span></span>
<span id="cb104-23"><a href="#cb104-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_tile</span>(<span class="fu">aes</span>(<span class="at">fill =</span> pred)) <span class="sc">+</span></span>
<span id="cb104-24"><a href="#cb104-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_distiller</span>(<span class="at">palette =</span> <span class="st">"Spectral"</span>, <span class="at">limits =</span> <span class="fu">c</span>(<span class="fl">6.5</span>,<span class="dv">20</span>)) <span class="sc">+</span></span>
<span id="cb104-25"><a href="#cb104-25" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>() <span class="sc">+</span> <span class="fu">theme</span>(<span class="at">panel.grid =</span> <span class="fu">element_blank</span>()) <span class="sc">+</span></span>
<span id="cb104-26"><a href="#cb104-26" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(<span class="at">expand =</span> <span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">0</span>)) <span class="sc">+</span> <span class="fu">scale_y_continuous</span>(<span class="at">expand =</span> <span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">0</span>)) <span class="sc">+</span></span>
<span id="cb104-27"><a href="#cb104-27" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">fill =</span> <span class="st">"Water</span><span class="sc">\n</span><span class="st">temp."</span>) <span class="sc">+</span> <span class="fu">xlab</span>(<span class="st">"Air temperature"</span>) <span class="sc">+</span> <span class="fu">ylab</span>(<span class="st">"Flow"</span>)</span>
<span id="cb104-28"><a href="#cb104-28" aria-hidden="true" tabindex="-1"></a><span class="co"># combine</span></span>
<span id="cb104-29"><a href="#cb104-29" aria-hidden="true" tabindex="-1"></a>egg<span class="sc">::</span><span class="fu">ggarrange</span>(p1, p2, <span class="at">nrow =</span> <span class="dv">1</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="ModelTemp-Letcher_files/figure-html/unnamed-chunk-79-1.png" class="img-fluid figure-img" width="864"></p>
</figure>
</div>
</div>
</div>
</div>
<div id="tabset-5-3" class="tab-pane" role="tabpanel" aria-labelledby="tabset-5-3-tab">
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb105"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb105-1"><a href="#cb105-1" aria-hidden="true" tabindex="-1"></a><span class="co"># set up</span></span>
<span id="cb105-2"><a href="#cb105-2" aria-hidden="true" tabindex="-1"></a>np <span class="ot">&lt;-</span> <span class="dv">100</span></span>
<span id="cb105-3"><a href="#cb105-3" aria-hidden="true" tabindex="-1"></a>myriv <span class="ot">&lt;-</span> <span class="st">"WB MITCHELL"</span></span>
<span id="cb105-4"><a href="#cb105-4" aria-hidden="true" tabindex="-1"></a>x_temp <span class="ot">&lt;-</span> <span class="fu">seq</span>(<span class="at">from =</span> <span class="fu">min</span>(tempDataSyncS<span class="sc">$</span>airTemp[tempDataSyncS<span class="sc">$</span>riverOrdered <span class="sc">==</span> myriv]),</span>
<span id="cb105-5"><a href="#cb105-5" aria-hidden="true" tabindex="-1"></a>              <span class="at">to =</span> <span class="fu">max</span>(tempDataSyncS<span class="sc">$</span>airTemp[tempDataSyncS<span class="sc">$</span>riverOrdered <span class="sc">==</span> myriv]),</span>
<span id="cb105-6"><a href="#cb105-6" aria-hidden="true" tabindex="-1"></a>              <span class="at">length.out =</span> np)</span>
<span id="cb105-7"><a href="#cb105-7" aria-hidden="true" tabindex="-1"></a>x_flow <span class="ot">&lt;-</span> <span class="fu">seq</span>(<span class="at">from =</span> <span class="fu">min</span>(tempDataSyncS<span class="sc">$</span>airTemp[tempDataSyncS<span class="sc">$</span>riverOrdered <span class="sc">==</span> myriv]),</span>
<span id="cb105-8"><a href="#cb105-8" aria-hidden="true" tabindex="-1"></a>              <span class="at">to =</span> <span class="fu">max</span>(tempDataSyncS<span class="sc">$</span>airTemp[tempDataSyncS<span class="sc">$</span>riverOrdered <span class="sc">==</span> myriv]),</span>
<span id="cb105-9"><a href="#cb105-9" aria-hidden="true" tabindex="-1"></a>              <span class="at">length.out =</span> np)</span>
<span id="cb105-10"><a href="#cb105-10" aria-hidden="true" tabindex="-1"></a>pred_df <span class="ot">&lt;-</span> <span class="fu">expand_grid</span>(x_temp, x_flow)</span>
<span id="cb105-11"><a href="#cb105-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb105-12"><a href="#cb105-12" aria-hidden="true" tabindex="-1"></a><span class="co"># predict from model</span></span>
<span id="cb105-13"><a href="#cb105-13" aria-hidden="true" tabindex="-1"></a>pred_df<span class="sc">$</span>pred <span class="ot">&lt;-</span> param.summary[<span class="st">"B.site[3,1]"</span>,<span class="dv">1</span>] <span class="sc">+</span> param.summary[<span class="st">"B.site[3,2]"</span>,<span class="dv">1</span>]<span class="sc">*</span>pred_df<span class="sc">$</span>x_temp <span class="sc">+</span> param.summary[<span class="st">"B.site[3,3]"</span>,<span class="dv">1</span>]<span class="sc">*</span>pred_df<span class="sc">$</span>x_flow <span class="sc">+</span> param.summary[<span class="st">"B.site[3,4]"</span>,<span class="dv">1</span>]<span class="sc">*</span>pred_df<span class="sc">$</span>x_temp<span class="sc">*</span>pred_df<span class="sc">$</span>x_flow</span>
<span id="cb105-14"><a href="#cb105-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb105-15"><a href="#cb105-15" aria-hidden="true" tabindex="-1"></a><span class="co"># lines </span></span>
<span id="cb105-16"><a href="#cb105-16" aria-hidden="true" tabindex="-1"></a>p1 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(pred_df, <span class="fu">aes</span>(<span class="at">x =</span> x_temp, <span class="at">y =</span> pred, <span class="at">color =</span> x_flow, <span class="at">group =</span> x_flow)) <span class="sc">+</span></span>
<span id="cb105-17"><a href="#cb105-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>() <span class="sc">+</span></span>
<span id="cb105-18"><a href="#cb105-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_distiller</span>(<span class="at">palette =</span> <span class="st">"BrBG"</span>, <span class="at">direction =</span> <span class="sc">+</span><span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb105-19"><a href="#cb105-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>() <span class="sc">+</span> <span class="fu">theme</span>(<span class="at">panel.grid =</span> <span class="fu">element_blank</span>()) <span class="sc">+</span></span>
<span id="cb105-20"><a href="#cb105-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">color =</span> <span class="st">"Flow"</span>) <span class="sc">+</span> <span class="fu">xlab</span>(<span class="st">"Air temperature"</span>) <span class="sc">+</span> <span class="fu">ylab</span>(<span class="st">"Water temperature"</span>) <span class="sc">+</span> <span class="fu">ylim</span>(<span class="fl">6.5</span>,<span class="dv">20</span>)</span>
<span id="cb105-21"><a href="#cb105-21" aria-hidden="true" tabindex="-1"></a><span class="co"># heatmap</span></span>
<span id="cb105-22"><a href="#cb105-22" aria-hidden="true" tabindex="-1"></a>p2 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(pred_df, <span class="fu">aes</span>(<span class="at">x =</span> x_temp, <span class="at">y =</span> x_flow)) <span class="sc">+</span></span>
<span id="cb105-23"><a href="#cb105-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_tile</span>(<span class="fu">aes</span>(<span class="at">fill =</span> pred)) <span class="sc">+</span></span>
<span id="cb105-24"><a href="#cb105-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_distiller</span>(<span class="at">palette =</span> <span class="st">"Spectral"</span>, <span class="at">limits =</span> <span class="fu">c</span>(<span class="fl">6.5</span>,<span class="dv">20</span>)) <span class="sc">+</span></span>
<span id="cb105-25"><a href="#cb105-25" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>() <span class="sc">+</span> <span class="fu">theme</span>(<span class="at">panel.grid =</span> <span class="fu">element_blank</span>()) <span class="sc">+</span></span>
<span id="cb105-26"><a href="#cb105-26" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(<span class="at">expand =</span> <span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">0</span>)) <span class="sc">+</span> <span class="fu">scale_y_continuous</span>(<span class="at">expand =</span> <span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">0</span>)) <span class="sc">+</span></span>
<span id="cb105-27"><a href="#cb105-27" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">fill =</span> <span class="st">"Water</span><span class="sc">\n</span><span class="st">temp."</span>) <span class="sc">+</span> <span class="fu">xlab</span>(<span class="st">"Air temperature"</span>) <span class="sc">+</span> <span class="fu">ylab</span>(<span class="st">"Flow"</span>)</span>
<span id="cb105-28"><a href="#cb105-28" aria-hidden="true" tabindex="-1"></a><span class="co"># combine</span></span>
<span id="cb105-29"><a href="#cb105-29" aria-hidden="true" tabindex="-1"></a>egg<span class="sc">::</span><span class="fu">ggarrange</span>(p1, p2, <span class="at">nrow =</span> <span class="dv">1</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="ModelTemp-Letcher_files/figure-html/unnamed-chunk-80-1.png" class="img-fluid figure-img" width="864"></p>
</figure>
</div>
</div>
</div>
</div>
<div id="tabset-5-4" class="tab-pane" role="tabpanel" aria-labelledby="tabset-5-4-tab">
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb106"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb106-1"><a href="#cb106-1" aria-hidden="true" tabindex="-1"></a><span class="co"># set up</span></span>
<span id="cb106-2"><a href="#cb106-2" aria-hidden="true" tabindex="-1"></a>np <span class="ot">&lt;-</span> <span class="dv">100</span></span>
<span id="cb106-3"><a href="#cb106-3" aria-hidden="true" tabindex="-1"></a>myriv <span class="ot">&lt;-</span> <span class="st">"WB OBEAR"</span></span>
<span id="cb106-4"><a href="#cb106-4" aria-hidden="true" tabindex="-1"></a>x_temp <span class="ot">&lt;-</span> <span class="fu">seq</span>(<span class="at">from =</span> <span class="fu">min</span>(tempDataSyncS<span class="sc">$</span>airTemp[tempDataSyncS<span class="sc">$</span>riverOrdered <span class="sc">==</span> myriv]),</span>
<span id="cb106-5"><a href="#cb106-5" aria-hidden="true" tabindex="-1"></a>              <span class="at">to =</span> <span class="fu">max</span>(tempDataSyncS<span class="sc">$</span>airTemp[tempDataSyncS<span class="sc">$</span>riverOrdered <span class="sc">==</span> myriv]),</span>
<span id="cb106-6"><a href="#cb106-6" aria-hidden="true" tabindex="-1"></a>              <span class="at">length.out =</span> np)</span>
<span id="cb106-7"><a href="#cb106-7" aria-hidden="true" tabindex="-1"></a>x_flow <span class="ot">&lt;-</span> <span class="fu">seq</span>(<span class="at">from =</span> <span class="fu">min</span>(tempDataSyncS<span class="sc">$</span>airTemp[tempDataSyncS<span class="sc">$</span>riverOrdered <span class="sc">==</span> myriv]),</span>
<span id="cb106-8"><a href="#cb106-8" aria-hidden="true" tabindex="-1"></a>              <span class="at">to =</span> <span class="fu">max</span>(tempDataSyncS<span class="sc">$</span>airTemp[tempDataSyncS<span class="sc">$</span>riverOrdered <span class="sc">==</span> myriv]),</span>
<span id="cb106-9"><a href="#cb106-9" aria-hidden="true" tabindex="-1"></a>              <span class="at">length.out =</span> np)</span>
<span id="cb106-10"><a href="#cb106-10" aria-hidden="true" tabindex="-1"></a>pred_df <span class="ot">&lt;-</span> <span class="fu">expand_grid</span>(x_temp, x_flow)</span>
<span id="cb106-11"><a href="#cb106-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb106-12"><a href="#cb106-12" aria-hidden="true" tabindex="-1"></a><span class="co"># predict from model</span></span>
<span id="cb106-13"><a href="#cb106-13" aria-hidden="true" tabindex="-1"></a>pred_df<span class="sc">$</span>pred <span class="ot">&lt;-</span> param.summary[<span class="st">"B.site[4,1]"</span>,<span class="dv">1</span>] <span class="sc">+</span> param.summary[<span class="st">"B.site[4,2]"</span>,<span class="dv">1</span>]<span class="sc">*</span>pred_df<span class="sc">$</span>x_temp <span class="sc">+</span> param.summary[<span class="st">"B.site[4,3]"</span>,<span class="dv">1</span>]<span class="sc">*</span>pred_df<span class="sc">$</span>x_flow <span class="sc">+</span> param.summary[<span class="st">"B.site[4,4]"</span>,<span class="dv">1</span>]<span class="sc">*</span>pred_df<span class="sc">$</span>x_temp<span class="sc">*</span>pred_df<span class="sc">$</span>x_flow</span>
<span id="cb106-14"><a href="#cb106-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb106-15"><a href="#cb106-15" aria-hidden="true" tabindex="-1"></a><span class="co"># lines </span></span>
<span id="cb106-16"><a href="#cb106-16" aria-hidden="true" tabindex="-1"></a>p1 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(pred_df, <span class="fu">aes</span>(<span class="at">x =</span> x_temp, <span class="at">y =</span> pred, <span class="at">color =</span> x_flow, <span class="at">group =</span> x_flow)) <span class="sc">+</span></span>
<span id="cb106-17"><a href="#cb106-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>() <span class="sc">+</span></span>
<span id="cb106-18"><a href="#cb106-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_distiller</span>(<span class="at">palette =</span> <span class="st">"BrBG"</span>, <span class="at">direction =</span> <span class="sc">+</span><span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb106-19"><a href="#cb106-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>() <span class="sc">+</span> <span class="fu">theme</span>(<span class="at">panel.grid =</span> <span class="fu">element_blank</span>()) <span class="sc">+</span></span>
<span id="cb106-20"><a href="#cb106-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">color =</span> <span class="st">"Flow"</span>) <span class="sc">+</span> <span class="fu">xlab</span>(<span class="st">"Air temperature"</span>) <span class="sc">+</span> <span class="fu">ylab</span>(<span class="st">"Water temperature"</span>) <span class="sc">+</span> <span class="fu">ylim</span>(<span class="fl">6.5</span>,<span class="dv">20</span>)</span>
<span id="cb106-21"><a href="#cb106-21" aria-hidden="true" tabindex="-1"></a><span class="co"># heatmap</span></span>
<span id="cb106-22"><a href="#cb106-22" aria-hidden="true" tabindex="-1"></a>p2 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(pred_df, <span class="fu">aes</span>(<span class="at">x =</span> x_temp, <span class="at">y =</span> x_flow)) <span class="sc">+</span></span>
<span id="cb106-23"><a href="#cb106-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_tile</span>(<span class="fu">aes</span>(<span class="at">fill =</span> pred)) <span class="sc">+</span></span>
<span id="cb106-24"><a href="#cb106-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_distiller</span>(<span class="at">palette =</span> <span class="st">"Spectral"</span>, <span class="at">limits =</span> <span class="fu">c</span>(<span class="fl">6.5</span>,<span class="dv">20</span>)) <span class="sc">+</span></span>
<span id="cb106-25"><a href="#cb106-25" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>() <span class="sc">+</span> <span class="fu">theme</span>(<span class="at">panel.grid =</span> <span class="fu">element_blank</span>()) <span class="sc">+</span></span>
<span id="cb106-26"><a href="#cb106-26" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(<span class="at">expand =</span> <span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">0</span>)) <span class="sc">+</span> <span class="fu">scale_y_continuous</span>(<span class="at">expand =</span> <span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">0</span>)) <span class="sc">+</span></span>
<span id="cb106-27"><a href="#cb106-27" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">fill =</span> <span class="st">"Water</span><span class="sc">\n</span><span class="st">temp."</span>) <span class="sc">+</span> <span class="fu">xlab</span>(<span class="st">"Air temperature"</span>) <span class="sc">+</span> <span class="fu">ylab</span>(<span class="st">"Flow"</span>)</span>
<span id="cb106-28"><a href="#cb106-28" aria-hidden="true" tabindex="-1"></a><span class="co"># combine</span></span>
<span id="cb106-29"><a href="#cb106-29" aria-hidden="true" tabindex="-1"></a>egg<span class="sc">::</span><span class="fu">ggarrange</span>(p1, p2, <span class="at">nrow =</span> <span class="dv">1</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="ModelTemp-Letcher_files/figure-html/unnamed-chunk-81-1.png" class="img-fluid figure-img" width="864"></p>
</figure>
</div>
</div>
</div>
</div>
</div>
</div>


<!-- -->

</section>
</section>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
  window.document.addEventListener("DOMContentLoaded", function (event) {
    // Ensure there is a toggle, if there isn't float one in the top right
    if (window.document.querySelector('.quarto-color-scheme-toggle') === null) {
      const a = window.document.createElement('a');
      a.classList.add('top-right');
      a.classList.add('quarto-color-scheme-toggle');
      a.href = "";
      a.onclick = function() { try { window.quartoToggleColorScheme(); } catch {} return false; };
      const i = window.document.createElement("i");
      i.classList.add('bi');
      a.appendChild(i);
      window.document.body.appendChild(a);
    }
    setColorSchemeToggle(hasAlternateSentinel())
    const icon = "î§‹";
    const anchorJS = new window.AnchorJS();
    anchorJS.options = {
      placement: 'right',
      icon: icon
    };
    anchorJS.add('.anchored');
    const isCodeAnnotation = (el) => {
      for (const clz of el.classList) {
        if (clz.startsWith('code-annotation-')) {                     
          return true;
        }
      }
      return false;
    }
    const onCopySuccess = function(e) {
      // button target
      const button = e.trigger;
      // don't keep focus
      button.blur();
      // flash "checked"
      button.classList.add('code-copy-button-checked');
      var currentTitle = button.getAttribute("title");
      button.setAttribute("title", "Copied!");
      let tooltip;
      if (window.bootstrap) {
        button.setAttribute("data-bs-toggle", "tooltip");
        button.setAttribute("data-bs-placement", "left");
        button.setAttribute("data-bs-title", "Copied!");
        tooltip = new bootstrap.Tooltip(button, 
          { trigger: "manual", 
            customClass: "code-copy-button-tooltip",
            offset: [0, -8]});
        tooltip.show();    
      }
      setTimeout(function() {
        if (tooltip) {
          tooltip.hide();
          button.removeAttribute("data-bs-title");
          button.removeAttribute("data-bs-toggle");
          button.removeAttribute("data-bs-placement");
        }
        button.setAttribute("title", currentTitle);
        button.classList.remove('code-copy-button-checked');
      }, 1000);
      // clear code selection
      e.clearSelection();
    }
    const getTextToCopy = function(trigger) {
        const codeEl = trigger.previousElementSibling.cloneNode(true);
        for (const childEl of codeEl.children) {
          if (isCodeAnnotation(childEl)) {
            childEl.remove();
          }
        }
        return codeEl.innerText;
    }
    const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
      text: getTextToCopy
    });
    clipboard.on('success', onCopySuccess);
    if (window.document.getElementById('quarto-embedded-source-code-modal')) {
      const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
        text: getTextToCopy,
        container: window.document.getElementById('quarto-embedded-source-code-modal')
      });
      clipboardModal.on('success', onCopySuccess);
    }
    const viewSource = window.document.getElementById('quarto-view-source') ||
                       window.document.getElementById('quarto-code-tools-source');
    if (viewSource) {
      const sourceUrl = viewSource.getAttribute("data-quarto-source-url");
      viewSource.addEventListener("click", function(e) {
        if (sourceUrl) {
          // rstudio viewer pane
          if (/\bcapabilities=\b/.test(window.location)) {
            window.open(sourceUrl);
          } else {
            window.location.href = sourceUrl;
          }
        } else {
          const modal = new bootstrap.Modal(document.getElementById('quarto-embedded-source-code-modal'));
          modal.show();
        }
        return false;
      });
    }
    function toggleCodeHandler(show) {
      return function(e) {
        const detailsSrc = window.document.querySelectorAll(".cell > details > .sourceCode");
        for (let i=0; i<detailsSrc.length; i++) {
          const details = detailsSrc[i].parentElement;
          if (show) {
            details.open = true;
          } else {
            details.removeAttribute("open");
          }
        }
        const cellCodeDivs = window.document.querySelectorAll(".cell > .sourceCode");
        const fromCls = show ? "hidden" : "unhidden";
        const toCls = show ? "unhidden" : "hidden";
        for (let i=0; i<cellCodeDivs.length; i++) {
          const codeDiv = cellCodeDivs[i];
          if (codeDiv.classList.contains(fromCls)) {
            codeDiv.classList.remove(fromCls);
            codeDiv.classList.add(toCls);
          } 
        }
        return false;
      }
    }
    const hideAllCode = window.document.getElementById("quarto-hide-all-code");
    if (hideAllCode) {
      hideAllCode.addEventListener("click", toggleCodeHandler(false));
    }
    const showAllCode = window.document.getElementById("quarto-show-all-code");
    if (showAllCode) {
      showAllCode.addEventListener("click", toggleCodeHandler(true));
    }
      var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
      var mailtoRegex = new RegExp(/^mailto:/);
        var filterRegex = new RegExp('/' + window.location.host + '/');
      var isInternal = (href) => {
          return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
      }
      // Inspect non-navigation links and adorn them if external
     var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
      for (var i=0; i<links.length; i++) {
        const link = links[i];
        if (!isInternal(link.href)) {
          // undo the damage that might have been done by quarto-nav.js in the case of
          // links that we want to consider external
          if (link.dataset.originalHref !== undefined) {
            link.href = link.dataset.originalHref;
          }
        }
      }
    function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
      const config = {
        allowHTML: true,
        maxWidth: 500,
        delay: 100,
        arrow: false,
        appendTo: function(el) {
            return el.parentElement;
        },
        interactive: true,
        interactiveBorder: 10,
        theme: 'quarto',
        placement: 'bottom-start',
      };
      if (contentFn) {
        config.content = contentFn;
      }
      if (onTriggerFn) {
        config.onTrigger = onTriggerFn;
      }
      if (onUntriggerFn) {
        config.onUntrigger = onUntriggerFn;
      }
      window.tippy(el, config); 
    }
    const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
    for (var i=0; i<noterefs.length; i++) {
      const ref = noterefs[i];
      tippyHover(ref, function() {
        // use id or data attribute instead here
        let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
        try { href = new URL(href).hash; } catch {}
        const id = href.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note) {
          return note.innerHTML;
        } else {
          return "";
        }
      });
    }
    const xrefs = window.document.querySelectorAll('a.quarto-xref');
    const processXRef = (id, note) => {
      // Strip column container classes
      const stripColumnClz = (el) => {
        el.classList.remove("page-full", "page-columns");
        if (el.children) {
          for (const child of el.children) {
            stripColumnClz(child);
          }
        }
      }
      stripColumnClz(note)
      if (id === null || id.startsWith('sec-')) {
        // Special case sections, only their first couple elements
        const container = document.createElement("div");
        if (note.children && note.children.length > 2) {
          container.appendChild(note.children[0].cloneNode(true));
          for (let i = 1; i < note.children.length; i++) {
            const child = note.children[i];
            if (child.tagName === "P" && child.innerText === "") {
              continue;
            } else {
              container.appendChild(child.cloneNode(true));
              break;
            }
          }
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(container);
          }
          return container.innerHTML
        } else {
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(note);
          }
          return note.innerHTML;
        }
      } else {
        // Remove any anchor links if they are present
        const anchorLink = note.querySelector('a.anchorjs-link');
        if (anchorLink) {
          anchorLink.remove();
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        if (note.classList.contains("callout")) {
          return note.outerHTML;
        } else {
          return note.innerHTML;
        }
      }
    }
    for (var i=0; i<xrefs.length; i++) {
      const xref = xrefs[i];
      tippyHover(xref, undefined, function(instance) {
        instance.disable();
        let url = xref.getAttribute('href');
        let hash = undefined; 
        if (url.startsWith('#')) {
          hash = url;
        } else {
          try { hash = new URL(url).hash; } catch {}
        }
        if (hash) {
          const id = hash.replace(/^#\/?/, "");
          const note = window.document.getElementById(id);
          if (note !== null) {
            try {
              const html = processXRef(id, note.cloneNode(true));
              instance.setContent(html);
            } finally {
              instance.enable();
              instance.show();
            }
          } else {
            // See if we can fetch this
            fetch(url.split('#')[0])
            .then(res => res.text())
            .then(html => {
              const parser = new DOMParser();
              const htmlDoc = parser.parseFromString(html, "text/html");
              const note = htmlDoc.getElementById(id);
              if (note !== null) {
                const html = processXRef(id, note);
                instance.setContent(html);
              } 
            }).finally(() => {
              instance.enable();
              instance.show();
            });
          }
        } else {
          // See if we can fetch a full url (with no hash to target)
          // This is a special case and we should probably do some content thinning / targeting
          fetch(url)
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.querySelector('main.content');
            if (note !== null) {
              // This should only happen for chapter cross references
              // (since there is no id in the URL)
              // remove the first header
              if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
                note.children[0].remove();
              }
              const html = processXRef(null, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      }, function(instance) {
      });
    }
        let selectedAnnoteEl;
        const selectorForAnnotation = ( cell, annotation) => {
          let cellAttr = 'data-code-cell="' + cell + '"';
          let lineAttr = 'data-code-annotation="' +  annotation + '"';
          const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
          return selector;
        }
        const selectCodeLines = (annoteEl) => {
          const doc = window.document;
          const targetCell = annoteEl.getAttribute("data-target-cell");
          const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
          const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
          const lines = annoteSpan.getAttribute("data-code-lines").split(",");
          const lineIds = lines.map((line) => {
            return targetCell + "-" + line;
          })
          let top = null;
          let height = null;
          let parent = null;
          if (lineIds.length > 0) {
              //compute the position of the single el (top and bottom and make a div)
              const el = window.document.getElementById(lineIds[0]);
              top = el.offsetTop;
              height = el.offsetHeight;
              parent = el.parentElement.parentElement;
            if (lineIds.length > 1) {
              const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
              const bottom = lastEl.offsetTop + lastEl.offsetHeight;
              height = bottom - top;
            }
            if (top !== null && height !== null && parent !== null) {
              // cook up a div (if necessary) and position it 
              let div = window.document.getElementById("code-annotation-line-highlight");
              if (div === null) {
                div = window.document.createElement("div");
                div.setAttribute("id", "code-annotation-line-highlight");
                div.style.position = 'absolute';
                parent.appendChild(div);
              }
              div.style.top = top - 2 + "px";
              div.style.height = height + 4 + "px";
              div.style.left = 0;
              let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
              if (gutterDiv === null) {
                gutterDiv = window.document.createElement("div");
                gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
                gutterDiv.style.position = 'absolute';
                const codeCell = window.document.getElementById(targetCell);
                const gutter = codeCell.querySelector('.code-annotation-gutter');
                gutter.appendChild(gutterDiv);
              }
              gutterDiv.style.top = top - 2 + "px";
              gutterDiv.style.height = height + 4 + "px";
            }
            selectedAnnoteEl = annoteEl;
          }
        };
        const unselectCodeLines = () => {
          const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
          elementsIds.forEach((elId) => {
            const div = window.document.getElementById(elId);
            if (div) {
              div.remove();
            }
          });
          selectedAnnoteEl = undefined;
        };
          // Handle positioning of the toggle
      window.addEventListener(
        "resize",
        throttle(() => {
          elRect = undefined;
          if (selectedAnnoteEl) {
            selectCodeLines(selectedAnnoteEl);
          }
        }, 10)
      );
      function throttle(fn, ms) {
      let throttle = false;
      let timer;
        return (...args) => {
          if(!throttle) { // first call gets through
              fn.apply(this, args);
              throttle = true;
          } else { // all the others get throttled
              if(timer) clearTimeout(timer); // cancel #2
              timer = setTimeout(() => {
                fn.apply(this, args);
                timer = throttle = false;
              }, ms);
          }
        };
      }
        // Attach click handler to the DT
        const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
        for (const annoteDlNode of annoteDls) {
          annoteDlNode.addEventListener('click', (event) => {
            const clickedEl = event.target;
            if (clickedEl !== selectedAnnoteEl) {
              unselectCodeLines();
              const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
              if (activeEl) {
                activeEl.classList.remove('code-annotation-active');
              }
              selectCodeLines(clickedEl);
              clickedEl.classList.add('code-annotation-active');
            } else {
              // Unselect the line
              unselectCodeLines();
              clickedEl.classList.remove('code-annotation-active');
            }
          });
        }
    const findCites = (el) => {
      const parentEl = el.parentElement;
      if (parentEl) {
        const cites = parentEl.dataset.cites;
        if (cites) {
          return {
            el,
            cites: cites.split(' ')
          };
        } else {
          return findCites(el.parentElement)
        }
      } else {
        return undefined;
      }
    };
    var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
    for (var i=0; i<bibliorefs.length; i++) {
      const ref = bibliorefs[i];
      const citeInfo = findCites(ref);
      if (citeInfo) {
        tippyHover(citeInfo.el, function() {
          var popup = window.document.createElement('div');
          citeInfo.cites.forEach(function(cite) {
            var citeDiv = window.document.createElement('div');
            citeDiv.classList.add('hanging-indent');
            citeDiv.classList.add('csl-entry');
            var biblioDiv = window.document.getElementById('ref-' + cite);
            if (biblioDiv) {
              citeDiv.innerHTML = biblioDiv.innerHTML;
            }
            popup.appendChild(citeDiv);
          });
          return popup.innerHTML;
        });
      }
    }
  });
  </script>
<nav class="page-navigation">
  <div class="nav-page nav-page-previous">
      <a href="./FormatData.html" class="pagination-link" aria-label="Format Data">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">Format Data</span></span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="./ModelTemp-EcoDrought.html" class="pagination-link" aria-label="ModelTemp - EcoDrought">
        <span class="nav-page-text"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">ModelTemp - EcoDrought</span></span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav><div class="modal fade" id="quarto-embedded-source-code-modal" tabindex="-1" aria-labelledby="quarto-embedded-source-code-modal-label" aria-hidden="true"><div class="modal-dialog modal-dialog-scrollable"><div class="modal-content"><div class="modal-header"><h5 class="modal-title" id="quarto-embedded-source-code-modal-label">Source Code</h5><button class="btn-close" data-bs-dismiss="modal"></button></div><div class="modal-body"><div class="">
<div class="sourceCode" id="cb107" data-shortcodes="false"><pre class="sourceCode markdown code-with-copy"><code class="sourceCode markdown"><span id="cb107-1"><a href="#cb107-1" aria-hidden="true" tabindex="-1"></a><span class="co">---</span></span>
<span id="cb107-2"><a href="#cb107-2" aria-hidden="true" tabindex="-1"></a><span class="an">title:</span><span class="co"> "ModelTemp - Letcher et al. (2016)"</span></span>
<span id="cb107-3"><a href="#cb107-3" aria-hidden="true" tabindex="-1"></a><span class="co">---</span></span>
<span id="cb107-4"><a href="#cb107-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb107-5"><a href="#cb107-5" aria-hidden="true" tabindex="-1"></a>**Purpose:** fit stream temp model as in Letcher et al. (2016); modify JAGS model to estimate parameters hierarchically and check to make sure output matches. </span>
<span id="cb107-6"><a href="#cb107-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb107-7"><a href="#cb107-7" aria-hidden="true" tabindex="-1"></a><span class="in">```{r include=FALSE}</span></span>
<span id="cb107-8"><a href="#cb107-8" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb107-9"><a href="#cb107-9" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(R2jags)</span>
<span id="cb107-10"><a href="#cb107-10" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(MCMCvis)</span>
<span id="cb107-11"><a href="#cb107-11" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(loo)</span>
<span id="cb107-12"><a href="#cb107-12" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(HDInterval)</span>
<span id="cb107-13"><a href="#cb107-13" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(scales)</span>
<span id="cb107-14"><a href="#cb107-14" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggmcmc)</span>
<span id="cb107-15"><a href="#cb107-15" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(GGally)</span>
<span id="cb107-16"><a href="#cb107-16" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(beepr)</span>
<span id="cb107-17"><a href="#cb107-17" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb107-18"><a href="#cb107-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb107-19"><a href="#cb107-19" aria-hidden="true" tabindex="-1"></a><span class="fu">## Repeat Letcher et al.</span></span>
<span id="cb107-20"><a href="#cb107-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb107-21"><a href="#cb107-21" aria-hidden="true" tabindex="-1"></a><span class="fu">### Load data</span></span>
<span id="cb107-22"><a href="#cb107-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb107-23"><a href="#cb107-23" aria-hidden="true" tabindex="-1"></a>Load fully formatted data used in Letcher et al. (2016) PeerJ</span>
<span id="cb107-26"><a href="#cb107-26" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb107-27"><a href="#cb107-27" aria-hidden="true" tabindex="-1"></a><span class="fu">load</span>(<span class="st">"data/tempDataSyncSUsed.RData"</span>)</span>
<span id="cb107-28"><a href="#cb107-28" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(tempDataSyncS)</span>
<span id="cb107-29"><a href="#cb107-29" aria-hidden="true" tabindex="-1"></a><span class="fu">unique</span>(tempDataSyncS<span class="sc">$</span>river)</span>
<span id="cb107-30"><a href="#cb107-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb107-31"><a href="#cb107-31" aria-hidden="true" tabindex="-1"></a>tempDataSyncS <span class="ot">&lt;-</span> tempDataSyncS <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="at">siteYear =</span> <span class="fu">paste</span>(site, year, <span class="at">sep =</span> <span class="st">"_"</span>))</span>
<span id="cb107-32"><a href="#cb107-32" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb107-33"><a href="#cb107-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb107-34"><a href="#cb107-34" aria-hidden="true" tabindex="-1"></a>Any missing data?</span>
<span id="cb107-37"><a href="#cb107-37" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb107-38"><a href="#cb107-38" aria-hidden="true" tabindex="-1"></a><span class="fu">any</span>(<span class="fu">is.na</span>(tempDataSyncS<span class="sc">$</span>airTemp))</span>
<span id="cb107-39"><a href="#cb107-39" aria-hidden="true" tabindex="-1"></a><span class="fu">any</span>(<span class="fu">is.na</span>(tempDataSyncS<span class="sc">$</span>airTempLagged1))</span>
<span id="cb107-40"><a href="#cb107-40" aria-hidden="true" tabindex="-1"></a><span class="fu">any</span>(<span class="fu">is.na</span>(tempDataSyncS<span class="sc">$</span>airTempLagged2))</span>
<span id="cb107-41"><a href="#cb107-41" aria-hidden="true" tabindex="-1"></a><span class="fu">any</span>(<span class="fu">is.na</span>(tempDataSyncS<span class="sc">$</span>flowLS))</span>
<span id="cb107-42"><a href="#cb107-42" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb107-43"><a href="#cb107-43" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb107-44"><a href="#cb107-44" aria-hidden="true" tabindex="-1"></a>Visualize data. Note that air temp is standardized. By site? Or among sites?</span>
<span id="cb107-45"><a href="#cb107-45" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb107-46"><a href="#cb107-46" aria-hidden="true" tabindex="-1"></a>::: panel-tabset</span>
<span id="cb107-47"><a href="#cb107-47" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb107-48"><a href="#cb107-48" aria-hidden="true" tabindex="-1"></a><span class="fu">#### Air temp</span></span>
<span id="cb107-51"><a href="#cb107-51" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb107-52"><a href="#cb107-52" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(tempDataSyncS,<span class="fu">aes</span>(dOY,airTemp))<span class="sc">+</span></span>
<span id="cb107-53"><a href="#cb107-53" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">color=</span><span class="fu">factor</span>(year))) <span class="sc">+</span></span>
<span id="cb107-54"><a href="#cb107-54" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_grid</span>(year<span class="sc">~</span>riverOrdered)</span>
<span id="cb107-55"><a href="#cb107-55" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb107-56"><a href="#cb107-56" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb107-57"><a href="#cb107-57" aria-hidden="true" tabindex="-1"></a><span class="fu">#### Water temp</span></span>
<span id="cb107-60"><a href="#cb107-60" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb107-61"><a href="#cb107-61" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(tempDataSyncS,<span class="fu">aes</span>(dOY,temp))<span class="sc">+</span></span>
<span id="cb107-62"><a href="#cb107-62" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">color=</span><span class="fu">factor</span>(year)))<span class="sc">+</span></span>
<span id="cb107-63"><a href="#cb107-63" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_grid</span>(year<span class="sc">~</span>riverOrdered)</span>
<span id="cb107-64"><a href="#cb107-64" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb107-65"><a href="#cb107-65" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb107-66"><a href="#cb107-66" aria-hidden="true" tabindex="-1"></a><span class="fu">#### Flow (log and std)</span></span>
<span id="cb107-69"><a href="#cb107-69" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb107-70"><a href="#cb107-70" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(tempDataSyncS,<span class="fu">aes</span>(dOY,flowLS))<span class="sc">+</span></span>
<span id="cb107-71"><a href="#cb107-71" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">color=</span><span class="fu">factor</span>(year)))<span class="sc">+</span></span>
<span id="cb107-72"><a href="#cb107-72" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_grid</span>(year<span class="sc">~</span>riverOrdered)</span>
<span id="cb107-73"><a href="#cb107-73" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb107-74"><a href="#cb107-74" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb107-75"><a href="#cb107-75" aria-hidden="true" tabindex="-1"></a><span class="fu">#### Tw ~ Ta + F</span></span>
<span id="cb107-78"><a href="#cb107-78" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb107-79"><a href="#cb107-79" aria-hidden="true" tabindex="-1"></a>tempDataSyncS <span class="sc">%&gt;%</span> <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> airTemp, <span class="at">y =</span> temp, <span class="at">color =</span> flowLS)) <span class="sc">+</span> <span class="fu">geom_point</span>(<span class="at">size =</span> <span class="fl">0.2</span>) <span class="sc">+</span> <span class="fu">facet_wrap</span>(<span class="sc">~</span>riverOrdered) <span class="sc">+</span> <span class="fu">theme_bw</span>()</span>
<span id="cb107-80"><a href="#cb107-80" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb107-81"><a href="#cb107-81" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb107-82"><a href="#cb107-82" aria-hidden="true" tabindex="-1"></a><span class="fu">#### Ta ~ F</span></span>
<span id="cb107-85"><a href="#cb107-85" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb107-86"><a href="#cb107-86" aria-hidden="true" tabindex="-1"></a>tempDataSyncS <span class="sc">%&gt;%</span> <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> airTemp, <span class="at">y =</span> flowLS, <span class="at">colour =</span> temp)) <span class="sc">+</span> <span class="fu">geom_point</span>(<span class="at">size =</span> <span class="fl">0.2</span>) <span class="sc">+</span> <span class="fu">facet_wrap</span>(<span class="sc">~</span>riverOrdered) <span class="sc">+</span> <span class="fu">theme_bw</span>() <span class="sc">+</span> ggpubr<span class="sc">::</span><span class="fu">stat_cor</span>()</span>
<span id="cb107-87"><a href="#cb107-87" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb107-88"><a href="#cb107-88" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb107-89"><a href="#cb107-89" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb107-90"><a href="#cb107-90" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb107-91"><a href="#cb107-91" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb107-92"><a href="#cb107-92" aria-hidden="true" tabindex="-1"></a><span class="fu">### Specify model</span></span>
<span id="cb107-93"><a href="#cb107-93" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb107-94"><a href="#cb107-94" aria-hidden="true" tabindex="-1"></a>Straight from Letcher et al (2016)</span>
<span id="cb107-97"><a href="#cb107-97" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb107-98"><a href="#cb107-98" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"model {</span></span>
<span id="cb107-99"><a href="#cb107-99" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb107-100"><a href="#cb107-100" aria-hidden="true" tabindex="-1"></a><span class="st">    ###----------------- LIKELIHOOD -----------------###</span></span>
<span id="cb107-101"><a href="#cb107-101" aria-hidden="true" tabindex="-1"></a><span class="st">    </span></span>
<span id="cb107-102"><a href="#cb107-102" aria-hidden="true" tabindex="-1"></a><span class="st">    # Days without an observation on the previous day (first observation in a series)</span></span>
<span id="cb107-103"><a href="#cb107-103" aria-hidden="true" tabindex="-1"></a><span class="st">    # No autoregressive term</span></span>
<span id="cb107-104"><a href="#cb107-104" aria-hidden="true" tabindex="-1"></a><span class="st">    </span></span>
<span id="cb107-105"><a href="#cb107-105" aria-hidden="true" tabindex="-1"></a><span class="st">    for (i in 1:nFirstObsRows){</span></span>
<span id="cb107-106"><a href="#cb107-106" aria-hidden="true" tabindex="-1"></a><span class="st">      temp[firstObsRows[i]] ~ dnorm(stream.mu[firstObsRows[i]], pow(sigma, -2)) </span></span>
<span id="cb107-107"><a href="#cb107-107" aria-hidden="true" tabindex="-1"></a><span class="st">      stream.mu[firstObsRows[i]] &lt;- trend[firstObsRows[i]]</span></span>
<span id="cb107-108"><a href="#cb107-108" aria-hidden="true" tabindex="-1"></a><span class="st">      trend[firstObsRows[i]] &lt;- inprod(B.0[], X.0[firstObsRows[i], ]) + inprod(B.year[year[firstObsRows[i]], ], X.year[firstObsRows[i], ])</span></span>
<span id="cb107-109"><a href="#cb107-109" aria-hidden="true" tabindex="-1"></a><span class="st">      }</span></span>
<span id="cb107-110"><a href="#cb107-110" aria-hidden="true" tabindex="-1"></a><span class="st">    </span></span>
<span id="cb107-111"><a href="#cb107-111" aria-hidden="true" tabindex="-1"></a><span class="st">    # Days with an observation on the previous dat (all days following the first day)</span></span>
<span id="cb107-112"><a href="#cb107-112" aria-hidden="true" tabindex="-1"></a><span class="st">    # Includes autoregressive term (ar1)</span></span>
<span id="cb107-113"><a href="#cb107-113" aria-hidden="true" tabindex="-1"></a><span class="st">    </span></span>
<span id="cb107-114"><a href="#cb107-114" aria-hidden="true" tabindex="-1"></a><span class="st">    for (i in 1:nEvalRows){ </span></span>
<span id="cb107-115"><a href="#cb107-115" aria-hidden="true" tabindex="-1"></a><span class="st">      temp[evalRows[i]] ~ dnorm(stream.mu[evalRows[i]], pow(sigma, -2))</span></span>
<span id="cb107-116"><a href="#cb107-116" aria-hidden="true" tabindex="-1"></a><span class="st">      stream.mu[evalRows[i]] &lt;- trend[evalRows[i]] + ar1[river[evalRows[i]]] * (temp[evalRows[i]-1] - trend[ evalRows[i]-1 ])</span></span>
<span id="cb107-117"><a href="#cb107-117" aria-hidden="true" tabindex="-1"></a><span class="st">      trend[evalRows[i]]  &lt;- inprod(B.0[], X.0[evalRows[i], ]) + inprod(B.year[year[evalRows[i]], ], X.year[evalRows[i], ])</span></span>
<span id="cb107-118"><a href="#cb107-118" aria-hidden="true" tabindex="-1"></a><span class="st">      }</span></span>
<span id="cb107-119"><a href="#cb107-119" aria-hidden="true" tabindex="-1"></a><span class="st">    </span></span>
<span id="cb107-120"><a href="#cb107-120" aria-hidden="true" tabindex="-1"></a><span class="st">    </span></span>
<span id="cb107-121"><a href="#cb107-121" aria-hidden="true" tabindex="-1"></a><span class="st">    ###----------------- PRIORS ---------------------###</span></span>
<span id="cb107-122"><a href="#cb107-122" aria-hidden="true" tabindex="-1"></a><span class="st">    </span></span>
<span id="cb107-123"><a href="#cb107-123" aria-hidden="true" tabindex="-1"></a><span class="st">    # ar1, hierarchical by site</span></span>
<span id="cb107-124"><a href="#cb107-124" aria-hidden="true" tabindex="-1"></a><span class="st">    for (i in 1:nRiver){</span></span>
<span id="cb107-125"><a href="#cb107-125" aria-hidden="true" tabindex="-1"></a><span class="st">      ar1[i] ~ dnorm(ar1Mean, pow(ar1SD,-2) ) T(-1,1)       </span></span>
<span id="cb107-126"><a href="#cb107-126" aria-hidden="true" tabindex="-1"></a><span class="st">    }</span></span>
<span id="cb107-127"><a href="#cb107-127" aria-hidden="true" tabindex="-1"></a><span class="st">    ar1Mean ~ dunif( -1,1 ) </span></span>
<span id="cb107-128"><a href="#cb107-128" aria-hidden="true" tabindex="-1"></a><span class="st">    ar1SD ~ dunif( 0, 2 )</span></span>
<span id="cb107-129"><a href="#cb107-129" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb107-130"><a href="#cb107-130" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb107-131"><a href="#cb107-131" aria-hidden="true" tabindex="-1"></a><span class="st">    # model variance</span></span>
<span id="cb107-132"><a href="#cb107-132" aria-hidden="true" tabindex="-1"></a><span class="st">    sigma ~ dunif(0, 100)</span></span>
<span id="cb107-133"><a href="#cb107-133" aria-hidden="true" tabindex="-1"></a><span class="st">    </span></span>
<span id="cb107-134"><a href="#cb107-134" aria-hidden="true" tabindex="-1"></a><span class="st">    </span></span>
<span id="cb107-135"><a href="#cb107-135" aria-hidden="true" tabindex="-1"></a><span class="st">    # fixed effect coefficients</span></span>
<span id="cb107-136"><a href="#cb107-136" aria-hidden="true" tabindex="-1"></a><span class="st">    for (k in 1:K.0) {</span></span>
<span id="cb107-137"><a href="#cb107-137" aria-hidden="true" tabindex="-1"></a><span class="st">      B.0[k] ~ dnorm(0, 0.001)</span></span>
<span id="cb107-138"><a href="#cb107-138" aria-hidden="true" tabindex="-1"></a><span class="st">      }</span></span>
<span id="cb107-139"><a href="#cb107-139" aria-hidden="true" tabindex="-1"></a><span class="st">      </span></span>
<span id="cb107-140"><a href="#cb107-140" aria-hidden="true" tabindex="-1"></a><span class="st">      </span></span>
<span id="cb107-141"><a href="#cb107-141" aria-hidden="true" tabindex="-1"></a><span class="st">    # YEAR EFFECTS</span></span>
<span id="cb107-142"><a href="#cb107-142" aria-hidden="true" tabindex="-1"></a><span class="st">    # Priors for random effects of year</span></span>
<span id="cb107-143"><a href="#cb107-143" aria-hidden="true" tabindex="-1"></a><span class="st">    for (t in 1:Ti) { # Ti years</span></span>
<span id="cb107-144"><a href="#cb107-144" aria-hidden="true" tabindex="-1"></a><span class="st">      B.year[t, 1:L] ~ dmnorm(mu.year[ ], tau.B.year[ , ])</span></span>
<span id="cb107-145"><a href="#cb107-145" aria-hidden="true" tabindex="-1"></a><span class="st">      }</span></span>
<span id="cb107-146"><a href="#cb107-146" aria-hidden="true" tabindex="-1"></a><span class="st">      </span></span>
<span id="cb107-147"><a href="#cb107-147" aria-hidden="true" tabindex="-1"></a><span class="st">    mu.year[1] &lt;- 0</span></span>
<span id="cb107-148"><a href="#cb107-148" aria-hidden="true" tabindex="-1"></a><span class="st">    </span></span>
<span id="cb107-149"><a href="#cb107-149" aria-hidden="true" tabindex="-1"></a><span class="st">    for (l in 2:L) {</span></span>
<span id="cb107-150"><a href="#cb107-150" aria-hidden="true" tabindex="-1"></a><span class="st">      mu.year[l] ~ dnorm(0, 0.0001)</span></span>
<span id="cb107-151"><a href="#cb107-151" aria-hidden="true" tabindex="-1"></a><span class="st">      }</span></span>
<span id="cb107-152"><a href="#cb107-152" aria-hidden="true" tabindex="-1"></a><span class="st">      </span></span>
<span id="cb107-153"><a href="#cb107-153" aria-hidden="true" tabindex="-1"></a><span class="st">    # Prior on multivariate normal std deviation</span></span>
<span id="cb107-154"><a href="#cb107-154" aria-hidden="true" tabindex="-1"></a><span class="st">    tau.B.year[1:L, 1:L] ~ dwish(W.year[ , ], df.year)</span></span>
<span id="cb107-155"><a href="#cb107-155" aria-hidden="true" tabindex="-1"></a><span class="st">    df.year &lt;- L + 1</span></span>
<span id="cb107-156"><a href="#cb107-156" aria-hidden="true" tabindex="-1"></a><span class="st">    sigma.B.year[1:L, 1:L] &lt;- inverse(tau.B.year[ , ])</span></span>
<span id="cb107-157"><a href="#cb107-157" aria-hidden="true" tabindex="-1"></a><span class="st">    for (l in 1:L) {</span></span>
<span id="cb107-158"><a href="#cb107-158" aria-hidden="true" tabindex="-1"></a><span class="st">      for (l.prime in 1:L) {</span></span>
<span id="cb107-159"><a href="#cb107-159" aria-hidden="true" tabindex="-1"></a><span class="st">        rho.B.year[l, l.prime] &lt;- sigma.B.year[l, l.prime]/sqrt(sigma.B.year[l, l]*sigma.B.year[l.prime, l.prime])</span></span>
<span id="cb107-160"><a href="#cb107-160" aria-hidden="true" tabindex="-1"></a><span class="st">        }</span></span>
<span id="cb107-161"><a href="#cb107-161" aria-hidden="true" tabindex="-1"></a><span class="st">      sigma.b.year[l] &lt;- sqrt(sigma.B.year[l, l])</span></span>
<span id="cb107-162"><a href="#cb107-162" aria-hidden="true" tabindex="-1"></a><span class="st">    }</span></span>
<span id="cb107-163"><a href="#cb107-163" aria-hidden="true" tabindex="-1"></a><span class="st">    </span></span>
<span id="cb107-164"><a href="#cb107-164" aria-hidden="true" tabindex="-1"></a><span class="st">    </span></span>
<span id="cb107-165"><a href="#cb107-165" aria-hidden="true" tabindex="-1"></a><span class="st">    ###----------------- DERIVED VALUES -------------###</span></span>
<span id="cb107-166"><a href="#cb107-166" aria-hidden="true" tabindex="-1"></a><span class="st">    residuals[1] &lt;- 0 # hold the place. Not sure if this is necessary...</span></span>
<span id="cb107-167"><a href="#cb107-167" aria-hidden="true" tabindex="-1"></a><span class="st">    for (i in 2:n) {</span></span>
<span id="cb107-168"><a href="#cb107-168" aria-hidden="true" tabindex="-1"></a><span class="st">      residuals[i] &lt;- temp[i] - stream.mu[i]</span></span>
<span id="cb107-169"><a href="#cb107-169" aria-hidden="true" tabindex="-1"></a><span class="st">    }</span></span>
<span id="cb107-170"><a href="#cb107-170" aria-hidden="true" tabindex="-1"></a><span class="st">    </span></span>
<span id="cb107-171"><a href="#cb107-171" aria-hidden="true" tabindex="-1"></a><span class="st">    }"</span>, <span class="at">file =</span> <span class="st">"JAGS models/DailyTempModelJAGS_Letcher.txt"</span>)</span>
<span id="cb107-172"><a href="#cb107-172" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb107-173"><a href="#cb107-173" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb107-174"><a href="#cb107-174" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb107-175"><a href="#cb107-175" aria-hidden="true" tabindex="-1"></a><span class="fu">### Organize objects</span></span>
<span id="cb107-176"><a href="#cb107-176" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb107-177"><a href="#cb107-177" aria-hidden="true" tabindex="-1"></a>Get first observation indices and check that nFirstRowObs equals the number of unique site-years: **must be TRUE!**</span>
<span id="cb107-180"><a href="#cb107-180" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb107-181"><a href="#cb107-181" aria-hidden="true" tabindex="-1"></a><span class="co"># row indices for first observation in each site-year</span></span>
<span id="cb107-182"><a href="#cb107-182" aria-hidden="true" tabindex="-1"></a>firstObsRows <span class="ot">&lt;-</span> <span class="fu">unlist</span>(tempDataSyncS <span class="sc">%&gt;%</span> </span>
<span id="cb107-183"><a href="#cb107-183" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(siteYear) <span class="sc">%&gt;%</span></span>
<span id="cb107-184"><a href="#cb107-184" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="at">index =</span> rowNum[<span class="fu">min</span>(<span class="fu">which</span>(<span class="sc">!</span><span class="fu">is.na</span>(temp)))]) <span class="sc">%&gt;%</span></span>
<span id="cb107-185"><a href="#cb107-185" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb107-186"><a href="#cb107-186" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(index))</span>
<span id="cb107-187"><a href="#cb107-187" aria-hidden="true" tabindex="-1"></a>nFirstObsRows <span class="ot">&lt;-</span> <span class="fu">length</span>(firstObsRows)</span>
<span id="cb107-188"><a href="#cb107-188" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb107-189"><a href="#cb107-189" aria-hidden="true" tabindex="-1"></a><span class="co"># does the number of first observations match the number of site years?</span></span>
<span id="cb107-190"><a href="#cb107-190" aria-hidden="true" tabindex="-1"></a>nFirstObsRows <span class="sc">==</span> <span class="fu">length</span>(<span class="fu">unique</span>(tempDataSyncS<span class="sc">$</span>siteYear))</span>
<span id="cb107-191"><a href="#cb107-191" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb107-192"><a href="#cb107-192" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb107-193"><a href="#cb107-193" aria-hidden="true" tabindex="-1"></a>Get row indices for all other observations</span>
<span id="cb107-196"><a href="#cb107-196" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb107-197"><a href="#cb107-197" aria-hidden="true" tabindex="-1"></a>evalRows <span class="ot">&lt;-</span> <span class="fu">unlist</span>(tempDataSyncS <span class="sc">%&gt;%</span> <span class="fu">filter</span>(<span class="sc">!</span>rowNum <span class="sc">%in%</span> firstObsRows) <span class="sc">%&gt;%</span> <span class="fu">select</span>(rowNum))</span>
<span id="cb107-198"><a href="#cb107-198" aria-hidden="true" tabindex="-1"></a>nEvalRows <span class="ot">&lt;-</span> <span class="fu">length</span>(evalRows)</span>
<span id="cb107-199"><a href="#cb107-199" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb107-200"><a href="#cb107-200" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb107-201"><a href="#cb107-201" aria-hidden="true" tabindex="-1"></a>Fixed and random effect data</span>
<span id="cb107-204"><a href="#cb107-204" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb107-205"><a href="#cb107-205" aria-hidden="true" tabindex="-1"></a>data.fixed <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">intercept =</span> <span class="dv">1</span></span>
<span id="cb107-206"><a href="#cb107-206" aria-hidden="true" tabindex="-1"></a>                         ,<span class="at">airTemp =</span> tempDataSyncS<span class="sc">$</span>airTemp </span>
<span id="cb107-207"><a href="#cb107-207" aria-hidden="true" tabindex="-1"></a>                         ,<span class="at">airTempLag1 =</span> tempDataSyncS<span class="sc">$</span>airTempLagged1</span>
<span id="cb107-208"><a href="#cb107-208" aria-hidden="true" tabindex="-1"></a>                         ,<span class="at">airTempLag2 =</span> tempDataSyncS<span class="sc">$</span>airTempLagged2</span>
<span id="cb107-209"><a href="#cb107-209" aria-hidden="true" tabindex="-1"></a>                         </span>
<span id="cb107-210"><a href="#cb107-210" aria-hidden="true" tabindex="-1"></a>                         ,<span class="at">flow =</span>  tempDataSyncS<span class="sc">$</span>flowLS</span>
<span id="cb107-211"><a href="#cb107-211" aria-hidden="true" tabindex="-1"></a>                         </span>
<span id="cb107-212"><a href="#cb107-212" aria-hidden="true" tabindex="-1"></a>                         ,<span class="at">airFlow =</span> tempDataSyncS<span class="sc">$</span>airTemp <span class="sc">*</span> tempDataSyncS<span class="sc">$</span>flowLS</span>
<span id="cb107-213"><a href="#cb107-213" aria-hidden="true" tabindex="-1"></a><span class="co">#                         ,air1Flow = tempDataSyncS$airTempLagged1 * tempDataSyncS$flowLS</span></span>
<span id="cb107-214"><a href="#cb107-214" aria-hidden="true" tabindex="-1"></a><span class="co">#                         ,air2Flow = tempDataSyncS$airTempLagged2 * tempDataSyncS$flowLS</span></span>
<span id="cb107-215"><a href="#cb107-215" aria-hidden="true" tabindex="-1"></a>                         </span>
<span id="cb107-216"><a href="#cb107-216" aria-hidden="true" tabindex="-1"></a>                         <span class="co">#main river effects</span></span>
<span id="cb107-217"><a href="#cb107-217" aria-hidden="true" tabindex="-1"></a>                         ,<span class="at">river1 =</span> tempDataSyncS<span class="sc">$</span>river1</span>
<span id="cb107-218"><a href="#cb107-218" aria-hidden="true" tabindex="-1"></a>                         ,<span class="at">river2 =</span> tempDataSyncS<span class="sc">$</span>river2</span>
<span id="cb107-219"><a href="#cb107-219" aria-hidden="true" tabindex="-1"></a>                         ,<span class="at">river3 =</span> tempDataSyncS<span class="sc">$</span>river3</span>
<span id="cb107-220"><a href="#cb107-220" aria-hidden="true" tabindex="-1"></a>                         </span>
<span id="cb107-221"><a href="#cb107-221" aria-hidden="true" tabindex="-1"></a>                         <span class="co">#river interaction with air temp</span></span>
<span id="cb107-222"><a href="#cb107-222" aria-hidden="true" tabindex="-1"></a>                         ,<span class="at">river1Air =</span> tempDataSyncS<span class="sc">$</span>river1 <span class="sc">*</span> tempDataSyncS<span class="sc">$</span>airTemp</span>
<span id="cb107-223"><a href="#cb107-223" aria-hidden="true" tabindex="-1"></a>                         ,<span class="at">river2Air =</span> tempDataSyncS<span class="sc">$</span>river2 <span class="sc">*</span> tempDataSyncS<span class="sc">$</span>airTemp</span>
<span id="cb107-224"><a href="#cb107-224" aria-hidden="true" tabindex="-1"></a>                         ,<span class="at">river3Air =</span> tempDataSyncS<span class="sc">$</span>river3 <span class="sc">*</span> tempDataSyncS<span class="sc">$</span>airTemp</span>
<span id="cb107-225"><a href="#cb107-225" aria-hidden="true" tabindex="-1"></a>                         </span>
<span id="cb107-226"><a href="#cb107-226" aria-hidden="true" tabindex="-1"></a>                          ) </span>
<span id="cb107-227"><a href="#cb107-227" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb107-228"><a href="#cb107-228" aria-hidden="true" tabindex="-1"></a>data.random.years <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">intercept.year =</span> <span class="dv">1</span>, </span>
<span id="cb107-229"><a href="#cb107-229" aria-hidden="true" tabindex="-1"></a>                     <span class="at">dOY  =</span> tempDataSyncS<span class="sc">$</span>dOY, </span>
<span id="cb107-230"><a href="#cb107-230" aria-hidden="true" tabindex="-1"></a>                     <span class="at">dOY2 =</span> tempDataSyncS<span class="sc">$</span>dOY<span class="sc">^</span><span class="dv">2</span>,</span>
<span id="cb107-231"><a href="#cb107-231" aria-hidden="true" tabindex="-1"></a>                     <span class="at">dOY3 =</span> tempDataSyncS<span class="sc">$</span>dOY<span class="sc">^</span><span class="dv">3</span></span>
<span id="cb107-232"><a href="#cb107-232" aria-hidden="true" tabindex="-1"></a>                     )</span>
<span id="cb107-233"><a href="#cb107-233" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb107-234"><a href="#cb107-234" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb107-235"><a href="#cb107-235" aria-hidden="true" tabindex="-1"></a>Misc. objects</span>
<span id="cb107-238"><a href="#cb107-238" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb107-239"><a href="#cb107-239" aria-hidden="true" tabindex="-1"></a>Ti <span class="ot">&lt;-</span> <span class="fu">length</span>(<span class="fu">unique</span>(tempDataSyncS<span class="sc">$</span>year))</span>
<span id="cb107-240"><a href="#cb107-240" aria-hidden="true" tabindex="-1"></a>L <span class="ot">&lt;-</span> <span class="fu">dim</span>(data.random.years)[<span class="dv">2</span>]</span>
<span id="cb107-241"><a href="#cb107-241" aria-hidden="true" tabindex="-1"></a>W.year <span class="ot">&lt;-</span> <span class="fu">diag</span>(L)</span>
<span id="cb107-242"><a href="#cb107-242" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb107-243"><a href="#cb107-243" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb107-244"><a href="#cb107-244" aria-hidden="true" tabindex="-1"></a>Combine data in list</span>
<span id="cb107-247"><a href="#cb107-247" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb107-248"><a href="#cb107-248" aria-hidden="true" tabindex="-1"></a><span class="co"># combine data in a list</span></span>
<span id="cb107-249"><a href="#cb107-249" aria-hidden="true" tabindex="-1"></a>jags.data <span class="ot">&lt;-</span> <span class="fu">list</span>(<span class="st">"temp"</span> <span class="ot">=</span> tempDataSyncS<span class="sc">$</span>temp,</span>
<span id="cb107-250"><a href="#cb107-250" aria-hidden="true" tabindex="-1"></a>                  <span class="st">"nFirstObsRows"</span> <span class="ot">=</span> nFirstObsRows,</span>
<span id="cb107-251"><a href="#cb107-251" aria-hidden="true" tabindex="-1"></a>                  <span class="st">"firstObsRows"</span> <span class="ot">=</span> firstObsRows,</span>
<span id="cb107-252"><a href="#cb107-252" aria-hidden="true" tabindex="-1"></a>                  <span class="st">"nEvalRows"</span> <span class="ot">=</span> nEvalRows,</span>
<span id="cb107-253"><a href="#cb107-253" aria-hidden="true" tabindex="-1"></a>                  <span class="st">"evalRows"</span> <span class="ot">=</span> evalRows,</span>
<span id="cb107-254"><a href="#cb107-254" aria-hidden="true" tabindex="-1"></a>                  <span class="st">"X.0"</span> <span class="ot">=</span> data.fixed,</span>
<span id="cb107-255"><a href="#cb107-255" aria-hidden="true" tabindex="-1"></a>                  <span class="st">"X.year"</span> <span class="ot">=</span> data.random.years,</span>
<span id="cb107-256"><a href="#cb107-256" aria-hidden="true" tabindex="-1"></a>                  <span class="st">"K.0"</span> <span class="ot">=</span> <span class="fu">dim</span>(data.fixed)[<span class="dv">2</span>],</span>
<span id="cb107-257"><a href="#cb107-257" aria-hidden="true" tabindex="-1"></a>                  <span class="st">"nRiver"</span> <span class="ot">=</span> <span class="fu">length</span>(<span class="fu">unique</span>(tempDataSyncS<span class="sc">$</span>site)),</span>
<span id="cb107-258"><a href="#cb107-258" aria-hidden="true" tabindex="-1"></a>                  <span class="st">"Ti"</span> <span class="ot">=</span> Ti,</span>
<span id="cb107-259"><a href="#cb107-259" aria-hidden="true" tabindex="-1"></a>                  <span class="st">"L"</span> <span class="ot">=</span> L,</span>
<span id="cb107-260"><a href="#cb107-260" aria-hidden="true" tabindex="-1"></a>                  <span class="st">"W.year"</span> <span class="ot">=</span> W.year,</span>
<span id="cb107-261"><a href="#cb107-261" aria-hidden="true" tabindex="-1"></a>                  <span class="st">"n"</span> <span class="ot">=</span> <span class="fu">dim</span>(tempDataSyncS)[<span class="dv">1</span>],</span>
<span id="cb107-262"><a href="#cb107-262" aria-hidden="true" tabindex="-1"></a>                  <span class="st">"year"</span> <span class="ot">=</span> <span class="fu">as.factor</span>(tempDataSyncS<span class="sc">$</span>year),</span>
<span id="cb107-263"><a href="#cb107-263" aria-hidden="true" tabindex="-1"></a>                  <span class="st">"river"</span> <span class="ot">=</span> <span class="fu">as.factor</span>(tempDataSyncS<span class="sc">$</span>riverOrdered)</span>
<span id="cb107-264"><a href="#cb107-264" aria-hidden="true" tabindex="-1"></a>                  )</span>
<span id="cb107-265"><a href="#cb107-265" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb107-266"><a href="#cb107-266" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb107-267"><a href="#cb107-267" aria-hidden="true" tabindex="-1"></a>Parameters to monitor</span>
<span id="cb107-270"><a href="#cb107-270" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb107-271"><a href="#cb107-271" aria-hidden="true" tabindex="-1"></a>jags.params <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"residuals"</span>,</span>
<span id="cb107-272"><a href="#cb107-272" aria-hidden="true" tabindex="-1"></a>            <span class="st">"deviance"</span>,</span>
<span id="cb107-273"><a href="#cb107-273" aria-hidden="true" tabindex="-1"></a> <span class="co">#           "pD",</span></span>
<span id="cb107-274"><a href="#cb107-274" aria-hidden="true" tabindex="-1"></a>            <span class="st">"sigma"</span>,</span>
<span id="cb107-275"><a href="#cb107-275" aria-hidden="true" tabindex="-1"></a>            <span class="st">"B.0"</span>,</span>
<span id="cb107-276"><a href="#cb107-276" aria-hidden="true" tabindex="-1"></a>            <span class="st">"B.year"</span>,</span>
<span id="cb107-277"><a href="#cb107-277" aria-hidden="true" tabindex="-1"></a>            <span class="st">"rho.B.year"</span>,</span>
<span id="cb107-278"><a href="#cb107-278" aria-hidden="true" tabindex="-1"></a>            <span class="st">"mu.year"</span>,</span>
<span id="cb107-279"><a href="#cb107-279" aria-hidden="true" tabindex="-1"></a>            <span class="st">"sigma.b.year"</span>,</span>
<span id="cb107-280"><a href="#cb107-280" aria-hidden="true" tabindex="-1"></a>            <span class="st">"stream.mu"</span>,</span>
<span id="cb107-281"><a href="#cb107-281" aria-hidden="true" tabindex="-1"></a>            <span class="st">"ar1"</span> ,</span>
<span id="cb107-282"><a href="#cb107-282" aria-hidden="true" tabindex="-1"></a>            <span class="st">"ar1Mean"</span>,</span>
<span id="cb107-283"><a href="#cb107-283" aria-hidden="true" tabindex="-1"></a>            <span class="st">"ar1SD"</span>,</span>
<span id="cb107-284"><a href="#cb107-284" aria-hidden="true" tabindex="-1"></a>            <span class="st">"temp"</span></span>
<span id="cb107-285"><a href="#cb107-285" aria-hidden="true" tabindex="-1"></a>            )</span>
<span id="cb107-286"><a href="#cb107-286" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb107-287"><a href="#cb107-287" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb107-288"><a href="#cb107-288" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb107-289"><a href="#cb107-289" aria-hidden="true" tabindex="-1"></a><span class="fu">### Fit model</span></span>
<span id="cb107-290"><a href="#cb107-290" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb107-291"><a href="#cb107-291" aria-hidden="true" tabindex="-1"></a><span class="in">```{r eval=FALSE}</span></span>
<span id="cb107-292"><a href="#cb107-292" aria-hidden="true" tabindex="-1"></a>fit0 <span class="ot">&lt;-</span> <span class="fu">jags.parallel</span>(<span class="at">data =</span> jags.data, <span class="at">inits =</span> <span class="cn">NULL</span>, <span class="at">parameters.to.save =</span> jags.params, <span class="at">model.file =</span> <span class="st">"JAGS models/DailyTempModelJAGS_Letcher.txt"</span>,</span>
<span id="cb107-293"><a href="#cb107-293" aria-hidden="true" tabindex="-1"></a>            <span class="at">n.chains =</span> <span class="dv">10</span>, <span class="at">n.thin =</span> <span class="dv">5</span>, <span class="at">n.burnin =</span> <span class="dv">500</span>, <span class="at">n.iter =</span> <span class="dv">1500</span>, <span class="at">DIC =</span> <span class="cn">TRUE</span>)</span>
<span id="cb107-294"><a href="#cb107-294" aria-hidden="true" tabindex="-1"></a><span class="fu">beep</span>()</span>
<span id="cb107-295"><a href="#cb107-295" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb107-296"><a href="#cb107-296" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb107-297"><a href="#cb107-297" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb107-298"><a href="#cb107-298" aria-hidden="true" tabindex="-1"></a><span class="fu">#### Save model output</span></span>
<span id="cb107-299"><a href="#cb107-299" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb107-300"><a href="#cb107-300" aria-hidden="true" tabindex="-1"></a>Save to file</span>
<span id="cb107-301"><a href="#cb107-301" aria-hidden="true" tabindex="-1"></a><span class="in">```{r eval=FALSE}</span></span>
<span id="cb107-302"><a href="#cb107-302" aria-hidden="true" tabindex="-1"></a><span class="fu">saveRDS</span>(fit0, <span class="st">"Model objects/LetcherTempModel_PeerJ2016.RDS"</span>)</span>
<span id="cb107-303"><a href="#cb107-303" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb107-304"><a href="#cb107-304" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb107-305"><a href="#cb107-305" aria-hidden="true" tabindex="-1"></a>Read in fitted model object</span>
<span id="cb107-308"><a href="#cb107-308" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb107-309"><a href="#cb107-309" aria-hidden="true" tabindex="-1"></a>fit0 <span class="ot">&lt;-</span> <span class="fu">readRDS</span>(<span class="st">"Model objects/LetcherTempModel_PeerJ2016.RDS"</span>)</span>
<span id="cb107-310"><a href="#cb107-310" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb107-311"><a href="#cb107-311" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb107-312"><a href="#cb107-312" aria-hidden="true" tabindex="-1"></a>Get MCMC samples and summary</span>
<span id="cb107-315"><a href="#cb107-315" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb107-316"><a href="#cb107-316" aria-hidden="true" tabindex="-1"></a>top_mod <span class="ot">&lt;-</span> fit0</span>
<span id="cb107-317"><a href="#cb107-317" aria-hidden="true" tabindex="-1"></a><span class="co"># generate MCMC samples and store as an array</span></span>
<span id="cb107-318"><a href="#cb107-318" aria-hidden="true" tabindex="-1"></a>modelout <span class="ot">&lt;-</span> top_mod<span class="sc">$</span>BUGSoutput</span>
<span id="cb107-319"><a href="#cb107-319" aria-hidden="true" tabindex="-1"></a>McmcList <span class="ot">&lt;-</span> <span class="fu">vector</span>(<span class="st">"list"</span>, <span class="at">length =</span> <span class="fu">dim</span>(modelout<span class="sc">$</span>sims.array)[<span class="dv">2</span>])</span>
<span id="cb107-320"><a href="#cb107-320" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(McmcList)) { McmcList[[i]] <span class="ot">=</span> <span class="fu">as.mcmc</span>(modelout<span class="sc">$</span>sims.array[,i,]) }</span>
<span id="cb107-321"><a href="#cb107-321" aria-hidden="true" tabindex="-1"></a><span class="co"># rbind MCMC samples from 10 chains </span></span>
<span id="cb107-322"><a href="#cb107-322" aria-hidden="true" tabindex="-1"></a>Mcmcdat <span class="ot">&lt;-</span> <span class="fu">rbind</span>(McmcList[[<span class="dv">1</span>]], McmcList[[<span class="dv">2</span>]], McmcList[[<span class="dv">3</span>]], McmcList[[<span class="dv">4</span>]], McmcList[[<span class="dv">5</span>]], McmcList[[<span class="dv">6</span>]], McmcList[[<span class="dv">7</span>]], McmcList[[<span class="dv">8</span>]], McmcList[[<span class="dv">9</span>]], McmcList[[<span class="dv">10</span>]])</span>
<span id="cb107-323"><a href="#cb107-323" aria-hidden="true" tabindex="-1"></a>param.summary <span class="ot">&lt;-</span> modelout<span class="sc">$</span>summary</span>
<span id="cb107-324"><a href="#cb107-324" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(param.summary)</span>
<span id="cb107-325"><a href="#cb107-325" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb107-326"><a href="#cb107-326" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb107-327"><a href="#cb107-327" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb107-328"><a href="#cb107-328" aria-hidden="true" tabindex="-1"></a><span class="fu">#### Check convergence</span></span>
<span id="cb107-329"><a href="#cb107-329" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb107-330"><a href="#cb107-330" aria-hidden="true" tabindex="-1"></a>Any problematic R-hat values (&gt;1.05)?</span>
<span id="cb107-333"><a href="#cb107-333" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb107-334"><a href="#cb107-334" aria-hidden="true" tabindex="-1"></a>top_mod<span class="sc">$</span>BUGSoutput<span class="sc">$</span>summary[,<span class="dv">8</span>][top_mod<span class="sc">$</span>BUGSoutput<span class="sc">$</span>summary[,<span class="dv">8</span>] <span class="sc">&gt;</span> <span class="fl">1.05</span>]</span>
<span id="cb107-335"><a href="#cb107-335" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb107-336"><a href="#cb107-336" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb107-337"><a href="#cb107-337" aria-hidden="true" tabindex="-1"></a>View traceplots</span>
<span id="cb107-340"><a href="#cb107-340" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb107-341"><a href="#cb107-341" aria-hidden="true" tabindex="-1"></a><span class="fu">MCMCtrace</span>(top_mod, <span class="at">ind =</span> <span class="cn">TRUE</span>, </span>
<span id="cb107-342"><a href="#cb107-342" aria-hidden="true" tabindex="-1"></a>          <span class="at">params =</span> <span class="fu">c</span>(<span class="st">"B.0"</span>, <span class="st">"mu.year"</span>, </span>
<span id="cb107-343"><a href="#cb107-343" aria-hidden="true" tabindex="-1"></a>                     <span class="st">"ar1"</span>, </span>
<span id="cb107-344"><a href="#cb107-344" aria-hidden="true" tabindex="-1"></a>                     <span class="st">"sigma"</span>), <span class="at">pdf =</span> <span class="cn">FALSE</span>)</span>
<span id="cb107-345"><a href="#cb107-345" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb107-346"><a href="#cb107-346" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb107-347"><a href="#cb107-347" aria-hidden="true" tabindex="-1"></a>Convert to ggs object</span>
<span id="cb107-350"><a href="#cb107-350" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb107-351"><a href="#cb107-351" aria-hidden="true" tabindex="-1"></a>ggfit <span class="ot">&lt;-</span> <span class="fu">ggs</span>(<span class="fu">as.mcmc</span>(top_mod), <span class="at">keep_original_order =</span> <span class="cn">TRUE</span>)</span>
<span id="cb107-352"><a href="#cb107-352" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(ggfit)</span>
<span id="cb107-353"><a href="#cb107-353" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb107-354"><a href="#cb107-354" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb107-355"><a href="#cb107-355" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb107-356"><a href="#cb107-356" aria-hidden="true" tabindex="-1"></a><span class="fu">### Goodness of fit</span></span>
<span id="cb107-357"><a href="#cb107-357" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb107-358"><a href="#cb107-358" aria-hidden="true" tabindex="-1"></a>Format observed and predicted values</span>
<span id="cb107-361"><a href="#cb107-361" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb107-362"><a href="#cb107-362" aria-hidden="true" tabindex="-1"></a>Mcmcdat <span class="ot">&lt;-</span> <span class="fu">as_tibble</span>(Mcmcdat)</span>
<span id="cb107-363"><a href="#cb107-363" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb107-364"><a href="#cb107-364" aria-hidden="true" tabindex="-1"></a><span class="co"># subset expected and observed MCMC samples</span></span>
<span id="cb107-365"><a href="#cb107-365" aria-hidden="true" tabindex="-1"></a>ppdat_exp <span class="ot">&lt;-</span> <span class="fu">as.matrix</span>(Mcmcdat[,<span class="fu">startsWith</span>(<span class="fu">names</span>(Mcmcdat), <span class="st">"stream.mu["</span>)])</span>
<span id="cb107-366"><a href="#cb107-366" aria-hidden="true" tabindex="-1"></a>ppdat_obs <span class="ot">&lt;-</span> <span class="fu">as.matrix</span>(Mcmcdat[,<span class="fu">startsWith</span>(<span class="fu">names</span>(Mcmcdat), <span class="st">"temp["</span>)])</span>
<span id="cb107-367"><a href="#cb107-367" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb107-368"><a href="#cb107-368" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb107-369"><a href="#cb107-369" aria-hidden="true" tabindex="-1"></a>Bayesian p-value</span>
<span id="cb107-372"><a href="#cb107-372" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb107-373"><a href="#cb107-373" aria-hidden="true" tabindex="-1"></a><span class="fu">sum</span>(ppdat_exp <span class="sc">&gt;</span> ppdat_obs) <span class="sc">/</span> (<span class="fu">dim</span>(ppdat_obs)[<span class="dv">1</span>]<span class="sc">*</span><span class="fu">dim</span>(ppdat_obs)[<span class="dv">2</span>])</span>
<span id="cb107-374"><a href="#cb107-374" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb107-375"><a href="#cb107-375" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb107-376"><a href="#cb107-376" aria-hidden="true" tabindex="-1"></a>PP-check, global</span>
<span id="cb107-379"><a href="#cb107-379" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb107-380"><a href="#cb107-380" aria-hidden="true" tabindex="-1"></a>ppdat_obs_mean <span class="ot">&lt;-</span> <span class="fu">apply</span>(ppdat_obs, <span class="dv">2</span>, mean)</span>
<span id="cb107-381"><a href="#cb107-381" aria-hidden="true" tabindex="-1"></a>ppdat_exp_mean <span class="ot">&lt;-</span> <span class="fu">apply</span>(ppdat_exp, <span class="dv">2</span>, mean)</span>
<span id="cb107-382"><a href="#cb107-382" aria-hidden="true" tabindex="-1"></a><span class="fu">tibble</span>(<span class="at">obs =</span> ppdat_obs_mean, <span class="at">exp =</span> ppdat_exp_mean) <span class="sc">%&gt;%</span> </span>
<span id="cb107-383"><a href="#cb107-383" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> obs, <span class="at">y =</span> exp)) <span class="sc">+</span> </span>
<span id="cb107-384"><a href="#cb107-384" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">alpha =</span> <span class="fl">0.1</span>) <span class="sc">+</span> </span>
<span id="cb107-385"><a href="#cb107-385" aria-hidden="true" tabindex="-1"></a>  <span class="co"># geom_smooth(method = "lm") +</span></span>
<span id="cb107-386"><a href="#cb107-386" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_abline</span>(<span class="at">intercept =</span> <span class="dv">0</span>, <span class="at">slope =</span> <span class="dv">1</span>, <span class="at">color =</span> <span class="st">"red"</span>) <span class="sc">+</span> </span>
<span id="cb107-387"><a href="#cb107-387" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>() <span class="sc">+</span> <span class="fu">theme</span>(<span class="at">panel.grid =</span> <span class="fu">element_blank</span>()) <span class="sc">+</span></span>
<span id="cb107-388"><a href="#cb107-388" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="st">"Observed"</span>) <span class="sc">+</span> <span class="fu">ylab</span>(<span class="st">"Predicted (mean)"</span>)</span>
<span id="cb107-389"><a href="#cb107-389" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb107-390"><a href="#cb107-390" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb107-391"><a href="#cb107-391" aria-hidden="true" tabindex="-1"></a>PP-check by river and year</span>
<span id="cb107-392"><a href="#cb107-392" aria-hidden="true" tabindex="-1"></a><span class="in">```{r fig.height=10, fig.width=7}</span></span>
<span id="cb107-393"><a href="#cb107-393" aria-hidden="true" tabindex="-1"></a><span class="fu">tibble</span>(<span class="at">obs =</span> ppdat_obs_mean, <span class="at">exp =</span> ppdat_exp_mean, <span class="at">river =</span> tempDataSyncS<span class="sc">$</span>riverOrdered, <span class="at">year =</span> tempDataSyncS<span class="sc">$</span>year) <span class="sc">%&gt;%</span> </span>
<span id="cb107-394"><a href="#cb107-394" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> obs, <span class="at">y =</span> exp)) <span class="sc">+</span> </span>
<span id="cb107-395"><a href="#cb107-395" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">alpha =</span> <span class="fl">0.1</span>) <span class="sc">+</span> </span>
<span id="cb107-396"><a href="#cb107-396" aria-hidden="true" tabindex="-1"></a>  <span class="co"># geom_smooth(method = "lm") +</span></span>
<span id="cb107-397"><a href="#cb107-397" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_abline</span>(<span class="at">intercept =</span> <span class="dv">0</span>, <span class="at">slope =</span> <span class="dv">1</span>, <span class="at">color =</span> <span class="st">"red"</span>) <span class="sc">+</span> </span>
<span id="cb107-398"><a href="#cb107-398" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>() <span class="sc">+</span> <span class="fu">theme</span>(<span class="at">panel.grid =</span> <span class="fu">element_blank</span>()) <span class="sc">+</span></span>
<span id="cb107-399"><a href="#cb107-399" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="st">"Observed"</span>) <span class="sc">+</span> <span class="fu">ylab</span>(<span class="st">"Predicted (mean)"</span>) <span class="sc">+</span></span>
<span id="cb107-400"><a href="#cb107-400" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_grid</span>(year <span class="sc">~</span> river)</span>
<span id="cb107-401"><a href="#cb107-401" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb107-402"><a href="#cb107-402" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb107-403"><a href="#cb107-403" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb107-404"><a href="#cb107-404" aria-hidden="true" tabindex="-1"></a><span class="fu">### Plot model output</span></span>
<span id="cb107-405"><a href="#cb107-405" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb107-406"><a href="#cb107-406" aria-hidden="true" tabindex="-1"></a>*Output is identical to Letcher et al. (2016), as expected*</span>
<span id="cb107-407"><a href="#cb107-407" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb107-408"><a href="#cb107-408" aria-hidden="true" tabindex="-1"></a><span class="fu">#### Dot plots</span></span>
<span id="cb107-409"><a href="#cb107-409" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb107-410"><a href="#cb107-410" aria-hidden="true" tabindex="-1"></a>::: panel-tabset</span>
<span id="cb107-411"><a href="#cb107-411" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb107-412"><a href="#cb107-412" aria-hidden="true" tabindex="-1"></a><span class="fu">##### Intercept</span></span>
<span id="cb107-415"><a href="#cb107-415" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb107-416"><a href="#cb107-416" aria-hidden="true" tabindex="-1"></a><span class="fu">ggs_caterpillar</span>(ggfit <span class="sc">%&gt;%</span> <span class="fu">filter</span>(Parameter <span class="sc">==</span> <span class="st">"B.0[1]"</span>), <span class="at">sort =</span> <span class="cn">FALSE</span>) <span class="sc">+</span> <span class="fu">scale_y_discrete</span>(<span class="at">labels =</span> <span class="st">"Intercept"</span>) <span class="sc">+</span> <span class="fu">theme_bw</span>()</span>
<span id="cb107-417"><a href="#cb107-417" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb107-418"><a href="#cb107-418" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb107-419"><a href="#cb107-419" aria-hidden="true" tabindex="-1"></a><span class="fu">##### Betas</span></span>
<span id="cb107-422"><a href="#cb107-422" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb107-423"><a href="#cb107-423" aria-hidden="true" tabindex="-1"></a><span class="fu">ggs_caterpillar</span>(ggfit <span class="sc">%&gt;%</span> <span class="fu">filter</span>(Parameter <span class="sc">%in%</span> <span class="fu">grep</span>(<span class="st">"B.0"</span>, <span class="fu">unique</span>(ggfit<span class="sc">$</span>Parameter), <span class="at">value =</span> <span class="cn">TRUE</span>)[<span class="sc">-</span><span class="dv">1</span>]) <span class="sc">%&gt;%</span></span>
<span id="cb107-424"><a href="#cb107-424" aria-hidden="true" tabindex="-1"></a>                  <span class="fu">mutate</span>(<span class="at">Parameter =</span> <span class="fu">factor</span>(Parameter, <span class="at">levels =</span> <span class="fu">c</span>(<span class="st">"B.0[2]"</span>, <span class="st">"B.0[3]"</span>, <span class="st">"B.0[4]"</span>, <span class="st">"B.0[5]"</span>, <span class="st">"B.0[6]"</span>, </span>
<span id="cb107-425"><a href="#cb107-425" aria-hidden="true" tabindex="-1"></a>                                                                  <span class="st">"B.0[7]"</span>, <span class="st">"B.0[8]"</span>, <span class="st">"B.0[9]"</span>, <span class="st">"B.0[10]"</span>, <span class="st">"B.0[11]"</span>, <span class="st">"B.0[12]"</span>))),</span>
<span id="cb107-426"><a href="#cb107-426" aria-hidden="true" tabindex="-1"></a>                <span class="at">sort =</span> <span class="cn">FALSE</span>) <span class="sc">+</span> <span class="fu">scale_y_discrete</span>(<span class="at">labels =</span> <span class="fu">rev</span>(<span class="fu">c</span>(<span class="st">"T"</span>, <span class="st">"T(d-1)"</span>, <span class="st">"T(d-2)"</span>, <span class="st">"F"</span>, <span class="st">"T*F"</span>, <span class="st">"OL"</span>, <span class="st">"OS"</span>, <span class="st">"IS"</span>, <span class="st">"OL*T"</span>, <span class="st">"OS*T"</span>, <span class="st">"IS*T"</span>)), <span class="at">limits =</span> rev) <span class="sc">+</span> <span class="fu">theme_bw</span>() <span class="sc">+</span> <span class="fu">geom_vline</span>(<span class="at">xintercept =</span> <span class="dv">0</span>, <span class="at">linetype =</span> <span class="st">"dashed"</span>)</span>
<span id="cb107-427"><a href="#cb107-427" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb107-428"><a href="#cb107-428" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb107-429"><a href="#cb107-429" aria-hidden="true" tabindex="-1"></a><span class="fu">##### Autoregressive terms</span></span>
<span id="cb107-432"><a href="#cb107-432" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb107-433"><a href="#cb107-433" aria-hidden="true" tabindex="-1"></a><span class="fu">ggs_caterpillar</span>(ggfit <span class="sc">%&gt;%</span> <span class="fu">filter</span>(Parameter <span class="sc">%in%</span> <span class="fu">grep</span>(<span class="st">"ar1"</span>, <span class="fu">unique</span>(ggfit<span class="sc">$</span>Parameter), <span class="at">value =</span> <span class="cn">TRUE</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb107-434"><a href="#cb107-434" aria-hidden="true" tabindex="-1"></a>                  <span class="fu">mutate</span>(<span class="at">Parameter =</span> <span class="fu">factor</span>(Parameter, <span class="at">levels =</span> <span class="fu">c</span>(<span class="st">"ar1Mean"</span>, <span class="st">"ar1SD"</span>, <span class="st">"ar1[1]"</span>, <span class="st">"ar1[2]"</span>, <span class="st">"ar1[3]"</span>, <span class="st">"ar1[4]"</span>))),</span>
<span id="cb107-435"><a href="#cb107-435" aria-hidden="true" tabindex="-1"></a>                <span class="at">sort =</span> <span class="cn">FALSE</span>) <span class="sc">+</span> <span class="fu">scale_y_discrete</span>(<span class="at">labels =</span> <span class="fu">rev</span>(<span class="fu">c</span>(<span class="st">"ar1Mean"</span>, <span class="st">"ar1SD"</span>, <span class="st">"ar1[WB]"</span>, <span class="st">"ar1[OL]"</span>, <span class="st">"ar1[OS]"</span>, <span class="st">"ar1[IL]"</span>)), <span class="at">limits =</span> rev) <span class="sc">+</span> <span class="fu">theme_bw</span>() <span class="sc">+</span> <span class="fu">xlim</span>(<span class="dv">0</span>,<span class="dv">1</span>)</span>
<span id="cb107-436"><a href="#cb107-436" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb107-437"><a href="#cb107-437" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb107-438"><a href="#cb107-438" aria-hidden="true" tabindex="-1"></a><span class="fu">##### Within year trends</span></span>
<span id="cb107-441"><a href="#cb107-441" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb107-442"><a href="#cb107-442" aria-hidden="true" tabindex="-1"></a><span class="fu">ggs_caterpillar</span>(ggfit, <span class="at">family =</span> <span class="st">"mu.year"</span>, <span class="at">sort =</span> <span class="cn">FALSE</span>) <span class="sc">+</span> <span class="fu">scale_y_discrete</span>(<span class="at">labels =</span> <span class="fu">rev</span>(<span class="fu">c</span>(<span class="st">"Intercept"</span>, <span class="st">"Linear"</span>, <span class="st">"Quadratic"</span>, <span class="st">"Cubic"</span>)), <span class="at">limits =</span> rev) <span class="sc">+</span> <span class="fu">theme_bw</span>()</span>
<span id="cb107-443"><a href="#cb107-443" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb107-444"><a href="#cb107-444" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb107-445"><a href="#cb107-445" aria-hidden="true" tabindex="-1"></a><span class="fu">##### Site-specific intercepts</span></span>
<span id="cb107-448"><a href="#cb107-448" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb107-449"><a href="#cb107-449" aria-hidden="true" tabindex="-1"></a>ggfit <span class="sc">%&gt;%</span> </span>
<span id="cb107-450"><a href="#cb107-450" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(Parameter <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"B.0[1]"</span>, <span class="st">"B.0[7]"</span>, <span class="st">"B.0[8]"</span>, <span class="st">"B.0[9]"</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb107-451"><a href="#cb107-451" aria-hidden="true" tabindex="-1"></a>  <span class="fu">spread</span>(<span class="at">key =</span> Parameter, <span class="at">value =</span> value) <span class="sc">%&gt;%</span></span>
<span id="cb107-452"><a href="#cb107-452" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">int_WB =</span> <span class="dv">3</span>, <span class="at">os_OL =</span> <span class="dv">4</span>, <span class="at">os_OS =</span> <span class="dv">5</span>, <span class="at">os_IS =</span> <span class="dv">6</span>) <span class="sc">%&gt;%</span></span>
<span id="cb107-453"><a href="#cb107-453" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">int_OL =</span> int_WB <span class="sc">+</span> os_OL,</span>
<span id="cb107-454"><a href="#cb107-454" aria-hidden="true" tabindex="-1"></a>         <span class="at">int_OS =</span> int_WB <span class="sc">+</span> os_OS,</span>
<span id="cb107-455"><a href="#cb107-455" aria-hidden="true" tabindex="-1"></a>         <span class="at">int_IS =</span> int_WB <span class="sc">+</span> os_IS) <span class="sc">%&gt;%</span></span>
<span id="cb107-456"><a href="#cb107-456" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span><span class="fu">c</span>(os_OL, os_OS, os_IS)) <span class="sc">%&gt;%</span></span>
<span id="cb107-457"><a href="#cb107-457" aria-hidden="true" tabindex="-1"></a>  <span class="fu">gather</span>(int_WB<span class="sc">:</span>int_IS, <span class="at">key =</span> <span class="st">"Parameter"</span>, <span class="at">value =</span> <span class="st">"value"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb107-458"><a href="#cb107-458" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Parameter =</span> <span class="fu">factor</span>(Parameter, <span class="at">levels =</span> <span class="fu">c</span>(<span class="st">"int_WB"</span>, <span class="st">"int_OL"</span>, <span class="st">"int_OS"</span>, <span class="st">"int_IS"</span>))) <span class="sc">%&gt;%</span></span>
<span id="cb107-459"><a href="#cb107-459" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggs_caterpillar</span>(<span class="at">sort =</span> <span class="cn">FALSE</span>) <span class="sc">+</span></span>
<span id="cb107-460"><a href="#cb107-460" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_discrete</span>(<span class="at">limits =</span> rev) <span class="sc">+</span> </span>
<span id="cb107-461"><a href="#cb107-461" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylab</span>(<span class="st">"Intercepts"</span>) <span class="sc">+</span></span>
<span id="cb107-462"><a href="#cb107-462" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>()</span>
<span id="cb107-463"><a href="#cb107-463" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb107-464"><a href="#cb107-464" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb107-465"><a href="#cb107-465" aria-hidden="true" tabindex="-1"></a><span class="fu">##### Site specific slopes</span></span>
<span id="cb107-468"><a href="#cb107-468" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb107-469"><a href="#cb107-469" aria-hidden="true" tabindex="-1"></a>ggfit <span class="sc">%&gt;%</span> </span>
<span id="cb107-470"><a href="#cb107-470" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(Parameter <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"B.0[2]"</span>, <span class="st">"B.0[10]"</span>, <span class="st">"B.0[11]"</span>, <span class="st">"B.0[12]"</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb107-471"><a href="#cb107-471" aria-hidden="true" tabindex="-1"></a>  <span class="fu">spread</span>(<span class="at">key =</span> Parameter, <span class="at">value =</span> value) <span class="sc">%&gt;%</span></span>
<span id="cb107-472"><a href="#cb107-472" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">slo_WB =</span> <span class="dv">6</span>, <span class="at">os_OL =</span> <span class="dv">3</span>, <span class="at">os_OS =</span> <span class="dv">4</span>, <span class="at">os_IS =</span> <span class="dv">5</span>) <span class="sc">%&gt;%</span></span>
<span id="cb107-473"><a href="#cb107-473" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">slo_OL =</span> slo_WB <span class="sc">+</span> os_OL,</span>
<span id="cb107-474"><a href="#cb107-474" aria-hidden="true" tabindex="-1"></a>         <span class="at">slo_OS =</span> slo_WB <span class="sc">+</span> os_OS,</span>
<span id="cb107-475"><a href="#cb107-475" aria-hidden="true" tabindex="-1"></a>         <span class="at">slo_IS =</span> slo_WB <span class="sc">+</span> os_IS) <span class="sc">%&gt;%</span></span>
<span id="cb107-476"><a href="#cb107-476" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span><span class="fu">c</span>(os_OL, os_OS, os_IS)) <span class="sc">%&gt;%</span></span>
<span id="cb107-477"><a href="#cb107-477" aria-hidden="true" tabindex="-1"></a>  <span class="fu">gather</span>(slo_WB<span class="sc">:</span>slo_IS, <span class="at">key =</span> <span class="st">"Parameter"</span>, <span class="at">value =</span> <span class="st">"value"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb107-478"><a href="#cb107-478" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Parameter =</span> <span class="fu">factor</span>(Parameter, <span class="at">levels =</span> <span class="fu">c</span>(<span class="st">"slo_WB"</span>, <span class="st">"slo_OL"</span>, <span class="st">"slo_OS"</span>, <span class="st">"slo_IS"</span>))) <span class="sc">%&gt;%</span></span>
<span id="cb107-479"><a href="#cb107-479" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggs_caterpillar</span>(<span class="at">sort =</span> <span class="cn">FALSE</span>) <span class="sc">+</span></span>
<span id="cb107-480"><a href="#cb107-480" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_discrete</span>(<span class="at">limits =</span> rev) <span class="sc">+</span> </span>
<span id="cb107-481"><a href="#cb107-481" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylab</span>(<span class="st">"Slopes, temperature effect"</span>) <span class="sc">+</span></span>
<span id="cb107-482"><a href="#cb107-482" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>()</span>
<span id="cb107-483"><a href="#cb107-483" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb107-484"><a href="#cb107-484" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb107-485"><a href="#cb107-485" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb107-486"><a href="#cb107-486" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb107-487"><a href="#cb107-487" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb107-488"><a href="#cb107-488" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb107-489"><a href="#cb107-489" aria-hidden="true" tabindex="-1"></a><span class="fu">#### Marginal efffects</span></span>
<span id="cb107-490"><a href="#cb107-490" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb107-491"><a href="#cb107-491" aria-hidden="true" tabindex="-1"></a>Marginal effects of air temperature x flow interaction, not accounting for lagged temperature effects, temporal autocorrelation, </span>
<span id="cb107-492"><a href="#cb107-492" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb107-493"><a href="#cb107-493" aria-hidden="true" tabindex="-1"></a>::: panel-tabset</span>
<span id="cb107-494"><a href="#cb107-494" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb107-495"><a href="#cb107-495" aria-hidden="true" tabindex="-1"></a><span class="fu">##### West Brook</span></span>
<span id="cb107-496"><a href="#cb107-496" aria-hidden="true" tabindex="-1"></a><span class="in">```{r fig.width=9, fig.height=4}</span></span>
<span id="cb107-497"><a href="#cb107-497" aria-hidden="true" tabindex="-1"></a><span class="co"># set up</span></span>
<span id="cb107-498"><a href="#cb107-498" aria-hidden="true" tabindex="-1"></a>np <span class="ot">&lt;-</span> <span class="dv">100</span></span>
<span id="cb107-499"><a href="#cb107-499" aria-hidden="true" tabindex="-1"></a>myriv <span class="ot">&lt;-</span> <span class="st">"WEST BROOK"</span></span>
<span id="cb107-500"><a href="#cb107-500" aria-hidden="true" tabindex="-1"></a>x_temp <span class="ot">&lt;-</span> <span class="fu">seq</span>(<span class="at">from =</span> <span class="fu">min</span>(tempDataSyncS<span class="sc">$</span>airTemp[tempDataSyncS<span class="sc">$</span>riverOrdered <span class="sc">==</span> myriv]),</span>
<span id="cb107-501"><a href="#cb107-501" aria-hidden="true" tabindex="-1"></a>              <span class="at">to =</span> <span class="fu">max</span>(tempDataSyncS<span class="sc">$</span>airTemp[tempDataSyncS<span class="sc">$</span>riverOrdered <span class="sc">==</span> myriv]),</span>
<span id="cb107-502"><a href="#cb107-502" aria-hidden="true" tabindex="-1"></a>              <span class="at">length.out =</span> np)</span>
<span id="cb107-503"><a href="#cb107-503" aria-hidden="true" tabindex="-1"></a>x_flow <span class="ot">&lt;-</span> <span class="fu">seq</span>(<span class="at">from =</span> <span class="fu">min</span>(tempDataSyncS<span class="sc">$</span>flowLS[tempDataSyncS<span class="sc">$</span>riverOrdered <span class="sc">==</span> myriv]),</span>
<span id="cb107-504"><a href="#cb107-504" aria-hidden="true" tabindex="-1"></a>              <span class="at">to =</span> <span class="fu">max</span>(tempDataSyncS<span class="sc">$</span>flowLS[tempDataSyncS<span class="sc">$</span>riverOrdered <span class="sc">==</span> myriv]),</span>
<span id="cb107-505"><a href="#cb107-505" aria-hidden="true" tabindex="-1"></a>              <span class="at">length.out =</span> np)</span>
<span id="cb107-506"><a href="#cb107-506" aria-hidden="true" tabindex="-1"></a>pred_df <span class="ot">&lt;-</span> <span class="fu">expand_grid</span>(x_temp, x_flow)</span>
<span id="cb107-507"><a href="#cb107-507" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb107-508"><a href="#cb107-508" aria-hidden="true" tabindex="-1"></a><span class="co"># predict from model</span></span>
<span id="cb107-509"><a href="#cb107-509" aria-hidden="true" tabindex="-1"></a>pred_df<span class="sc">$</span>pred <span class="ot">&lt;-</span> param.summary[<span class="st">"B.0[1]"</span>,<span class="dv">1</span>] <span class="sc">+</span> param.summary[<span class="st">"B.0[2]"</span>,<span class="dv">1</span>]<span class="sc">*</span>pred_df<span class="sc">$</span>x_temp <span class="sc">+</span> param.summary[<span class="st">"B.0[5]"</span>,<span class="dv">1</span>]<span class="sc">*</span>pred_df<span class="sc">$</span>x_flow <span class="sc">+</span> param.summary[<span class="st">"B.0[6]"</span>,<span class="dv">1</span>]<span class="sc">*</span>pred_df<span class="sc">$</span>x_temp<span class="sc">*</span>pred_df<span class="sc">$</span>x_flow</span>
<span id="cb107-510"><a href="#cb107-510" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb107-511"><a href="#cb107-511" aria-hidden="true" tabindex="-1"></a><span class="co"># lines </span></span>
<span id="cb107-512"><a href="#cb107-512" aria-hidden="true" tabindex="-1"></a>p1 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(pred_df, <span class="fu">aes</span>(<span class="at">x =</span> x_temp, <span class="at">y =</span> pred, <span class="at">color =</span> x_flow, <span class="at">group =</span> x_flow)) <span class="sc">+</span></span>
<span id="cb107-513"><a href="#cb107-513" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>() <span class="sc">+</span></span>
<span id="cb107-514"><a href="#cb107-514" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_distiller</span>(<span class="at">palette =</span> <span class="st">"BrBG"</span>, <span class="at">direction =</span> <span class="sc">+</span><span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb107-515"><a href="#cb107-515" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>() <span class="sc">+</span> <span class="fu">theme</span>(<span class="at">panel.grid =</span> <span class="fu">element_blank</span>()) <span class="sc">+</span></span>
<span id="cb107-516"><a href="#cb107-516" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">color =</span> <span class="st">"Flow"</span>) <span class="sc">+</span> <span class="fu">xlab</span>(<span class="st">"Air temperature"</span>) <span class="sc">+</span> <span class="fu">ylab</span>(<span class="st">"Water temperature"</span>) <span class="sc">+</span> <span class="fu">ylim</span>(<span class="fl">6.5</span>,<span class="dv">20</span>)</span>
<span id="cb107-517"><a href="#cb107-517" aria-hidden="true" tabindex="-1"></a><span class="co"># heatmap</span></span>
<span id="cb107-518"><a href="#cb107-518" aria-hidden="true" tabindex="-1"></a>p2 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(pred_df, <span class="fu">aes</span>(<span class="at">x =</span> x_temp, <span class="at">y =</span> x_flow)) <span class="sc">+</span></span>
<span id="cb107-519"><a href="#cb107-519" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_tile</span>(<span class="fu">aes</span>(<span class="at">fill =</span> pred)) <span class="sc">+</span></span>
<span id="cb107-520"><a href="#cb107-520" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_distiller</span>(<span class="at">palette =</span> <span class="st">"Spectral"</span>, <span class="at">limits =</span> <span class="fu">c</span>(<span class="fl">6.5</span>,<span class="dv">20</span>)) <span class="sc">+</span></span>
<span id="cb107-521"><a href="#cb107-521" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>() <span class="sc">+</span> <span class="fu">theme</span>(<span class="at">panel.grid =</span> <span class="fu">element_blank</span>()) <span class="sc">+</span></span>
<span id="cb107-522"><a href="#cb107-522" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(<span class="at">expand =</span> <span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">0</span>)) <span class="sc">+</span> <span class="fu">scale_y_continuous</span>(<span class="at">expand =</span> <span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">0</span>)) <span class="sc">+</span></span>
<span id="cb107-523"><a href="#cb107-523" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">fill =</span> <span class="st">"Water</span><span class="sc">\n</span><span class="st">temp."</span>) <span class="sc">+</span> <span class="fu">xlab</span>(<span class="st">"Air temperature"</span>) <span class="sc">+</span> <span class="fu">ylab</span>(<span class="st">"Flow"</span>) <span class="co">#+ </span></span>
<span id="cb107-524"><a href="#cb107-524" aria-hidden="true" tabindex="-1"></a>  <span class="co">#geom_point(data = tempDataSyncS %&gt;% filter(riverOrdered == myriv), aes(x = airTemp, y = flowLS, color = temp)) +</span></span>
<span id="cb107-525"><a href="#cb107-525" aria-hidden="true" tabindex="-1"></a>  <span class="co">#scale_color_distiller(palette = "Spectral", limits = c(0,23)) </span></span>
<span id="cb107-526"><a href="#cb107-526" aria-hidden="true" tabindex="-1"></a><span class="co"># combine</span></span>
<span id="cb107-527"><a href="#cb107-527" aria-hidden="true" tabindex="-1"></a>egg<span class="sc">::</span><span class="fu">ggarrange</span>(p1, p2, <span class="at">nrow =</span> <span class="dv">1</span>)</span>
<span id="cb107-528"><a href="#cb107-528" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb107-529"><a href="#cb107-529" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb107-530"><a href="#cb107-530" aria-hidden="true" tabindex="-1"></a><span class="fu">##### Jimmy</span></span>
<span id="cb107-531"><a href="#cb107-531" aria-hidden="true" tabindex="-1"></a><span class="in">```{r fig.width=9, fig.height=4}</span></span>
<span id="cb107-532"><a href="#cb107-532" aria-hidden="true" tabindex="-1"></a><span class="co"># set up</span></span>
<span id="cb107-533"><a href="#cb107-533" aria-hidden="true" tabindex="-1"></a>np <span class="ot">&lt;-</span> <span class="dv">100</span></span>
<span id="cb107-534"><a href="#cb107-534" aria-hidden="true" tabindex="-1"></a>myriv <span class="ot">&lt;-</span> <span class="st">"WB JIMMY"</span></span>
<span id="cb107-535"><a href="#cb107-535" aria-hidden="true" tabindex="-1"></a>x_temp <span class="ot">&lt;-</span> <span class="fu">seq</span>(<span class="at">from =</span> <span class="fu">min</span>(tempDataSyncS<span class="sc">$</span>airTemp[tempDataSyncS<span class="sc">$</span>riverOrdered <span class="sc">==</span> myriv]),</span>
<span id="cb107-536"><a href="#cb107-536" aria-hidden="true" tabindex="-1"></a>              <span class="at">to =</span> <span class="fu">max</span>(tempDataSyncS<span class="sc">$</span>airTemp[tempDataSyncS<span class="sc">$</span>riverOrdered <span class="sc">==</span> myriv]),</span>
<span id="cb107-537"><a href="#cb107-537" aria-hidden="true" tabindex="-1"></a>              <span class="at">length.out =</span> np)</span>
<span id="cb107-538"><a href="#cb107-538" aria-hidden="true" tabindex="-1"></a>x_flow <span class="ot">&lt;-</span> <span class="fu">seq</span>(<span class="at">from =</span> <span class="fu">min</span>(tempDataSyncS<span class="sc">$</span>airTemp[tempDataSyncS<span class="sc">$</span>riverOrdered <span class="sc">==</span> myriv]),</span>
<span id="cb107-539"><a href="#cb107-539" aria-hidden="true" tabindex="-1"></a>              <span class="at">to =</span> <span class="fu">max</span>(tempDataSyncS<span class="sc">$</span>airTemp[tempDataSyncS<span class="sc">$</span>riverOrdered <span class="sc">==</span> myriv]),</span>
<span id="cb107-540"><a href="#cb107-540" aria-hidden="true" tabindex="-1"></a>              <span class="at">length.out =</span> np)</span>
<span id="cb107-541"><a href="#cb107-541" aria-hidden="true" tabindex="-1"></a>pred_df <span class="ot">&lt;-</span> <span class="fu">expand_grid</span>(x_temp, x_flow)</span>
<span id="cb107-542"><a href="#cb107-542" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb107-543"><a href="#cb107-543" aria-hidden="true" tabindex="-1"></a><span class="co"># predict from model</span></span>
<span id="cb107-544"><a href="#cb107-544" aria-hidden="true" tabindex="-1"></a>pred_df<span class="sc">$</span>pred <span class="ot">&lt;-</span> param.summary[<span class="st">"B.0[1]"</span>,<span class="dv">1</span>] <span class="sc">+</span> param.summary[<span class="st">"B.0[2]"</span>,<span class="dv">1</span>]<span class="sc">*</span>pred_df<span class="sc">$</span>x_temp <span class="sc">+</span> param.summary[<span class="st">"B.0[5]"</span>,<span class="dv">1</span>]<span class="sc">*</span>pred_df<span class="sc">$</span>x_flow <span class="sc">+</span> param.summary[<span class="st">"B.0[6]"</span>,<span class="dv">1</span>]<span class="sc">*</span>pred_df<span class="sc">$</span>x_temp<span class="sc">*</span>pred_df<span class="sc">$</span>x_flow <span class="sc">+</span> param.summary[<span class="st">"B.0[7]"</span>,<span class="dv">1</span>] <span class="sc">+</span> param.summary[<span class="st">"B.0[10]"</span>,<span class="dv">1</span>]<span class="sc">*</span>pred_df<span class="sc">$</span>x_temp</span>
<span id="cb107-545"><a href="#cb107-545" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb107-546"><a href="#cb107-546" aria-hidden="true" tabindex="-1"></a><span class="co"># lines </span></span>
<span id="cb107-547"><a href="#cb107-547" aria-hidden="true" tabindex="-1"></a>p1 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(pred_df, <span class="fu">aes</span>(<span class="at">x =</span> x_temp, <span class="at">y =</span> pred, <span class="at">color =</span> x_flow, <span class="at">group =</span> x_flow)) <span class="sc">+</span></span>
<span id="cb107-548"><a href="#cb107-548" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>() <span class="sc">+</span></span>
<span id="cb107-549"><a href="#cb107-549" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_distiller</span>(<span class="at">palette =</span> <span class="st">"BrBG"</span>, <span class="at">direction =</span> <span class="sc">+</span><span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb107-550"><a href="#cb107-550" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>() <span class="sc">+</span> <span class="fu">theme</span>(<span class="at">panel.grid =</span> <span class="fu">element_blank</span>()) <span class="sc">+</span></span>
<span id="cb107-551"><a href="#cb107-551" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">color =</span> <span class="st">"Flow"</span>) <span class="sc">+</span> <span class="fu">xlab</span>(<span class="st">"Air temperature"</span>) <span class="sc">+</span> <span class="fu">ylab</span>(<span class="st">"Water temperature"</span>) <span class="sc">+</span> <span class="fu">ylim</span>(<span class="fl">6.5</span>,<span class="dv">20</span>)</span>
<span id="cb107-552"><a href="#cb107-552" aria-hidden="true" tabindex="-1"></a><span class="co"># heatmap</span></span>
<span id="cb107-553"><a href="#cb107-553" aria-hidden="true" tabindex="-1"></a>p2 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(pred_df, <span class="fu">aes</span>(<span class="at">x =</span> x_temp, <span class="at">y =</span> x_flow)) <span class="sc">+</span></span>
<span id="cb107-554"><a href="#cb107-554" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_tile</span>(<span class="fu">aes</span>(<span class="at">fill =</span> pred)) <span class="sc">+</span></span>
<span id="cb107-555"><a href="#cb107-555" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_distiller</span>(<span class="at">palette =</span> <span class="st">"Spectral"</span>, <span class="at">limits =</span> <span class="fu">c</span>(<span class="fl">6.5</span>,<span class="dv">20</span>)) <span class="sc">+</span></span>
<span id="cb107-556"><a href="#cb107-556" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>() <span class="sc">+</span> <span class="fu">theme</span>(<span class="at">panel.grid =</span> <span class="fu">element_blank</span>()) <span class="sc">+</span></span>
<span id="cb107-557"><a href="#cb107-557" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(<span class="at">expand =</span> <span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">0</span>)) <span class="sc">+</span> <span class="fu">scale_y_continuous</span>(<span class="at">expand =</span> <span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">0</span>)) <span class="sc">+</span></span>
<span id="cb107-558"><a href="#cb107-558" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">fill =</span> <span class="st">"Water</span><span class="sc">\n</span><span class="st">temp."</span>) <span class="sc">+</span> <span class="fu">xlab</span>(<span class="st">"Air temperature"</span>) <span class="sc">+</span> <span class="fu">ylab</span>(<span class="st">"Flow"</span>)</span>
<span id="cb107-559"><a href="#cb107-559" aria-hidden="true" tabindex="-1"></a><span class="co"># combine</span></span>
<span id="cb107-560"><a href="#cb107-560" aria-hidden="true" tabindex="-1"></a>egg<span class="sc">::</span><span class="fu">ggarrange</span>(p1, p2, <span class="at">nrow =</span> <span class="dv">1</span>)</span>
<span id="cb107-561"><a href="#cb107-561" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb107-562"><a href="#cb107-562" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb107-563"><a href="#cb107-563" aria-hidden="true" tabindex="-1"></a><span class="fu">##### Mitchell</span></span>
<span id="cb107-564"><a href="#cb107-564" aria-hidden="true" tabindex="-1"></a><span class="in">```{r fig.width=9, fig.height=4}</span></span>
<span id="cb107-565"><a href="#cb107-565" aria-hidden="true" tabindex="-1"></a><span class="co"># set up</span></span>
<span id="cb107-566"><a href="#cb107-566" aria-hidden="true" tabindex="-1"></a>np <span class="ot">&lt;-</span> <span class="dv">100</span></span>
<span id="cb107-567"><a href="#cb107-567" aria-hidden="true" tabindex="-1"></a>myriv <span class="ot">&lt;-</span> <span class="st">"WB MITCHELL"</span></span>
<span id="cb107-568"><a href="#cb107-568" aria-hidden="true" tabindex="-1"></a>x_temp <span class="ot">&lt;-</span> <span class="fu">seq</span>(<span class="at">from =</span> <span class="fu">min</span>(tempDataSyncS<span class="sc">$</span>airTemp[tempDataSyncS<span class="sc">$</span>riverOrdered <span class="sc">==</span> myriv]),</span>
<span id="cb107-569"><a href="#cb107-569" aria-hidden="true" tabindex="-1"></a>              <span class="at">to =</span> <span class="fu">max</span>(tempDataSyncS<span class="sc">$</span>airTemp[tempDataSyncS<span class="sc">$</span>riverOrdered <span class="sc">==</span> myriv]),</span>
<span id="cb107-570"><a href="#cb107-570" aria-hidden="true" tabindex="-1"></a>              <span class="at">length.out =</span> np)</span>
<span id="cb107-571"><a href="#cb107-571" aria-hidden="true" tabindex="-1"></a>x_flow <span class="ot">&lt;-</span> <span class="fu">seq</span>(<span class="at">from =</span> <span class="fu">min</span>(tempDataSyncS<span class="sc">$</span>airTemp[tempDataSyncS<span class="sc">$</span>riverOrdered <span class="sc">==</span> myriv]),</span>
<span id="cb107-572"><a href="#cb107-572" aria-hidden="true" tabindex="-1"></a>              <span class="at">to =</span> <span class="fu">max</span>(tempDataSyncS<span class="sc">$</span>airTemp[tempDataSyncS<span class="sc">$</span>riverOrdered <span class="sc">==</span> myriv]),</span>
<span id="cb107-573"><a href="#cb107-573" aria-hidden="true" tabindex="-1"></a>              <span class="at">length.out =</span> np)</span>
<span id="cb107-574"><a href="#cb107-574" aria-hidden="true" tabindex="-1"></a>pred_df <span class="ot">&lt;-</span> <span class="fu">expand_grid</span>(x_temp, x_flow)</span>
<span id="cb107-575"><a href="#cb107-575" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb107-576"><a href="#cb107-576" aria-hidden="true" tabindex="-1"></a><span class="co"># predict from model</span></span>
<span id="cb107-577"><a href="#cb107-577" aria-hidden="true" tabindex="-1"></a>pred_df<span class="sc">$</span>pred <span class="ot">&lt;-</span> param.summary[<span class="st">"B.0[1]"</span>,<span class="dv">1</span>] <span class="sc">+</span> param.summary[<span class="st">"B.0[2]"</span>,<span class="dv">1</span>]<span class="sc">*</span>pred_df<span class="sc">$</span>x_temp <span class="sc">+</span> param.summary[<span class="st">"B.0[5]"</span>,<span class="dv">1</span>]<span class="sc">*</span>pred_df<span class="sc">$</span>x_flow <span class="sc">+</span> param.summary[<span class="st">"B.0[6]"</span>,<span class="dv">1</span>]<span class="sc">*</span>pred_df<span class="sc">$</span>x_temp<span class="sc">*</span>pred_df<span class="sc">$</span>x_flow <span class="sc">+</span> param.summary[<span class="st">"B.0[8]"</span>,<span class="dv">1</span>] <span class="sc">+</span> param.summary[<span class="st">"B.0[11]"</span>,<span class="dv">1</span>]<span class="sc">*</span>pred_df<span class="sc">$</span>x_temp</span>
<span id="cb107-578"><a href="#cb107-578" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb107-579"><a href="#cb107-579" aria-hidden="true" tabindex="-1"></a><span class="co"># lines </span></span>
<span id="cb107-580"><a href="#cb107-580" aria-hidden="true" tabindex="-1"></a>p1 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(pred_df, <span class="fu">aes</span>(<span class="at">x =</span> x_temp, <span class="at">y =</span> pred, <span class="at">color =</span> x_flow, <span class="at">group =</span> x_flow)) <span class="sc">+</span></span>
<span id="cb107-581"><a href="#cb107-581" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>() <span class="sc">+</span></span>
<span id="cb107-582"><a href="#cb107-582" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_distiller</span>(<span class="at">palette =</span> <span class="st">"BrBG"</span>, <span class="at">direction =</span> <span class="sc">+</span><span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb107-583"><a href="#cb107-583" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>() <span class="sc">+</span> <span class="fu">theme</span>(<span class="at">panel.grid =</span> <span class="fu">element_blank</span>()) <span class="sc">+</span></span>
<span id="cb107-584"><a href="#cb107-584" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">color =</span> <span class="st">"Flow"</span>) <span class="sc">+</span> <span class="fu">xlab</span>(<span class="st">"Air temperature"</span>) <span class="sc">+</span> <span class="fu">ylab</span>(<span class="st">"Water temperature"</span>) <span class="sc">+</span> <span class="fu">ylim</span>(<span class="fl">6.5</span>,<span class="dv">20</span>)</span>
<span id="cb107-585"><a href="#cb107-585" aria-hidden="true" tabindex="-1"></a><span class="co"># heatmap</span></span>
<span id="cb107-586"><a href="#cb107-586" aria-hidden="true" tabindex="-1"></a>p2 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(pred_df, <span class="fu">aes</span>(<span class="at">x =</span> x_temp, <span class="at">y =</span> x_flow)) <span class="sc">+</span></span>
<span id="cb107-587"><a href="#cb107-587" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_tile</span>(<span class="fu">aes</span>(<span class="at">fill =</span> pred)) <span class="sc">+</span></span>
<span id="cb107-588"><a href="#cb107-588" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_distiller</span>(<span class="at">palette =</span> <span class="st">"Spectral"</span>, <span class="at">limits =</span> <span class="fu">c</span>(<span class="fl">6.5</span>,<span class="dv">20</span>)) <span class="sc">+</span></span>
<span id="cb107-589"><a href="#cb107-589" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>() <span class="sc">+</span> <span class="fu">theme</span>(<span class="at">panel.grid =</span> <span class="fu">element_blank</span>()) <span class="sc">+</span></span>
<span id="cb107-590"><a href="#cb107-590" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(<span class="at">expand =</span> <span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">0</span>)) <span class="sc">+</span> <span class="fu">scale_y_continuous</span>(<span class="at">expand =</span> <span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">0</span>)) <span class="sc">+</span></span>
<span id="cb107-591"><a href="#cb107-591" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">fill =</span> <span class="st">"Water</span><span class="sc">\n</span><span class="st">temp."</span>) <span class="sc">+</span> <span class="fu">xlab</span>(<span class="st">"Air temperature"</span>) <span class="sc">+</span> <span class="fu">ylab</span>(<span class="st">"Flow"</span>)</span>
<span id="cb107-592"><a href="#cb107-592" aria-hidden="true" tabindex="-1"></a><span class="co"># combine</span></span>
<span id="cb107-593"><a href="#cb107-593" aria-hidden="true" tabindex="-1"></a>egg<span class="sc">::</span><span class="fu">ggarrange</span>(p1, p2, <span class="at">nrow =</span> <span class="dv">1</span>)</span>
<span id="cb107-594"><a href="#cb107-594" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb107-595"><a href="#cb107-595" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb107-596"><a href="#cb107-596" aria-hidden="true" tabindex="-1"></a><span class="fu">##### Obear</span></span>
<span id="cb107-597"><a href="#cb107-597" aria-hidden="true" tabindex="-1"></a><span class="in">```{r fig.width=9, fig.height=4}</span></span>
<span id="cb107-598"><a href="#cb107-598" aria-hidden="true" tabindex="-1"></a><span class="co"># set up</span></span>
<span id="cb107-599"><a href="#cb107-599" aria-hidden="true" tabindex="-1"></a>np <span class="ot">&lt;-</span> <span class="dv">100</span></span>
<span id="cb107-600"><a href="#cb107-600" aria-hidden="true" tabindex="-1"></a>myriv <span class="ot">&lt;-</span> <span class="st">"WB OBEAR"</span></span>
<span id="cb107-601"><a href="#cb107-601" aria-hidden="true" tabindex="-1"></a>x_temp <span class="ot">&lt;-</span> <span class="fu">seq</span>(<span class="at">from =</span> <span class="fu">min</span>(tempDataSyncS<span class="sc">$</span>airTemp[tempDataSyncS<span class="sc">$</span>riverOrdered <span class="sc">==</span> myriv]),</span>
<span id="cb107-602"><a href="#cb107-602" aria-hidden="true" tabindex="-1"></a>              <span class="at">to =</span> <span class="fu">max</span>(tempDataSyncS<span class="sc">$</span>airTemp[tempDataSyncS<span class="sc">$</span>riverOrdered <span class="sc">==</span> myriv]),</span>
<span id="cb107-603"><a href="#cb107-603" aria-hidden="true" tabindex="-1"></a>              <span class="at">length.out =</span> np)</span>
<span id="cb107-604"><a href="#cb107-604" aria-hidden="true" tabindex="-1"></a>x_flow <span class="ot">&lt;-</span> <span class="fu">seq</span>(<span class="at">from =</span> <span class="fu">min</span>(tempDataSyncS<span class="sc">$</span>airTemp[tempDataSyncS<span class="sc">$</span>riverOrdered <span class="sc">==</span> myriv]),</span>
<span id="cb107-605"><a href="#cb107-605" aria-hidden="true" tabindex="-1"></a>              <span class="at">to =</span> <span class="fu">max</span>(tempDataSyncS<span class="sc">$</span>airTemp[tempDataSyncS<span class="sc">$</span>riverOrdered <span class="sc">==</span> myriv]),</span>
<span id="cb107-606"><a href="#cb107-606" aria-hidden="true" tabindex="-1"></a>              <span class="at">length.out =</span> np)</span>
<span id="cb107-607"><a href="#cb107-607" aria-hidden="true" tabindex="-1"></a>pred_df <span class="ot">&lt;-</span> <span class="fu">expand_grid</span>(x_temp, x_flow)</span>
<span id="cb107-608"><a href="#cb107-608" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb107-609"><a href="#cb107-609" aria-hidden="true" tabindex="-1"></a><span class="co"># predict from model</span></span>
<span id="cb107-610"><a href="#cb107-610" aria-hidden="true" tabindex="-1"></a>pred_df<span class="sc">$</span>pred <span class="ot">&lt;-</span> param.summary[<span class="st">"B.0[1]"</span>,<span class="dv">1</span>] <span class="sc">+</span> param.summary[<span class="st">"B.0[2]"</span>,<span class="dv">1</span>]<span class="sc">*</span>pred_df<span class="sc">$</span>x_temp <span class="sc">+</span> param.summary[<span class="st">"B.0[5]"</span>,<span class="dv">1</span>]<span class="sc">*</span>pred_df<span class="sc">$</span>x_flow <span class="sc">+</span> param.summary[<span class="st">"B.0[6]"</span>,<span class="dv">1</span>]<span class="sc">*</span>pred_df<span class="sc">$</span>x_temp<span class="sc">*</span>pred_df<span class="sc">$</span>x_flow <span class="sc">+</span> param.summary[<span class="st">"B.0[9]"</span>,<span class="dv">1</span>] <span class="sc">+</span> param.summary[<span class="st">"B.0[12]"</span>,<span class="dv">1</span>]<span class="sc">*</span>pred_df<span class="sc">$</span>x_temp</span>
<span id="cb107-611"><a href="#cb107-611" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb107-612"><a href="#cb107-612" aria-hidden="true" tabindex="-1"></a><span class="co"># lines </span></span>
<span id="cb107-613"><a href="#cb107-613" aria-hidden="true" tabindex="-1"></a>p1 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(pred_df, <span class="fu">aes</span>(<span class="at">x =</span> x_temp, <span class="at">y =</span> pred, <span class="at">color =</span> x_flow, <span class="at">group =</span> x_flow)) <span class="sc">+</span></span>
<span id="cb107-614"><a href="#cb107-614" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>() <span class="sc">+</span></span>
<span id="cb107-615"><a href="#cb107-615" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_distiller</span>(<span class="at">palette =</span> <span class="st">"BrBG"</span>, <span class="at">direction =</span> <span class="sc">+</span><span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb107-616"><a href="#cb107-616" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>() <span class="sc">+</span> <span class="fu">theme</span>(<span class="at">panel.grid =</span> <span class="fu">element_blank</span>()) <span class="sc">+</span></span>
<span id="cb107-617"><a href="#cb107-617" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">color =</span> <span class="st">"Flow"</span>) <span class="sc">+</span> <span class="fu">xlab</span>(<span class="st">"Air temperature"</span>) <span class="sc">+</span> <span class="fu">ylab</span>(<span class="st">"Water temperature"</span>) <span class="sc">+</span> <span class="fu">ylim</span>(<span class="fl">6.5</span>,<span class="dv">20</span>)</span>
<span id="cb107-618"><a href="#cb107-618" aria-hidden="true" tabindex="-1"></a><span class="co"># heatmap</span></span>
<span id="cb107-619"><a href="#cb107-619" aria-hidden="true" tabindex="-1"></a>p2 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(pred_df, <span class="fu">aes</span>(<span class="at">x =</span> x_temp, <span class="at">y =</span> x_flow)) <span class="sc">+</span></span>
<span id="cb107-620"><a href="#cb107-620" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_tile</span>(<span class="fu">aes</span>(<span class="at">fill =</span> pred)) <span class="sc">+</span></span>
<span id="cb107-621"><a href="#cb107-621" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_distiller</span>(<span class="at">palette =</span> <span class="st">"Spectral"</span>, <span class="at">limits =</span> <span class="fu">c</span>(<span class="fl">6.5</span>,<span class="dv">20</span>)) <span class="sc">+</span></span>
<span id="cb107-622"><a href="#cb107-622" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>() <span class="sc">+</span> <span class="fu">theme</span>(<span class="at">panel.grid =</span> <span class="fu">element_blank</span>()) <span class="sc">+</span></span>
<span id="cb107-623"><a href="#cb107-623" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(<span class="at">expand =</span> <span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">0</span>)) <span class="sc">+</span> <span class="fu">scale_y_continuous</span>(<span class="at">expand =</span> <span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">0</span>)) <span class="sc">+</span></span>
<span id="cb107-624"><a href="#cb107-624" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">fill =</span> <span class="st">"Water</span><span class="sc">\n</span><span class="st">temp."</span>) <span class="sc">+</span> <span class="fu">xlab</span>(<span class="st">"Air temperature"</span>) <span class="sc">+</span> <span class="fu">ylab</span>(<span class="st">"Flow"</span>)</span>
<span id="cb107-625"><a href="#cb107-625" aria-hidden="true" tabindex="-1"></a><span class="co"># combine</span></span>
<span id="cb107-626"><a href="#cb107-626" aria-hidden="true" tabindex="-1"></a>egg<span class="sc">::</span><span class="fu">ggarrange</span>(p1, p2, <span class="at">nrow =</span> <span class="dv">1</span>)</span>
<span id="cb107-627"><a href="#cb107-627" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb107-628"><a href="#cb107-628" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb107-629"><a href="#cb107-629" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb107-630"><a href="#cb107-630" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb107-631"><a href="#cb107-631" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb107-632"><a href="#cb107-632" aria-hidden="true" tabindex="-1"></a><span class="fu">## Hierarchical</span></span>
<span id="cb107-633"><a href="#cb107-633" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb107-634"><a href="#cb107-634" aria-hidden="true" tabindex="-1"></a>Fit the same model as above, but draw the intercepts and temperature effects hierarchically and check that the output matches</span>
<span id="cb107-635"><a href="#cb107-635" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb107-636"><a href="#cb107-636" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb107-637"><a href="#cb107-637" aria-hidden="true" tabindex="-1"></a><span class="fu">### Specify model</span></span>
<span id="cb107-638"><a href="#cb107-638" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb107-639"><a href="#cb107-639" aria-hidden="true" tabindex="-1"></a>Modify Letcher model to estimate intercepts and slopes hierarchically</span>
<span id="cb107-642"><a href="#cb107-642" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb107-643"><a href="#cb107-643" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"model {</span></span>
<span id="cb107-644"><a href="#cb107-644" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb107-645"><a href="#cb107-645" aria-hidden="true" tabindex="-1"></a><span class="st">    ###----------------- LIKELIHOOD -----------------###</span></span>
<span id="cb107-646"><a href="#cb107-646" aria-hidden="true" tabindex="-1"></a><span class="st">    </span></span>
<span id="cb107-647"><a href="#cb107-647" aria-hidden="true" tabindex="-1"></a><span class="st">    # Days without an observation on the previous day (first observation in a series)</span></span>
<span id="cb107-648"><a href="#cb107-648" aria-hidden="true" tabindex="-1"></a><span class="st">    # No autoregressive term</span></span>
<span id="cb107-649"><a href="#cb107-649" aria-hidden="true" tabindex="-1"></a><span class="st">    </span></span>
<span id="cb107-650"><a href="#cb107-650" aria-hidden="true" tabindex="-1"></a><span class="st">    for (i in 1:nFirstObsRows){</span></span>
<span id="cb107-651"><a href="#cb107-651" aria-hidden="true" tabindex="-1"></a><span class="st">      temp[firstObsRows[i]] ~ dnorm(stream.mu[firstObsRows[i]], pow(sigma, -2)) </span></span>
<span id="cb107-652"><a href="#cb107-652" aria-hidden="true" tabindex="-1"></a><span class="st">      stream.mu[firstObsRows[i]] &lt;- trend[firstObsRows[i]]</span></span>
<span id="cb107-653"><a href="#cb107-653" aria-hidden="true" tabindex="-1"></a><span class="st">      trend[firstObsRows[i]] &lt;- inprod(B.0[], X.0[firstObsRows[i], ]) + </span></span>
<span id="cb107-654"><a href="#cb107-654" aria-hidden="true" tabindex="-1"></a><span class="st">                                inprod(B.site[site[firstObsRows[i]], ], X.site[firstObsRows[i], ]) + </span></span>
<span id="cb107-655"><a href="#cb107-655" aria-hidden="true" tabindex="-1"></a><span class="st">                                inprod(B.year[year[firstObsRows[i]], ], X.year[firstObsRows[i], ])</span></span>
<span id="cb107-656"><a href="#cb107-656" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb107-657"><a href="#cb107-657" aria-hidden="true" tabindex="-1"></a><span class="st">      }</span></span>
<span id="cb107-658"><a href="#cb107-658" aria-hidden="true" tabindex="-1"></a><span class="st">    </span></span>
<span id="cb107-659"><a href="#cb107-659" aria-hidden="true" tabindex="-1"></a><span class="st">    # Days with an observation on the previous dat (all days following the first day)</span></span>
<span id="cb107-660"><a href="#cb107-660" aria-hidden="true" tabindex="-1"></a><span class="st">    # Includes autoregressive term (ar1)</span></span>
<span id="cb107-661"><a href="#cb107-661" aria-hidden="true" tabindex="-1"></a><span class="st">    </span></span>
<span id="cb107-662"><a href="#cb107-662" aria-hidden="true" tabindex="-1"></a><span class="st">    for (i in 1:nEvalRows){ </span></span>
<span id="cb107-663"><a href="#cb107-663" aria-hidden="true" tabindex="-1"></a><span class="st">      temp[evalRows[i]] ~ dnorm(stream.mu[evalRows[i]], pow(sigma, -2))</span></span>
<span id="cb107-664"><a href="#cb107-664" aria-hidden="true" tabindex="-1"></a><span class="st">      stream.mu[evalRows[i]] &lt;- trend[evalRows[i]] + ar1[site[evalRows[i]]] * (temp[evalRows[i]-1] - trend[ evalRows[i]-1 ])</span></span>
<span id="cb107-665"><a href="#cb107-665" aria-hidden="true" tabindex="-1"></a><span class="st">      trend[evalRows[i]] &lt;- inprod(B.0[], X.0[evalRows[i], ]) + </span></span>
<span id="cb107-666"><a href="#cb107-666" aria-hidden="true" tabindex="-1"></a><span class="st">                            inprod(B.site[site[evalRows[i]], ], X.site[evalRows[i], ]) + </span></span>
<span id="cb107-667"><a href="#cb107-667" aria-hidden="true" tabindex="-1"></a><span class="st">                            inprod(B.year[year[evalRows[i]], ], X.year[evalRows[i], ])</span></span>
<span id="cb107-668"><a href="#cb107-668" aria-hidden="true" tabindex="-1"></a><span class="st">      }</span></span>
<span id="cb107-669"><a href="#cb107-669" aria-hidden="true" tabindex="-1"></a><span class="st">    </span></span>
<span id="cb107-670"><a href="#cb107-670" aria-hidden="true" tabindex="-1"></a><span class="st">    </span></span>
<span id="cb107-671"><a href="#cb107-671" aria-hidden="true" tabindex="-1"></a><span class="st">    ###----------------- PRIORS ---------------------###</span></span>
<span id="cb107-672"><a href="#cb107-672" aria-hidden="true" tabindex="-1"></a><span class="st">    </span></span>
<span id="cb107-673"><a href="#cb107-673" aria-hidden="true" tabindex="-1"></a><span class="st">    # ar1, hierarchical by site</span></span>
<span id="cb107-674"><a href="#cb107-674" aria-hidden="true" tabindex="-1"></a><span class="st">    for (i in 1:nsites){</span></span>
<span id="cb107-675"><a href="#cb107-675" aria-hidden="true" tabindex="-1"></a><span class="st">      ar1[i] ~ dnorm(ar1Mean, pow(ar1SD,-2) ) T(-1,1)       </span></span>
<span id="cb107-676"><a href="#cb107-676" aria-hidden="true" tabindex="-1"></a><span class="st">    }</span></span>
<span id="cb107-677"><a href="#cb107-677" aria-hidden="true" tabindex="-1"></a><span class="st">    ar1Mean ~ dunif( -1,1 ) </span></span>
<span id="cb107-678"><a href="#cb107-678" aria-hidden="true" tabindex="-1"></a><span class="st">    ar1SD ~ dunif( 0, 2 )</span></span>
<span id="cb107-679"><a href="#cb107-679" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb107-680"><a href="#cb107-680" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb107-681"><a href="#cb107-681" aria-hidden="true" tabindex="-1"></a><span class="st">    # model variance</span></span>
<span id="cb107-682"><a href="#cb107-682" aria-hidden="true" tabindex="-1"></a><span class="st">    sigma ~ dunif(0, 100)</span></span>
<span id="cb107-683"><a href="#cb107-683" aria-hidden="true" tabindex="-1"></a><span class="st">    </span></span>
<span id="cb107-684"><a href="#cb107-684" aria-hidden="true" tabindex="-1"></a><span class="st">    </span></span>
<span id="cb107-685"><a href="#cb107-685" aria-hidden="true" tabindex="-1"></a><span class="st">    # fixed effect coefficients</span></span>
<span id="cb107-686"><a href="#cb107-686" aria-hidden="true" tabindex="-1"></a><span class="st">    for (k in 1:Kfixed) {</span></span>
<span id="cb107-687"><a href="#cb107-687" aria-hidden="true" tabindex="-1"></a><span class="st">      B.0[k] ~ dnorm(0, 0.001)</span></span>
<span id="cb107-688"><a href="#cb107-688" aria-hidden="true" tabindex="-1"></a><span class="st">      }</span></span>
<span id="cb107-689"><a href="#cb107-689" aria-hidden="true" tabindex="-1"></a><span class="st">      </span></span>
<span id="cb107-690"><a href="#cb107-690" aria-hidden="true" tabindex="-1"></a><span class="st">    # random effect coefficients (by site)</span></span>
<span id="cb107-691"><a href="#cb107-691" aria-hidden="true" tabindex="-1"></a><span class="st">    for (k in 1:Krandom) {</span></span>
<span id="cb107-692"><a href="#cb107-692" aria-hidden="true" tabindex="-1"></a><span class="st">      sigma.B.site[k] ~ dunif(0, 100)</span></span>
<span id="cb107-693"><a href="#cb107-693" aria-hidden="true" tabindex="-1"></a><span class="st">      for (i in 1:nsites) {</span></span>
<span id="cb107-694"><a href="#cb107-694" aria-hidden="true" tabindex="-1"></a><span class="st">        B.site[i,k] ~ dnorm(0, pow(sigma.B.site[k], -2))</span></span>
<span id="cb107-695"><a href="#cb107-695" aria-hidden="true" tabindex="-1"></a><span class="st">      }</span></span>
<span id="cb107-696"><a href="#cb107-696" aria-hidden="true" tabindex="-1"></a><span class="st">    }</span></span>
<span id="cb107-697"><a href="#cb107-697" aria-hidden="true" tabindex="-1"></a><span class="st">    </span></span>
<span id="cb107-698"><a href="#cb107-698" aria-hidden="true" tabindex="-1"></a><span class="st">    # YEAR EFFECTS</span></span>
<span id="cb107-699"><a href="#cb107-699" aria-hidden="true" tabindex="-1"></a><span class="st">    # Priors for random effects of year</span></span>
<span id="cb107-700"><a href="#cb107-700" aria-hidden="true" tabindex="-1"></a><span class="st">    for (t in 1:Ti) { # Ti years</span></span>
<span id="cb107-701"><a href="#cb107-701" aria-hidden="true" tabindex="-1"></a><span class="st">      B.year[t, 1:L] ~ dmnorm(mu.year[ ], tau.B.year[ , ])</span></span>
<span id="cb107-702"><a href="#cb107-702" aria-hidden="true" tabindex="-1"></a><span class="st">      }</span></span>
<span id="cb107-703"><a href="#cb107-703" aria-hidden="true" tabindex="-1"></a><span class="st">      </span></span>
<span id="cb107-704"><a href="#cb107-704" aria-hidden="true" tabindex="-1"></a><span class="st">    mu.year[1] &lt;- 0</span></span>
<span id="cb107-705"><a href="#cb107-705" aria-hidden="true" tabindex="-1"></a><span class="st">    </span></span>
<span id="cb107-706"><a href="#cb107-706" aria-hidden="true" tabindex="-1"></a><span class="st">    for (l in 2:L) {</span></span>
<span id="cb107-707"><a href="#cb107-707" aria-hidden="true" tabindex="-1"></a><span class="st">      mu.year[l] ~ dnorm(0, 0.0001)</span></span>
<span id="cb107-708"><a href="#cb107-708" aria-hidden="true" tabindex="-1"></a><span class="st">      }</span></span>
<span id="cb107-709"><a href="#cb107-709" aria-hidden="true" tabindex="-1"></a><span class="st">      </span></span>
<span id="cb107-710"><a href="#cb107-710" aria-hidden="true" tabindex="-1"></a><span class="st">    # Prior on multivariate normal std deviation</span></span>
<span id="cb107-711"><a href="#cb107-711" aria-hidden="true" tabindex="-1"></a><span class="st">    tau.B.year[1:L, 1:L] ~ dwish(W.year[ , ], df.year)</span></span>
<span id="cb107-712"><a href="#cb107-712" aria-hidden="true" tabindex="-1"></a><span class="st">    df.year &lt;- L + 1</span></span>
<span id="cb107-713"><a href="#cb107-713" aria-hidden="true" tabindex="-1"></a><span class="st">    sigma.B.year[1:L, 1:L] &lt;- inverse(tau.B.year[ , ])</span></span>
<span id="cb107-714"><a href="#cb107-714" aria-hidden="true" tabindex="-1"></a><span class="st">    for (l in 1:L) {</span></span>
<span id="cb107-715"><a href="#cb107-715" aria-hidden="true" tabindex="-1"></a><span class="st">      for (l.prime in 1:L) {</span></span>
<span id="cb107-716"><a href="#cb107-716" aria-hidden="true" tabindex="-1"></a><span class="st">        rho.B.year[l, l.prime] &lt;- sigma.B.year[l, l.prime]/sqrt(sigma.B.year[l, l]*sigma.B.year[l.prime, l.prime])</span></span>
<span id="cb107-717"><a href="#cb107-717" aria-hidden="true" tabindex="-1"></a><span class="st">        }</span></span>
<span id="cb107-718"><a href="#cb107-718" aria-hidden="true" tabindex="-1"></a><span class="st">      sigma.b.year[l] &lt;- sqrt(sigma.B.year[l, l])</span></span>
<span id="cb107-719"><a href="#cb107-719" aria-hidden="true" tabindex="-1"></a><span class="st">    }</span></span>
<span id="cb107-720"><a href="#cb107-720" aria-hidden="true" tabindex="-1"></a><span class="st">    </span></span>
<span id="cb107-721"><a href="#cb107-721" aria-hidden="true" tabindex="-1"></a><span class="st">    </span></span>
<span id="cb107-722"><a href="#cb107-722" aria-hidden="true" tabindex="-1"></a><span class="st">    ###----------------- DERIVED VALUES -------------###</span></span>
<span id="cb107-723"><a href="#cb107-723" aria-hidden="true" tabindex="-1"></a><span class="st">    residuals[1] &lt;- 0 # hold the place. Not sure if this is necessary...</span></span>
<span id="cb107-724"><a href="#cb107-724" aria-hidden="true" tabindex="-1"></a><span class="st">    for (i in 2:n) {</span></span>
<span id="cb107-725"><a href="#cb107-725" aria-hidden="true" tabindex="-1"></a><span class="st">      residuals[i] &lt;- temp[i] - stream.mu[i]</span></span>
<span id="cb107-726"><a href="#cb107-726" aria-hidden="true" tabindex="-1"></a><span class="st">    }</span></span>
<span id="cb107-727"><a href="#cb107-727" aria-hidden="true" tabindex="-1"></a><span class="st">    </span></span>
<span id="cb107-728"><a href="#cb107-728" aria-hidden="true" tabindex="-1"></a><span class="st">    }"</span>, <span class="at">file =</span> <span class="st">"JAGS models/DailyTempModelJAGS_Letcher_hierarchical.txt"</span>)</span>
<span id="cb107-729"><a href="#cb107-729" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb107-730"><a href="#cb107-730" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb107-731"><a href="#cb107-731" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb107-732"><a href="#cb107-732" aria-hidden="true" tabindex="-1"></a><span class="fu">### Organize objects</span></span>
<span id="cb107-733"><a href="#cb107-733" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb107-734"><a href="#cb107-734" aria-hidden="true" tabindex="-1"></a>Get first observation indices and check that nFirstRowObs equals the number of unique site-years: **must be TRUE!**</span>
<span id="cb107-737"><a href="#cb107-737" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb107-738"><a href="#cb107-738" aria-hidden="true" tabindex="-1"></a><span class="co"># row indices for first observation in each site-year</span></span>
<span id="cb107-739"><a href="#cb107-739" aria-hidden="true" tabindex="-1"></a>firstObsRows <span class="ot">&lt;-</span> <span class="fu">unlist</span>(tempDataSyncS <span class="sc">%&gt;%</span> </span>
<span id="cb107-740"><a href="#cb107-740" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(siteYear) <span class="sc">%&gt;%</span></span>
<span id="cb107-741"><a href="#cb107-741" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="at">index =</span> rowNum[<span class="fu">min</span>(<span class="fu">which</span>(<span class="sc">!</span><span class="fu">is.na</span>(temp)))]) <span class="sc">%&gt;%</span></span>
<span id="cb107-742"><a href="#cb107-742" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb107-743"><a href="#cb107-743" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(index))</span>
<span id="cb107-744"><a href="#cb107-744" aria-hidden="true" tabindex="-1"></a>nFirstObsRows <span class="ot">&lt;-</span> <span class="fu">length</span>(firstObsRows)</span>
<span id="cb107-745"><a href="#cb107-745" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb107-746"><a href="#cb107-746" aria-hidden="true" tabindex="-1"></a><span class="co"># does the number of first observations match the number of site years?</span></span>
<span id="cb107-747"><a href="#cb107-747" aria-hidden="true" tabindex="-1"></a>nFirstObsRows <span class="sc">==</span> <span class="fu">length</span>(<span class="fu">unique</span>(tempDataSyncS<span class="sc">$</span>siteYear))</span>
<span id="cb107-748"><a href="#cb107-748" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb107-749"><a href="#cb107-749" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb107-750"><a href="#cb107-750" aria-hidden="true" tabindex="-1"></a>Get row indices for all other observations</span>
<span id="cb107-753"><a href="#cb107-753" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb107-754"><a href="#cb107-754" aria-hidden="true" tabindex="-1"></a>evalRows <span class="ot">&lt;-</span> <span class="fu">unlist</span>(tempDataSyncS <span class="sc">%&gt;%</span> <span class="fu">filter</span>(<span class="sc">!</span>rowNum <span class="sc">%in%</span> firstObsRows) <span class="sc">%&gt;%</span> <span class="fu">select</span>(rowNum))</span>
<span id="cb107-755"><a href="#cb107-755" aria-hidden="true" tabindex="-1"></a>nEvalRows <span class="ot">&lt;-</span> <span class="fu">length</span>(evalRows)</span>
<span id="cb107-756"><a href="#cb107-756" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb107-757"><a href="#cb107-757" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb107-758"><a href="#cb107-758" aria-hidden="true" tabindex="-1"></a>Fixed and random effect data</span>
<span id="cb107-761"><a href="#cb107-761" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb107-762"><a href="#cb107-762" aria-hidden="true" tabindex="-1"></a>data.random <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">intercept =</span> <span class="dv">1</span>,</span>
<span id="cb107-763"><a href="#cb107-763" aria-hidden="true" tabindex="-1"></a>                          <span class="at">airTemp =</span> tempDataSyncS<span class="sc">$</span>airTemp )</span>
<span id="cb107-764"><a href="#cb107-764" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb107-765"><a href="#cb107-765" aria-hidden="true" tabindex="-1"></a>data.fixed <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="co">#intercept = 1</span></span>
<span id="cb107-766"><a href="#cb107-766" aria-hidden="true" tabindex="-1"></a>                         <span class="co">#,airTemp = tempDataSyncS$airTemp </span></span>
<span id="cb107-767"><a href="#cb107-767" aria-hidden="true" tabindex="-1"></a>                         <span class="at">airTempLag1 =</span> tempDataSyncS<span class="sc">$</span>airTempLagged1</span>
<span id="cb107-768"><a href="#cb107-768" aria-hidden="true" tabindex="-1"></a>                         ,<span class="at">airTempLag2 =</span> tempDataSyncS<span class="sc">$</span>airTempLagged2</span>
<span id="cb107-769"><a href="#cb107-769" aria-hidden="true" tabindex="-1"></a>                         </span>
<span id="cb107-770"><a href="#cb107-770" aria-hidden="true" tabindex="-1"></a>                         ,<span class="at">flow =</span>  tempDataSyncS<span class="sc">$</span>flowLS</span>
<span id="cb107-771"><a href="#cb107-771" aria-hidden="true" tabindex="-1"></a>                         </span>
<span id="cb107-772"><a href="#cb107-772" aria-hidden="true" tabindex="-1"></a>                         ,<span class="at">airFlow =</span> tempDataSyncS<span class="sc">$</span>airTemp <span class="sc">*</span> tempDataSyncS<span class="sc">$</span>flowLS</span>
<span id="cb107-773"><a href="#cb107-773" aria-hidden="true" tabindex="-1"></a><span class="co">#                         ,air1Flow = tempDataSyncS$airTempLagged1 * tempDataSyncS$flowLS</span></span>
<span id="cb107-774"><a href="#cb107-774" aria-hidden="true" tabindex="-1"></a><span class="co">#                         ,air2Flow = tempDataSyncS$airTempLagged2 * tempDataSyncS$flowLS</span></span>
<span id="cb107-775"><a href="#cb107-775" aria-hidden="true" tabindex="-1"></a>                         </span>
<span id="cb107-776"><a href="#cb107-776" aria-hidden="true" tabindex="-1"></a>                         <span class="co">#main river effects</span></span>
<span id="cb107-777"><a href="#cb107-777" aria-hidden="true" tabindex="-1"></a>                         <span class="co"># ,river1 = tempDataSyncS$river1</span></span>
<span id="cb107-778"><a href="#cb107-778" aria-hidden="true" tabindex="-1"></a>                         <span class="co"># ,river2 = tempDataSyncS$river2</span></span>
<span id="cb107-779"><a href="#cb107-779" aria-hidden="true" tabindex="-1"></a>                         <span class="co"># ,river3 = tempDataSyncS$river3</span></span>
<span id="cb107-780"><a href="#cb107-780" aria-hidden="true" tabindex="-1"></a>                         <span class="co"># </span></span>
<span id="cb107-781"><a href="#cb107-781" aria-hidden="true" tabindex="-1"></a>                         <span class="co"># #river interaction with air temp</span></span>
<span id="cb107-782"><a href="#cb107-782" aria-hidden="true" tabindex="-1"></a>                         <span class="co"># ,river1Air = tempDataSyncS$river1 * tempDataSyncS$airTemp</span></span>
<span id="cb107-783"><a href="#cb107-783" aria-hidden="true" tabindex="-1"></a>                         <span class="co"># ,river2Air = tempDataSyncS$river2 * tempDataSyncS$airTemp</span></span>
<span id="cb107-784"><a href="#cb107-784" aria-hidden="true" tabindex="-1"></a>                         <span class="co"># ,river3Air = tempDataSyncS$river3 * tempDataSyncS$airTemp</span></span>
<span id="cb107-785"><a href="#cb107-785" aria-hidden="true" tabindex="-1"></a>                         </span>
<span id="cb107-786"><a href="#cb107-786" aria-hidden="true" tabindex="-1"></a>                          ) </span>
<span id="cb107-787"><a href="#cb107-787" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb107-788"><a href="#cb107-788" aria-hidden="true" tabindex="-1"></a>data.random.years <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">intercept.year =</span> <span class="dv">1</span>, </span>
<span id="cb107-789"><a href="#cb107-789" aria-hidden="true" tabindex="-1"></a>                     <span class="at">dOY  =</span> tempDataSyncS<span class="sc">$</span>dOY, </span>
<span id="cb107-790"><a href="#cb107-790" aria-hidden="true" tabindex="-1"></a>                     <span class="at">dOY2 =</span> tempDataSyncS<span class="sc">$</span>dOY<span class="sc">^</span><span class="dv">2</span>,</span>
<span id="cb107-791"><a href="#cb107-791" aria-hidden="true" tabindex="-1"></a>                     <span class="at">dOY3 =</span> tempDataSyncS<span class="sc">$</span>dOY<span class="sc">^</span><span class="dv">3</span></span>
<span id="cb107-792"><a href="#cb107-792" aria-hidden="true" tabindex="-1"></a>                     )</span>
<span id="cb107-793"><a href="#cb107-793" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb107-794"><a href="#cb107-794" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb107-795"><a href="#cb107-795" aria-hidden="true" tabindex="-1"></a>Misc. objects</span>
<span id="cb107-798"><a href="#cb107-798" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb107-799"><a href="#cb107-799" aria-hidden="true" tabindex="-1"></a>Ti <span class="ot">&lt;-</span> <span class="fu">length</span>(<span class="fu">unique</span>(tempDataSyncS<span class="sc">$</span>year))</span>
<span id="cb107-800"><a href="#cb107-800" aria-hidden="true" tabindex="-1"></a>L <span class="ot">&lt;-</span> <span class="fu">dim</span>(data.random.years)[<span class="dv">2</span>]</span>
<span id="cb107-801"><a href="#cb107-801" aria-hidden="true" tabindex="-1"></a>W.year <span class="ot">&lt;-</span> <span class="fu">diag</span>(L)</span>
<span id="cb107-802"><a href="#cb107-802" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb107-803"><a href="#cb107-803" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb107-804"><a href="#cb107-804" aria-hidden="true" tabindex="-1"></a>Combine data in list</span>
<span id="cb107-807"><a href="#cb107-807" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb107-808"><a href="#cb107-808" aria-hidden="true" tabindex="-1"></a><span class="co"># combine data in a list</span></span>
<span id="cb107-809"><a href="#cb107-809" aria-hidden="true" tabindex="-1"></a>jags.data <span class="ot">&lt;-</span> <span class="fu">list</span>(<span class="st">"temp"</span> <span class="ot">=</span> tempDataSyncS<span class="sc">$</span>temp,</span>
<span id="cb107-810"><a href="#cb107-810" aria-hidden="true" tabindex="-1"></a>                  <span class="st">"nFirstObsRows"</span> <span class="ot">=</span> nFirstObsRows,</span>
<span id="cb107-811"><a href="#cb107-811" aria-hidden="true" tabindex="-1"></a>                  <span class="st">"firstObsRows"</span> <span class="ot">=</span> firstObsRows,</span>
<span id="cb107-812"><a href="#cb107-812" aria-hidden="true" tabindex="-1"></a>                  <span class="st">"nEvalRows"</span> <span class="ot">=</span> nEvalRows,</span>
<span id="cb107-813"><a href="#cb107-813" aria-hidden="true" tabindex="-1"></a>                  <span class="st">"evalRows"</span> <span class="ot">=</span> evalRows,</span>
<span id="cb107-814"><a href="#cb107-814" aria-hidden="true" tabindex="-1"></a>                  <span class="st">"X.0"</span> <span class="ot">=</span> <span class="fu">as.matrix</span>(data.fixed),</span>
<span id="cb107-815"><a href="#cb107-815" aria-hidden="true" tabindex="-1"></a>                  <span class="st">"X.site"</span> <span class="ot">=</span> <span class="fu">as.matrix</span>(data.random),</span>
<span id="cb107-816"><a href="#cb107-816" aria-hidden="true" tabindex="-1"></a>                  <span class="st">"X.year"</span> <span class="ot">=</span> <span class="fu">as.matrix</span>(data.random.years),</span>
<span id="cb107-817"><a href="#cb107-817" aria-hidden="true" tabindex="-1"></a>                  <span class="st">"Kfixed"</span> <span class="ot">=</span> <span class="fu">dim</span>(data.fixed)[<span class="dv">2</span>],</span>
<span id="cb107-818"><a href="#cb107-818" aria-hidden="true" tabindex="-1"></a>                  <span class="st">"Krandom"</span> <span class="ot">=</span> <span class="fu">dim</span>(data.random)[<span class="dv">2</span>],</span>
<span id="cb107-819"><a href="#cb107-819" aria-hidden="true" tabindex="-1"></a>                  <span class="st">"nsites"</span> <span class="ot">=</span> <span class="fu">length</span>(<span class="fu">unique</span>(tempDataSyncS<span class="sc">$</span>site)),</span>
<span id="cb107-820"><a href="#cb107-820" aria-hidden="true" tabindex="-1"></a>                  <span class="st">"Ti"</span> <span class="ot">=</span> Ti,</span>
<span id="cb107-821"><a href="#cb107-821" aria-hidden="true" tabindex="-1"></a>                  <span class="st">"L"</span> <span class="ot">=</span> L,</span>
<span id="cb107-822"><a href="#cb107-822" aria-hidden="true" tabindex="-1"></a>                  <span class="st">"W.year"</span> <span class="ot">=</span> W.year,</span>
<span id="cb107-823"><a href="#cb107-823" aria-hidden="true" tabindex="-1"></a>                  <span class="st">"n"</span> <span class="ot">=</span> <span class="fu">dim</span>(tempDataSyncS)[<span class="dv">1</span>],</span>
<span id="cb107-824"><a href="#cb107-824" aria-hidden="true" tabindex="-1"></a>                  <span class="st">"year"</span> <span class="ot">=</span> <span class="fu">as.factor</span>(tempDataSyncS<span class="sc">$</span>year),</span>
<span id="cb107-825"><a href="#cb107-825" aria-hidden="true" tabindex="-1"></a>                  <span class="st">"site"</span> <span class="ot">=</span> <span class="fu">as.numeric</span>(tempDataSyncS<span class="sc">$</span>riverOrdered)</span>
<span id="cb107-826"><a href="#cb107-826" aria-hidden="true" tabindex="-1"></a>                  )</span>
<span id="cb107-827"><a href="#cb107-827" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb107-828"><a href="#cb107-828" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb107-829"><a href="#cb107-829" aria-hidden="true" tabindex="-1"></a>Parameters to monitor</span>
<span id="cb107-832"><a href="#cb107-832" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb107-833"><a href="#cb107-833" aria-hidden="true" tabindex="-1"></a>jags.params <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"residuals"</span>,</span>
<span id="cb107-834"><a href="#cb107-834" aria-hidden="true" tabindex="-1"></a>            <span class="st">"deviance"</span>,</span>
<span id="cb107-835"><a href="#cb107-835" aria-hidden="true" tabindex="-1"></a>            <span class="co">#"pD",</span></span>
<span id="cb107-836"><a href="#cb107-836" aria-hidden="true" tabindex="-1"></a>            <span class="st">"sigma"</span>,</span>
<span id="cb107-837"><a href="#cb107-837" aria-hidden="true" tabindex="-1"></a>            <span class="st">"B.0"</span>,</span>
<span id="cb107-838"><a href="#cb107-838" aria-hidden="true" tabindex="-1"></a>            <span class="st">"B.site"</span>,</span>
<span id="cb107-839"><a href="#cb107-839" aria-hidden="true" tabindex="-1"></a>            <span class="st">"B.year"</span>,</span>
<span id="cb107-840"><a href="#cb107-840" aria-hidden="true" tabindex="-1"></a>            <span class="co">#"mu.B.river",</span></span>
<span id="cb107-841"><a href="#cb107-841" aria-hidden="true" tabindex="-1"></a>            <span class="st">"rho.B.year"</span>,</span>
<span id="cb107-842"><a href="#cb107-842" aria-hidden="true" tabindex="-1"></a>            <span class="st">"mu.year"</span>,</span>
<span id="cb107-843"><a href="#cb107-843" aria-hidden="true" tabindex="-1"></a>            <span class="st">"sigma.b.year"</span>,</span>
<span id="cb107-844"><a href="#cb107-844" aria-hidden="true" tabindex="-1"></a>            <span class="st">"stream.mu"</span>,</span>
<span id="cb107-845"><a href="#cb107-845" aria-hidden="true" tabindex="-1"></a>            <span class="st">"ar1"</span> ,</span>
<span id="cb107-846"><a href="#cb107-846" aria-hidden="true" tabindex="-1"></a>            <span class="st">"ar1Mean"</span>,</span>
<span id="cb107-847"><a href="#cb107-847" aria-hidden="true" tabindex="-1"></a>            <span class="st">"ar1SD"</span>,</span>
<span id="cb107-848"><a href="#cb107-848" aria-hidden="true" tabindex="-1"></a>            <span class="st">"temp"</span>,</span>
<span id="cb107-849"><a href="#cb107-849" aria-hidden="true" tabindex="-1"></a>            <span class="st">"sigma.B.site"</span></span>
<span id="cb107-850"><a href="#cb107-850" aria-hidden="true" tabindex="-1"></a>            )</span>
<span id="cb107-851"><a href="#cb107-851" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb107-852"><a href="#cb107-852" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb107-853"><a href="#cb107-853" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb107-854"><a href="#cb107-854" aria-hidden="true" tabindex="-1"></a><span class="fu">### Fit model</span></span>
<span id="cb107-855"><a href="#cb107-855" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb107-856"><a href="#cb107-856" aria-hidden="true" tabindex="-1"></a><span class="in">```{r eval=FALSE}</span></span>
<span id="cb107-857"><a href="#cb107-857" aria-hidden="true" tabindex="-1"></a>fit0_h <span class="ot">&lt;-</span> <span class="fu">jags.parallel</span>(<span class="at">data =</span> jags.data, <span class="at">inits =</span> <span class="cn">NULL</span>, <span class="at">parameters.to.save =</span> jags.params, </span>
<span id="cb107-858"><a href="#cb107-858" aria-hidden="true" tabindex="-1"></a>                        <span class="at">model.file =</span> <span class="st">"JAGS models/DailyTempModelJAGS_Letcher_hierarchical.txt"</span>,</span>
<span id="cb107-859"><a href="#cb107-859" aria-hidden="true" tabindex="-1"></a>                        <span class="at">n.chains =</span> <span class="dv">10</span>, <span class="at">n.thin =</span> <span class="dv">10</span>, <span class="at">n.burnin =</span> <span class="dv">1000</span>, <span class="at">n.iter =</span> <span class="dv">3000</span>, <span class="at">DIC =</span> <span class="cn">TRUE</span>)</span>
<span id="cb107-860"><a href="#cb107-860" aria-hidden="true" tabindex="-1"></a><span class="fu">beep</span>()</span>
<span id="cb107-861"><a href="#cb107-861" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb107-862"><a href="#cb107-862" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb107-863"><a href="#cb107-863" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb107-864"><a href="#cb107-864" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb107-865"><a href="#cb107-865" aria-hidden="true" tabindex="-1"></a><span class="fu">#### Save model output</span></span>
<span id="cb107-866"><a href="#cb107-866" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb107-867"><a href="#cb107-867" aria-hidden="true" tabindex="-1"></a>Save to file</span>
<span id="cb107-868"><a href="#cb107-868" aria-hidden="true" tabindex="-1"></a><span class="in">```{r eval=FALSE}</span></span>
<span id="cb107-869"><a href="#cb107-869" aria-hidden="true" tabindex="-1"></a><span class="fu">saveRDS</span>(fit0_h, <span class="st">"Model objects/LetcherTempModel_PeerJ2016_hierarchical.RDS"</span>)</span>
<span id="cb107-870"><a href="#cb107-870" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb107-871"><a href="#cb107-871" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb107-872"><a href="#cb107-872" aria-hidden="true" tabindex="-1"></a>Read in fitted model object</span>
<span id="cb107-875"><a href="#cb107-875" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb107-876"><a href="#cb107-876" aria-hidden="true" tabindex="-1"></a>fit0_h <span class="ot">&lt;-</span> <span class="fu">readRDS</span>(<span class="st">"Model objects/LetcherTempModel_PeerJ2016_hierarchical.RDS"</span>)</span>
<span id="cb107-877"><a href="#cb107-877" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb107-878"><a href="#cb107-878" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb107-879"><a href="#cb107-879" aria-hidden="true" tabindex="-1"></a>Get MCMC samples and summary</span>
<span id="cb107-882"><a href="#cb107-882" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb107-883"><a href="#cb107-883" aria-hidden="true" tabindex="-1"></a>top_mod <span class="ot">&lt;-</span> fit0_h</span>
<span id="cb107-884"><a href="#cb107-884" aria-hidden="true" tabindex="-1"></a><span class="co"># generate MCMC samples and store as an array</span></span>
<span id="cb107-885"><a href="#cb107-885" aria-hidden="true" tabindex="-1"></a>modelout <span class="ot">&lt;-</span> top_mod<span class="sc">$</span>BUGSoutput</span>
<span id="cb107-886"><a href="#cb107-886" aria-hidden="true" tabindex="-1"></a>McmcList <span class="ot">&lt;-</span> <span class="fu">vector</span>(<span class="st">"list"</span>, <span class="at">length =</span> <span class="fu">dim</span>(modelout<span class="sc">$</span>sims.array)[<span class="dv">2</span>])</span>
<span id="cb107-887"><a href="#cb107-887" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(McmcList)) { McmcList[[i]] <span class="ot">=</span> <span class="fu">as.mcmc</span>(modelout<span class="sc">$</span>sims.array[,i,]) }</span>
<span id="cb107-888"><a href="#cb107-888" aria-hidden="true" tabindex="-1"></a><span class="co"># rbind MCMC samples from 10 chains </span></span>
<span id="cb107-889"><a href="#cb107-889" aria-hidden="true" tabindex="-1"></a>Mcmcdat <span class="ot">&lt;-</span> <span class="fu">rbind</span>(McmcList[[<span class="dv">1</span>]], McmcList[[<span class="dv">2</span>]], McmcList[[<span class="dv">3</span>]], McmcList[[<span class="dv">4</span>]], McmcList[[<span class="dv">5</span>]], McmcList[[<span class="dv">6</span>]], McmcList[[<span class="dv">7</span>]], McmcList[[<span class="dv">8</span>]], McmcList[[<span class="dv">9</span>]], McmcList[[<span class="dv">10</span>]])</span>
<span id="cb107-890"><a href="#cb107-890" aria-hidden="true" tabindex="-1"></a>param.summary <span class="ot">&lt;-</span> modelout<span class="sc">$</span>summary</span>
<span id="cb107-891"><a href="#cb107-891" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(param.summary)</span>
<span id="cb107-892"><a href="#cb107-892" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb107-893"><a href="#cb107-893" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb107-894"><a href="#cb107-894" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb107-895"><a href="#cb107-895" aria-hidden="true" tabindex="-1"></a><span class="fu">#### Check convergence</span></span>
<span id="cb107-896"><a href="#cb107-896" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb107-897"><a href="#cb107-897" aria-hidden="true" tabindex="-1"></a>Any problematic R-hat values (&gt;1.05)?</span>
<span id="cb107-900"><a href="#cb107-900" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb107-901"><a href="#cb107-901" aria-hidden="true" tabindex="-1"></a>top_mod<span class="sc">$</span>BUGSoutput<span class="sc">$</span>summary[,<span class="dv">8</span>][top_mod<span class="sc">$</span>BUGSoutput<span class="sc">$</span>summary[,<span class="dv">8</span>] <span class="sc">&gt;</span> <span class="fl">1.05</span>]</span>
<span id="cb107-902"><a href="#cb107-902" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb107-903"><a href="#cb107-903" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb107-904"><a href="#cb107-904" aria-hidden="true" tabindex="-1"></a>View traceplots</span>
<span id="cb107-907"><a href="#cb107-907" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb107-908"><a href="#cb107-908" aria-hidden="true" tabindex="-1"></a><span class="fu">MCMCtrace</span>(top_mod, <span class="at">ind =</span> <span class="cn">TRUE</span>, </span>
<span id="cb107-909"><a href="#cb107-909" aria-hidden="true" tabindex="-1"></a>          <span class="at">params =</span> <span class="fu">c</span>(<span class="st">"B.0"</span>, <span class="st">"B.site"</span>, <span class="st">"mu.year"</span>,</span>
<span id="cb107-910"><a href="#cb107-910" aria-hidden="true" tabindex="-1"></a>                     <span class="st">"ar1"</span>, </span>
<span id="cb107-911"><a href="#cb107-911" aria-hidden="true" tabindex="-1"></a>                     <span class="st">"sigma"</span>), <span class="at">pdf =</span> <span class="cn">FALSE</span>)</span>
<span id="cb107-912"><a href="#cb107-912" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb107-913"><a href="#cb107-913" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb107-914"><a href="#cb107-914" aria-hidden="true" tabindex="-1"></a>Convert to ggs object</span>
<span id="cb107-917"><a href="#cb107-917" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb107-918"><a href="#cb107-918" aria-hidden="true" tabindex="-1"></a>ggfit <span class="ot">&lt;-</span> <span class="fu">ggs</span>(<span class="fu">as.mcmc</span>(top_mod), <span class="at">keep_original_order =</span> <span class="cn">TRUE</span>)</span>
<span id="cb107-919"><a href="#cb107-919" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(ggfit)</span>
<span id="cb107-920"><a href="#cb107-920" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb107-921"><a href="#cb107-921" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb107-922"><a href="#cb107-922" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb107-923"><a href="#cb107-923" aria-hidden="true" tabindex="-1"></a><span class="fu">### Goodness of fit</span></span>
<span id="cb107-924"><a href="#cb107-924" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb107-925"><a href="#cb107-925" aria-hidden="true" tabindex="-1"></a>Format observed and predicted values</span>
<span id="cb107-928"><a href="#cb107-928" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb107-929"><a href="#cb107-929" aria-hidden="true" tabindex="-1"></a>Mcmcdat <span class="ot">&lt;-</span> <span class="fu">as_tibble</span>(Mcmcdat)</span>
<span id="cb107-930"><a href="#cb107-930" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb107-931"><a href="#cb107-931" aria-hidden="true" tabindex="-1"></a><span class="co"># subset expected and observed MCMC samples</span></span>
<span id="cb107-932"><a href="#cb107-932" aria-hidden="true" tabindex="-1"></a>ppdat_exp <span class="ot">&lt;-</span> <span class="fu">as.matrix</span>(Mcmcdat[,<span class="fu">startsWith</span>(<span class="fu">names</span>(Mcmcdat), <span class="st">"stream.mu["</span>)])</span>
<span id="cb107-933"><a href="#cb107-933" aria-hidden="true" tabindex="-1"></a>ppdat_obs <span class="ot">&lt;-</span> <span class="fu">as.matrix</span>(Mcmcdat[,<span class="fu">startsWith</span>(<span class="fu">names</span>(Mcmcdat), <span class="st">"temp["</span>)])</span>
<span id="cb107-934"><a href="#cb107-934" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb107-935"><a href="#cb107-935" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb107-936"><a href="#cb107-936" aria-hidden="true" tabindex="-1"></a>Bayesian p-value</span>
<span id="cb107-939"><a href="#cb107-939" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb107-940"><a href="#cb107-940" aria-hidden="true" tabindex="-1"></a><span class="fu">sum</span>(ppdat_exp <span class="sc">&gt;</span> ppdat_obs) <span class="sc">/</span> (<span class="fu">dim</span>(ppdat_obs)[<span class="dv">1</span>]<span class="sc">*</span><span class="fu">dim</span>(ppdat_obs)[<span class="dv">2</span>])</span>
<span id="cb107-941"><a href="#cb107-941" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb107-942"><a href="#cb107-942" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb107-943"><a href="#cb107-943" aria-hidden="true" tabindex="-1"></a>PP-check</span>
<span id="cb107-946"><a href="#cb107-946" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb107-947"><a href="#cb107-947" aria-hidden="true" tabindex="-1"></a>ppdat_obs_mean <span class="ot">&lt;-</span> <span class="fu">apply</span>(ppdat_obs, <span class="dv">2</span>, mean)</span>
<span id="cb107-948"><a href="#cb107-948" aria-hidden="true" tabindex="-1"></a>ppdat_exp_mean <span class="ot">&lt;-</span> <span class="fu">apply</span>(ppdat_exp, <span class="dv">2</span>, mean)</span>
<span id="cb107-949"><a href="#cb107-949" aria-hidden="true" tabindex="-1"></a><span class="fu">tibble</span>(<span class="at">obs =</span> ppdat_obs_mean, <span class="at">exp =</span> ppdat_exp_mean) <span class="sc">%&gt;%</span> </span>
<span id="cb107-950"><a href="#cb107-950" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> obs, <span class="at">y =</span> exp)) <span class="sc">+</span> </span>
<span id="cb107-951"><a href="#cb107-951" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">alpha =</span> <span class="fl">0.1</span>) <span class="sc">+</span> </span>
<span id="cb107-952"><a href="#cb107-952" aria-hidden="true" tabindex="-1"></a>  <span class="co"># geom_smooth(method = "lm") +</span></span>
<span id="cb107-953"><a href="#cb107-953" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_abline</span>(<span class="at">intercept =</span> <span class="dv">0</span>, <span class="at">slope =</span> <span class="dv">1</span>, <span class="at">color =</span> <span class="st">"red"</span>) <span class="sc">+</span> </span>
<span id="cb107-954"><a href="#cb107-954" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>() <span class="sc">+</span> <span class="fu">theme</span>(<span class="at">panel.grid =</span> <span class="fu">element_blank</span>()) <span class="sc">+</span></span>
<span id="cb107-955"><a href="#cb107-955" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="st">"Observed"</span>) <span class="sc">+</span> <span class="fu">ylab</span>(<span class="st">"Predicted (mean)"</span>)</span>
<span id="cb107-956"><a href="#cb107-956" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb107-957"><a href="#cb107-957" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb107-958"><a href="#cb107-958" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb107-959"><a href="#cb107-959" aria-hidden="true" tabindex="-1"></a><span class="fu">### Plot model output</span></span>
<span id="cb107-960"><a href="#cb107-960" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb107-961"><a href="#cb107-961" aria-hidden="true" tabindex="-1"></a><span class="fu">#### Dot plots</span></span>
<span id="cb107-962"><a href="#cb107-962" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb107-963"><a href="#cb107-963" aria-hidden="true" tabindex="-1"></a>*Output is the same! Good!*</span>
<span id="cb107-964"><a href="#cb107-964" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb107-965"><a href="#cb107-965" aria-hidden="true" tabindex="-1"></a>Intercepts</span>
<span id="cb107-968"><a href="#cb107-968" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb107-969"><a href="#cb107-969" aria-hidden="true" tabindex="-1"></a>ggfit <span class="sc">%&gt;%</span></span>
<span id="cb107-970"><a href="#cb107-970" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(Parameter <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"B.site[1,1]"</span>, <span class="st">"B.site[2,1]"</span>, <span class="st">"B.site[3,1]"</span>, <span class="st">"B.site[4,1]"</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb107-971"><a href="#cb107-971" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Parameter =</span> <span class="fu">factor</span>(Parameter, <span class="at">levels =</span> <span class="fu">c</span>(<span class="st">"B.site[1,1]"</span>, <span class="st">"B.site[2,1]"</span>, <span class="st">"B.site[3,1]"</span>, <span class="st">"B.site[4,1]"</span>))) <span class="sc">%&gt;%</span></span>
<span id="cb107-972"><a href="#cb107-972" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggs_caterpillar</span>(<span class="at">sort =</span> <span class="cn">FALSE</span>) <span class="sc">+</span></span>
<span id="cb107-973"><a href="#cb107-973" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_discrete</span>(<span class="at">labels =</span> <span class="fu">rev</span>(<span class="fu">c</span>(<span class="st">"int_WB"</span>, <span class="st">"int_OL"</span>, <span class="st">"int_OS"</span>, <span class="st">"int_IS"</span>)), <span class="at">limits =</span> rev) <span class="sc">+</span> </span>
<span id="cb107-974"><a href="#cb107-974" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylab</span>(<span class="st">"Intercepts"</span>) <span class="sc">+</span></span>
<span id="cb107-975"><a href="#cb107-975" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>()</span>
<span id="cb107-976"><a href="#cb107-976" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb107-977"><a href="#cb107-977" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb107-978"><a href="#cb107-978" aria-hidden="true" tabindex="-1"></a>Slopes, temperature effect</span>
<span id="cb107-981"><a href="#cb107-981" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb107-982"><a href="#cb107-982" aria-hidden="true" tabindex="-1"></a>ggfit <span class="sc">%&gt;%</span></span>
<span id="cb107-983"><a href="#cb107-983" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(Iteration <span class="sc">&gt;</span> <span class="dv">125</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb107-984"><a href="#cb107-984" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(Parameter <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"B.site[1,2]"</span>, <span class="st">"B.site[2,2]"</span>, <span class="st">"B.site[3,2]"</span>, <span class="st">"B.site[4,2]"</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb107-985"><a href="#cb107-985" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Parameter =</span> <span class="fu">factor</span>(Parameter, <span class="at">levels =</span> <span class="fu">c</span>(<span class="st">"B.site[1,2]"</span>, <span class="st">"B.site[2,2]"</span>, <span class="st">"B.site[3,2]"</span>, <span class="st">"B.site[4,2]"</span>))) <span class="sc">%&gt;%</span></span>
<span id="cb107-986"><a href="#cb107-986" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggs_caterpillar</span>(<span class="at">sort =</span> <span class="cn">FALSE</span>) <span class="sc">+</span></span>
<span id="cb107-987"><a href="#cb107-987" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_discrete</span>(<span class="at">labels =</span> <span class="fu">rev</span>(<span class="fu">c</span>(<span class="st">"slo_WB"</span>, <span class="st">"slo_OL"</span>, <span class="st">"slo_OS"</span>, <span class="st">"slo_IS"</span>)), <span class="at">limits =</span> rev) <span class="sc">+</span> </span>
<span id="cb107-988"><a href="#cb107-988" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylab</span>(<span class="st">"Slopes, temperature effect"</span>) <span class="sc">+</span></span>
<span id="cb107-989"><a href="#cb107-989" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>()</span>
<span id="cb107-990"><a href="#cb107-990" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb107-991"><a href="#cb107-991" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb107-992"><a href="#cb107-992" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb107-993"><a href="#cb107-993" aria-hidden="true" tabindex="-1"></a><span class="fu">## Hierarchical, flow var.</span></span>
<span id="cb107-994"><a href="#cb107-994" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb107-995"><a href="#cb107-995" aria-hidden="true" tabindex="-1"></a>Use the same hierarchical model as above, but allow effect of flow and flow-temp interaction to vary by site. </span>
<span id="cb107-996"><a href="#cb107-996" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb107-997"><a href="#cb107-997" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb107-998"><a href="#cb107-998" aria-hidden="true" tabindex="-1"></a><span class="fu">### Organize objects</span></span>
<span id="cb107-999"><a href="#cb107-999" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb107-1000"><a href="#cb107-1000" aria-hidden="true" tabindex="-1"></a>Get first observation indices and check that nFirstRowObs equals the number of unique site-years: **must be TRUE!**</span>
<span id="cb107-1003"><a href="#cb107-1003" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb107-1004"><a href="#cb107-1004" aria-hidden="true" tabindex="-1"></a><span class="co"># row indices for first observation in each site-year</span></span>
<span id="cb107-1005"><a href="#cb107-1005" aria-hidden="true" tabindex="-1"></a>firstObsRows <span class="ot">&lt;-</span> <span class="fu">unlist</span>(tempDataSyncS <span class="sc">%&gt;%</span> </span>
<span id="cb107-1006"><a href="#cb107-1006" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(siteYear) <span class="sc">%&gt;%</span></span>
<span id="cb107-1007"><a href="#cb107-1007" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="at">index =</span> rowNum[<span class="fu">min</span>(<span class="fu">which</span>(<span class="sc">!</span><span class="fu">is.na</span>(temp)))]) <span class="sc">%&gt;%</span></span>
<span id="cb107-1008"><a href="#cb107-1008" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb107-1009"><a href="#cb107-1009" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(index))</span>
<span id="cb107-1010"><a href="#cb107-1010" aria-hidden="true" tabindex="-1"></a>nFirstObsRows <span class="ot">&lt;-</span> <span class="fu">length</span>(firstObsRows)</span>
<span id="cb107-1011"><a href="#cb107-1011" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb107-1012"><a href="#cb107-1012" aria-hidden="true" tabindex="-1"></a><span class="co"># does the number of first observations match the number of site years?</span></span>
<span id="cb107-1013"><a href="#cb107-1013" aria-hidden="true" tabindex="-1"></a>nFirstObsRows <span class="sc">==</span> <span class="fu">length</span>(<span class="fu">unique</span>(tempDataSyncS<span class="sc">$</span>siteYear))</span>
<span id="cb107-1014"><a href="#cb107-1014" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb107-1015"><a href="#cb107-1015" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb107-1016"><a href="#cb107-1016" aria-hidden="true" tabindex="-1"></a>Get row indices for all other observations</span>
<span id="cb107-1019"><a href="#cb107-1019" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb107-1020"><a href="#cb107-1020" aria-hidden="true" tabindex="-1"></a>evalRows <span class="ot">&lt;-</span> <span class="fu">unlist</span>(tempDataSyncS <span class="sc">%&gt;%</span> <span class="fu">filter</span>(<span class="sc">!</span>rowNum <span class="sc">%in%</span> firstObsRows) <span class="sc">%&gt;%</span> <span class="fu">select</span>(rowNum))</span>
<span id="cb107-1021"><a href="#cb107-1021" aria-hidden="true" tabindex="-1"></a>nEvalRows <span class="ot">&lt;-</span> <span class="fu">length</span>(evalRows)</span>
<span id="cb107-1022"><a href="#cb107-1022" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb107-1023"><a href="#cb107-1023" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb107-1024"><a href="#cb107-1024" aria-hidden="true" tabindex="-1"></a>Fixed and random effect data</span>
<span id="cb107-1027"><a href="#cb107-1027" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb107-1028"><a href="#cb107-1028" aria-hidden="true" tabindex="-1"></a>data.random <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">intercept =</span> <span class="dv">1</span>,</span>
<span id="cb107-1029"><a href="#cb107-1029" aria-hidden="true" tabindex="-1"></a>                          <span class="at">airTemp =</span> tempDataSyncS<span class="sc">$</span>airTemp, </span>
<span id="cb107-1030"><a href="#cb107-1030" aria-hidden="true" tabindex="-1"></a>                          <span class="at">flow =</span>  tempDataSyncS<span class="sc">$</span>flowLS,</span>
<span id="cb107-1031"><a href="#cb107-1031" aria-hidden="true" tabindex="-1"></a>                          <span class="at">airFlow =</span> tempDataSyncS<span class="sc">$</span>airTemp <span class="sc">*</span> tempDataSyncS<span class="sc">$</span>flowLS)</span>
<span id="cb107-1032"><a href="#cb107-1032" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb107-1033"><a href="#cb107-1033" aria-hidden="true" tabindex="-1"></a>data.fixed <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="co">#intercept = 1</span></span>
<span id="cb107-1034"><a href="#cb107-1034" aria-hidden="true" tabindex="-1"></a>                         <span class="co">#,airTemp = tempDataSyncS$airTemp </span></span>
<span id="cb107-1035"><a href="#cb107-1035" aria-hidden="true" tabindex="-1"></a>                         <span class="at">airTempLag1 =</span> tempDataSyncS<span class="sc">$</span>airTempLagged1</span>
<span id="cb107-1036"><a href="#cb107-1036" aria-hidden="true" tabindex="-1"></a>                         ,<span class="at">airTempLag2 =</span> tempDataSyncS<span class="sc">$</span>airTempLagged2</span>
<span id="cb107-1037"><a href="#cb107-1037" aria-hidden="true" tabindex="-1"></a>                         </span>
<span id="cb107-1038"><a href="#cb107-1038" aria-hidden="true" tabindex="-1"></a>                         <span class="co"># ,flow =  tempDataSyncS$flowLS</span></span>
<span id="cb107-1039"><a href="#cb107-1039" aria-hidden="true" tabindex="-1"></a>                         <span class="co"># </span></span>
<span id="cb107-1040"><a href="#cb107-1040" aria-hidden="true" tabindex="-1"></a>                         <span class="co"># ,airFlow = tempDataSyncS$airTemp * tempDataSyncS$flowLS</span></span>
<span id="cb107-1041"><a href="#cb107-1041" aria-hidden="true" tabindex="-1"></a><span class="co">#                         ,air1Flow = tempDataSyncS$airTempLagged1 * tempDataSyncS$flowLS</span></span>
<span id="cb107-1042"><a href="#cb107-1042" aria-hidden="true" tabindex="-1"></a><span class="co">#                         ,air2Flow = tempDataSyncS$airTempLagged2 * tempDataSyncS$flowLS</span></span>
<span id="cb107-1043"><a href="#cb107-1043" aria-hidden="true" tabindex="-1"></a>                         </span>
<span id="cb107-1044"><a href="#cb107-1044" aria-hidden="true" tabindex="-1"></a>                         <span class="co">#main river effects</span></span>
<span id="cb107-1045"><a href="#cb107-1045" aria-hidden="true" tabindex="-1"></a>                         <span class="co"># ,river1 = tempDataSyncS$river1</span></span>
<span id="cb107-1046"><a href="#cb107-1046" aria-hidden="true" tabindex="-1"></a>                         <span class="co"># ,river2 = tempDataSyncS$river2</span></span>
<span id="cb107-1047"><a href="#cb107-1047" aria-hidden="true" tabindex="-1"></a>                         <span class="co"># ,river3 = tempDataSyncS$river3</span></span>
<span id="cb107-1048"><a href="#cb107-1048" aria-hidden="true" tabindex="-1"></a>                         <span class="co"># </span></span>
<span id="cb107-1049"><a href="#cb107-1049" aria-hidden="true" tabindex="-1"></a>                         <span class="co"># #river interaction with air temp</span></span>
<span id="cb107-1050"><a href="#cb107-1050" aria-hidden="true" tabindex="-1"></a>                         <span class="co"># ,river1Air = tempDataSyncS$river1 * tempDataSyncS$airTemp</span></span>
<span id="cb107-1051"><a href="#cb107-1051" aria-hidden="true" tabindex="-1"></a>                         <span class="co"># ,river2Air = tempDataSyncS$river2 * tempDataSyncS$airTemp</span></span>
<span id="cb107-1052"><a href="#cb107-1052" aria-hidden="true" tabindex="-1"></a>                         <span class="co"># ,river3Air = tempDataSyncS$river3 * tempDataSyncS$airTemp</span></span>
<span id="cb107-1053"><a href="#cb107-1053" aria-hidden="true" tabindex="-1"></a>                         </span>
<span id="cb107-1054"><a href="#cb107-1054" aria-hidden="true" tabindex="-1"></a>                          ) </span>
<span id="cb107-1055"><a href="#cb107-1055" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb107-1056"><a href="#cb107-1056" aria-hidden="true" tabindex="-1"></a>data.random.years <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">intercept.year =</span> <span class="dv">1</span>, </span>
<span id="cb107-1057"><a href="#cb107-1057" aria-hidden="true" tabindex="-1"></a>                     <span class="at">dOY  =</span> tempDataSyncS<span class="sc">$</span>dOY, </span>
<span id="cb107-1058"><a href="#cb107-1058" aria-hidden="true" tabindex="-1"></a>                     <span class="at">dOY2 =</span> tempDataSyncS<span class="sc">$</span>dOY<span class="sc">^</span><span class="dv">2</span>,</span>
<span id="cb107-1059"><a href="#cb107-1059" aria-hidden="true" tabindex="-1"></a>                     <span class="at">dOY3 =</span> tempDataSyncS<span class="sc">$</span>dOY<span class="sc">^</span><span class="dv">3</span></span>
<span id="cb107-1060"><a href="#cb107-1060" aria-hidden="true" tabindex="-1"></a>                     )</span>
<span id="cb107-1061"><a href="#cb107-1061" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb107-1062"><a href="#cb107-1062" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb107-1063"><a href="#cb107-1063" aria-hidden="true" tabindex="-1"></a>Misc. objects</span>
<span id="cb107-1066"><a href="#cb107-1066" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb107-1067"><a href="#cb107-1067" aria-hidden="true" tabindex="-1"></a>Ti <span class="ot">&lt;-</span> <span class="fu">length</span>(<span class="fu">unique</span>(tempDataSyncS<span class="sc">$</span>year))</span>
<span id="cb107-1068"><a href="#cb107-1068" aria-hidden="true" tabindex="-1"></a>L <span class="ot">&lt;-</span> <span class="fu">dim</span>(data.random.years)[<span class="dv">2</span>]</span>
<span id="cb107-1069"><a href="#cb107-1069" aria-hidden="true" tabindex="-1"></a>W.year <span class="ot">&lt;-</span> <span class="fu">diag</span>(L)</span>
<span id="cb107-1070"><a href="#cb107-1070" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb107-1071"><a href="#cb107-1071" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb107-1072"><a href="#cb107-1072" aria-hidden="true" tabindex="-1"></a>Combine data in list</span>
<span id="cb107-1075"><a href="#cb107-1075" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb107-1076"><a href="#cb107-1076" aria-hidden="true" tabindex="-1"></a><span class="co"># combine data in a list</span></span>
<span id="cb107-1077"><a href="#cb107-1077" aria-hidden="true" tabindex="-1"></a>jags.data <span class="ot">&lt;-</span> <span class="fu">list</span>(<span class="st">"temp"</span> <span class="ot">=</span> tempDataSyncS<span class="sc">$</span>temp,</span>
<span id="cb107-1078"><a href="#cb107-1078" aria-hidden="true" tabindex="-1"></a>                  <span class="st">"nFirstObsRows"</span> <span class="ot">=</span> nFirstObsRows,</span>
<span id="cb107-1079"><a href="#cb107-1079" aria-hidden="true" tabindex="-1"></a>                  <span class="st">"firstObsRows"</span> <span class="ot">=</span> firstObsRows,</span>
<span id="cb107-1080"><a href="#cb107-1080" aria-hidden="true" tabindex="-1"></a>                  <span class="st">"nEvalRows"</span> <span class="ot">=</span> nEvalRows,</span>
<span id="cb107-1081"><a href="#cb107-1081" aria-hidden="true" tabindex="-1"></a>                  <span class="st">"evalRows"</span> <span class="ot">=</span> evalRows,</span>
<span id="cb107-1082"><a href="#cb107-1082" aria-hidden="true" tabindex="-1"></a>                  <span class="st">"X.0"</span> <span class="ot">=</span> <span class="fu">as.matrix</span>(data.fixed),</span>
<span id="cb107-1083"><a href="#cb107-1083" aria-hidden="true" tabindex="-1"></a>                  <span class="st">"X.site"</span> <span class="ot">=</span> <span class="fu">as.matrix</span>(data.random),</span>
<span id="cb107-1084"><a href="#cb107-1084" aria-hidden="true" tabindex="-1"></a>                  <span class="st">"X.year"</span> <span class="ot">=</span> <span class="fu">as.matrix</span>(data.random.years),</span>
<span id="cb107-1085"><a href="#cb107-1085" aria-hidden="true" tabindex="-1"></a>                  <span class="st">"Kfixed"</span> <span class="ot">=</span> <span class="fu">dim</span>(data.fixed)[<span class="dv">2</span>],</span>
<span id="cb107-1086"><a href="#cb107-1086" aria-hidden="true" tabindex="-1"></a>                  <span class="st">"Krandom"</span> <span class="ot">=</span> <span class="fu">dim</span>(data.random)[<span class="dv">2</span>],</span>
<span id="cb107-1087"><a href="#cb107-1087" aria-hidden="true" tabindex="-1"></a>                  <span class="st">"nsites"</span> <span class="ot">=</span> <span class="fu">length</span>(<span class="fu">unique</span>(tempDataSyncS<span class="sc">$</span>site)),</span>
<span id="cb107-1088"><a href="#cb107-1088" aria-hidden="true" tabindex="-1"></a>                  <span class="st">"Ti"</span> <span class="ot">=</span> Ti,</span>
<span id="cb107-1089"><a href="#cb107-1089" aria-hidden="true" tabindex="-1"></a>                  <span class="st">"L"</span> <span class="ot">=</span> L,</span>
<span id="cb107-1090"><a href="#cb107-1090" aria-hidden="true" tabindex="-1"></a>                  <span class="st">"W.year"</span> <span class="ot">=</span> W.year,</span>
<span id="cb107-1091"><a href="#cb107-1091" aria-hidden="true" tabindex="-1"></a>                  <span class="st">"n"</span> <span class="ot">=</span> <span class="fu">dim</span>(tempDataSyncS)[<span class="dv">1</span>],</span>
<span id="cb107-1092"><a href="#cb107-1092" aria-hidden="true" tabindex="-1"></a>                  <span class="st">"year"</span> <span class="ot">=</span> <span class="fu">as.factor</span>(tempDataSyncS<span class="sc">$</span>year),</span>
<span id="cb107-1093"><a href="#cb107-1093" aria-hidden="true" tabindex="-1"></a>                  <span class="st">"site"</span> <span class="ot">=</span> <span class="fu">as.numeric</span>(tempDataSyncS<span class="sc">$</span>riverOrdered)</span>
<span id="cb107-1094"><a href="#cb107-1094" aria-hidden="true" tabindex="-1"></a>                  )</span>
<span id="cb107-1095"><a href="#cb107-1095" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb107-1096"><a href="#cb107-1096" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb107-1097"><a href="#cb107-1097" aria-hidden="true" tabindex="-1"></a>Parameters to monitor</span>
<span id="cb107-1100"><a href="#cb107-1100" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb107-1101"><a href="#cb107-1101" aria-hidden="true" tabindex="-1"></a>jags.params <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"residuals"</span>,</span>
<span id="cb107-1102"><a href="#cb107-1102" aria-hidden="true" tabindex="-1"></a>            <span class="st">"deviance"</span>,</span>
<span id="cb107-1103"><a href="#cb107-1103" aria-hidden="true" tabindex="-1"></a>            <span class="co">#"pD",</span></span>
<span id="cb107-1104"><a href="#cb107-1104" aria-hidden="true" tabindex="-1"></a>            <span class="st">"sigma"</span>,</span>
<span id="cb107-1105"><a href="#cb107-1105" aria-hidden="true" tabindex="-1"></a>            <span class="st">"B.0"</span>,</span>
<span id="cb107-1106"><a href="#cb107-1106" aria-hidden="true" tabindex="-1"></a>            <span class="st">"B.site"</span>,</span>
<span id="cb107-1107"><a href="#cb107-1107" aria-hidden="true" tabindex="-1"></a>            <span class="st">"B.year"</span>,</span>
<span id="cb107-1108"><a href="#cb107-1108" aria-hidden="true" tabindex="-1"></a>            <span class="co">#"mu.B.river",</span></span>
<span id="cb107-1109"><a href="#cb107-1109" aria-hidden="true" tabindex="-1"></a>            <span class="st">"rho.B.year"</span>,</span>
<span id="cb107-1110"><a href="#cb107-1110" aria-hidden="true" tabindex="-1"></a>            <span class="st">"mu.year"</span>,</span>
<span id="cb107-1111"><a href="#cb107-1111" aria-hidden="true" tabindex="-1"></a>            <span class="st">"sigma.b.year"</span>,</span>
<span id="cb107-1112"><a href="#cb107-1112" aria-hidden="true" tabindex="-1"></a>            <span class="st">"stream.mu"</span>,</span>
<span id="cb107-1113"><a href="#cb107-1113" aria-hidden="true" tabindex="-1"></a>            <span class="st">"ar1"</span> ,</span>
<span id="cb107-1114"><a href="#cb107-1114" aria-hidden="true" tabindex="-1"></a>            <span class="st">"ar1Mean"</span>,</span>
<span id="cb107-1115"><a href="#cb107-1115" aria-hidden="true" tabindex="-1"></a>            <span class="st">"ar1SD"</span>,</span>
<span id="cb107-1116"><a href="#cb107-1116" aria-hidden="true" tabindex="-1"></a>            <span class="st">"temp"</span>,</span>
<span id="cb107-1117"><a href="#cb107-1117" aria-hidden="true" tabindex="-1"></a>            <span class="st">"sigma.B.site"</span></span>
<span id="cb107-1118"><a href="#cb107-1118" aria-hidden="true" tabindex="-1"></a>            )</span>
<span id="cb107-1119"><a href="#cb107-1119" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb107-1120"><a href="#cb107-1120" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb107-1121"><a href="#cb107-1121" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb107-1122"><a href="#cb107-1122" aria-hidden="true" tabindex="-1"></a><span class="fu">### Fit model</span></span>
<span id="cb107-1123"><a href="#cb107-1123" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb107-1124"><a href="#cb107-1124" aria-hidden="true" tabindex="-1"></a><span class="in">```{r eval=FALSE}</span></span>
<span id="cb107-1125"><a href="#cb107-1125" aria-hidden="true" tabindex="-1"></a>fit0_h2 <span class="ot">&lt;-</span> <span class="fu">jags.parallel</span>(<span class="at">data =</span> jags.data, <span class="at">inits =</span> <span class="cn">NULL</span>, <span class="at">parameters.to.save =</span> jags.params, </span>
<span id="cb107-1126"><a href="#cb107-1126" aria-hidden="true" tabindex="-1"></a>                         <span class="at">model.file =</span> <span class="st">"JAGS models/DailyTempModelJAGS_Letcher_hierarchical.txt"</span>,</span>
<span id="cb107-1127"><a href="#cb107-1127" aria-hidden="true" tabindex="-1"></a>                         <span class="at">n.chains =</span> <span class="dv">10</span>, <span class="at">n.thin =</span> <span class="dv">10</span>, <span class="at">n.burnin =</span> <span class="dv">1000</span>, <span class="at">n.iter =</span> <span class="dv">3000</span>, <span class="at">DIC =</span> <span class="cn">TRUE</span>)</span>
<span id="cb107-1128"><a href="#cb107-1128" aria-hidden="true" tabindex="-1"></a><span class="fu">beep</span>()</span>
<span id="cb107-1129"><a href="#cb107-1129" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb107-1130"><a href="#cb107-1130" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb107-1131"><a href="#cb107-1131" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb107-1132"><a href="#cb107-1132" aria-hidden="true" tabindex="-1"></a><span class="fu">#### Save model ouput</span></span>
<span id="cb107-1133"><a href="#cb107-1133" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb107-1134"><a href="#cb107-1134" aria-hidden="true" tabindex="-1"></a>Save to file</span>
<span id="cb107-1135"><a href="#cb107-1135" aria-hidden="true" tabindex="-1"></a><span class="in">```{r eval=FALSE}</span></span>
<span id="cb107-1136"><a href="#cb107-1136" aria-hidden="true" tabindex="-1"></a><span class="fu">saveRDS</span>(fit0_h2, <span class="st">"Model objects/LetcherTempModel_PeerJ2016_hierarchical.RDS"</span>)</span>
<span id="cb107-1137"><a href="#cb107-1137" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb107-1138"><a href="#cb107-1138" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb107-1139"><a href="#cb107-1139" aria-hidden="true" tabindex="-1"></a>Read in fitted model object</span>
<span id="cb107-1142"><a href="#cb107-1142" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb107-1143"><a href="#cb107-1143" aria-hidden="true" tabindex="-1"></a>fit0_h2 <span class="ot">&lt;-</span> <span class="fu">readRDS</span>(<span class="st">"Model objects/LetcherTempModel_PeerJ2016_hierarchical.RDS"</span>)</span>
<span id="cb107-1144"><a href="#cb107-1144" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb107-1145"><a href="#cb107-1145" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb107-1146"><a href="#cb107-1146" aria-hidden="true" tabindex="-1"></a>Get MCMC samples and summary</span>
<span id="cb107-1149"><a href="#cb107-1149" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb107-1150"><a href="#cb107-1150" aria-hidden="true" tabindex="-1"></a>top_mod <span class="ot">&lt;-</span> fit0_h2</span>
<span id="cb107-1151"><a href="#cb107-1151" aria-hidden="true" tabindex="-1"></a><span class="co"># generate MCMC samples and store as an array</span></span>
<span id="cb107-1152"><a href="#cb107-1152" aria-hidden="true" tabindex="-1"></a>modelout <span class="ot">&lt;-</span> top_mod<span class="sc">$</span>BUGSoutput</span>
<span id="cb107-1153"><a href="#cb107-1153" aria-hidden="true" tabindex="-1"></a>McmcList <span class="ot">&lt;-</span> <span class="fu">vector</span>(<span class="st">"list"</span>, <span class="at">length =</span> <span class="fu">dim</span>(modelout<span class="sc">$</span>sims.array)[<span class="dv">2</span>])</span>
<span id="cb107-1154"><a href="#cb107-1154" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(McmcList)) { McmcList[[i]] <span class="ot">=</span> <span class="fu">as.mcmc</span>(modelout<span class="sc">$</span>sims.array[,i,]) }</span>
<span id="cb107-1155"><a href="#cb107-1155" aria-hidden="true" tabindex="-1"></a><span class="co"># rbind MCMC samples from 10 chains </span></span>
<span id="cb107-1156"><a href="#cb107-1156" aria-hidden="true" tabindex="-1"></a>Mcmcdat <span class="ot">&lt;-</span> <span class="fu">rbind</span>(McmcList[[<span class="dv">1</span>]], McmcList[[<span class="dv">2</span>]], McmcList[[<span class="dv">3</span>]], McmcList[[<span class="dv">4</span>]], McmcList[[<span class="dv">5</span>]], McmcList[[<span class="dv">6</span>]], McmcList[[<span class="dv">7</span>]], McmcList[[<span class="dv">8</span>]], McmcList[[<span class="dv">9</span>]], McmcList[[<span class="dv">10</span>]])</span>
<span id="cb107-1157"><a href="#cb107-1157" aria-hidden="true" tabindex="-1"></a>param.summary <span class="ot">&lt;-</span> modelout<span class="sc">$</span>summary</span>
<span id="cb107-1158"><a href="#cb107-1158" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(param.summary)</span>
<span id="cb107-1159"><a href="#cb107-1159" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb107-1160"><a href="#cb107-1160" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb107-1161"><a href="#cb107-1161" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb107-1162"><a href="#cb107-1162" aria-hidden="true" tabindex="-1"></a><span class="fu">#### Check convergence</span></span>
<span id="cb107-1163"><a href="#cb107-1163" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb107-1164"><a href="#cb107-1164" aria-hidden="true" tabindex="-1"></a>Any problematic R-hat values (&gt;1.05)?</span>
<span id="cb107-1167"><a href="#cb107-1167" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb107-1168"><a href="#cb107-1168" aria-hidden="true" tabindex="-1"></a>top_mod<span class="sc">$</span>BUGSoutput<span class="sc">$</span>summary[,<span class="dv">8</span>][top_mod<span class="sc">$</span>BUGSoutput<span class="sc">$</span>summary[,<span class="dv">8</span>] <span class="sc">&gt;</span> <span class="fl">1.05</span>]</span>
<span id="cb107-1169"><a href="#cb107-1169" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb107-1170"><a href="#cb107-1170" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb107-1171"><a href="#cb107-1171" aria-hidden="true" tabindex="-1"></a>View traceplots</span>
<span id="cb107-1174"><a href="#cb107-1174" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb107-1175"><a href="#cb107-1175" aria-hidden="true" tabindex="-1"></a><span class="fu">MCMCtrace</span>(top_mod, <span class="at">ind =</span> <span class="cn">TRUE</span>, </span>
<span id="cb107-1176"><a href="#cb107-1176" aria-hidden="true" tabindex="-1"></a>          <span class="at">params =</span> <span class="fu">c</span>(<span class="st">"B.0"</span>, <span class="st">"B.site"</span>, <span class="st">"mu.year"</span>, </span>
<span id="cb107-1177"><a href="#cb107-1177" aria-hidden="true" tabindex="-1"></a>                     <span class="st">"ar1"</span>, </span>
<span id="cb107-1178"><a href="#cb107-1178" aria-hidden="true" tabindex="-1"></a>                     <span class="st">"sigma"</span>), <span class="at">pdf =</span> <span class="cn">FALSE</span>)</span>
<span id="cb107-1179"><a href="#cb107-1179" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb107-1180"><a href="#cb107-1180" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb107-1181"><a href="#cb107-1181" aria-hidden="true" tabindex="-1"></a>Convert to ggs object</span>
<span id="cb107-1184"><a href="#cb107-1184" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb107-1185"><a href="#cb107-1185" aria-hidden="true" tabindex="-1"></a>ggfit <span class="ot">&lt;-</span> <span class="fu">ggs</span>(<span class="fu">as.mcmc</span>(top_mod), <span class="at">keep_original_order =</span> <span class="cn">TRUE</span>)</span>
<span id="cb107-1186"><a href="#cb107-1186" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(ggfit)</span>
<span id="cb107-1187"><a href="#cb107-1187" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb107-1188"><a href="#cb107-1188" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb107-1189"><a href="#cb107-1189" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb107-1190"><a href="#cb107-1190" aria-hidden="true" tabindex="-1"></a><span class="fu">### Goodness of fit</span></span>
<span id="cb107-1191"><a href="#cb107-1191" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb107-1192"><a href="#cb107-1192" aria-hidden="true" tabindex="-1"></a>Format observed and predicted values</span>
<span id="cb107-1195"><a href="#cb107-1195" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb107-1196"><a href="#cb107-1196" aria-hidden="true" tabindex="-1"></a>Mcmcdat <span class="ot">&lt;-</span> <span class="fu">as_tibble</span>(Mcmcdat)</span>
<span id="cb107-1197"><a href="#cb107-1197" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb107-1198"><a href="#cb107-1198" aria-hidden="true" tabindex="-1"></a><span class="co"># subset expected and observed MCMC samples</span></span>
<span id="cb107-1199"><a href="#cb107-1199" aria-hidden="true" tabindex="-1"></a>ppdat_exp <span class="ot">&lt;-</span> <span class="fu">as.matrix</span>(Mcmcdat[,<span class="fu">startsWith</span>(<span class="fu">names</span>(Mcmcdat), <span class="st">"stream.mu["</span>)])</span>
<span id="cb107-1200"><a href="#cb107-1200" aria-hidden="true" tabindex="-1"></a>ppdat_obs <span class="ot">&lt;-</span> <span class="fu">as.matrix</span>(Mcmcdat[,<span class="fu">startsWith</span>(<span class="fu">names</span>(Mcmcdat), <span class="st">"temp["</span>)])</span>
<span id="cb107-1201"><a href="#cb107-1201" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb107-1202"><a href="#cb107-1202" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb107-1203"><a href="#cb107-1203" aria-hidden="true" tabindex="-1"></a>Bayesian p-value</span>
<span id="cb107-1206"><a href="#cb107-1206" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb107-1207"><a href="#cb107-1207" aria-hidden="true" tabindex="-1"></a><span class="fu">sum</span>(ppdat_exp <span class="sc">&gt;</span> ppdat_obs) <span class="sc">/</span> (<span class="fu">dim</span>(ppdat_obs)[<span class="dv">1</span>]<span class="sc">*</span><span class="fu">dim</span>(ppdat_obs)[<span class="dv">2</span>])</span>
<span id="cb107-1208"><a href="#cb107-1208" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb107-1209"><a href="#cb107-1209" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb107-1210"><a href="#cb107-1210" aria-hidden="true" tabindex="-1"></a>PP-check</span>
<span id="cb107-1213"><a href="#cb107-1213" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb107-1214"><a href="#cb107-1214" aria-hidden="true" tabindex="-1"></a>ppdat_obs_mean <span class="ot">&lt;-</span> <span class="fu">apply</span>(ppdat_obs, <span class="dv">2</span>, mean)</span>
<span id="cb107-1215"><a href="#cb107-1215" aria-hidden="true" tabindex="-1"></a>ppdat_exp_mean <span class="ot">&lt;-</span> <span class="fu">apply</span>(ppdat_exp, <span class="dv">2</span>, mean)</span>
<span id="cb107-1216"><a href="#cb107-1216" aria-hidden="true" tabindex="-1"></a><span class="fu">tibble</span>(<span class="at">obs =</span> ppdat_obs_mean, <span class="at">exp =</span> ppdat_exp_mean) <span class="sc">%&gt;%</span> </span>
<span id="cb107-1217"><a href="#cb107-1217" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> obs, <span class="at">y =</span> exp)) <span class="sc">+</span> </span>
<span id="cb107-1218"><a href="#cb107-1218" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">alpha =</span> <span class="fl">0.1</span>) <span class="sc">+</span> </span>
<span id="cb107-1219"><a href="#cb107-1219" aria-hidden="true" tabindex="-1"></a>  <span class="co"># geom_smooth(method = "lm") +</span></span>
<span id="cb107-1220"><a href="#cb107-1220" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_abline</span>(<span class="at">intercept =</span> <span class="dv">0</span>, <span class="at">slope =</span> <span class="dv">1</span>, <span class="at">color =</span> <span class="st">"red"</span>) <span class="sc">+</span> </span>
<span id="cb107-1221"><a href="#cb107-1221" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>() <span class="sc">+</span> <span class="fu">theme</span>(<span class="at">panel.grid =</span> <span class="fu">element_blank</span>()) <span class="sc">+</span></span>
<span id="cb107-1222"><a href="#cb107-1222" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="st">"Observed"</span>) <span class="sc">+</span> <span class="fu">ylab</span>(<span class="st">"Predicted (mean)"</span>)</span>
<span id="cb107-1223"><a href="#cb107-1223" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb107-1224"><a href="#cb107-1224" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb107-1225"><a href="#cb107-1225" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb107-1226"><a href="#cb107-1226" aria-hidden="true" tabindex="-1"></a><span class="fu">### Plot model output</span></span>
<span id="cb107-1227"><a href="#cb107-1227" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb107-1228"><a href="#cb107-1228" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb107-1229"><a href="#cb107-1229" aria-hidden="true" tabindex="-1"></a><span class="fu">#### Dot plots</span></span>
<span id="cb107-1230"><a href="#cb107-1230" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb107-1231"><a href="#cb107-1231" aria-hidden="true" tabindex="-1"></a>::: panel-tabset</span>
<span id="cb107-1232"><a href="#cb107-1232" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb107-1233"><a href="#cb107-1233" aria-hidden="true" tabindex="-1"></a><span class="fu">##### Site intercepts</span></span>
<span id="cb107-1236"><a href="#cb107-1236" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb107-1237"><a href="#cb107-1237" aria-hidden="true" tabindex="-1"></a>ggfit <span class="sc">%&gt;%</span></span>
<span id="cb107-1238"><a href="#cb107-1238" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(Parameter <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"B.site[1,1]"</span>, <span class="st">"B.site[2,1]"</span>, <span class="st">"B.site[3,1]"</span>, <span class="st">"B.site[4,1]"</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb107-1239"><a href="#cb107-1239" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Parameter =</span> <span class="fu">factor</span>(Parameter, <span class="at">levels =</span> <span class="fu">c</span>(<span class="st">"B.site[1,1]"</span>, <span class="st">"B.site[2,1]"</span>, <span class="st">"B.site[3,1]"</span>, <span class="st">"B.site[4,1]"</span>))) <span class="sc">%&gt;%</span></span>
<span id="cb107-1240"><a href="#cb107-1240" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggs_caterpillar</span>(<span class="at">sort =</span> <span class="cn">FALSE</span>) <span class="sc">+</span></span>
<span id="cb107-1241"><a href="#cb107-1241" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_discrete</span>(<span class="at">labels =</span> <span class="fu">rev</span>(<span class="fu">c</span>(<span class="st">"int_WB"</span>, <span class="st">"int_OL"</span>, <span class="st">"int_OS"</span>, <span class="st">"int_IS"</span>)), <span class="at">limits =</span> rev) <span class="sc">+</span> </span>
<span id="cb107-1242"><a href="#cb107-1242" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylab</span>(<span class="st">"Intercepts"</span>) <span class="sc">+</span></span>
<span id="cb107-1243"><a href="#cb107-1243" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>()</span>
<span id="cb107-1244"><a href="#cb107-1244" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb107-1245"><a href="#cb107-1245" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb107-1246"><a href="#cb107-1246" aria-hidden="true" tabindex="-1"></a><span class="fu">##### Site slopes - temp</span></span>
<span id="cb107-1249"><a href="#cb107-1249" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb107-1250"><a href="#cb107-1250" aria-hidden="true" tabindex="-1"></a>ggfit <span class="sc">%&gt;%</span></span>
<span id="cb107-1251"><a href="#cb107-1251" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(Parameter <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"B.site[1,2]"</span>, <span class="st">"B.site[2,2]"</span>, <span class="st">"B.site[3,2]"</span>, <span class="st">"B.site[4,2]"</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb107-1252"><a href="#cb107-1252" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Parameter =</span> <span class="fu">factor</span>(Parameter, <span class="at">levels =</span> <span class="fu">c</span>(<span class="st">"B.site[1,2]"</span>, <span class="st">"B.site[2,2]"</span>, <span class="st">"B.site[3,2]"</span>, <span class="st">"B.site[4,2]"</span>))) <span class="sc">%&gt;%</span></span>
<span id="cb107-1253"><a href="#cb107-1253" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggs_caterpillar</span>(<span class="at">sort =</span> <span class="cn">FALSE</span>) <span class="sc">+</span></span>
<span id="cb107-1254"><a href="#cb107-1254" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_discrete</span>(<span class="at">labels =</span> <span class="fu">rev</span>(<span class="fu">c</span>(<span class="st">"slo_WB"</span>, <span class="st">"slo_OL"</span>, <span class="st">"slo_OS"</span>, <span class="st">"slo_IS"</span>)), <span class="at">limits =</span> rev) <span class="sc">+</span> </span>
<span id="cb107-1255"><a href="#cb107-1255" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylab</span>(<span class="st">"Slopes, temperature effect"</span>) <span class="sc">+</span></span>
<span id="cb107-1256"><a href="#cb107-1256" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>()</span>
<span id="cb107-1257"><a href="#cb107-1257" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb107-1258"><a href="#cb107-1258" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb107-1259"><a href="#cb107-1259" aria-hidden="true" tabindex="-1"></a><span class="fu">##### Site slopes - flow</span></span>
<span id="cb107-1262"><a href="#cb107-1262" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb107-1263"><a href="#cb107-1263" aria-hidden="true" tabindex="-1"></a>ggfit <span class="sc">%&gt;%</span></span>
<span id="cb107-1264"><a href="#cb107-1264" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(Parameter <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"B.site[1,3]"</span>, <span class="st">"B.site[2,3]"</span>, <span class="st">"B.site[3,3]"</span>, <span class="st">"B.site[4,3]"</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb107-1265"><a href="#cb107-1265" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Parameter =</span> <span class="fu">factor</span>(Parameter, <span class="at">levels =</span> <span class="fu">c</span>(<span class="st">"B.site[1,3]"</span>, <span class="st">"B.site[2,3]"</span>, <span class="st">"B.site[3,3]"</span>, <span class="st">"B.site[4,3]"</span>))) <span class="sc">%&gt;%</span></span>
<span id="cb107-1266"><a href="#cb107-1266" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggs_caterpillar</span>(<span class="at">sort =</span> <span class="cn">FALSE</span>) <span class="sc">+</span></span>
<span id="cb107-1267"><a href="#cb107-1267" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_discrete</span>(<span class="at">labels =</span> <span class="fu">rev</span>(<span class="fu">c</span>(<span class="st">"slo_WB"</span>, <span class="st">"slo_OL"</span>, <span class="st">"slo_OS"</span>, <span class="st">"slo_IS"</span>)), <span class="at">limits =</span> rev) <span class="sc">+</span> </span>
<span id="cb107-1268"><a href="#cb107-1268" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylab</span>(<span class="st">"Slopes, flow effect"</span>) <span class="sc">+</span></span>
<span id="cb107-1269"><a href="#cb107-1269" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>()</span>
<span id="cb107-1270"><a href="#cb107-1270" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb107-1271"><a href="#cb107-1271" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb107-1272"><a href="#cb107-1272" aria-hidden="true" tabindex="-1"></a><span class="fu">##### Site slopes - temp x flow</span></span>
<span id="cb107-1275"><a href="#cb107-1275" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb107-1276"><a href="#cb107-1276" aria-hidden="true" tabindex="-1"></a>ggfit <span class="sc">%&gt;%</span></span>
<span id="cb107-1277"><a href="#cb107-1277" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(Parameter <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"B.site[1,4]"</span>, <span class="st">"B.site[2,4]"</span>, <span class="st">"B.site[3,4]"</span>, <span class="st">"B.site[4,4]"</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb107-1278"><a href="#cb107-1278" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Parameter =</span> <span class="fu">factor</span>(Parameter, <span class="at">levels =</span> <span class="fu">c</span>(<span class="st">"B.site[1,4]"</span>, <span class="st">"B.site[2,4]"</span>, <span class="st">"B.site[3,4]"</span>, <span class="st">"B.site[4,4]"</span>))) <span class="sc">%&gt;%</span></span>
<span id="cb107-1279"><a href="#cb107-1279" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggs_caterpillar</span>(<span class="at">sort =</span> <span class="cn">FALSE</span>) <span class="sc">+</span></span>
<span id="cb107-1280"><a href="#cb107-1280" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_discrete</span>(<span class="at">labels =</span> <span class="fu">rev</span>(<span class="fu">c</span>(<span class="st">"slo_WB"</span>, <span class="st">"slo_OL"</span>, <span class="st">"slo_OS"</span>, <span class="st">"slo_IS"</span>)), <span class="at">limits =</span> rev) <span class="sc">+</span> </span>
<span id="cb107-1281"><a href="#cb107-1281" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylab</span>(<span class="st">"Slopes, temp-flow interaction"</span>) <span class="sc">+</span></span>
<span id="cb107-1282"><a href="#cb107-1282" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>()</span>
<span id="cb107-1283"><a href="#cb107-1283" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb107-1284"><a href="#cb107-1284" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb107-1285"><a href="#cb107-1285" aria-hidden="true" tabindex="-1"></a><span class="fu">##### Autoregressive terms</span></span>
<span id="cb107-1288"><a href="#cb107-1288" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb107-1289"><a href="#cb107-1289" aria-hidden="true" tabindex="-1"></a><span class="fu">ggs_caterpillar</span>(ggfit <span class="sc">%&gt;%</span> <span class="fu">filter</span>(Parameter <span class="sc">%in%</span> <span class="fu">grep</span>(<span class="st">"ar1"</span>, <span class="fu">unique</span>(ggfit<span class="sc">$</span>Parameter), <span class="at">value =</span> <span class="cn">TRUE</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb107-1290"><a href="#cb107-1290" aria-hidden="true" tabindex="-1"></a>                  <span class="fu">mutate</span>(<span class="at">Parameter =</span> <span class="fu">factor</span>(Parameter, <span class="at">levels =</span> <span class="fu">c</span>(<span class="st">"ar1Mean"</span>, <span class="st">"ar1SD"</span>, <span class="st">"ar1[1]"</span>, <span class="st">"ar1[2]"</span>, <span class="st">"ar1[3]"</span>, <span class="st">"ar1[4]"</span>))),</span>
<span id="cb107-1291"><a href="#cb107-1291" aria-hidden="true" tabindex="-1"></a>                <span class="at">sort =</span> <span class="cn">FALSE</span>) <span class="sc">+</span> <span class="fu">scale_y_discrete</span>(<span class="at">labels =</span> <span class="fu">rev</span>(<span class="fu">c</span>(<span class="st">"ar1Mean"</span>, <span class="st">"ar1SD"</span>, <span class="st">"ar1[WB]"</span>, <span class="st">"ar1[OL]"</span>, <span class="st">"ar1[OS]"</span>, <span class="st">"ar1[IL]"</span>)), <span class="at">limits =</span> rev) <span class="sc">+</span> <span class="fu">theme_bw</span>() <span class="sc">+</span> <span class="fu">xlim</span>(<span class="dv">0</span>,<span class="dv">1</span>)</span>
<span id="cb107-1292"><a href="#cb107-1292" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb107-1293"><a href="#cb107-1293" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb107-1294"><a href="#cb107-1294" aria-hidden="true" tabindex="-1"></a><span class="fu">##### Within year trends</span></span>
<span id="cb107-1297"><a href="#cb107-1297" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb107-1298"><a href="#cb107-1298" aria-hidden="true" tabindex="-1"></a><span class="fu">ggs_caterpillar</span>(ggfit, <span class="at">family =</span> <span class="st">"mu.year"</span>, <span class="at">sort =</span> <span class="cn">FALSE</span>) <span class="sc">+</span> <span class="fu">scale_y_discrete</span>(<span class="at">labels =</span> <span class="fu">rev</span>(<span class="fu">c</span>(<span class="st">"Intercept"</span>, <span class="st">"Linear"</span>, <span class="st">"Quadratic"</span>, <span class="st">"Cubic"</span>)), <span class="at">limits =</span> rev) <span class="sc">+</span> <span class="fu">theme_bw</span>()</span>
<span id="cb107-1299"><a href="#cb107-1299" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb107-1300"><a href="#cb107-1300" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb107-1301"><a href="#cb107-1301" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb107-1302"><a href="#cb107-1302" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb107-1303"><a href="#cb107-1303" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb107-1304"><a href="#cb107-1304" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb107-1305"><a href="#cb107-1305" aria-hidden="true" tabindex="-1"></a><span class="fu">#### Marginal efffects</span></span>
<span id="cb107-1306"><a href="#cb107-1306" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb107-1307"><a href="#cb107-1307" aria-hidden="true" tabindex="-1"></a>Marginal effects of air temperature x flow interaction, not accounting for lagged temperature effects, temporal autocorrelation, </span>
<span id="cb107-1308"><a href="#cb107-1308" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb107-1309"><a href="#cb107-1309" aria-hidden="true" tabindex="-1"></a>::: panel-tabset</span>
<span id="cb107-1310"><a href="#cb107-1310" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb107-1311"><a href="#cb107-1311" aria-hidden="true" tabindex="-1"></a><span class="fu">##### West Brook</span></span>
<span id="cb107-1312"><a href="#cb107-1312" aria-hidden="true" tabindex="-1"></a><span class="in">```{r fig.width=9, fig.height=4}</span></span>
<span id="cb107-1313"><a href="#cb107-1313" aria-hidden="true" tabindex="-1"></a><span class="co"># set up</span></span>
<span id="cb107-1314"><a href="#cb107-1314" aria-hidden="true" tabindex="-1"></a>np <span class="ot">&lt;-</span> <span class="dv">100</span></span>
<span id="cb107-1315"><a href="#cb107-1315" aria-hidden="true" tabindex="-1"></a>myriv <span class="ot">&lt;-</span> <span class="st">"WEST BROOK"</span></span>
<span id="cb107-1316"><a href="#cb107-1316" aria-hidden="true" tabindex="-1"></a>x_temp <span class="ot">&lt;-</span> <span class="fu">seq</span>(<span class="at">from =</span> <span class="fu">min</span>(tempDataSyncS<span class="sc">$</span>airTemp[tempDataSyncS<span class="sc">$</span>riverOrdered <span class="sc">==</span> myriv]),</span>
<span id="cb107-1317"><a href="#cb107-1317" aria-hidden="true" tabindex="-1"></a>              <span class="at">to =</span> <span class="fu">max</span>(tempDataSyncS<span class="sc">$</span>airTemp[tempDataSyncS<span class="sc">$</span>riverOrdered <span class="sc">==</span> myriv]),</span>
<span id="cb107-1318"><a href="#cb107-1318" aria-hidden="true" tabindex="-1"></a>              <span class="at">length.out =</span> np)</span>
<span id="cb107-1319"><a href="#cb107-1319" aria-hidden="true" tabindex="-1"></a>x_flow <span class="ot">&lt;-</span> <span class="fu">seq</span>(<span class="at">from =</span> <span class="fu">min</span>(tempDataSyncS<span class="sc">$</span>flowLS[tempDataSyncS<span class="sc">$</span>riverOrdered <span class="sc">==</span> myriv]),</span>
<span id="cb107-1320"><a href="#cb107-1320" aria-hidden="true" tabindex="-1"></a>              <span class="at">to =</span> <span class="fu">max</span>(tempDataSyncS<span class="sc">$</span>flowLS[tempDataSyncS<span class="sc">$</span>riverOrdered <span class="sc">==</span> myriv]),</span>
<span id="cb107-1321"><a href="#cb107-1321" aria-hidden="true" tabindex="-1"></a>              <span class="at">length.out =</span> np)</span>
<span id="cb107-1322"><a href="#cb107-1322" aria-hidden="true" tabindex="-1"></a>pred_df <span class="ot">&lt;-</span> <span class="fu">expand_grid</span>(x_temp, x_flow)</span>
<span id="cb107-1323"><a href="#cb107-1323" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb107-1324"><a href="#cb107-1324" aria-hidden="true" tabindex="-1"></a><span class="co"># predict from model</span></span>
<span id="cb107-1325"><a href="#cb107-1325" aria-hidden="true" tabindex="-1"></a>pred_df<span class="sc">$</span>pred <span class="ot">&lt;-</span> param.summary[<span class="st">"B.site[1,1]"</span>,<span class="dv">1</span>] <span class="sc">+</span> param.summary[<span class="st">"B.site[1,2]"</span>,<span class="dv">1</span>]<span class="sc">*</span>pred_df<span class="sc">$</span>x_temp <span class="sc">+</span> param.summary[<span class="st">"B.site[1,3]"</span>,<span class="dv">1</span>]<span class="sc">*</span>pred_df<span class="sc">$</span>x_flow <span class="sc">+</span> param.summary[<span class="st">"B.site[1,4]"</span>,<span class="dv">1</span>]<span class="sc">*</span>pred_df<span class="sc">$</span>x_temp<span class="sc">*</span>pred_df<span class="sc">$</span>x_flow</span>
<span id="cb107-1326"><a href="#cb107-1326" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb107-1327"><a href="#cb107-1327" aria-hidden="true" tabindex="-1"></a><span class="co"># lines </span></span>
<span id="cb107-1328"><a href="#cb107-1328" aria-hidden="true" tabindex="-1"></a>p1 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(pred_df, <span class="fu">aes</span>(<span class="at">x =</span> x_temp, <span class="at">y =</span> pred, <span class="at">color =</span> x_flow, <span class="at">group =</span> x_flow)) <span class="sc">+</span></span>
<span id="cb107-1329"><a href="#cb107-1329" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>() <span class="sc">+</span></span>
<span id="cb107-1330"><a href="#cb107-1330" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_distiller</span>(<span class="at">palette =</span> <span class="st">"BrBG"</span>, <span class="at">direction =</span> <span class="sc">+</span><span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb107-1331"><a href="#cb107-1331" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>() <span class="sc">+</span> <span class="fu">theme</span>(<span class="at">panel.grid =</span> <span class="fu">element_blank</span>()) <span class="sc">+</span></span>
<span id="cb107-1332"><a href="#cb107-1332" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">color =</span> <span class="st">"Flow"</span>) <span class="sc">+</span> <span class="fu">xlab</span>(<span class="st">"Air temperature"</span>) <span class="sc">+</span> <span class="fu">ylab</span>(<span class="st">"Water temperature"</span>) <span class="sc">+</span> <span class="fu">ylim</span>(<span class="fl">6.5</span>,<span class="dv">20</span>)</span>
<span id="cb107-1333"><a href="#cb107-1333" aria-hidden="true" tabindex="-1"></a><span class="co"># heatmap</span></span>
<span id="cb107-1334"><a href="#cb107-1334" aria-hidden="true" tabindex="-1"></a>p2 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(pred_df, <span class="fu">aes</span>(<span class="at">x =</span> x_temp, <span class="at">y =</span> x_flow)) <span class="sc">+</span></span>
<span id="cb107-1335"><a href="#cb107-1335" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_tile</span>(<span class="fu">aes</span>(<span class="at">fill =</span> pred)) <span class="sc">+</span></span>
<span id="cb107-1336"><a href="#cb107-1336" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_distiller</span>(<span class="at">palette =</span> <span class="st">"Spectral"</span>, <span class="at">limits =</span> <span class="fu">c</span>(<span class="fl">6.5</span>,<span class="dv">20</span>)) <span class="sc">+</span></span>
<span id="cb107-1337"><a href="#cb107-1337" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>() <span class="sc">+</span> <span class="fu">theme</span>(<span class="at">panel.grid =</span> <span class="fu">element_blank</span>()) <span class="sc">+</span></span>
<span id="cb107-1338"><a href="#cb107-1338" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(<span class="at">expand =</span> <span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">0</span>)) <span class="sc">+</span> <span class="fu">scale_y_continuous</span>(<span class="at">expand =</span> <span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">0</span>)) <span class="sc">+</span></span>
<span id="cb107-1339"><a href="#cb107-1339" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">fill =</span> <span class="st">"Water</span><span class="sc">\n</span><span class="st">temp."</span>) <span class="sc">+</span> <span class="fu">xlab</span>(<span class="st">"Air temperature"</span>) <span class="sc">+</span> <span class="fu">ylab</span>(<span class="st">"Flow"</span>) <span class="co">#+ </span></span>
<span id="cb107-1340"><a href="#cb107-1340" aria-hidden="true" tabindex="-1"></a>  <span class="co">#geom_point(data = tempDataSyncS %&gt;% filter(riverOrdered == myriv), aes(x = airTemp, y = flowLS, color = temp)) +</span></span>
<span id="cb107-1341"><a href="#cb107-1341" aria-hidden="true" tabindex="-1"></a>  <span class="co">#scale_color_distiller(palette = "Spectral", limits = c(0,23)) </span></span>
<span id="cb107-1342"><a href="#cb107-1342" aria-hidden="true" tabindex="-1"></a><span class="co"># combine</span></span>
<span id="cb107-1343"><a href="#cb107-1343" aria-hidden="true" tabindex="-1"></a>egg<span class="sc">::</span><span class="fu">ggarrange</span>(p1, p2, <span class="at">nrow =</span> <span class="dv">1</span>)</span>
<span id="cb107-1344"><a href="#cb107-1344" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb107-1345"><a href="#cb107-1345" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb107-1346"><a href="#cb107-1346" aria-hidden="true" tabindex="-1"></a><span class="fu">##### Jimmy</span></span>
<span id="cb107-1347"><a href="#cb107-1347" aria-hidden="true" tabindex="-1"></a><span class="in">```{r fig.width=9, fig.height=4}</span></span>
<span id="cb107-1348"><a href="#cb107-1348" aria-hidden="true" tabindex="-1"></a><span class="co"># set up</span></span>
<span id="cb107-1349"><a href="#cb107-1349" aria-hidden="true" tabindex="-1"></a>np <span class="ot">&lt;-</span> <span class="dv">100</span></span>
<span id="cb107-1350"><a href="#cb107-1350" aria-hidden="true" tabindex="-1"></a>myriv <span class="ot">&lt;-</span> <span class="st">"WB JIMMY"</span></span>
<span id="cb107-1351"><a href="#cb107-1351" aria-hidden="true" tabindex="-1"></a>x_temp <span class="ot">&lt;-</span> <span class="fu">seq</span>(<span class="at">from =</span> <span class="fu">min</span>(tempDataSyncS<span class="sc">$</span>airTemp[tempDataSyncS<span class="sc">$</span>riverOrdered <span class="sc">==</span> myriv]),</span>
<span id="cb107-1352"><a href="#cb107-1352" aria-hidden="true" tabindex="-1"></a>              <span class="at">to =</span> <span class="fu">max</span>(tempDataSyncS<span class="sc">$</span>airTemp[tempDataSyncS<span class="sc">$</span>riverOrdered <span class="sc">==</span> myriv]),</span>
<span id="cb107-1353"><a href="#cb107-1353" aria-hidden="true" tabindex="-1"></a>              <span class="at">length.out =</span> np)</span>
<span id="cb107-1354"><a href="#cb107-1354" aria-hidden="true" tabindex="-1"></a>x_flow <span class="ot">&lt;-</span> <span class="fu">seq</span>(<span class="at">from =</span> <span class="fu">min</span>(tempDataSyncS<span class="sc">$</span>airTemp[tempDataSyncS<span class="sc">$</span>riverOrdered <span class="sc">==</span> myriv]),</span>
<span id="cb107-1355"><a href="#cb107-1355" aria-hidden="true" tabindex="-1"></a>              <span class="at">to =</span> <span class="fu">max</span>(tempDataSyncS<span class="sc">$</span>airTemp[tempDataSyncS<span class="sc">$</span>riverOrdered <span class="sc">==</span> myriv]),</span>
<span id="cb107-1356"><a href="#cb107-1356" aria-hidden="true" tabindex="-1"></a>              <span class="at">length.out =</span> np)</span>
<span id="cb107-1357"><a href="#cb107-1357" aria-hidden="true" tabindex="-1"></a>pred_df <span class="ot">&lt;-</span> <span class="fu">expand_grid</span>(x_temp, x_flow)</span>
<span id="cb107-1358"><a href="#cb107-1358" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb107-1359"><a href="#cb107-1359" aria-hidden="true" tabindex="-1"></a><span class="co"># predict from model</span></span>
<span id="cb107-1360"><a href="#cb107-1360" aria-hidden="true" tabindex="-1"></a>pred_df<span class="sc">$</span>pred <span class="ot">&lt;-</span> param.summary[<span class="st">"B.site[2,1]"</span>,<span class="dv">1</span>] <span class="sc">+</span> param.summary[<span class="st">"B.site[2,2]"</span>,<span class="dv">1</span>]<span class="sc">*</span>pred_df<span class="sc">$</span>x_temp <span class="sc">+</span> param.summary[<span class="st">"B.site[2,3]"</span>,<span class="dv">1</span>]<span class="sc">*</span>pred_df<span class="sc">$</span>x_flow <span class="sc">+</span> param.summary[<span class="st">"B.site[2,4]"</span>,<span class="dv">1</span>]<span class="sc">*</span>pred_df<span class="sc">$</span>x_temp<span class="sc">*</span>pred_df<span class="sc">$</span>x_flow</span>
<span id="cb107-1361"><a href="#cb107-1361" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb107-1362"><a href="#cb107-1362" aria-hidden="true" tabindex="-1"></a><span class="co"># lines </span></span>
<span id="cb107-1363"><a href="#cb107-1363" aria-hidden="true" tabindex="-1"></a>p1 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(pred_df, <span class="fu">aes</span>(<span class="at">x =</span> x_temp, <span class="at">y =</span> pred, <span class="at">color =</span> x_flow, <span class="at">group =</span> x_flow)) <span class="sc">+</span></span>
<span id="cb107-1364"><a href="#cb107-1364" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>() <span class="sc">+</span></span>
<span id="cb107-1365"><a href="#cb107-1365" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_distiller</span>(<span class="at">palette =</span> <span class="st">"BrBG"</span>, <span class="at">direction =</span> <span class="sc">+</span><span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb107-1366"><a href="#cb107-1366" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>() <span class="sc">+</span> <span class="fu">theme</span>(<span class="at">panel.grid =</span> <span class="fu">element_blank</span>()) <span class="sc">+</span></span>
<span id="cb107-1367"><a href="#cb107-1367" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">color =</span> <span class="st">"Flow"</span>) <span class="sc">+</span> <span class="fu">xlab</span>(<span class="st">"Air temperature"</span>) <span class="sc">+</span> <span class="fu">ylab</span>(<span class="st">"Water temperature"</span>) <span class="sc">+</span> <span class="fu">ylim</span>(<span class="fl">6.5</span>,<span class="dv">20</span>)</span>
<span id="cb107-1368"><a href="#cb107-1368" aria-hidden="true" tabindex="-1"></a><span class="co"># heatmap</span></span>
<span id="cb107-1369"><a href="#cb107-1369" aria-hidden="true" tabindex="-1"></a>p2 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(pred_df, <span class="fu">aes</span>(<span class="at">x =</span> x_temp, <span class="at">y =</span> x_flow)) <span class="sc">+</span></span>
<span id="cb107-1370"><a href="#cb107-1370" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_tile</span>(<span class="fu">aes</span>(<span class="at">fill =</span> pred)) <span class="sc">+</span></span>
<span id="cb107-1371"><a href="#cb107-1371" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_distiller</span>(<span class="at">palette =</span> <span class="st">"Spectral"</span>, <span class="at">limits =</span> <span class="fu">c</span>(<span class="fl">6.5</span>,<span class="dv">20</span>)) <span class="sc">+</span></span>
<span id="cb107-1372"><a href="#cb107-1372" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>() <span class="sc">+</span> <span class="fu">theme</span>(<span class="at">panel.grid =</span> <span class="fu">element_blank</span>()) <span class="sc">+</span></span>
<span id="cb107-1373"><a href="#cb107-1373" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(<span class="at">expand =</span> <span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">0</span>)) <span class="sc">+</span> <span class="fu">scale_y_continuous</span>(<span class="at">expand =</span> <span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">0</span>)) <span class="sc">+</span></span>
<span id="cb107-1374"><a href="#cb107-1374" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">fill =</span> <span class="st">"Water</span><span class="sc">\n</span><span class="st">temp."</span>) <span class="sc">+</span> <span class="fu">xlab</span>(<span class="st">"Air temperature"</span>) <span class="sc">+</span> <span class="fu">ylab</span>(<span class="st">"Flow"</span>)</span>
<span id="cb107-1375"><a href="#cb107-1375" aria-hidden="true" tabindex="-1"></a><span class="co"># combine</span></span>
<span id="cb107-1376"><a href="#cb107-1376" aria-hidden="true" tabindex="-1"></a>egg<span class="sc">::</span><span class="fu">ggarrange</span>(p1, p2, <span class="at">nrow =</span> <span class="dv">1</span>)</span>
<span id="cb107-1377"><a href="#cb107-1377" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb107-1378"><a href="#cb107-1378" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb107-1379"><a href="#cb107-1379" aria-hidden="true" tabindex="-1"></a><span class="fu">##### Mitchell</span></span>
<span id="cb107-1380"><a href="#cb107-1380" aria-hidden="true" tabindex="-1"></a><span class="in">```{r fig.width=9, fig.height=4}</span></span>
<span id="cb107-1381"><a href="#cb107-1381" aria-hidden="true" tabindex="-1"></a><span class="co"># set up</span></span>
<span id="cb107-1382"><a href="#cb107-1382" aria-hidden="true" tabindex="-1"></a>np <span class="ot">&lt;-</span> <span class="dv">100</span></span>
<span id="cb107-1383"><a href="#cb107-1383" aria-hidden="true" tabindex="-1"></a>myriv <span class="ot">&lt;-</span> <span class="st">"WB MITCHELL"</span></span>
<span id="cb107-1384"><a href="#cb107-1384" aria-hidden="true" tabindex="-1"></a>x_temp <span class="ot">&lt;-</span> <span class="fu">seq</span>(<span class="at">from =</span> <span class="fu">min</span>(tempDataSyncS<span class="sc">$</span>airTemp[tempDataSyncS<span class="sc">$</span>riverOrdered <span class="sc">==</span> myriv]),</span>
<span id="cb107-1385"><a href="#cb107-1385" aria-hidden="true" tabindex="-1"></a>              <span class="at">to =</span> <span class="fu">max</span>(tempDataSyncS<span class="sc">$</span>airTemp[tempDataSyncS<span class="sc">$</span>riverOrdered <span class="sc">==</span> myriv]),</span>
<span id="cb107-1386"><a href="#cb107-1386" aria-hidden="true" tabindex="-1"></a>              <span class="at">length.out =</span> np)</span>
<span id="cb107-1387"><a href="#cb107-1387" aria-hidden="true" tabindex="-1"></a>x_flow <span class="ot">&lt;-</span> <span class="fu">seq</span>(<span class="at">from =</span> <span class="fu">min</span>(tempDataSyncS<span class="sc">$</span>airTemp[tempDataSyncS<span class="sc">$</span>riverOrdered <span class="sc">==</span> myriv]),</span>
<span id="cb107-1388"><a href="#cb107-1388" aria-hidden="true" tabindex="-1"></a>              <span class="at">to =</span> <span class="fu">max</span>(tempDataSyncS<span class="sc">$</span>airTemp[tempDataSyncS<span class="sc">$</span>riverOrdered <span class="sc">==</span> myriv]),</span>
<span id="cb107-1389"><a href="#cb107-1389" aria-hidden="true" tabindex="-1"></a>              <span class="at">length.out =</span> np)</span>
<span id="cb107-1390"><a href="#cb107-1390" aria-hidden="true" tabindex="-1"></a>pred_df <span class="ot">&lt;-</span> <span class="fu">expand_grid</span>(x_temp, x_flow)</span>
<span id="cb107-1391"><a href="#cb107-1391" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb107-1392"><a href="#cb107-1392" aria-hidden="true" tabindex="-1"></a><span class="co"># predict from model</span></span>
<span id="cb107-1393"><a href="#cb107-1393" aria-hidden="true" tabindex="-1"></a>pred_df<span class="sc">$</span>pred <span class="ot">&lt;-</span> param.summary[<span class="st">"B.site[3,1]"</span>,<span class="dv">1</span>] <span class="sc">+</span> param.summary[<span class="st">"B.site[3,2]"</span>,<span class="dv">1</span>]<span class="sc">*</span>pred_df<span class="sc">$</span>x_temp <span class="sc">+</span> param.summary[<span class="st">"B.site[3,3]"</span>,<span class="dv">1</span>]<span class="sc">*</span>pred_df<span class="sc">$</span>x_flow <span class="sc">+</span> param.summary[<span class="st">"B.site[3,4]"</span>,<span class="dv">1</span>]<span class="sc">*</span>pred_df<span class="sc">$</span>x_temp<span class="sc">*</span>pred_df<span class="sc">$</span>x_flow</span>
<span id="cb107-1394"><a href="#cb107-1394" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb107-1395"><a href="#cb107-1395" aria-hidden="true" tabindex="-1"></a><span class="co"># lines </span></span>
<span id="cb107-1396"><a href="#cb107-1396" aria-hidden="true" tabindex="-1"></a>p1 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(pred_df, <span class="fu">aes</span>(<span class="at">x =</span> x_temp, <span class="at">y =</span> pred, <span class="at">color =</span> x_flow, <span class="at">group =</span> x_flow)) <span class="sc">+</span></span>
<span id="cb107-1397"><a href="#cb107-1397" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>() <span class="sc">+</span></span>
<span id="cb107-1398"><a href="#cb107-1398" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_distiller</span>(<span class="at">palette =</span> <span class="st">"BrBG"</span>, <span class="at">direction =</span> <span class="sc">+</span><span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb107-1399"><a href="#cb107-1399" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>() <span class="sc">+</span> <span class="fu">theme</span>(<span class="at">panel.grid =</span> <span class="fu">element_blank</span>()) <span class="sc">+</span></span>
<span id="cb107-1400"><a href="#cb107-1400" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">color =</span> <span class="st">"Flow"</span>) <span class="sc">+</span> <span class="fu">xlab</span>(<span class="st">"Air temperature"</span>) <span class="sc">+</span> <span class="fu">ylab</span>(<span class="st">"Water temperature"</span>) <span class="sc">+</span> <span class="fu">ylim</span>(<span class="fl">6.5</span>,<span class="dv">20</span>)</span>
<span id="cb107-1401"><a href="#cb107-1401" aria-hidden="true" tabindex="-1"></a><span class="co"># heatmap</span></span>
<span id="cb107-1402"><a href="#cb107-1402" aria-hidden="true" tabindex="-1"></a>p2 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(pred_df, <span class="fu">aes</span>(<span class="at">x =</span> x_temp, <span class="at">y =</span> x_flow)) <span class="sc">+</span></span>
<span id="cb107-1403"><a href="#cb107-1403" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_tile</span>(<span class="fu">aes</span>(<span class="at">fill =</span> pred)) <span class="sc">+</span></span>
<span id="cb107-1404"><a href="#cb107-1404" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_distiller</span>(<span class="at">palette =</span> <span class="st">"Spectral"</span>, <span class="at">limits =</span> <span class="fu">c</span>(<span class="fl">6.5</span>,<span class="dv">20</span>)) <span class="sc">+</span></span>
<span id="cb107-1405"><a href="#cb107-1405" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>() <span class="sc">+</span> <span class="fu">theme</span>(<span class="at">panel.grid =</span> <span class="fu">element_blank</span>()) <span class="sc">+</span></span>
<span id="cb107-1406"><a href="#cb107-1406" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(<span class="at">expand =</span> <span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">0</span>)) <span class="sc">+</span> <span class="fu">scale_y_continuous</span>(<span class="at">expand =</span> <span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">0</span>)) <span class="sc">+</span></span>
<span id="cb107-1407"><a href="#cb107-1407" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">fill =</span> <span class="st">"Water</span><span class="sc">\n</span><span class="st">temp."</span>) <span class="sc">+</span> <span class="fu">xlab</span>(<span class="st">"Air temperature"</span>) <span class="sc">+</span> <span class="fu">ylab</span>(<span class="st">"Flow"</span>)</span>
<span id="cb107-1408"><a href="#cb107-1408" aria-hidden="true" tabindex="-1"></a><span class="co"># combine</span></span>
<span id="cb107-1409"><a href="#cb107-1409" aria-hidden="true" tabindex="-1"></a>egg<span class="sc">::</span><span class="fu">ggarrange</span>(p1, p2, <span class="at">nrow =</span> <span class="dv">1</span>)</span>
<span id="cb107-1410"><a href="#cb107-1410" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb107-1411"><a href="#cb107-1411" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb107-1412"><a href="#cb107-1412" aria-hidden="true" tabindex="-1"></a><span class="fu">##### Obear</span></span>
<span id="cb107-1413"><a href="#cb107-1413" aria-hidden="true" tabindex="-1"></a><span class="in">```{r fig.width=9, fig.height=4}</span></span>
<span id="cb107-1414"><a href="#cb107-1414" aria-hidden="true" tabindex="-1"></a><span class="co"># set up</span></span>
<span id="cb107-1415"><a href="#cb107-1415" aria-hidden="true" tabindex="-1"></a>np <span class="ot">&lt;-</span> <span class="dv">100</span></span>
<span id="cb107-1416"><a href="#cb107-1416" aria-hidden="true" tabindex="-1"></a>myriv <span class="ot">&lt;-</span> <span class="st">"WB OBEAR"</span></span>
<span id="cb107-1417"><a href="#cb107-1417" aria-hidden="true" tabindex="-1"></a>x_temp <span class="ot">&lt;-</span> <span class="fu">seq</span>(<span class="at">from =</span> <span class="fu">min</span>(tempDataSyncS<span class="sc">$</span>airTemp[tempDataSyncS<span class="sc">$</span>riverOrdered <span class="sc">==</span> myriv]),</span>
<span id="cb107-1418"><a href="#cb107-1418" aria-hidden="true" tabindex="-1"></a>              <span class="at">to =</span> <span class="fu">max</span>(tempDataSyncS<span class="sc">$</span>airTemp[tempDataSyncS<span class="sc">$</span>riverOrdered <span class="sc">==</span> myriv]),</span>
<span id="cb107-1419"><a href="#cb107-1419" aria-hidden="true" tabindex="-1"></a>              <span class="at">length.out =</span> np)</span>
<span id="cb107-1420"><a href="#cb107-1420" aria-hidden="true" tabindex="-1"></a>x_flow <span class="ot">&lt;-</span> <span class="fu">seq</span>(<span class="at">from =</span> <span class="fu">min</span>(tempDataSyncS<span class="sc">$</span>airTemp[tempDataSyncS<span class="sc">$</span>riverOrdered <span class="sc">==</span> myriv]),</span>
<span id="cb107-1421"><a href="#cb107-1421" aria-hidden="true" tabindex="-1"></a>              <span class="at">to =</span> <span class="fu">max</span>(tempDataSyncS<span class="sc">$</span>airTemp[tempDataSyncS<span class="sc">$</span>riverOrdered <span class="sc">==</span> myriv]),</span>
<span id="cb107-1422"><a href="#cb107-1422" aria-hidden="true" tabindex="-1"></a>              <span class="at">length.out =</span> np)</span>
<span id="cb107-1423"><a href="#cb107-1423" aria-hidden="true" tabindex="-1"></a>pred_df <span class="ot">&lt;-</span> <span class="fu">expand_grid</span>(x_temp, x_flow)</span>
<span id="cb107-1424"><a href="#cb107-1424" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb107-1425"><a href="#cb107-1425" aria-hidden="true" tabindex="-1"></a><span class="co"># predict from model</span></span>
<span id="cb107-1426"><a href="#cb107-1426" aria-hidden="true" tabindex="-1"></a>pred_df<span class="sc">$</span>pred <span class="ot">&lt;-</span> param.summary[<span class="st">"B.site[4,1]"</span>,<span class="dv">1</span>] <span class="sc">+</span> param.summary[<span class="st">"B.site[4,2]"</span>,<span class="dv">1</span>]<span class="sc">*</span>pred_df<span class="sc">$</span>x_temp <span class="sc">+</span> param.summary[<span class="st">"B.site[4,3]"</span>,<span class="dv">1</span>]<span class="sc">*</span>pred_df<span class="sc">$</span>x_flow <span class="sc">+</span> param.summary[<span class="st">"B.site[4,4]"</span>,<span class="dv">1</span>]<span class="sc">*</span>pred_df<span class="sc">$</span>x_temp<span class="sc">*</span>pred_df<span class="sc">$</span>x_flow</span>
<span id="cb107-1427"><a href="#cb107-1427" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb107-1428"><a href="#cb107-1428" aria-hidden="true" tabindex="-1"></a><span class="co"># lines </span></span>
<span id="cb107-1429"><a href="#cb107-1429" aria-hidden="true" tabindex="-1"></a>p1 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(pred_df, <span class="fu">aes</span>(<span class="at">x =</span> x_temp, <span class="at">y =</span> pred, <span class="at">color =</span> x_flow, <span class="at">group =</span> x_flow)) <span class="sc">+</span></span>
<span id="cb107-1430"><a href="#cb107-1430" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>() <span class="sc">+</span></span>
<span id="cb107-1431"><a href="#cb107-1431" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_distiller</span>(<span class="at">palette =</span> <span class="st">"BrBG"</span>, <span class="at">direction =</span> <span class="sc">+</span><span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb107-1432"><a href="#cb107-1432" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>() <span class="sc">+</span> <span class="fu">theme</span>(<span class="at">panel.grid =</span> <span class="fu">element_blank</span>()) <span class="sc">+</span></span>
<span id="cb107-1433"><a href="#cb107-1433" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">color =</span> <span class="st">"Flow"</span>) <span class="sc">+</span> <span class="fu">xlab</span>(<span class="st">"Air temperature"</span>) <span class="sc">+</span> <span class="fu">ylab</span>(<span class="st">"Water temperature"</span>) <span class="sc">+</span> <span class="fu">ylim</span>(<span class="fl">6.5</span>,<span class="dv">20</span>)</span>
<span id="cb107-1434"><a href="#cb107-1434" aria-hidden="true" tabindex="-1"></a><span class="co"># heatmap</span></span>
<span id="cb107-1435"><a href="#cb107-1435" aria-hidden="true" tabindex="-1"></a>p2 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(pred_df, <span class="fu">aes</span>(<span class="at">x =</span> x_temp, <span class="at">y =</span> x_flow)) <span class="sc">+</span></span>
<span id="cb107-1436"><a href="#cb107-1436" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_tile</span>(<span class="fu">aes</span>(<span class="at">fill =</span> pred)) <span class="sc">+</span></span>
<span id="cb107-1437"><a href="#cb107-1437" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_distiller</span>(<span class="at">palette =</span> <span class="st">"Spectral"</span>, <span class="at">limits =</span> <span class="fu">c</span>(<span class="fl">6.5</span>,<span class="dv">20</span>)) <span class="sc">+</span></span>
<span id="cb107-1438"><a href="#cb107-1438" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>() <span class="sc">+</span> <span class="fu">theme</span>(<span class="at">panel.grid =</span> <span class="fu">element_blank</span>()) <span class="sc">+</span></span>
<span id="cb107-1439"><a href="#cb107-1439" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(<span class="at">expand =</span> <span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">0</span>)) <span class="sc">+</span> <span class="fu">scale_y_continuous</span>(<span class="at">expand =</span> <span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">0</span>)) <span class="sc">+</span></span>
<span id="cb107-1440"><a href="#cb107-1440" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">fill =</span> <span class="st">"Water</span><span class="sc">\n</span><span class="st">temp."</span>) <span class="sc">+</span> <span class="fu">xlab</span>(<span class="st">"Air temperature"</span>) <span class="sc">+</span> <span class="fu">ylab</span>(<span class="st">"Flow"</span>)</span>
<span id="cb107-1441"><a href="#cb107-1441" aria-hidden="true" tabindex="-1"></a><span class="co"># combine</span></span>
<span id="cb107-1442"><a href="#cb107-1442" aria-hidden="true" tabindex="-1"></a>egg<span class="sc">::</span><span class="fu">ggarrange</span>(p1, p2, <span class="at">nrow =</span> <span class="dv">1</span>)</span>
<span id="cb107-1443"><a href="#cb107-1443" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb107-1444"><a href="#cb107-1444" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb107-1445"><a href="#cb107-1445" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb107-1446"><a href="#cb107-1446" aria-hidden="true" tabindex="-1"></a></span>
</code><button title="Copy to Clipboard" class="code-copy-button" data-in-quarto-modal=""><i class="bi"></i></button></pre></div>
</div></div></div></div></div>
</div> <!-- /content -->




</body></html>