<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.7.32">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>6&nbsp; ModelTemp - EcoDrought – Stream Temperature by Flow</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
html { -webkit-text-size-adjust: 100%; }
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<link href="./ModelTemp-Letcher.html" rel="prev">
<script src="site_libs/quarto-html/quarto.js" type="module"></script>
<script src="site_libs/quarto-html/tabsets/tabsets.js" type="module"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting-37eea08aefeeee20ff55810ff984fec1.css" rel="stylesheet" class="quarto-color-scheme" id="quarto-text-highlighting-styles">
<link href="site_libs/quarto-html/quarto-syntax-highlighting-dark-2fef5ea3f8957b3e4ecc936fc74692ca.css" rel="stylesheet" class="quarto-color-scheme quarto-color-alternate" id="quarto-text-highlighting-styles">
<link href="site_libs/quarto-html/quarto-syntax-highlighting-37eea08aefeeee20ff55810ff984fec1.css" rel="stylesheet" class="quarto-color-scheme-extra" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap-c599ca7844cfd5ff950332d51a54001f.min.css" rel="stylesheet" append-hash="true" class="quarto-color-scheme" id="quarto-bootstrap" data-mode="light">
<link href="site_libs/bootstrap/bootstrap-dark-a0800d32663627e31cbe2a42d8010cbb.min.css" rel="stylesheet" append-hash="true" class="quarto-color-scheme quarto-color-alternate" id="quarto-bootstrap" data-mode="dark">
<link href="site_libs/bootstrap/bootstrap-c599ca7844cfd5ff950332d51a54001f.min.css" rel="stylesheet" append-hash="true" class="quarto-color-scheme-extra" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>
<script type="application/json" class="js-hypothesis-config">
{
  "theme": "clean"
}
</script>
<script async="" src="https://hypothes.is/embed.js"></script>
<script>
  window.document.addEventListener("DOMContentLoaded", function (_event) {
    document.body.classList.add('hypothesis-enabled');
  });
</script>
</head><body class="nav-sidebar floating quarto-light"><script id="quarto-html-before-body" type="application/javascript">
    const toggleBodyColorMode = (bsSheetEl) => {
      const mode = bsSheetEl.getAttribute("data-mode");
      const bodyEl = window.document.querySelector("body");
      if (mode === "dark") {
        bodyEl.classList.add("quarto-dark");
        bodyEl.classList.remove("quarto-light");
      } else {
        bodyEl.classList.add("quarto-light");
        bodyEl.classList.remove("quarto-dark");
      }
    }
    const toggleBodyColorPrimary = () => {
      const bsSheetEl = window.document.querySelector("link#quarto-bootstrap:not([rel=disabled-stylesheet])");
      if (bsSheetEl) {
        toggleBodyColorMode(bsSheetEl);
      }
    }
    const setColorSchemeToggle = (alternate) => {
      const toggles = window.document.querySelectorAll('.quarto-color-scheme-toggle');
      for (let i=0; i < toggles.length; i++) {
        const toggle = toggles[i];
        if (toggle) {
          if (alternate) {
            toggle.classList.add("alternate");
          } else {
            toggle.classList.remove("alternate");
          }
        }
      }
    };
    const toggleColorMode = (alternate) => {
      // Switch the stylesheets
      const primaryStylesheets = window.document.querySelectorAll('link.quarto-color-scheme:not(.quarto-color-alternate)');
      const alternateStylesheets = window.document.querySelectorAll('link.quarto-color-scheme.quarto-color-alternate');
      manageTransitions('#quarto-margin-sidebar .nav-link', false);
      if (alternate) {
        // note: dark is layered on light, we don't disable primary!
        enableStylesheet(alternateStylesheets);
        for (const sheetNode of alternateStylesheets) {
          if (sheetNode.id === "quarto-bootstrap") {
            toggleBodyColorMode(sheetNode);
          }
        }
      } else {
        disableStylesheet(alternateStylesheets);
        enableStylesheet(primaryStylesheets)
        toggleBodyColorPrimary();
      }
      manageTransitions('#quarto-margin-sidebar .nav-link', true);
      // Switch the toggles
      setColorSchemeToggle(alternate)
      // Hack to workaround the fact that safari doesn't
      // properly recolor the scrollbar when toggling (#1455)
      if (navigator.userAgent.indexOf('Safari') > 0 && navigator.userAgent.indexOf('Chrome') == -1) {
        manageTransitions("body", false);
        window.scrollTo(0, 1);
        setTimeout(() => {
          window.scrollTo(0, 0);
          manageTransitions("body", true);
        }, 40);
      }
    }
    const disableStylesheet = (stylesheets) => {
      for (let i=0; i < stylesheets.length; i++) {
        const stylesheet = stylesheets[i];
        stylesheet.rel = 'disabled-stylesheet';
      }
    }
    const enableStylesheet = (stylesheets) => {
      for (let i=0; i < stylesheets.length; i++) {
        const stylesheet = stylesheets[i];
        if(stylesheet.rel !== 'stylesheet') { // for Chrome, which will still FOUC without this check
          stylesheet.rel = 'stylesheet';
        }
      }
    }
    const manageTransitions = (selector, allowTransitions) => {
      const els = window.document.querySelectorAll(selector);
      for (let i=0; i < els.length; i++) {
        const el = els[i];
        if (allowTransitions) {
          el.classList.remove('notransition');
        } else {
          el.classList.add('notransition');
        }
      }
    }
    const isFileUrl = () => {
      return window.location.protocol === 'file:';
    }
    const hasAlternateSentinel = () => {
      let styleSentinel = getColorSchemeSentinel();
      if (styleSentinel !== null) {
        return styleSentinel === "alternate";
      } else {
        return false;
      }
    }
    const setStyleSentinel = (alternate) => {
      const value = alternate ? "alternate" : "default";
      if (!isFileUrl()) {
        window.localStorage.setItem("quarto-color-scheme", value);
      } else {
        localAlternateSentinel = value;
      }
    }
    const getColorSchemeSentinel = () => {
      if (!isFileUrl()) {
        const storageValue = window.localStorage.getItem("quarto-color-scheme");
        return storageValue != null ? storageValue : localAlternateSentinel;
      } else {
        return localAlternateSentinel;
      }
    }
    const toggleGiscusIfUsed = (isAlternate, darkModeDefault) => {
      const baseTheme = document.querySelector('#giscus-base-theme')?.value ?? 'light';
      const alternateTheme = document.querySelector('#giscus-alt-theme')?.value ?? 'dark';
      let newTheme = '';
      if(authorPrefersDark) {
        newTheme = isAlternate ? baseTheme : alternateTheme;
      } else {
        newTheme = isAlternate ? alternateTheme : baseTheme;
      }
      const changeGiscusTheme = () => {
        // From: https://github.com/giscus/giscus/issues/336
        const sendMessage = (message) => {
          const iframe = document.querySelector('iframe.giscus-frame');
          if (!iframe) return;
          iframe.contentWindow.postMessage({ giscus: message }, 'https://giscus.app');
        }
        sendMessage({
          setConfig: {
            theme: newTheme
          }
        });
      }
      const isGiscussLoaded = window.document.querySelector('iframe.giscus-frame') !== null;
      if (isGiscussLoaded) {
        changeGiscusTheme();
      }
    };
    const authorPrefersDark = false;
    const darkModeDefault = authorPrefersDark;
      document.querySelector('link#quarto-text-highlighting-styles.quarto-color-scheme-extra').rel = 'disabled-stylesheet';
      document.querySelector('link#quarto-bootstrap.quarto-color-scheme-extra').rel = 'disabled-stylesheet';
    let localAlternateSentinel = darkModeDefault ? 'alternate' : 'default';
    // Dark / light mode switch
    window.quartoToggleColorScheme = () => {
      // Read the current dark / light value
      let toAlternate = !hasAlternateSentinel();
      toggleColorMode(toAlternate);
      setStyleSentinel(toAlternate);
      toggleGiscusIfUsed(toAlternate, darkModeDefault);
      window.dispatchEvent(new Event('resize'));
    };
    // Switch to dark mode if need be
    if (hasAlternateSentinel()) {
      toggleColorMode(true);
    } else {
      toggleColorMode(false);
    }
  </script><a href="https://github.com/j-baldock/TempFlowSensitivity" class="github-corner" aria-label="View source on GitHub"><svg width="80" height="80" viewbox="0 0 250 250" style="fill:#69b3a2; color:#fff; position: 

absolute; top: 0; border: 0; right: 0;" aria-hidden="true"><path d="M0,0 L115,115 L130,115 

L142,142 L250,250 L250,0 Z"></path><path d="M128.3,109.0 C113.8,99.7 119.0,89.6 119.0,89.6 

C122.0,82.7 120.5,78.6 120.5,78.6 C119.2,72.0 123.4,76.3 123.4,76.3 C127.3,80.9 125.5,87.3 

125.5,87.3 C122.9,97.6 130.6,101.9 134.4,103.2" fill="currentColor" style="transform-origin: 

130px 106px;" class="octo-arm"></path><path d="M115.0,115.0 C114.9,115.1 118.7,116.5 

119.8,115.4 L133.7,101.6 C136.9,99.2 139.9,98.4 142.2,98.6 C133.8,88.0 127.5,74.4 143.8,58.0 

C148.5,53.4 154.0,51.2 159.7,51.0 C160.3,49.4 163.2,43.6 171.4,40.1 C171.4,40.1 176.1,42.5 

178.8,56.2 C183.1,58.6 187.2,61.8 190.9,65.4 C194.5,69.0 197.7,73.2 200.1,77.6 C213.8,80.2 

216.3,84.9 216.3,84.9 C212.7,93.1 206.9,96.0 205.4,96.6 C205.1,102.4 203.0,107.8 198.3,112.5 

C181.9,128.9 168.3,122.5 157.7,114.1 C157.9,116.9 156.7,120.9 152.7,124.9 L141.0,136.5 

C139.8,137.7 141.6,141.9 141.8,141.8 Z" fill="currentColor" class="octo-body"></path></svg></a><style>.github-corner:hover 

.octo-arm{animation:octocat-wave 560ms ease-in-out}@keyframes 

octocat-wave{0%,100%{transform:rotate(0)}20%,60%{transform:rotate(-25deg)}40%,80%{transform:rotate(10deg)}}@media 

(max-width:500px){.github-corner:hover .octo-arm{animation:none}.github-corner 

  .octo-arm{animation:octocat-wave 560ms ease-in-out}}</style>






<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" role="button" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./ModelTemp-EcoDrought.html"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">ModelTemp - EcoDrought</span></a></li></ol></nav>
        <a class="flex-grow-1" role="navigation" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
      <button type="button" class="btn quarto-search-button" aria-label="Search" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation floating overflow-auto">
    <div class="pt-lg-2 mt-2 text-left sidebar-header">
    <div class="sidebar-title mb-0 py-0">
      <a href="./">Stream Temperature by Flow</a> 
        <div class="sidebar-tools-main">
  <a href="" class="quarto-color-scheme-toggle quarto-navigation-tool  px-1" onclick="window.quartoToggleColorScheme(); return false;" title="Toggle dark mode"><i class="bi"></i></a>
</div>
    </div>
      </div>
        <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
        </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">Introduction</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./DataViz.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">Visualize Data</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./Breakpoints.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Breakpoints</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./FormatData.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">Format Data</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./ModelTemp-Letcher.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">ModelTemp - Letcher et al.&nbsp;(2016)</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./ModelTemp-EcoDrought.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">ModelTemp - EcoDrought</span></span></a>
  </div>
</li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table of contents</h2>
   
  <ul>
  <li><a href="#load-data" id="toc-load-data" class="nav-link active" data-scroll-target="#load-data"><span class="header-section-number">6.1</span> Load data</a></li>
  <li><a href="#specify-jags-model" id="toc-specify-jags-model" class="nav-link" data-scroll-target="#specify-jags-model"><span class="header-section-number">6.2</span> Specify JAGS model</a></li>
  <li><a href="#organize-objects" id="toc-organize-objects" class="nav-link" data-scroll-target="#organize-objects"><span class="header-section-number">6.3</span> Organize objects</a></li>
  <li><a href="#fit-model" id="toc-fit-model" class="nav-link" data-scroll-target="#fit-model"><span class="header-section-number">6.4</span> Fit model</a>
  <ul class="collapse">
  <li><a href="#goodness-of-fit" id="toc-goodness-of-fit" class="nav-link" data-scroll-target="#goodness-of-fit"><span class="header-section-number">6.4.1</span> Goodness of fit</a></li>
  </ul></li>
  <li><a href="#plot-model-output" id="toc-plot-model-output" class="nav-link" data-scroll-target="#plot-model-output"><span class="header-section-number">6.5</span> Plot model output</a>
  <ul class="collapse">
  <li><a href="#dot-plots" id="toc-dot-plots" class="nav-link" data-scroll-target="#dot-plots"><span class="header-section-number">6.5.1</span> Dot plots</a></li>
  <li><a href="#marginal-efffects" id="toc-marginal-efffects" class="nav-link" data-scroll-target="#marginal-efffects"><span class="header-section-number">6.5.2</span> Marginal efffects</a></li>
  </ul></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">


<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<div class="quarto-title-block"><div><h1 class="title"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">ModelTemp - EcoDrought</span></h1><button type="button" class="btn code-tools-button dropdown-toggle" id="quarto-code-tools-menu" data-bs-toggle="dropdown" aria-expanded="false"><i class="bi"></i> Code</button><ul class="dropdown-menu dropdown-menu-end" aria-labelelledby="quarto-code-tools-menu"><li><a id="quarto-show-all-code" class="dropdown-item" href="javascript:void(0)" role="button">Show All Code</a></li><li><a id="quarto-hide-all-code" class="dropdown-item" href="javascript:void(0)" role="button">Hide All Code</a></li><li><hr class="dropdown-divider"></li><li><a id="quarto-view-source" class="dropdown-item" href="javascript:void(0)" role="button">View Source</a></li></ul></div></div>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header>


<p><strong>Purpose:</strong> fit hierarchical stream temp model to EcoDrought data.</p>
<p>Notes:</p>
<ul>
<li>Consider bringing in additional data from NWIS to fill in middle-upper end of catchment size spectrum (Snake: Blackrock, Cache, Granite…bigger rivers? (Hoback, Gros Ventre, Greys…where to draw the line?))</li>
</ul>
<section id="load-data" class="level2" data-number="6.1">
<h2 data-number="6.1" class="anchored" data-anchor-id="load-data"><span class="header-section-number">6.1</span> Load data</h2>
<p>Also set flow = NA to 0. Probably should change this to latent variable in model, especially when expanding to sites where flow data is more rare</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a>dat <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(<span class="st">"data/EcoDrought_FlowTempData_formatted.csv"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(basin <span class="sc">==</span> <span class="st">"Snake River"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">rowNum =</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">nrow</span>(.),</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a>         <span class="at">site_code =</span> <span class="fu">as.numeric</span>(<span class="fu">as.factor</span>(site_name)),</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a>         <span class="at">year_code =</span> year <span class="sc">-</span> <span class="fu">min</span>(year) <span class="sc">+</span> <span class="dv">1</span>) <span class="sc">%&gt;%</span></span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(tempc_mean)) <span class="sc">%&gt;%</span></span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">z_Yield_mm_log =</span> <span class="fu">ifelse</span>(<span class="fu">is.na</span>(z_Yield_mm_log), <span class="dv">0</span>, z_Yield_mm_log))</span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a>dat</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 12,184 × 38
   site_name basin   lat  long elev_ft area_sqmi date        yday  year siteYear
   &lt;chr&gt;     &lt;chr&gt; &lt;dbl&gt; &lt;dbl&gt;   &lt;dbl&gt;     &lt;dbl&gt; &lt;date&gt;     &lt;dbl&gt; &lt;dbl&gt; &lt;chr&gt;   
 1 Grizzly … Snak…  43.8 -110.   8340.      12.7 2018-07-03   184  2018 Grizzly…
 2 Grizzly … Snak…  43.8 -110.   8340.      12.7 2018-07-04   185  2018 Grizzly…
 3 Grizzly … Snak…  43.8 -110.   8340.      12.7 2018-07-05   186  2018 Grizzly…
 4 Grizzly … Snak…  43.8 -110.   8340.      12.7 2018-07-06   187  2018 Grizzly…
 5 Grizzly … Snak…  43.8 -110.   8340.      12.7 2018-07-07   188  2018 Grizzly…
 6 Grizzly … Snak…  43.8 -110.   8340.      12.7 2018-07-08   189  2018 Grizzly…
 7 Grizzly … Snak…  43.8 -110.   8340.      12.7 2018-07-09   190  2018 Grizzly…
 8 Grizzly … Snak…  43.8 -110.   8340.      12.7 2018-07-10   191  2018 Grizzly…
 9 Grizzly … Snak…  43.8 -110.   8340.      12.7 2018-07-11   192  2018 Grizzly…
10 Grizzly … Snak…  43.8 -110.   8340.      12.7 2018-07-12   193  2018 Grizzly…
# ℹ 12,174 more rows
# ℹ 28 more variables: tempc_mean &lt;dbl&gt;, tempc_min &lt;dbl&gt;, tempc_max &lt;dbl&gt;,
#   flow_mean &lt;dbl&gt;, Yield_mm &lt;dbl&gt;, air_temp_mean &lt;dbl&gt;, precip_mmday &lt;dbl&gt;,
#   swe_kgm2 &lt;dbl&gt;, daylength_sec &lt;dbl&gt;, shortrad_wm2 &lt;dbl&gt;,
#   Yield_mm_log &lt;dbl&gt;, flow_mean_log &lt;dbl&gt;, z_Yield_mm_log &lt;dbl&gt;,
#   z_air_temp_mean &lt;dbl&gt;, air_temp_mean_lag1 &lt;dbl&gt;, air_temp_mean_lag2 &lt;dbl&gt;,
#   z_air_temp_mean_lag1 &lt;dbl&gt;, z_air_temp_mean_lag2 &lt;dbl&gt;, …</code></pre>
</div>
</div>
<p>Drop sites without any flow or water temp observations and re-do site and year codes</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a>dropsites <span class="ot">&lt;-</span> <span class="fu">unlist</span>(dat <span class="sc">%&gt;%</span> </span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(site_name) <span class="sc">%&gt;%</span> </span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="at">numt =</span> <span class="fu">sum</span>(<span class="sc">!</span><span class="fu">is.na</span>(tempc_mean)), </span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a>            <span class="at">numf =</span> <span class="fu">sum</span>(<span class="sc">!</span><span class="fu">is.na</span>(z_Yield_mm_log))) <span class="sc">%&gt;%</span> </span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span></span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(numt <span class="sc">==</span> <span class="dv">0</span> <span class="sc">|</span> numf <span class="sc">==</span> <span class="dv">0</span>) <span class="sc">%&gt;%</span></span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(site_name))</span>
<span id="cb3-8"><a href="#cb3-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-9"><a href="#cb3-9" aria-hidden="true" tabindex="-1"></a>dat <span class="ot">&lt;-</span> dat <span class="sc">%&gt;%</span> </span>
<span id="cb3-10"><a href="#cb3-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span>site_name <span class="sc">%in%</span> dropsites) <span class="sc">%&gt;%</span></span>
<span id="cb3-11"><a href="#cb3-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">rowNum =</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">nrow</span>(.),</span>
<span id="cb3-12"><a href="#cb3-12" aria-hidden="true" tabindex="-1"></a>         <span class="at">site_code =</span> <span class="fu">as.numeric</span>(<span class="fu">as.factor</span>(site_name)),</span>
<span id="cb3-13"><a href="#cb3-13" aria-hidden="true" tabindex="-1"></a>         <span class="at">year_code =</span> year <span class="sc">-</span> <span class="fu">min</span>(year) <span class="sc">+</span> <span class="dv">1</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>View site codes</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a>dat <span class="sc">%&gt;%</span> <span class="fu">group_by</span>(site_name) <span class="sc">%&gt;%</span> <span class="fu">summarize</span>(<span class="at">site_code =</span> <span class="fu">unique</span>(site_code)) <span class="sc">%&gt;%</span> <span class="fu">ungroup</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 11 × 2
   site_name                   site_code
   &lt;chr&gt;                           &lt;dbl&gt;
 1 Grizzly Creek                       1
 2 Grouse Creek                        2
 3 Leidy Creek Mouth                   3
 4 Leidy Creek Upper                   4
 5 NF Spread Creek Lower               5
 6 NF Spread Creek Upper               6
 7 Pacific Creek at Moran NWIS         7
 8 Rock Creek                          8
 9 SF Spread Creek Lower               9
10 SF Spread Creek Upper              10
11 Spread Creek Dam                   11</code></pre>
</div>
</div>
<p>Any missing data? <em>Need to put a prior on flow</em></p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="fu">any</span>(<span class="fu">is.na</span>(dat<span class="sc">$</span>z_air_temp_mean))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>[1] FALSE</code></pre>
</div>
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="fu">any</span>(<span class="fu">is.na</span>(dat<span class="sc">$</span>z_air_temp_mean_lag1))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>[1] FALSE</code></pre>
</div>
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="fu">any</span>(<span class="fu">is.na</span>(dat<span class="sc">$</span>z_air_temp_mean_lag2))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>[1] FALSE</code></pre>
</div>
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="fu">any</span>(<span class="fu">is.na</span>(dat<span class="sc">$</span>z_Yield_mm_log))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>[1] FALSE</code></pre>
</div>
</div>
<p>View data</p>
<div class="tabset-margin-container"></div><div class="panel-tabset">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-1-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-1-1" role="tab" aria-controls="tabset-1-1" aria-selected="true">Distributions</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-1-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-1-2" role="tab" aria-controls="tabset-1-2" aria-selected="false">Air temp</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-1-3-tab" data-bs-toggle="tab" data-bs-target="#tabset-1-3" role="tab" aria-controls="tabset-1-3" aria-selected="false">Water temp</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-1-4-tab" data-bs-toggle="tab" data-bs-target="#tabset-1-4" role="tab" aria-controls="tabset-1-4" aria-selected="false">Flow (log and std)</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-1-5-tab" data-bs-toggle="tab" data-bs-target="#tabset-1-5" role="tab" aria-controls="tabset-1-5" aria-selected="false">Tw ~ Ta + F</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-1-6-tab" data-bs-toggle="tab" data-bs-target="#tabset-1-6" role="tab" aria-controls="tabset-1-6" aria-selected="false">Ta ~ F</a></li></ul>
<div class="tab-content">
<div id="tabset-1-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-1-1-tab">
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a>ggpubr<span class="sc">::</span><span class="fu">ggarrange</span>(dat <span class="sc">%&gt;%</span> <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> air_temp_mean, <span class="at">color =</span> site_name)) <span class="sc">+</span> <span class="fu">geom_density</span>() <span class="sc">+</span> <span class="fu">theme_bw</span>(),</span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a>                  dat <span class="sc">%&gt;%</span> <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> flow_mean_log, <span class="at">color =</span> site_name)) <span class="sc">+</span> <span class="fu">geom_density</span>() <span class="sc">+</span> <span class="fu">theme_bw</span>(),</span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a>                  dat <span class="sc">%&gt;%</span> <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> Yield_mm_log, <span class="at">color =</span> site_name)) <span class="sc">+</span> <span class="fu">geom_density</span>() <span class="sc">+</span> <span class="fu">theme_bw</span>(),</span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true" tabindex="-1"></a>                  <span class="at">common.legend =</span> <span class="cn">TRUE</span>, <span class="at">legend =</span> <span class="st">"right"</span>, <span class="at">ncol =</span> <span class="dv">1</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="ModelTemp-EcoDrought_files/figure-html/unnamed-chunk-6-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</div>
<div id="tabset-1-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-1-2-tab">
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(dat, <span class="fu">aes</span>(yday, z_air_temp_mean))<span class="sc">+</span></span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">color =</span> <span class="fu">factor</span>(year))) <span class="sc">+</span></span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_grid</span>(year <span class="sc">~</span> site_name)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="ModelTemp-EcoDrought_files/figure-html/unnamed-chunk-7-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</div>
<div id="tabset-1-3" class="tab-pane" role="tabpanel" aria-labelledby="tabset-1-3-tab">
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(dat, <span class="fu">aes</span>(yday, tempc_mean))<span class="sc">+</span></span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">color =</span> <span class="fu">factor</span>(year)))<span class="sc">+</span></span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_grid</span>(year <span class="sc">~</span> site_name)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="ModelTemp-EcoDrought_files/figure-html/unnamed-chunk-8-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</div>
<div id="tabset-1-4" class="tab-pane" role="tabpanel" aria-labelledby="tabset-1-4-tab">
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(dat, <span class="fu">aes</span>(yday, z_Yield_mm_log))<span class="sc">+</span></span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">color =</span> <span class="fu">factor</span>(year)))<span class="sc">+</span></span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_grid</span>(year <span class="sc">~</span> site_name)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="ModelTemp-EcoDrought_files/figure-html/unnamed-chunk-9-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</div>
<div id="tabset-1-5" class="tab-pane" role="tabpanel" aria-labelledby="tabset-1-5-tab">
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a>dat <span class="sc">%&gt;%</span> <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> z_air_temp_mean, <span class="at">y =</span> tempc_mean, <span class="at">color =</span> z_Yield_mm_log)) <span class="sc">+</span> <span class="fu">geom_point</span>(<span class="at">size =</span> <span class="fl">0.2</span>) <span class="sc">+</span> <span class="fu">facet_wrap</span>(<span class="sc">~</span>site_name) <span class="sc">+</span> <span class="fu">theme_bw</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="ModelTemp-EcoDrought_files/figure-html/unnamed-chunk-10-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</div>
<div id="tabset-1-6" class="tab-pane" role="tabpanel" aria-labelledby="tabset-1-6-tab">
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a>dat <span class="sc">%&gt;%</span> <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> z_air_temp_mean, <span class="at">y =</span> z_Yield_mm_log, <span class="at">colour =</span> tempc_mean)) <span class="sc">+</span> <span class="fu">geom_point</span>(<span class="at">size =</span> <span class="fl">0.2</span>) <span class="sc">+</span> <span class="fu">facet_wrap</span>(<span class="sc">~</span>site_name) <span class="sc">+</span> <span class="fu">theme_bw</span>() <span class="sc">+</span> ggpubr<span class="sc">::</span><span class="fu">stat_cor</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="ModelTemp-EcoDrought_files/figure-html/unnamed-chunk-11-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</div>
</div>
</div>
</section>
<section id="specify-jags-model" class="level2" data-number="6.2">
<h2 data-number="6.2" class="anchored" data-anchor-id="specify-jags-model"><span class="header-section-number">6.2</span> Specify JAGS model</h2>
<p>Specify hierarchical model following Letcher et al.&nbsp;(2016). MODIFIED:</p>
<ul>
<li>add prior on covariates to deal with missing values</li>
<li>calculate Bayesian R^2 and RMSE</li>
<li>remove the year trends (same as for Hocking et al 2018)</li>
<li>add catchment covariate effects on random effects parameters</li>
</ul>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"model {</span></span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-3"><a href="#cb20-3" aria-hidden="true" tabindex="-1"></a><span class="st">    ###----------------- LIKELIHOOD -----------------###</span></span>
<span id="cb20-4"><a href="#cb20-4" aria-hidden="true" tabindex="-1"></a><span class="st">    </span></span>
<span id="cb20-5"><a href="#cb20-5" aria-hidden="true" tabindex="-1"></a><span class="st">    # Days without an observation on the previous day (first observation in a series)</span></span>
<span id="cb20-6"><a href="#cb20-6" aria-hidden="true" tabindex="-1"></a><span class="st">    # No autoregressive term</span></span>
<span id="cb20-7"><a href="#cb20-7" aria-hidden="true" tabindex="-1"></a><span class="st">    </span></span>
<span id="cb20-8"><a href="#cb20-8" aria-hidden="true" tabindex="-1"></a><span class="st">    for (i in 1:nFirstObsRows){</span></span>
<span id="cb20-9"><a href="#cb20-9" aria-hidden="true" tabindex="-1"></a><span class="st">      temp[firstObsRows[i]] ~ dnorm(stream.mu[firstObsRows[i]], pow(sigma, -2)) </span></span>
<span id="cb20-10"><a href="#cb20-10" aria-hidden="true" tabindex="-1"></a><span class="st">      stream.mu[firstObsRows[i]] &lt;- trend[firstObsRows[i]]</span></span>
<span id="cb20-11"><a href="#cb20-11" aria-hidden="true" tabindex="-1"></a><span class="st">      trend[firstObsRows[i]] &lt;- inprod(B.0[], X.0[firstObsRows[i], ]) + </span></span>
<span id="cb20-12"><a href="#cb20-12" aria-hidden="true" tabindex="-1"></a><span class="st">                                inprod(B.site[site[firstObsRows[i]], ], X.site[firstObsRows[i], ]) + </span></span>
<span id="cb20-13"><a href="#cb20-13" aria-hidden="true" tabindex="-1"></a><span class="st">                                inprod(B.year[year[firstObsRows[i]], ], X.year[firstObsRows[i], ])</span></span>
<span id="cb20-14"><a href="#cb20-14" aria-hidden="true" tabindex="-1"></a><span class="st">      #X.site[firstObsRows[i], ] ~ dnorm(0, pow(1, -2))</span></span>
<span id="cb20-15"><a href="#cb20-15" aria-hidden="true" tabindex="-1"></a><span class="st">      }</span></span>
<span id="cb20-16"><a href="#cb20-16" aria-hidden="true" tabindex="-1"></a><span class="st">    </span></span>
<span id="cb20-17"><a href="#cb20-17" aria-hidden="true" tabindex="-1"></a><span class="st">    # Days with an observation on the previous dat (all days following the first day)</span></span>
<span id="cb20-18"><a href="#cb20-18" aria-hidden="true" tabindex="-1"></a><span class="st">    # Includes autoregressive term (ar1)</span></span>
<span id="cb20-19"><a href="#cb20-19" aria-hidden="true" tabindex="-1"></a><span class="st">    </span></span>
<span id="cb20-20"><a href="#cb20-20" aria-hidden="true" tabindex="-1"></a><span class="st">    for (i in 1:nEvalRows){ </span></span>
<span id="cb20-21"><a href="#cb20-21" aria-hidden="true" tabindex="-1"></a><span class="st">      temp[evalRows[i]] ~ dnorm(stream.mu[evalRows[i]], pow(sigma, -2))</span></span>
<span id="cb20-22"><a href="#cb20-22" aria-hidden="true" tabindex="-1"></a><span class="st">      stream.mu[evalRows[i]] &lt;- trend[evalRows[i]] + ar1[site[evalRows[i]]] * (temp[evalRows[i]-1] - trend[ evalRows[i]-1 ])</span></span>
<span id="cb20-23"><a href="#cb20-23" aria-hidden="true" tabindex="-1"></a><span class="st">      trend[evalRows[i]] &lt;- inprod(B.0[], X.0[evalRows[i], ]) + </span></span>
<span id="cb20-24"><a href="#cb20-24" aria-hidden="true" tabindex="-1"></a><span class="st">                            inprod(B.site[site[evalRows[i]], ], X.site[evalRows[i], ]) + </span></span>
<span id="cb20-25"><a href="#cb20-25" aria-hidden="true" tabindex="-1"></a><span class="st">                            inprod(B.year[year[evalRows[i]], ], X.year[evalRows[i], ])</span></span>
<span id="cb20-26"><a href="#cb20-26" aria-hidden="true" tabindex="-1"></a><span class="st">      #X.site[evalRows[i], ] ~ dnorm(0, pow(1, -2))</span></span>
<span id="cb20-27"><a href="#cb20-27" aria-hidden="true" tabindex="-1"></a><span class="st">      }</span></span>
<span id="cb20-28"><a href="#cb20-28" aria-hidden="true" tabindex="-1"></a><span class="st">    </span></span>
<span id="cb20-29"><a href="#cb20-29" aria-hidden="true" tabindex="-1"></a><span class="st">    </span></span>
<span id="cb20-30"><a href="#cb20-30" aria-hidden="true" tabindex="-1"></a><span class="st">    ###----------------- PRIORS ---------------------###</span></span>
<span id="cb20-31"><a href="#cb20-31" aria-hidden="true" tabindex="-1"></a><span class="st">    </span></span>
<span id="cb20-32"><a href="#cb20-32" aria-hidden="true" tabindex="-1"></a><span class="st">    # ar1, hierarchical by site</span></span>
<span id="cb20-33"><a href="#cb20-33" aria-hidden="true" tabindex="-1"></a><span class="st">    for (i in 1:nsites){</span></span>
<span id="cb20-34"><a href="#cb20-34" aria-hidden="true" tabindex="-1"></a><span class="st">      ar1[i] ~ dnorm(ar1Mean, pow(ar1SD, -2)) T(-1,1)       </span></span>
<span id="cb20-35"><a href="#cb20-35" aria-hidden="true" tabindex="-1"></a><span class="st">    }</span></span>
<span id="cb20-36"><a href="#cb20-36" aria-hidden="true" tabindex="-1"></a><span class="st">    ar1Mean ~ dunif(-1, 1) </span></span>
<span id="cb20-37"><a href="#cb20-37" aria-hidden="true" tabindex="-1"></a><span class="st">    ar1SD ~ dunif(0, 2)</span></span>
<span id="cb20-38"><a href="#cb20-38" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-39"><a href="#cb20-39" aria-hidden="true" tabindex="-1"></a><span class="st">    # model variance</span></span>
<span id="cb20-40"><a href="#cb20-40" aria-hidden="true" tabindex="-1"></a><span class="st">    sigma ~ dunif(0, 100)</span></span>
<span id="cb20-41"><a href="#cb20-41" aria-hidden="true" tabindex="-1"></a><span class="st">    </span></span>
<span id="cb20-42"><a href="#cb20-42" aria-hidden="true" tabindex="-1"></a><span class="st">    </span></span>
<span id="cb20-43"><a href="#cb20-43" aria-hidden="true" tabindex="-1"></a><span class="st">    # fixed effect coefficients</span></span>
<span id="cb20-44"><a href="#cb20-44" aria-hidden="true" tabindex="-1"></a><span class="st">    for (k in 1:Kfixed) {</span></span>
<span id="cb20-45"><a href="#cb20-45" aria-hidden="true" tabindex="-1"></a><span class="st">      B.0[k] ~ dnorm(0, 0.001)</span></span>
<span id="cb20-46"><a href="#cb20-46" aria-hidden="true" tabindex="-1"></a><span class="st">      }</span></span>
<span id="cb20-47"><a href="#cb20-47" aria-hidden="true" tabindex="-1"></a><span class="st">      </span></span>
<span id="cb20-48"><a href="#cb20-48" aria-hidden="true" tabindex="-1"></a><span class="st">    # random effect coefficients (by site)</span></span>
<span id="cb20-49"><a href="#cb20-49" aria-hidden="true" tabindex="-1"></a><span class="st">    for (k in 1:Krandom) {</span></span>
<span id="cb20-50"><a href="#cb20-50" aria-hidden="true" tabindex="-1"></a><span class="st">      sigma.B.site[k] ~ dunif(0, 100)</span></span>
<span id="cb20-51"><a href="#cb20-51" aria-hidden="true" tabindex="-1"></a><span class="st">      alpha.0[k] ~ dnorm(0, pow(10, -2))</span></span>
<span id="cb20-52"><a href="#cb20-52" aria-hidden="true" tabindex="-1"></a><span class="st">      alpha.1[k] ~ dnorm(0, pow(10, -2))</span></span>
<span id="cb20-53"><a href="#cb20-53" aria-hidden="true" tabindex="-1"></a><span class="st">      for (i in 1:nsites) {</span></span>
<span id="cb20-54"><a href="#cb20-54" aria-hidden="true" tabindex="-1"></a><span class="st">        B.site[i,k] ~ dnorm(mu.B.site[i,k], pow(sigma.B.site[k], -2))</span></span>
<span id="cb20-55"><a href="#cb20-55" aria-hidden="true" tabindex="-1"></a><span class="st">        mu.B.site[i,k] &lt;- alpha.0[k] + alpha.1[k] * area[i]</span></span>
<span id="cb20-56"><a href="#cb20-56" aria-hidden="true" tabindex="-1"></a><span class="st">      }</span></span>
<span id="cb20-57"><a href="#cb20-57" aria-hidden="true" tabindex="-1"></a><span class="st">    }</span></span>
<span id="cb20-58"><a href="#cb20-58" aria-hidden="true" tabindex="-1"></a><span class="st">    </span></span>
<span id="cb20-59"><a href="#cb20-59" aria-hidden="true" tabindex="-1"></a><span class="st">    # YEAR EFFECTS</span></span>
<span id="cb20-60"><a href="#cb20-60" aria-hidden="true" tabindex="-1"></a><span class="st">    for(l in 1:L) {</span></span>
<span id="cb20-61"><a href="#cb20-61" aria-hidden="true" tabindex="-1"></a><span class="st">      sigma.b.year[l] ~ dunif(0, 100)</span></span>
<span id="cb20-62"><a href="#cb20-62" aria-hidden="true" tabindex="-1"></a><span class="st">      for(t in 1:Ti){</span></span>
<span id="cb20-63"><a href="#cb20-63" aria-hidden="true" tabindex="-1"></a><span class="st">        B.year[t, l] ~ dnorm(0, pow(sigma.b.year[l], -2))</span></span>
<span id="cb20-64"><a href="#cb20-64" aria-hidden="true" tabindex="-1"></a><span class="st">        }</span></span>
<span id="cb20-65"><a href="#cb20-65" aria-hidden="true" tabindex="-1"></a><span class="st">      }</span></span>
<span id="cb20-66"><a href="#cb20-66" aria-hidden="true" tabindex="-1"></a><span class="st">    </span></span>
<span id="cb20-67"><a href="#cb20-67" aria-hidden="true" tabindex="-1"></a><span class="st">    # # YEAR EFFECTS</span></span>
<span id="cb20-68"><a href="#cb20-68" aria-hidden="true" tabindex="-1"></a><span class="st">    # # Priors for random effects of year</span></span>
<span id="cb20-69"><a href="#cb20-69" aria-hidden="true" tabindex="-1"></a><span class="st">    # for (t in 1:Ti) { # Ti years</span></span>
<span id="cb20-70"><a href="#cb20-70" aria-hidden="true" tabindex="-1"></a><span class="st">    #   B.year[t, 1:L] ~ dmnorm(mu.year[ ], tau.B.year[ , ])</span></span>
<span id="cb20-71"><a href="#cb20-71" aria-hidden="true" tabindex="-1"></a><span class="st">    #   }</span></span>
<span id="cb20-72"><a href="#cb20-72" aria-hidden="true" tabindex="-1"></a><span class="st">    #   </span></span>
<span id="cb20-73"><a href="#cb20-73" aria-hidden="true" tabindex="-1"></a><span class="st">    # mu.year[1] &lt;- 0</span></span>
<span id="cb20-74"><a href="#cb20-74" aria-hidden="true" tabindex="-1"></a><span class="st">    # </span></span>
<span id="cb20-75"><a href="#cb20-75" aria-hidden="true" tabindex="-1"></a><span class="st">    # for (l in 2:L) {</span></span>
<span id="cb20-76"><a href="#cb20-76" aria-hidden="true" tabindex="-1"></a><span class="st">    #   mu.year[l] ~ dnorm(0, 0.0001)</span></span>
<span id="cb20-77"><a href="#cb20-77" aria-hidden="true" tabindex="-1"></a><span class="st">    #   }</span></span>
<span id="cb20-78"><a href="#cb20-78" aria-hidden="true" tabindex="-1"></a><span class="st">    #   </span></span>
<span id="cb20-79"><a href="#cb20-79" aria-hidden="true" tabindex="-1"></a><span class="st">    # # Prior on multivariate normal std deviation</span></span>
<span id="cb20-80"><a href="#cb20-80" aria-hidden="true" tabindex="-1"></a><span class="st">    # tau.B.year[1:L, 1:L] ~ dwish(W.year[ , ], df.year)</span></span>
<span id="cb20-81"><a href="#cb20-81" aria-hidden="true" tabindex="-1"></a><span class="st">    # df.year &lt;- L + 1</span></span>
<span id="cb20-82"><a href="#cb20-82" aria-hidden="true" tabindex="-1"></a><span class="st">    # sigma.B.year[1:L, 1:L] &lt;- inverse(tau.B.year[ , ])</span></span>
<span id="cb20-83"><a href="#cb20-83" aria-hidden="true" tabindex="-1"></a><span class="st">    # for (l in 1:L) {</span></span>
<span id="cb20-84"><a href="#cb20-84" aria-hidden="true" tabindex="-1"></a><span class="st">    #   for (l.prime in 1:L) {</span></span>
<span id="cb20-85"><a href="#cb20-85" aria-hidden="true" tabindex="-1"></a><span class="st">    #     rho.B.year[l, l.prime] &lt;- sigma.B.year[l, l.prime]/sqrt(sigma.B.year[l, l]*sigma.B.year[l.prime, l.prime])</span></span>
<span id="cb20-86"><a href="#cb20-86" aria-hidden="true" tabindex="-1"></a><span class="st">    #     }</span></span>
<span id="cb20-87"><a href="#cb20-87" aria-hidden="true" tabindex="-1"></a><span class="st">    #   sigma.b.year[l] &lt;- sqrt(sigma.B.year[l, l])</span></span>
<span id="cb20-88"><a href="#cb20-88" aria-hidden="true" tabindex="-1"></a><span class="st">    # }</span></span>
<span id="cb20-89"><a href="#cb20-89" aria-hidden="true" tabindex="-1"></a><span class="st">    </span></span>
<span id="cb20-90"><a href="#cb20-90" aria-hidden="true" tabindex="-1"></a><span class="st">    </span></span>
<span id="cb20-91"><a href="#cb20-91" aria-hidden="true" tabindex="-1"></a><span class="st">    ###----------------- DERIVED VALUES -------------###</span></span>
<span id="cb20-92"><a href="#cb20-92" aria-hidden="true" tabindex="-1"></a><span class="st">    #residuals[1] &lt;- 0 # hold the place. Not sure if this is necessary...</span></span>
<span id="cb20-93"><a href="#cb20-93" aria-hidden="true" tabindex="-1"></a><span class="st">    for (i in 1:n) {</span></span>
<span id="cb20-94"><a href="#cb20-94" aria-hidden="true" tabindex="-1"></a><span class="st">      residuals[i] &lt;- temp[i] - stream.mu[i]</span></span>
<span id="cb20-95"><a href="#cb20-95" aria-hidden="true" tabindex="-1"></a><span class="st">    }</span></span>
<span id="cb20-96"><a href="#cb20-96" aria-hidden="true" tabindex="-1"></a><span class="st">    </span></span>
<span id="cb20-97"><a href="#cb20-97" aria-hidden="true" tabindex="-1"></a><span class="st">    # variance of model predictions (fixed + random effects)</span></span>
<span id="cb20-98"><a href="#cb20-98" aria-hidden="true" tabindex="-1"></a><span class="st">    var_fit &lt;- (sd(stream.mu))^2</span></span>
<span id="cb20-99"><a href="#cb20-99" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-100"><a href="#cb20-100" aria-hidden="true" tabindex="-1"></a><span class="st">    # residual variance</span></span>
<span id="cb20-101"><a href="#cb20-101" aria-hidden="true" tabindex="-1"></a><span class="st">    var_res &lt;- (sd(residuals))^2</span></span>
<span id="cb20-102"><a href="#cb20-102" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-103"><a href="#cb20-103" aria-hidden="true" tabindex="-1"></a><span class="st">    # calculate Bayesian R^2</span></span>
<span id="cb20-104"><a href="#cb20-104" aria-hidden="true" tabindex="-1"></a><span class="st">    R2 &lt;- var_fit / (var_fit + var_res)</span></span>
<span id="cb20-105"><a href="#cb20-105" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-106"><a href="#cb20-106" aria-hidden="true" tabindex="-1"></a><span class="st">    # Root mean squared error</span></span>
<span id="cb20-107"><a href="#cb20-107" aria-hidden="true" tabindex="-1"></a><span class="st">    rmse &lt;- sqrt(mean(residuals[]^2))</span></span>
<span id="cb20-108"><a href="#cb20-108" aria-hidden="true" tabindex="-1"></a><span class="st">    </span></span>
<span id="cb20-109"><a href="#cb20-109" aria-hidden="true" tabindex="-1"></a><span class="st">    }"</span>, <span class="at">file =</span> <span class="st">"JAGS models/DailyTempModelJAGS_Letcher_hierarchical_modified.txt"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>Specify model following Letcher et al.&nbsp;(2016). MODIFIED</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"model {</span></span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-3"><a href="#cb21-3" aria-hidden="true" tabindex="-1"></a><span class="st">    ###----------------- LIKELIHOOD -----------------###</span></span>
<span id="cb21-4"><a href="#cb21-4" aria-hidden="true" tabindex="-1"></a><span class="st">    </span></span>
<span id="cb21-5"><a href="#cb21-5" aria-hidden="true" tabindex="-1"></a><span class="st">    # Days without an observation on the previous day (first observation in a series)</span></span>
<span id="cb21-6"><a href="#cb21-6" aria-hidden="true" tabindex="-1"></a><span class="st">    # No autoregressive term</span></span>
<span id="cb21-7"><a href="#cb21-7" aria-hidden="true" tabindex="-1"></a><span class="st">    </span></span>
<span id="cb21-8"><a href="#cb21-8" aria-hidden="true" tabindex="-1"></a><span class="st">    for (i in 1:n){</span></span>
<span id="cb21-9"><a href="#cb21-9" aria-hidden="true" tabindex="-1"></a><span class="st">      temp[i] ~ dnorm(stream.mu[i], pow(sigma, -2)) </span></span>
<span id="cb21-10"><a href="#cb21-10" aria-hidden="true" tabindex="-1"></a><span class="st">      stream.mu[i] &lt;- trend[i]</span></span>
<span id="cb21-11"><a href="#cb21-11" aria-hidden="true" tabindex="-1"></a><span class="st">      trend[i] &lt;- inprod(B.site[site[i], ], X.site[i, ])</span></span>
<span id="cb21-12"><a href="#cb21-12" aria-hidden="true" tabindex="-1"></a><span class="st">      </span></span>
<span id="cb21-13"><a href="#cb21-13" aria-hidden="true" tabindex="-1"></a><span class="st">      #flow[firstObsRows[i]] ~ dnorm(0, pow(10, -2))</span></span>
<span id="cb21-14"><a href="#cb21-14" aria-hidden="true" tabindex="-1"></a><span class="st">      }</span></span>
<span id="cb21-15"><a href="#cb21-15" aria-hidden="true" tabindex="-1"></a><span class="st">    </span></span>
<span id="cb21-16"><a href="#cb21-16" aria-hidden="true" tabindex="-1"></a><span class="st">    # for (i in 1:nFirstObsRows){</span></span>
<span id="cb21-17"><a href="#cb21-17" aria-hidden="true" tabindex="-1"></a><span class="st">    #   temp[firstObsRows[i]] ~ dnorm(stream.mu[firstObsRows[i]], pow(sigma, -2)) </span></span>
<span id="cb21-18"><a href="#cb21-18" aria-hidden="true" tabindex="-1"></a><span class="st">    #   stream.mu[firstObsRows[i]] &lt;- trend[firstObsRows[i]]</span></span>
<span id="cb21-19"><a href="#cb21-19" aria-hidden="true" tabindex="-1"></a><span class="st">    #   trend[firstObsRows[i]] &lt;- inprod(B.0[], X.0[firstObsRows[i], ]) + inprod(B.site[site[firstObsRows[i]], ], X.site[firstObsRows[i], ]) #+ inprod(B.year[year[firstObsRows[i]], ], X.year[firstObsRows[i], ])</span></span>
<span id="cb21-20"><a href="#cb21-20" aria-hidden="true" tabindex="-1"></a><span class="st">    #   </span></span>
<span id="cb21-21"><a href="#cb21-21" aria-hidden="true" tabindex="-1"></a><span class="st">    #   #flow[firstObsRows[i]] ~ dnorm(0, pow(10, -2))</span></span>
<span id="cb21-22"><a href="#cb21-22" aria-hidden="true" tabindex="-1"></a><span class="st">    #   }</span></span>
<span id="cb21-23"><a href="#cb21-23" aria-hidden="true" tabindex="-1"></a><span class="st">    # </span></span>
<span id="cb21-24"><a href="#cb21-24" aria-hidden="true" tabindex="-1"></a><span class="st">    # # Days with an observation on the previous dat (all days following the first day)</span></span>
<span id="cb21-25"><a href="#cb21-25" aria-hidden="true" tabindex="-1"></a><span class="st">    # # Includes autoregressive term (ar1)</span></span>
<span id="cb21-26"><a href="#cb21-26" aria-hidden="true" tabindex="-1"></a><span class="st">    # </span></span>
<span id="cb21-27"><a href="#cb21-27" aria-hidden="true" tabindex="-1"></a><span class="st">    # for (i in 1:nEvalRows){ </span></span>
<span id="cb21-28"><a href="#cb21-28" aria-hidden="true" tabindex="-1"></a><span class="st">    #   temp[evalRows[i]] ~ dnorm(stream.mu[evalRows[i]], pow(sigma, -2))</span></span>
<span id="cb21-29"><a href="#cb21-29" aria-hidden="true" tabindex="-1"></a><span class="st">    #   stream.mu[evalRows[i]] &lt;- trend[evalRows[i]] + ar1[site[evalRows[i]]] * (temp[evalRows[i]-1] - trend[ evalRows[i]-1 ])</span></span>
<span id="cb21-30"><a href="#cb21-30" aria-hidden="true" tabindex="-1"></a><span class="st">    #   trend[evalRows[i]]  &lt;- inprod(B.0[], X.0[evalRows[i], ]) + inprod(B.site[site[evalRows[i]], ], X.site[evalRows[i], ]) #+ inprod(B.year[year[evalRows[i]], ], X.year[evalRows[i], ])</span></span>
<span id="cb21-31"><a href="#cb21-31" aria-hidden="true" tabindex="-1"></a><span class="st">    #   </span></span>
<span id="cb21-32"><a href="#cb21-32" aria-hidden="true" tabindex="-1"></a><span class="st">    #   #flow[evalRows[i]] ~ dnorm(0, pow(10, -2))</span></span>
<span id="cb21-33"><a href="#cb21-33" aria-hidden="true" tabindex="-1"></a><span class="st">    #   }</span></span>
<span id="cb21-34"><a href="#cb21-34" aria-hidden="true" tabindex="-1"></a><span class="st">    </span></span>
<span id="cb21-35"><a href="#cb21-35" aria-hidden="true" tabindex="-1"></a><span class="st">    </span></span>
<span id="cb21-36"><a href="#cb21-36" aria-hidden="true" tabindex="-1"></a><span class="st">    ###----------------- PRIORS ---------------------###</span></span>
<span id="cb21-37"><a href="#cb21-37" aria-hidden="true" tabindex="-1"></a><span class="st">    </span></span>
<span id="cb21-38"><a href="#cb21-38" aria-hidden="true" tabindex="-1"></a><span class="st">    # # ar1, hierarchical by site</span></span>
<span id="cb21-39"><a href="#cb21-39" aria-hidden="true" tabindex="-1"></a><span class="st">    # for (i in 1:nSite){</span></span>
<span id="cb21-40"><a href="#cb21-40" aria-hidden="true" tabindex="-1"></a><span class="st">    #   ar1[i] ~ dnorm(ar1Mean, pow(ar1SD,-2) ) T(-1,1)       </span></span>
<span id="cb21-41"><a href="#cb21-41" aria-hidden="true" tabindex="-1"></a><span class="st">    # }</span></span>
<span id="cb21-42"><a href="#cb21-42" aria-hidden="true" tabindex="-1"></a><span class="st">    # ar1Mean ~ dunif( -1,1 ) </span></span>
<span id="cb21-43"><a href="#cb21-43" aria-hidden="true" tabindex="-1"></a><span class="st">    # ar1SD ~ dunif( 0, 2 )</span></span>
<span id="cb21-44"><a href="#cb21-44" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-45"><a href="#cb21-45" aria-hidden="true" tabindex="-1"></a><span class="st">    # model variance</span></span>
<span id="cb21-46"><a href="#cb21-46" aria-hidden="true" tabindex="-1"></a><span class="st">    sigma ~ dunif(0, 100)</span></span>
<span id="cb21-47"><a href="#cb21-47" aria-hidden="true" tabindex="-1"></a><span class="st">    </span></span>
<span id="cb21-48"><a href="#cb21-48" aria-hidden="true" tabindex="-1"></a><span class="st">    </span></span>
<span id="cb21-49"><a href="#cb21-49" aria-hidden="true" tabindex="-1"></a><span class="st">    # fixed effect coefficients</span></span>
<span id="cb21-50"><a href="#cb21-50" aria-hidden="true" tabindex="-1"></a><span class="st">    for (k in 1:nFixedCovs) {</span></span>
<span id="cb21-51"><a href="#cb21-51" aria-hidden="true" tabindex="-1"></a><span class="st">      B.0[k] ~ dnorm(0, pow(100, -2))</span></span>
<span id="cb21-52"><a href="#cb21-52" aria-hidden="true" tabindex="-1"></a><span class="st">      }</span></span>
<span id="cb21-53"><a href="#cb21-53" aria-hidden="true" tabindex="-1"></a><span class="st">    </span></span>
<span id="cb21-54"><a href="#cb21-54" aria-hidden="true" tabindex="-1"></a><span class="st">    </span></span>
<span id="cb21-55"><a href="#cb21-55" aria-hidden="true" tabindex="-1"></a><span class="st">    # SITE EFFECTS</span></span>
<span id="cb21-56"><a href="#cb21-56" aria-hidden="true" tabindex="-1"></a><span class="st">    for (k in 1:nRandCovs) {</span></span>
<span id="cb21-57"><a href="#cb21-57" aria-hidden="true" tabindex="-1"></a><span class="st">      for (i in 1:nSite) {</span></span>
<span id="cb21-58"><a href="#cb21-58" aria-hidden="true" tabindex="-1"></a><span class="st">        B.site[i,k] ~ dnorm(0, pow(10, -2))   </span></span>
<span id="cb21-59"><a href="#cb21-59" aria-hidden="true" tabindex="-1"></a><span class="st">      }</span></span>
<span id="cb21-60"><a href="#cb21-60" aria-hidden="true" tabindex="-1"></a><span class="st">    }</span></span>
<span id="cb21-61"><a href="#cb21-61" aria-hidden="true" tabindex="-1"></a><span class="st">    </span></span>
<span id="cb21-62"><a href="#cb21-62" aria-hidden="true" tabindex="-1"></a><span class="st">      </span></span>
<span id="cb21-63"><a href="#cb21-63" aria-hidden="true" tabindex="-1"></a><span class="st">    # # YEAR EFFECTS</span></span>
<span id="cb21-64"><a href="#cb21-64" aria-hidden="true" tabindex="-1"></a><span class="st">    # # Priors for random effects of year</span></span>
<span id="cb21-65"><a href="#cb21-65" aria-hidden="true" tabindex="-1"></a><span class="st">    # for (t in 1:Ti) { # Ti years</span></span>
<span id="cb21-66"><a href="#cb21-66" aria-hidden="true" tabindex="-1"></a><span class="st">    #   B.year[t, 1:L] ~ dmnorm(mu.year[ ], tau.B.year[ , ])</span></span>
<span id="cb21-67"><a href="#cb21-67" aria-hidden="true" tabindex="-1"></a><span class="st">    #   }</span></span>
<span id="cb21-68"><a href="#cb21-68" aria-hidden="true" tabindex="-1"></a><span class="st">    # </span></span>
<span id="cb21-69"><a href="#cb21-69" aria-hidden="true" tabindex="-1"></a><span class="st">    # mu.year[1] &lt;- 0</span></span>
<span id="cb21-70"><a href="#cb21-70" aria-hidden="true" tabindex="-1"></a><span class="st">    # </span></span>
<span id="cb21-71"><a href="#cb21-71" aria-hidden="true" tabindex="-1"></a><span class="st">    # for (l in 2:L) {</span></span>
<span id="cb21-72"><a href="#cb21-72" aria-hidden="true" tabindex="-1"></a><span class="st">    #   mu.year[l] ~ dnorm(0, 0.0001)</span></span>
<span id="cb21-73"><a href="#cb21-73" aria-hidden="true" tabindex="-1"></a><span class="st">    #   }</span></span>
<span id="cb21-74"><a href="#cb21-74" aria-hidden="true" tabindex="-1"></a><span class="st">    # </span></span>
<span id="cb21-75"><a href="#cb21-75" aria-hidden="true" tabindex="-1"></a><span class="st">    # # Prior on multivariate normal std deviation</span></span>
<span id="cb21-76"><a href="#cb21-76" aria-hidden="true" tabindex="-1"></a><span class="st">    # tau.B.year[1:L, 1:L] ~ dwish(W.year[ , ], df.year)</span></span>
<span id="cb21-77"><a href="#cb21-77" aria-hidden="true" tabindex="-1"></a><span class="st">    # df.year &lt;- L + 1</span></span>
<span id="cb21-78"><a href="#cb21-78" aria-hidden="true" tabindex="-1"></a><span class="st">    # sigma.B.year[1:L, 1:L] &lt;- inverse(tau.B.year[ , ])</span></span>
<span id="cb21-79"><a href="#cb21-79" aria-hidden="true" tabindex="-1"></a><span class="st">    # for (l in 1:L) {</span></span>
<span id="cb21-80"><a href="#cb21-80" aria-hidden="true" tabindex="-1"></a><span class="st">    #   for (l.prime in 1:L) {</span></span>
<span id="cb21-81"><a href="#cb21-81" aria-hidden="true" tabindex="-1"></a><span class="st">    #     rho.B.year[l, l.prime] &lt;- sigma.B.year[l, l.prime]/sqrt(sigma.B.year[l, l]*sigma.B.year[l.prime, l.prime])</span></span>
<span id="cb21-82"><a href="#cb21-82" aria-hidden="true" tabindex="-1"></a><span class="st">    #     }</span></span>
<span id="cb21-83"><a href="#cb21-83" aria-hidden="true" tabindex="-1"></a><span class="st">    #   sigma.b.year[l] &lt;- sqrt(sigma.B.year[l, l])</span></span>
<span id="cb21-84"><a href="#cb21-84" aria-hidden="true" tabindex="-1"></a><span class="st">    # }</span></span>
<span id="cb21-85"><a href="#cb21-85" aria-hidden="true" tabindex="-1"></a><span class="st">    </span></span>
<span id="cb21-86"><a href="#cb21-86" aria-hidden="true" tabindex="-1"></a><span class="st">    </span></span>
<span id="cb21-87"><a href="#cb21-87" aria-hidden="true" tabindex="-1"></a><span class="st">    ###----------------- DERIVED VALUES -------------###</span></span>
<span id="cb21-88"><a href="#cb21-88" aria-hidden="true" tabindex="-1"></a><span class="st">    </span></span>
<span id="cb21-89"><a href="#cb21-89" aria-hidden="true" tabindex="-1"></a><span class="st">    # residuals</span></span>
<span id="cb21-90"><a href="#cb21-90" aria-hidden="true" tabindex="-1"></a><span class="st">    # residuals[1] &lt;- 0 # hold the place. Not sure if this is necessary...</span></span>
<span id="cb21-91"><a href="#cb21-91" aria-hidden="true" tabindex="-1"></a><span class="st">    for (i in 1:n) {</span></span>
<span id="cb21-92"><a href="#cb21-92" aria-hidden="true" tabindex="-1"></a><span class="st">      residuals[i] &lt;- temp[i] - stream.mu[i]</span></span>
<span id="cb21-93"><a href="#cb21-93" aria-hidden="true" tabindex="-1"></a><span class="st">    }</span></span>
<span id="cb21-94"><a href="#cb21-94" aria-hidden="true" tabindex="-1"></a><span class="st">    </span></span>
<span id="cb21-95"><a href="#cb21-95" aria-hidden="true" tabindex="-1"></a><span class="st">    # variance of model predictions (fixed + random effects)</span></span>
<span id="cb21-96"><a href="#cb21-96" aria-hidden="true" tabindex="-1"></a><span class="st">    var_fit &lt;- (sd(stream.mu))^2 </span></span>
<span id="cb21-97"><a href="#cb21-97" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-98"><a href="#cb21-98" aria-hidden="true" tabindex="-1"></a><span class="st">    # residual variance</span></span>
<span id="cb21-99"><a href="#cb21-99" aria-hidden="true" tabindex="-1"></a><span class="st">    var_res &lt;- (sd(residuals))^2</span></span>
<span id="cb21-100"><a href="#cb21-100" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-101"><a href="#cb21-101" aria-hidden="true" tabindex="-1"></a><span class="st">    # calculate Bayesian R^2</span></span>
<span id="cb21-102"><a href="#cb21-102" aria-hidden="true" tabindex="-1"></a><span class="st">    R2 &lt;- var_fit / (var_fit + var_res)</span></span>
<span id="cb21-103"><a href="#cb21-103" aria-hidden="true" tabindex="-1"></a><span class="st">    </span></span>
<span id="cb21-104"><a href="#cb21-104" aria-hidden="true" tabindex="-1"></a><span class="st">    # Root mean squared error</span></span>
<span id="cb21-105"><a href="#cb21-105" aria-hidden="true" tabindex="-1"></a><span class="st">    rmse &lt;- sqrt(mean(residuals[]^2))</span></span>
<span id="cb21-106"><a href="#cb21-106" aria-hidden="true" tabindex="-1"></a><span class="st">    </span></span>
<span id="cb21-107"><a href="#cb21-107" aria-hidden="true" tabindex="-1"></a><span class="st">    }"</span>, <span class="at">file =</span> <span class="st">"DailyTempModelJAGS_mod.txt"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="organize-objects" class="level2" data-number="6.3">
<h2 data-number="6.3" class="anchored" data-anchor-id="organize-objects"><span class="header-section-number">6.3</span> Organize objects</h2>
<p>Get first observation indices and check that nFirstRowObs equals the number of unique site-years: <strong>must be TRUE!</strong></p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a><span class="co"># row indices for first observation in each site-year</span></span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a>firstObsRows <span class="ot">&lt;-</span> <span class="fu">unlist</span>(dat <span class="sc">%&gt;%</span> </span>
<span id="cb22-3"><a href="#cb22-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(siteYear) <span class="sc">%&gt;%</span></span>
<span id="cb22-4"><a href="#cb22-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="at">index =</span> rowNum[<span class="fu">min</span>(<span class="fu">which</span>(<span class="sc">!</span><span class="fu">is.na</span>(tempc_mean)))]) <span class="sc">%&gt;%</span></span>
<span id="cb22-5"><a href="#cb22-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb22-6"><a href="#cb22-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(index))</span>
<span id="cb22-7"><a href="#cb22-7" aria-hidden="true" tabindex="-1"></a>nFirstObsRows <span class="ot">&lt;-</span> <span class="fu">length</span>(firstObsRows)</span>
<span id="cb22-8"><a href="#cb22-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-9"><a href="#cb22-9" aria-hidden="true" tabindex="-1"></a><span class="co"># does the number of first observations match the number of site years?</span></span>
<span id="cb22-10"><a href="#cb22-10" aria-hidden="true" tabindex="-1"></a>nFirstObsRows <span class="sc">==</span> <span class="fu">length</span>(<span class="fu">unique</span>(dat<span class="sc">$</span>siteYear))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>[1] TRUE</code></pre>
</div>
</div>
<p>Get row indices for all other observations</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a>evalRows <span class="ot">&lt;-</span> <span class="fu">unlist</span>(dat <span class="sc">%&gt;%</span> <span class="fu">filter</span>(<span class="sc">!</span>rowNum <span class="sc">%in%</span> firstObsRows) <span class="sc">%&gt;%</span> <span class="fu">select</span>(rowNum))</span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a>nEvalRows <span class="ot">&lt;-</span> <span class="fu">length</span>(evalRows)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>Fixed and random effect data</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a>data.random <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">intercept =</span> <span class="dv">1</span>,</span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a>                          <span class="at">airTemp =</span> dat<span class="sc">$</span>z_air_temp_mean, </span>
<span id="cb25-3"><a href="#cb25-3" aria-hidden="true" tabindex="-1"></a>                          <span class="at">flow =</span>  dat<span class="sc">$</span>z_Yield_mm_log,</span>
<span id="cb25-4"><a href="#cb25-4" aria-hidden="true" tabindex="-1"></a>                          <span class="at">airFlow =</span> dat<span class="sc">$</span>z_air_temp_mean <span class="sc">*</span> dat<span class="sc">$</span>z_Yield_mm_log)</span>
<span id="cb25-5"><a href="#cb25-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-6"><a href="#cb25-6" aria-hidden="true" tabindex="-1"></a>data.fixed <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">airTempLag1 =</span> dat<span class="sc">$</span>z_air_temp_mean_lag1,</span>
<span id="cb25-7"><a href="#cb25-7" aria-hidden="true" tabindex="-1"></a>                         <span class="at">airTempLag2 =</span> dat<span class="sc">$</span>z_air_temp_mean_lag2) </span>
<span id="cb25-8"><a href="#cb25-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-9"><a href="#cb25-9" aria-hidden="true" tabindex="-1"></a>data.random.years <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">intercept.year =</span> <span class="fu">rep</span>(<span class="dv">1</span>, <span class="at">length.out =</span> <span class="fu">dim</span>(data.fixed)[<span class="dv">1</span>])<span class="co">#, </span></span>
<span id="cb25-10"><a href="#cb25-10" aria-hidden="true" tabindex="-1"></a>                                <span class="co">#dOY  = dat$yday, </span></span>
<span id="cb25-11"><a href="#cb25-11" aria-hidden="true" tabindex="-1"></a>                                <span class="co">#dOY2 = dat$yday^2,</span></span>
<span id="cb25-12"><a href="#cb25-12" aria-hidden="true" tabindex="-1"></a>                                <span class="co">#dOY3 = dat$yday^3</span></span>
<span id="cb25-13"><a href="#cb25-13" aria-hidden="true" tabindex="-1"></a>                                )</span>
<span id="cb25-14"><a href="#cb25-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-15"><a href="#cb25-15" aria-hidden="true" tabindex="-1"></a>data.random.covs <span class="ot">&lt;-</span> <span class="fu">log</span>(dat <span class="sc">%&gt;%</span> <span class="fu">group_by</span>(site_code) <span class="sc">%&gt;%</span> <span class="fu">summarize</span>(<span class="at">area_sqmi =</span> <span class="fu">unique</span>(area_sqmi)) <span class="sc">%&gt;%</span> <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span> <span class="fu">arrange</span>(site_code) <span class="sc">%&gt;%</span> <span class="fu">pull</span>(area_sqmi))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>Misc. objects</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a>Ti <span class="ot">&lt;-</span> <span class="fu">length</span>(<span class="fu">unique</span>(dat<span class="sc">$</span>year))</span>
<span id="cb26-2"><a href="#cb26-2" aria-hidden="true" tabindex="-1"></a>L <span class="ot">&lt;-</span> <span class="fu">dim</span>(data.random.years)[<span class="dv">2</span>]</span>
<span id="cb26-3"><a href="#cb26-3" aria-hidden="true" tabindex="-1"></a>W.year <span class="ot">&lt;-</span> <span class="fu">diag</span>(L)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>Combine data in list</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a><span class="co"># combine data in a list</span></span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a>jags.data <span class="ot">&lt;-</span> <span class="fu">list</span>(<span class="st">"temp"</span> <span class="ot">=</span> dat<span class="sc">$</span>tempc_mean,</span>
<span id="cb27-3"><a href="#cb27-3" aria-hidden="true" tabindex="-1"></a>                  <span class="st">"nFirstObsRows"</span> <span class="ot">=</span> nFirstObsRows,</span>
<span id="cb27-4"><a href="#cb27-4" aria-hidden="true" tabindex="-1"></a>                  <span class="st">"firstObsRows"</span> <span class="ot">=</span> firstObsRows,</span>
<span id="cb27-5"><a href="#cb27-5" aria-hidden="true" tabindex="-1"></a>                  <span class="st">"nEvalRows"</span> <span class="ot">=</span> nEvalRows,</span>
<span id="cb27-6"><a href="#cb27-6" aria-hidden="true" tabindex="-1"></a>                  <span class="st">"evalRows"</span> <span class="ot">=</span> evalRows,</span>
<span id="cb27-7"><a href="#cb27-7" aria-hidden="true" tabindex="-1"></a>                  <span class="st">"X.0"</span> <span class="ot">=</span> <span class="fu">as.matrix</span>(data.fixed),</span>
<span id="cb27-8"><a href="#cb27-8" aria-hidden="true" tabindex="-1"></a>                  <span class="st">"X.site"</span> <span class="ot">=</span> <span class="fu">as.matrix</span>(data.random),</span>
<span id="cb27-9"><a href="#cb27-9" aria-hidden="true" tabindex="-1"></a>                  <span class="st">"X.year"</span> <span class="ot">=</span> <span class="fu">as.matrix</span>(data.random.years),</span>
<span id="cb27-10"><a href="#cb27-10" aria-hidden="true" tabindex="-1"></a>                  <span class="st">"Kfixed"</span> <span class="ot">=</span> <span class="fu">dim</span>(data.fixed)[<span class="dv">2</span>],</span>
<span id="cb27-11"><a href="#cb27-11" aria-hidden="true" tabindex="-1"></a>                  <span class="st">"Krandom"</span> <span class="ot">=</span> <span class="fu">dim</span>(data.random)[<span class="dv">2</span>],</span>
<span id="cb27-12"><a href="#cb27-12" aria-hidden="true" tabindex="-1"></a>                  <span class="st">"nsites"</span> <span class="ot">=</span> <span class="fu">length</span>(<span class="fu">unique</span>(dat<span class="sc">$</span>site_name)),</span>
<span id="cb27-13"><a href="#cb27-13" aria-hidden="true" tabindex="-1"></a>                  <span class="st">"Ti"</span> <span class="ot">=</span> Ti,</span>
<span id="cb27-14"><a href="#cb27-14" aria-hidden="true" tabindex="-1"></a>                  <span class="st">"L"</span> <span class="ot">=</span> L,</span>
<span id="cb27-15"><a href="#cb27-15" aria-hidden="true" tabindex="-1"></a>                  <span class="st">"W.year"</span> <span class="ot">=</span> W.year,</span>
<span id="cb27-16"><a href="#cb27-16" aria-hidden="true" tabindex="-1"></a>                  <span class="st">"n"</span> <span class="ot">=</span> <span class="fu">dim</span>(dat)[<span class="dv">1</span>],</span>
<span id="cb27-17"><a href="#cb27-17" aria-hidden="true" tabindex="-1"></a>                  <span class="st">"year"</span> <span class="ot">=</span> dat<span class="sc">$</span>year_code,</span>
<span id="cb27-18"><a href="#cb27-18" aria-hidden="true" tabindex="-1"></a>                  <span class="st">"site"</span> <span class="ot">=</span> dat<span class="sc">$</span>site_code,</span>
<span id="cb27-19"><a href="#cb27-19" aria-hidden="true" tabindex="-1"></a>                  <span class="st">"area"</span> <span class="ot">=</span> data.random.covs</span>
<span id="cb27-20"><a href="#cb27-20" aria-hidden="true" tabindex="-1"></a>                  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>Parameters to monitor</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a>jags.params <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"residuals"</span>,</span>
<span id="cb28-2"><a href="#cb28-2" aria-hidden="true" tabindex="-1"></a>                 <span class="st">"deviance"</span>,</span>
<span id="cb28-3"><a href="#cb28-3" aria-hidden="true" tabindex="-1"></a>                 <span class="st">"sigma"</span>,</span>
<span id="cb28-4"><a href="#cb28-4" aria-hidden="true" tabindex="-1"></a>                 <span class="st">"B.0"</span>,</span>
<span id="cb28-5"><a href="#cb28-5" aria-hidden="true" tabindex="-1"></a>                 <span class="st">"B.site"</span>,</span>
<span id="cb28-6"><a href="#cb28-6" aria-hidden="true" tabindex="-1"></a>                 <span class="st">"B.year"</span>,</span>
<span id="cb28-7"><a href="#cb28-7" aria-hidden="true" tabindex="-1"></a>                 <span class="st">"rho.B.year"</span>,</span>
<span id="cb28-8"><a href="#cb28-8" aria-hidden="true" tabindex="-1"></a>                 <span class="st">"mu.year"</span>,</span>
<span id="cb28-9"><a href="#cb28-9" aria-hidden="true" tabindex="-1"></a>                 <span class="st">"sigma.b.year"</span>,</span>
<span id="cb28-10"><a href="#cb28-10" aria-hidden="true" tabindex="-1"></a>                 <span class="st">"stream.mu"</span>,</span>
<span id="cb28-11"><a href="#cb28-11" aria-hidden="true" tabindex="-1"></a>                 <span class="st">"ar1"</span> ,</span>
<span id="cb28-12"><a href="#cb28-12" aria-hidden="true" tabindex="-1"></a>                 <span class="st">"ar1Mean"</span>,</span>
<span id="cb28-13"><a href="#cb28-13" aria-hidden="true" tabindex="-1"></a>                 <span class="st">"ar1SD"</span>,</span>
<span id="cb28-14"><a href="#cb28-14" aria-hidden="true" tabindex="-1"></a>                 <span class="st">"temp"</span>,</span>
<span id="cb28-15"><a href="#cb28-15" aria-hidden="true" tabindex="-1"></a>                 <span class="st">"sigma.B.site"</span>,</span>
<span id="cb28-16"><a href="#cb28-16" aria-hidden="true" tabindex="-1"></a>                 <span class="st">"R2"</span>,</span>
<span id="cb28-17"><a href="#cb28-17" aria-hidden="true" tabindex="-1"></a>                 <span class="st">"rmse"</span>,</span>
<span id="cb28-18"><a href="#cb28-18" aria-hidden="true" tabindex="-1"></a>                 <span class="st">"alpha.0"</span>,</span>
<span id="cb28-19"><a href="#cb28-19" aria-hidden="true" tabindex="-1"></a>                 <span class="st">"alpha.1"</span></span>
<span id="cb28-20"><a href="#cb28-20" aria-hidden="true" tabindex="-1"></a>                 )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="fit-model" class="level2" data-number="6.4">
<h2 data-number="6.4" class="anchored" data-anchor-id="fit-model"><span class="header-section-number">6.4</span> Fit model</h2>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a>fit_ed <span class="ot">&lt;-</span> <span class="fu">jags.parallel</span>(<span class="at">data =</span> jags.data, <span class="at">inits =</span> <span class="cn">NULL</span>, <span class="at">parameters.to.save =</span> jags.params, </span>
<span id="cb29-2"><a href="#cb29-2" aria-hidden="true" tabindex="-1"></a>                        <span class="at">model.file =</span> <span class="st">"JAGS models/DailyTempModelJAGS_Letcher_hierarchical_modified.txt"</span>,</span>
<span id="cb29-3"><a href="#cb29-3" aria-hidden="true" tabindex="-1"></a>                        <span class="at">n.chains =</span> <span class="dv">10</span>, <span class="at">n.thin =</span> <span class="dv">10</span>, <span class="at">n.burnin =</span> <span class="dv">1000</span>, <span class="at">n.iter =</span> <span class="dv">3000</span>, <span class="at">DIC =</span> <span class="cn">TRUE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<section id="save-model-ouput" class="level4" data-number="6.4.0.1">
<h4 data-number="6.4.0.1" class="anchored" data-anchor-id="save-model-ouput"><span class="header-section-number">6.4.0.1</span> Save model ouput</h4>
<p>Save to file</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a><span class="fu">saveRDS</span>(fit_ed, <span class="st">"Model objects/LetcherTempModel_EcoDrought_hierarchical.RDS"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>Read in fitted model object</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb31"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a>fit_ed <span class="ot">&lt;-</span> <span class="fu">readRDS</span>(<span class="st">"Model objects/LetcherTempModel_EcoDrought_hierarchical.RDS"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>Get MCMC samples and summary</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb32"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a>top_mod <span class="ot">&lt;-</span> fit_ed</span>
<span id="cb32-2"><a href="#cb32-2" aria-hidden="true" tabindex="-1"></a><span class="co"># generate MCMC samples and store as an array</span></span>
<span id="cb32-3"><a href="#cb32-3" aria-hidden="true" tabindex="-1"></a>modelout <span class="ot">&lt;-</span> top_mod<span class="sc">$</span>BUGSoutput</span>
<span id="cb32-4"><a href="#cb32-4" aria-hidden="true" tabindex="-1"></a>McmcList <span class="ot">&lt;-</span> <span class="fu">vector</span>(<span class="st">"list"</span>, <span class="at">length =</span> <span class="fu">dim</span>(modelout<span class="sc">$</span>sims.array)[<span class="dv">2</span>])</span>
<span id="cb32-5"><a href="#cb32-5" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(McmcList)) { McmcList[[i]] <span class="ot">=</span> <span class="fu">as.mcmc</span>(modelout<span class="sc">$</span>sims.array[,i,]) }</span>
<span id="cb32-6"><a href="#cb32-6" aria-hidden="true" tabindex="-1"></a><span class="co"># rbind MCMC samples from 10 chains </span></span>
<span id="cb32-7"><a href="#cb32-7" aria-hidden="true" tabindex="-1"></a>Mcmcdat <span class="ot">&lt;-</span> <span class="fu">rbind</span>(McmcList[[<span class="dv">1</span>]], McmcList[[<span class="dv">2</span>]], McmcList[[<span class="dv">3</span>]], McmcList[[<span class="dv">4</span>]], McmcList[[<span class="dv">5</span>]], McmcList[[<span class="dv">6</span>]], McmcList[[<span class="dv">7</span>]], McmcList[[<span class="dv">8</span>]], McmcList[[<span class="dv">9</span>]], McmcList[[<span class="dv">10</span>]])</span>
<span id="cb32-8"><a href="#cb32-8" aria-hidden="true" tabindex="-1"></a>param.summary <span class="ot">&lt;-</span> modelout<span class="sc">$</span>summary</span>
<span id="cb32-9"><a href="#cb32-9" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(param.summary)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>                  mean         sd       2.5%        25%        50%       75%
B.0[1]      2.15300662 0.03019149 2.09367575 2.13210168 2.15254591 2.1735374
B.0[2]      0.09596838 0.03088395 0.03609678 0.07543631 0.09507888 0.1169487
B.site[1,1] 3.31907307 0.42373653 2.47278936 3.03330096 3.33164372 3.6125047
B.site[2,1] 4.67201490 0.27201792 4.12197692 4.49187169 4.67167411 4.8533811
B.site[3,1] 3.73162935 0.26306430 3.21714881 3.56051475 3.73538781 3.9036637
B.site[4,1] 7.72579212 0.29002571 7.15906884 7.53508128 7.72881227 7.9176183
                97.5%      Rhat n.eff
B.0[1]      2.2120172 1.0000096  2000
B.0[2]      0.1563257 1.0010937  2000
B.site[1,1] 4.1330942 1.0009200  2000
B.site[2,1] 5.2124136 0.9998663  2000
B.site[3,1] 4.2497683 1.0017038  1700
B.site[4,1] 8.2921851 0.9997870  2000</code></pre>
</div>
</div>
</section>
<section id="check-convergence" class="level4" data-number="6.4.0.2">
<h4 data-number="6.4.0.2" class="anchored" data-anchor-id="check-convergence"><span class="header-section-number">6.4.0.2</span> Check convergence</h4>
<p>Any problematic R-hat values (&gt;1.05)?</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb34"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a>top_mod<span class="sc">$</span>BUGSoutput<span class="sc">$</span>summary[,<span class="dv">8</span>][top_mod<span class="sc">$</span>BUGSoutput<span class="sc">$</span>summary[,<span class="dv">8</span>] <span class="sc">&gt;</span> <span class="fl">1.05</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>named numeric(0)</code></pre>
</div>
</div>
<p>View traceplots</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb36"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a><span class="fu">MCMCtrace</span>(top_mod, <span class="at">ind =</span> <span class="cn">TRUE</span>, </span>
<span id="cb36-2"><a href="#cb36-2" aria-hidden="true" tabindex="-1"></a>          <span class="at">params =</span> <span class="fu">c</span>(<span class="st">"B.0"</span>, <span class="st">"B.site"</span>, <span class="st">"B.year"</span>, </span>
<span id="cb36-3"><a href="#cb36-3" aria-hidden="true" tabindex="-1"></a>                     <span class="st">"ar1"</span>, <span class="st">"alpha.0"</span>, <span class="st">"alpha.1"</span>,</span>
<span id="cb36-4"><a href="#cb36-4" aria-hidden="true" tabindex="-1"></a>                     <span class="st">"sigma"</span>), <span class="at">pdf =</span> <span class="cn">FALSE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="ModelTemp-EcoDrought_files/figure-html/unnamed-chunk-25-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="ModelTemp-EcoDrought_files/figure-html/unnamed-chunk-25-2.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="ModelTemp-EcoDrought_files/figure-html/unnamed-chunk-25-3.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="ModelTemp-EcoDrought_files/figure-html/unnamed-chunk-25-4.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="ModelTemp-EcoDrought_files/figure-html/unnamed-chunk-25-5.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="ModelTemp-EcoDrought_files/figure-html/unnamed-chunk-25-6.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="ModelTemp-EcoDrought_files/figure-html/unnamed-chunk-25-7.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="ModelTemp-EcoDrought_files/figure-html/unnamed-chunk-25-8.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="ModelTemp-EcoDrought_files/figure-html/unnamed-chunk-25-9.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="ModelTemp-EcoDrought_files/figure-html/unnamed-chunk-25-10.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="ModelTemp-EcoDrought_files/figure-html/unnamed-chunk-25-11.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="ModelTemp-EcoDrought_files/figure-html/unnamed-chunk-25-12.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="ModelTemp-EcoDrought_files/figure-html/unnamed-chunk-25-13.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="ModelTemp-EcoDrought_files/figure-html/unnamed-chunk-25-14.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="ModelTemp-EcoDrought_files/figure-html/unnamed-chunk-25-15.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="ModelTemp-EcoDrought_files/figure-html/unnamed-chunk-25-16.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="ModelTemp-EcoDrought_files/figure-html/unnamed-chunk-25-17.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="ModelTemp-EcoDrought_files/figure-html/unnamed-chunk-25-18.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="ModelTemp-EcoDrought_files/figure-html/unnamed-chunk-25-19.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="ModelTemp-EcoDrought_files/figure-html/unnamed-chunk-25-20.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="ModelTemp-EcoDrought_files/figure-html/unnamed-chunk-25-21.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="ModelTemp-EcoDrought_files/figure-html/unnamed-chunk-25-22.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="ModelTemp-EcoDrought_files/figure-html/unnamed-chunk-25-23.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="ModelTemp-EcoDrought_files/figure-html/unnamed-chunk-25-24.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="ModelTemp-EcoDrought_files/figure-html/unnamed-chunk-25-25.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="ModelTemp-EcoDrought_files/figure-html/unnamed-chunk-25-26.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="ModelTemp-EcoDrought_files/figure-html/unnamed-chunk-25-27.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>Convert to ggs object</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb37"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a>ggfit <span class="ot">&lt;-</span> <span class="fu">ggs</span>(<span class="fu">as.mcmc</span>(top_mod), <span class="at">keep_original_order =</span> <span class="cn">TRUE</span>)</span>
<span id="cb37-2"><a href="#cb37-2" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(ggfit)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 6 × 4
  Iteration Chain Parameter  value
      &lt;int&gt; &lt;int&gt; &lt;fct&gt;      &lt;dbl&gt;
1         1     1 alpha.0[1]  4.77
2         2     1 alpha.0[1]  4.89
3         3     1 alpha.0[1]  5.72
4         4     1 alpha.0[1]  5.16
5         5     1 alpha.0[1]  4.43
6         6     1 alpha.0[1]  1.15</code></pre>
</div>
</div>
</section>
<section id="goodness-of-fit" class="level3" data-number="6.4.1">
<h3 data-number="6.4.1" class="anchored" data-anchor-id="goodness-of-fit"><span class="header-section-number">6.4.1</span> Goodness of fit</h3>
<p>Format observed and predicted values</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb39"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb39-1"><a href="#cb39-1" aria-hidden="true" tabindex="-1"></a>Mcmcdat <span class="ot">&lt;-</span> <span class="fu">as_tibble</span>(Mcmcdat)</span>
<span id="cb39-2"><a href="#cb39-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-3"><a href="#cb39-3" aria-hidden="true" tabindex="-1"></a><span class="co"># subset expected and observed MCMC samples</span></span>
<span id="cb39-4"><a href="#cb39-4" aria-hidden="true" tabindex="-1"></a>ppdat_exp <span class="ot">&lt;-</span> <span class="fu">as.matrix</span>(Mcmcdat[,<span class="fu">startsWith</span>(<span class="fu">names</span>(Mcmcdat), <span class="st">"stream.mu["</span>)])</span>
<span id="cb39-5"><a href="#cb39-5" aria-hidden="true" tabindex="-1"></a>ppdat_obs <span class="ot">&lt;-</span> <span class="fu">as.matrix</span>(Mcmcdat[,<span class="fu">startsWith</span>(<span class="fu">names</span>(Mcmcdat), <span class="st">"temp["</span>)])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>Bayesian p-value</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb40"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb40-1"><a href="#cb40-1" aria-hidden="true" tabindex="-1"></a><span class="fu">sum</span>(ppdat_exp <span class="sc">&gt;</span> ppdat_obs) <span class="sc">/</span> (<span class="fu">dim</span>(ppdat_obs)[<span class="dv">1</span>]<span class="sc">*</span><span class="fu">dim</span>(ppdat_obs)[<span class="dv">2</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.5128413</code></pre>
</div>
</div>
<p>PP-check, global</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb42"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb42-1"><a href="#cb42-1" aria-hidden="true" tabindex="-1"></a>ppdat_obs_mean <span class="ot">&lt;-</span> <span class="fu">apply</span>(ppdat_obs, <span class="dv">2</span>, mean)</span>
<span id="cb42-2"><a href="#cb42-2" aria-hidden="true" tabindex="-1"></a>ppdat_exp_mean <span class="ot">&lt;-</span> <span class="fu">apply</span>(ppdat_exp, <span class="dv">2</span>, mean)</span>
<span id="cb42-3"><a href="#cb42-3" aria-hidden="true" tabindex="-1"></a><span class="fu">tibble</span>(<span class="at">obs =</span> ppdat_obs_mean, <span class="at">exp =</span> ppdat_exp_mean) <span class="sc">%&gt;%</span> </span>
<span id="cb42-4"><a href="#cb42-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> obs, <span class="at">y =</span> exp)) <span class="sc">+</span> </span>
<span id="cb42-5"><a href="#cb42-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">alpha =</span> <span class="fl">0.1</span>) <span class="sc">+</span> </span>
<span id="cb42-6"><a href="#cb42-6" aria-hidden="true" tabindex="-1"></a>  <span class="co"># geom_smooth(method = "lm") +</span></span>
<span id="cb42-7"><a href="#cb42-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_abline</span>(<span class="at">intercept =</span> <span class="dv">0</span>, <span class="at">slope =</span> <span class="dv">1</span>, <span class="at">color =</span> <span class="st">"red"</span>) <span class="sc">+</span> </span>
<span id="cb42-8"><a href="#cb42-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>() <span class="sc">+</span> <span class="fu">theme</span>(<span class="at">panel.grid =</span> <span class="fu">element_blank</span>()) <span class="sc">+</span></span>
<span id="cb42-9"><a href="#cb42-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="st">"Observed"</span>) <span class="sc">+</span> <span class="fu">ylab</span>(<span class="st">"Predicted (mean)"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="ModelTemp-EcoDrought_files/figure-html/unnamed-chunk-29-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>PP-check by river and year</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb43"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb43-1"><a href="#cb43-1" aria-hidden="true" tabindex="-1"></a><span class="fu">tibble</span>(<span class="at">obs =</span> ppdat_obs_mean, <span class="at">exp =</span> ppdat_exp_mean, <span class="at">site =</span> dat<span class="sc">$</span>site_name, <span class="at">year =</span> dat<span class="sc">$</span>year) <span class="sc">%&gt;%</span> </span>
<span id="cb43-2"><a href="#cb43-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> obs, <span class="at">y =</span> exp)) <span class="sc">+</span> </span>
<span id="cb43-3"><a href="#cb43-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">alpha =</span> <span class="fl">0.1</span>) <span class="sc">+</span> </span>
<span id="cb43-4"><a href="#cb43-4" aria-hidden="true" tabindex="-1"></a>  <span class="co"># geom_smooth(method = "lm") +</span></span>
<span id="cb43-5"><a href="#cb43-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_abline</span>(<span class="at">intercept =</span> <span class="dv">0</span>, <span class="at">slope =</span> <span class="dv">1</span>, <span class="at">color =</span> <span class="st">"red"</span>) <span class="sc">+</span> </span>
<span id="cb43-6"><a href="#cb43-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>() <span class="sc">+</span> <span class="fu">theme</span>(<span class="at">panel.grid =</span> <span class="fu">element_blank</span>()) <span class="sc">+</span></span>
<span id="cb43-7"><a href="#cb43-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="st">"Observed"</span>) <span class="sc">+</span> <span class="fu">ylab</span>(<span class="st">"Predicted (mean)"</span>) <span class="sc">+</span></span>
<span id="cb43-8"><a href="#cb43-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_grid</span>(year <span class="sc">~</span> site)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="ModelTemp-EcoDrought_files/figure-html/unnamed-chunk-30-1.png" class="img-fluid figure-img" width="960"></p>
</figure>
</div>
</div>
</div>
<p>RMSE</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb44"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb44-1"><a href="#cb44-1" aria-hidden="true" tabindex="-1"></a><span class="fu">mean</span>(<span class="fu">unlist</span>(ggfit <span class="sc">%&gt;%</span> <span class="fu">filter</span>(Parameter <span class="sc">==</span> <span class="st">"rmse"</span>) <span class="sc">%&gt;%</span> <span class="fu">select</span>(value)))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.6298153</code></pre>
</div>
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb46"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb46-1"><a href="#cb46-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggs_density</span>(ggfit, <span class="st">"rmse"</span>) <span class="sc">+</span> <span class="fu">theme_bw</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="ModelTemp-EcoDrought_files/figure-html/unnamed-chunk-31-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>R-squared</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb47"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb47-1"><a href="#cb47-1" aria-hidden="true" tabindex="-1"></a><span class="fu">mean</span>(<span class="fu">unlist</span>(ggfit <span class="sc">%&gt;%</span> <span class="fu">filter</span>(Parameter <span class="sc">==</span> <span class="st">"R2"</span>) <span class="sc">%&gt;%</span> <span class="fu">select</span>(value)))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.9705148</code></pre>
</div>
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb49"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb49-1"><a href="#cb49-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggs_density</span>(ggfit, <span class="st">"R2"</span>) <span class="sc">+</span> <span class="fu">theme_bw</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="ModelTemp-EcoDrought_files/figure-html/unnamed-chunk-32-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
</section>
<section id="plot-model-output" class="level2" data-number="6.5">
<h2 data-number="6.5" class="anchored" data-anchor-id="plot-model-output"><span class="header-section-number">6.5</span> Plot model output</h2>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb50"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb50-1"><a href="#cb50-1" aria-hidden="true" tabindex="-1"></a>myparams <span class="ot">&lt;-</span> <span class="fu">unique</span>(ggfit<span class="sc">$</span>Parameter)</span>
<span id="cb50-2"><a href="#cb50-2" aria-hidden="true" tabindex="-1"></a>mysites <span class="ot">&lt;-</span> <span class="fu">c</span>(dat <span class="sc">%&gt;%</span> <span class="fu">group_by</span>(site_name) <span class="sc">%&gt;%</span> <span class="fu">summarize</span>(<span class="at">site_code =</span> <span class="fu">unique</span>(site_code)) <span class="sc">%&gt;%</span> <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span> <span class="fu">select</span>(site_name))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<section id="dot-plots" class="level3" data-number="6.5.1">
<h3 data-number="6.5.1" class="anchored" data-anchor-id="dot-plots"><span class="header-section-number">6.5.1</span> Dot plots</h3>
<div class="tabset-margin-container"></div><div class="panel-tabset">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-2-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-2-1" role="tab" aria-controls="tabset-2-1" aria-selected="true">Fixed effects</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-2-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-2-2" role="tab" aria-controls="tabset-2-2" aria-selected="false">Site intercepts</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-2-3-tab" data-bs-toggle="tab" data-bs-target="#tabset-2-3" role="tab" aria-controls="tabset-2-3" aria-selected="false">Site slopes - temp</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-2-4-tab" data-bs-toggle="tab" data-bs-target="#tabset-2-4" role="tab" aria-controls="tabset-2-4" aria-selected="false">Site slopes - flow</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-2-5-tab" data-bs-toggle="tab" data-bs-target="#tabset-2-5" role="tab" aria-controls="tabset-2-5" aria-selected="false">Site slopes - temp x flow</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-2-6-tab" data-bs-toggle="tab" data-bs-target="#tabset-2-6" role="tab" aria-controls="tabset-2-6" aria-selected="false">Autoregressive terms</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-2-7-tab" data-bs-toggle="tab" data-bs-target="#tabset-2-7" role="tab" aria-controls="tabset-2-7" aria-selected="false">Year effects (offsets)</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-2-8-tab" data-bs-toggle="tab" data-bs-target="#tabset-2-8" role="tab" aria-controls="tabset-2-8" aria-selected="false">Catchment area effects</a></li></ul>
<div class="tab-content">
<div id="tabset-2-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-2-1-tab">
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb51"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb51-1"><a href="#cb51-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggs_caterpillar</span>(ggfit, <span class="at">family =</span> <span class="st">"B.0"</span>, <span class="at">sort =</span> <span class="cn">FALSE</span>) <span class="sc">+</span></span>
<span id="cb51-2"><a href="#cb51-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_discrete</span>(<span class="at">labels =</span> <span class="fu">rev</span>(<span class="fu">c</span>(<span class="st">"Air temp, lag 1"</span>, <span class="st">"Air temp, lag 2"</span>)), <span class="at">limits =</span> rev) <span class="sc">+</span> </span>
<span id="cb51-3"><a href="#cb51-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylab</span>(<span class="st">"Fixed effects"</span>) <span class="sc">+</span></span>
<span id="cb51-4"><a href="#cb51-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="ModelTemp-EcoDrought_files/figure-html/unnamed-chunk-34-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</div>
<div id="tabset-2-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-2-2-tab">
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb52"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb52-1"><a href="#cb52-1" aria-hidden="true" tabindex="-1"></a>ggfit <span class="sc">%&gt;%</span></span>
<span id="cb52-2"><a href="#cb52-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(Parameter <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"B.site[1,1]"</span>, <span class="st">"B.site[2,1]"</span>, <span class="st">"B.site[3,1]"</span>, <span class="st">"B.site[4,1]"</span>, <span class="st">"B.site[5,1]"</span>,</span>
<span id="cb52-3"><a href="#cb52-3" aria-hidden="true" tabindex="-1"></a>                          <span class="st">"B.site[6,1]"</span>, <span class="st">"B.site[7,1]"</span>, <span class="st">"B.site[8,1]"</span>, <span class="st">"B.site[9,1]"</span>, <span class="st">"B.site[10,1]"</span>, <span class="st">"B.site[11,1]"</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb52-4"><a href="#cb52-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Parameter =</span> <span class="fu">factor</span>(Parameter, <span class="at">levels =</span> <span class="fu">c</span>(<span class="st">"B.site[1,1]"</span>, <span class="st">"B.site[2,1]"</span>, <span class="st">"B.site[3,1]"</span>, <span class="st">"B.site[4,1]"</span>, <span class="st">"B.site[5,1]"</span>,</span>
<span id="cb52-5"><a href="#cb52-5" aria-hidden="true" tabindex="-1"></a>                                                  <span class="st">"B.site[6,1]"</span>, <span class="st">"B.site[7,1]"</span>, <span class="st">"B.site[8,1]"</span>, <span class="st">"B.site[9,1]"</span>, <span class="st">"B.site[10,1]"</span>, <span class="st">"B.site[11,1]"</span>))) <span class="sc">%&gt;%</span></span>
<span id="cb52-6"><a href="#cb52-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggs_caterpillar</span>(<span class="at">sort =</span> <span class="cn">FALSE</span>) <span class="sc">+</span></span>
<span id="cb52-7"><a href="#cb52-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_discrete</span>(<span class="at">labels =</span> <span class="fu">rev</span>(mysites<span class="sc">$</span>site_name), <span class="at">limits =</span> rev) <span class="sc">+</span> </span>
<span id="cb52-8"><a href="#cb52-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylab</span>(<span class="st">"Intercepts"</span>) <span class="sc">+</span></span>
<span id="cb52-9"><a href="#cb52-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="ModelTemp-EcoDrought_files/figure-html/unnamed-chunk-35-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</div>
<div id="tabset-2-3" class="tab-pane" role="tabpanel" aria-labelledby="tabset-2-3-tab">
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb53"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb53-1"><a href="#cb53-1" aria-hidden="true" tabindex="-1"></a>ggfit <span class="sc">%&gt;%</span></span>
<span id="cb53-2"><a href="#cb53-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(Parameter <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"B.site[1,2]"</span>, <span class="st">"B.site[2,2]"</span>, <span class="st">"B.site[3,2]"</span>, <span class="st">"B.site[4,2]"</span>, <span class="st">"B.site[5,2]"</span>,</span>
<span id="cb53-3"><a href="#cb53-3" aria-hidden="true" tabindex="-1"></a>                          <span class="st">"B.site[6,2]"</span>, <span class="st">"B.site[7,2]"</span>, <span class="st">"B.site[8,2]"</span>, <span class="st">"B.site[9,2]"</span>, <span class="st">"B.site[10,2]"</span>, <span class="st">"B.site[11,2]"</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb53-4"><a href="#cb53-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Parameter =</span> <span class="fu">factor</span>(Parameter, <span class="at">levels =</span> <span class="fu">c</span>(<span class="st">"B.site[1,2]"</span>, <span class="st">"B.site[2,2]"</span>, <span class="st">"B.site[3,2]"</span>, <span class="st">"B.site[4,2]"</span>, <span class="st">"B.site[5,2]"</span>,</span>
<span id="cb53-5"><a href="#cb53-5" aria-hidden="true" tabindex="-1"></a>                          <span class="st">"B.site[6,2]"</span>, <span class="st">"B.site[7,2]"</span>, <span class="st">"B.site[8,2]"</span>, <span class="st">"B.site[9,2]"</span>, <span class="st">"B.site[10,2]"</span>, <span class="st">"B.site[11,2]"</span>))) <span class="sc">%&gt;%</span></span>
<span id="cb53-6"><a href="#cb53-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggs_caterpillar</span>(<span class="at">sort =</span> <span class="cn">FALSE</span>) <span class="sc">+</span></span>
<span id="cb53-7"><a href="#cb53-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_discrete</span>(<span class="at">labels =</span> <span class="fu">rev</span>(mysites<span class="sc">$</span>site_name), <span class="at">limits =</span> rev) <span class="sc">+</span> </span>
<span id="cb53-8"><a href="#cb53-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylab</span>(<span class="st">"Slopes, temperature effect"</span>) <span class="sc">+</span></span>
<span id="cb53-9"><a href="#cb53-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="ModelTemp-EcoDrought_files/figure-html/unnamed-chunk-36-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</div>
<div id="tabset-2-4" class="tab-pane" role="tabpanel" aria-labelledby="tabset-2-4-tab">
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb54"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb54-1"><a href="#cb54-1" aria-hidden="true" tabindex="-1"></a>ggfit <span class="sc">%&gt;%</span></span>
<span id="cb54-2"><a href="#cb54-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(Parameter <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"B.site[1,3]"</span>, <span class="st">"B.site[2,3]"</span>, <span class="st">"B.site[3,3]"</span>, <span class="st">"B.site[4,3]"</span>, <span class="st">"B.site[5,3]"</span>,</span>
<span id="cb54-3"><a href="#cb54-3" aria-hidden="true" tabindex="-1"></a>                          <span class="st">"B.site[6,3]"</span>, <span class="st">"B.site[7,3]"</span>, <span class="st">"B.site[8,3]"</span>, <span class="st">"B.site[9,3]"</span>, <span class="st">"B.site[10,3]"</span>, <span class="st">"B.site[11,3]"</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb54-4"><a href="#cb54-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Parameter =</span> <span class="fu">factor</span>(Parameter, <span class="at">levels =</span> <span class="fu">c</span>(<span class="st">"B.site[1,3]"</span>, <span class="st">"B.site[2,3]"</span>, <span class="st">"B.site[3,3]"</span>, <span class="st">"B.site[4,3]"</span>, <span class="st">"B.site[5,3]"</span>,</span>
<span id="cb54-5"><a href="#cb54-5" aria-hidden="true" tabindex="-1"></a>                          <span class="st">"B.site[6,3]"</span>, <span class="st">"B.site[7,3]"</span>, <span class="st">"B.site[8,3]"</span>, <span class="st">"B.site[9,3]"</span>, <span class="st">"B.site[10,3]"</span>, <span class="st">"B.site[11,3]"</span>))) <span class="sc">%&gt;%</span></span>
<span id="cb54-6"><a href="#cb54-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggs_caterpillar</span>(<span class="at">sort =</span> <span class="cn">FALSE</span>) <span class="sc">+</span></span>
<span id="cb54-7"><a href="#cb54-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_discrete</span>(<span class="at">labels =</span> <span class="fu">rev</span>(mysites<span class="sc">$</span>site_name), <span class="at">limits =</span> rev) <span class="sc">+</span> </span>
<span id="cb54-8"><a href="#cb54-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylab</span>(<span class="st">"Slopes, flow effect"</span>) <span class="sc">+</span></span>
<span id="cb54-9"><a href="#cb54-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>() <span class="sc">+</span> <span class="fu">geom_vline</span>(<span class="at">xintercept =</span> <span class="dv">0</span>, <span class="at">linetype =</span> <span class="st">"dashed"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="ModelTemp-EcoDrought_files/figure-html/unnamed-chunk-37-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</div>
<div id="tabset-2-5" class="tab-pane" role="tabpanel" aria-labelledby="tabset-2-5-tab">
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb55"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb55-1"><a href="#cb55-1" aria-hidden="true" tabindex="-1"></a>ggfit <span class="sc">%&gt;%</span></span>
<span id="cb55-2"><a href="#cb55-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(Parameter <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"B.site[1,4]"</span>, <span class="st">"B.site[2,4]"</span>, <span class="st">"B.site[3,4]"</span>, <span class="st">"B.site[4,4]"</span>, <span class="st">"B.site[5,4]"</span>,</span>
<span id="cb55-3"><a href="#cb55-3" aria-hidden="true" tabindex="-1"></a>                          <span class="st">"B.site[6,4]"</span>, <span class="st">"B.site[7,4]"</span>, <span class="st">"B.site[8,4]"</span>, <span class="st">"B.site[9,4]"</span>, <span class="st">"B.site[10,4]"</span>, <span class="st">"B.site[11,4]"</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb55-4"><a href="#cb55-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Parameter =</span> <span class="fu">factor</span>(Parameter, <span class="at">levels =</span> <span class="fu">c</span>(<span class="st">"B.site[1,4]"</span>, <span class="st">"B.site[2,4]"</span>, <span class="st">"B.site[3,4]"</span>, <span class="st">"B.site[4,4]"</span>, <span class="st">"B.site[5,4]"</span>,</span>
<span id="cb55-5"><a href="#cb55-5" aria-hidden="true" tabindex="-1"></a>                          <span class="st">"B.site[6,4]"</span>, <span class="st">"B.site[7,4]"</span>, <span class="st">"B.site[8,4]"</span>, <span class="st">"B.site[9,4]"</span>, <span class="st">"B.site[10,4]"</span>, <span class="st">"B.site[11,4]"</span>))) <span class="sc">%&gt;%</span></span>
<span id="cb55-6"><a href="#cb55-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggs_caterpillar</span>(<span class="at">sort =</span> <span class="cn">FALSE</span>) <span class="sc">+</span></span>
<span id="cb55-7"><a href="#cb55-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_discrete</span>(<span class="at">labels =</span> <span class="fu">rev</span>(mysites<span class="sc">$</span>site_name), <span class="at">limits =</span> rev) <span class="sc">+</span> </span>
<span id="cb55-8"><a href="#cb55-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylab</span>(<span class="st">"Slopes, temp-flow interaction"</span>) <span class="sc">+</span></span>
<span id="cb55-9"><a href="#cb55-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>() <span class="sc">+</span> <span class="fu">geom_vline</span>(<span class="at">xintercept =</span> <span class="dv">0</span>, <span class="at">linetype =</span> <span class="st">"dashed"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="ModelTemp-EcoDrought_files/figure-html/unnamed-chunk-38-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</div>
<div id="tabset-2-6" class="tab-pane" role="tabpanel" aria-labelledby="tabset-2-6-tab">
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb56"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb56-1"><a href="#cb56-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggs_caterpillar</span>(ggfit <span class="sc">%&gt;%</span> <span class="fu">filter</span>(Parameter <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"ar1[1]"</span>, <span class="st">"ar1[2]"</span>, <span class="st">"ar1[3]"</span>, <span class="st">"ar1[4]"</span>, <span class="st">"ar1[5]"</span>,</span>
<span id="cb56-2"><a href="#cb56-2" aria-hidden="true" tabindex="-1"></a>                          <span class="st">"ar1[6]"</span>, <span class="st">"ar1[7]"</span>, <span class="st">"ar1[8]"</span>, <span class="st">"ar1[9]"</span>, <span class="st">"ar1[10]"</span>, <span class="st">"ar1[11]"</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb56-3"><a href="#cb56-3" aria-hidden="true" tabindex="-1"></a>                  <span class="fu">mutate</span>(<span class="at">Parameter =</span> <span class="fu">factor</span>(Parameter, <span class="at">levels =</span> <span class="fu">c</span>(<span class="st">"ar1[1]"</span>, <span class="st">"ar1[2]"</span>, <span class="st">"ar1[3]"</span>, <span class="st">"ar1[4]"</span>, <span class="st">"ar1[5]"</span>,</span>
<span id="cb56-4"><a href="#cb56-4" aria-hidden="true" tabindex="-1"></a>                          <span class="st">"ar1[6]"</span>, <span class="st">"ar1[7]"</span>, <span class="st">"ar1[8]"</span>, <span class="st">"ar1[9]"</span>, <span class="st">"ar1[10]"</span>, <span class="st">"ar1[11]"</span>))),</span>
<span id="cb56-5"><a href="#cb56-5" aria-hidden="true" tabindex="-1"></a>                <span class="at">sort =</span> <span class="cn">FALSE</span>) <span class="sc">+</span> <span class="fu">scale_y_discrete</span>(<span class="at">labels =</span> <span class="fu">rev</span>(mysites<span class="sc">$</span>site_name), <span class="at">limits =</span> rev) <span class="sc">+</span> <span class="fu">theme_bw</span>() </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="ModelTemp-EcoDrought_files/figure-html/unnamed-chunk-39-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</div>
<div id="tabset-2-7" class="tab-pane" role="tabpanel" aria-labelledby="tabset-2-7-tab">
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb57"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb57-1"><a href="#cb57-1" aria-hidden="true" tabindex="-1"></a>ggfit <span class="sc">%&gt;%</span></span>
<span id="cb57-2"><a href="#cb57-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(Parameter <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"B.year[1,1]"</span>, <span class="st">"B.year[2,1]"</span>, <span class="st">"B.year[3,1]"</span>, <span class="st">"B.year[4,1]"</span>, <span class="st">"B.year[5,1]"</span>,</span>
<span id="cb57-3"><a href="#cb57-3" aria-hidden="true" tabindex="-1"></a>                          <span class="st">"B.year[6,1]"</span>, <span class="st">"B.year[7,1]"</span>, <span class="st">"B.year[8,1]"</span>, <span class="st">"B.year[9,1]"</span>, <span class="st">"B.year[10,1]"</span>, </span>
<span id="cb57-4"><a href="#cb57-4" aria-hidden="true" tabindex="-1"></a>                          <span class="st">"B.year[11,1]"</span>, <span class="st">"B.year[12,1]"</span>, <span class="st">"B.year[13,1]"</span>, <span class="st">"B.year[14,1]"</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb57-5"><a href="#cb57-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Parameter =</span> <span class="fu">factor</span>(Parameter, <span class="at">levels =</span> <span class="fu">c</span>(<span class="st">"B.year[1,1]"</span>, <span class="st">"B.year[2,1]"</span>, <span class="st">"B.year[3,1]"</span>, <span class="st">"B.year[4,1]"</span>, <span class="st">"B.year[5,1]"</span>,</span>
<span id="cb57-6"><a href="#cb57-6" aria-hidden="true" tabindex="-1"></a>                          <span class="st">"B.year[6,1]"</span>, <span class="st">"B.year[7,1]"</span>, <span class="st">"B.year[8,1]"</span>, <span class="st">"B.year[9,1]"</span>, <span class="st">"B.year[10,1]"</span>, </span>
<span id="cb57-7"><a href="#cb57-7" aria-hidden="true" tabindex="-1"></a>                          <span class="st">"B.year[11,1]"</span>, <span class="st">"B.year[12,1]"</span>, <span class="st">"B.year[13,1]"</span>, <span class="st">"B.year[14,1]"</span>))) <span class="sc">%&gt;%</span></span>
<span id="cb57-8"><a href="#cb57-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggs_caterpillar</span>(<span class="at">sort =</span> <span class="cn">FALSE</span>) <span class="sc">+</span></span>
<span id="cb57-9"><a href="#cb57-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_discrete</span>(<span class="at">labels =</span> <span class="fu">rev</span>(<span class="fu">sort</span>(<span class="fu">unique</span>(dat<span class="sc">$</span>year))), <span class="at">limits =</span> rev) <span class="sc">+</span> </span>
<span id="cb57-10"><a href="#cb57-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylab</span>(<span class="st">"Year effects, offsets to intercepts"</span>) <span class="sc">+</span></span>
<span id="cb57-11"><a href="#cb57-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>() <span class="sc">+</span> <span class="fu">geom_vline</span>(<span class="at">xintercept =</span> <span class="dv">0</span>, <span class="at">linetype =</span> <span class="st">"dashed"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="ModelTemp-EcoDrought_files/figure-html/unnamed-chunk-40-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</div>
<div id="tabset-2-8" class="tab-pane" role="tabpanel" aria-labelledby="tabset-2-8-tab">
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb58"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb58-1"><a href="#cb58-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggs_caterpillar</span>(ggfit, <span class="at">family =</span> <span class="st">"alpha.1"</span>, <span class="at">sort =</span> <span class="cn">FALSE</span>) <span class="sc">+</span></span>
<span id="cb58-2"><a href="#cb58-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_discrete</span>(<span class="at">labels =</span> <span class="fu">rev</span>(<span class="fu">c</span>(<span class="st">"Intercepts"</span>, <span class="st">"Temp eff."</span>, <span class="st">"Flow eff."</span>, <span class="st">"Temp-Flow int."</span>)), <span class="at">limits =</span> rev) <span class="sc">+</span> </span>
<span id="cb58-3"><a href="#cb58-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylab</span>(<span class="st">"Catchment size effects"</span>) <span class="sc">+</span></span>
<span id="cb58-4"><a href="#cb58-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>() <span class="sc">+</span> <span class="fu">geom_vline</span>(<span class="at">xintercept =</span> <span class="dv">0</span>, <span class="at">linetype =</span> <span class="st">"dashed"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="ModelTemp-EcoDrought_files/figure-html/unnamed-chunk-41-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</div>
</div>
</div>
</section>
<section id="marginal-efffects" class="level3" data-number="6.5.2">
<h3 data-number="6.5.2" class="anchored" data-anchor-id="marginal-efffects"><span class="header-section-number">6.5.2</span> Marginal efffects</h3>
<section id="temp-flow-by-site" class="level4" data-number="6.5.2.1">
<h4 data-number="6.5.2.1" class="anchored" data-anchor-id="temp-flow-by-site"><span class="header-section-number">6.5.2.1</span> Temp-flow by site</h4>
<p>Site names and codes</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb59"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb59-1"><a href="#cb59-1" aria-hidden="true" tabindex="-1"></a>sitecodes <span class="ot">&lt;-</span> dat <span class="sc">%&gt;%</span> <span class="fu">group_by</span>(site_name) <span class="sc">%&gt;%</span> <span class="fu">summarize</span>(<span class="at">site_code =</span> <span class="fu">unique</span>(site_code)) <span class="sc">%&gt;%</span> <span class="fu">ungroup</span>()</span>
<span id="cb59-2"><a href="#cb59-2" aria-hidden="true" tabindex="-1"></a>sitecodes</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 11 × 2
   site_name                   site_code
   &lt;chr&gt;                           &lt;dbl&gt;
 1 Grizzly Creek                       1
 2 Grouse Creek                        2
 3 Leidy Creek Mouth                   3
 4 Leidy Creek Upper                   4
 5 NF Spread Creek Lower               5
 6 NF Spread Creek Upper               6
 7 Pacific Creek at Moran NWIS         7
 8 Rock Creek                          8
 9 SF Spread Creek Lower               9
10 SF Spread Creek Upper              10
11 Spread Creek Dam                   11</code></pre>
</div>
</div>
<p>Plotting function</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb61"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb61-1"><a href="#cb61-1" aria-hidden="true" tabindex="-1"></a>margplot <span class="ot">&lt;-</span> <span class="cf">function</span>(code) {</span>
<span id="cb61-2"><a href="#cb61-2" aria-hidden="true" tabindex="-1"></a>  np <span class="ot">&lt;-</span> <span class="dv">100</span></span>
<span id="cb61-3"><a href="#cb61-3" aria-hidden="true" tabindex="-1"></a>  myriv <span class="ot">&lt;-</span> sitecodes<span class="sc">$</span>site_name[code]</span>
<span id="cb61-4"><a href="#cb61-4" aria-hidden="true" tabindex="-1"></a>  x_temp <span class="ot">&lt;-</span> <span class="fu">seq</span>(<span class="at">from =</span> <span class="fu">min</span>(dat<span class="sc">$</span>z_air_temp_mean[dat<span class="sc">$</span>site_name <span class="sc">==</span> myriv]),</span>
<span id="cb61-5"><a href="#cb61-5" aria-hidden="true" tabindex="-1"></a>                <span class="at">to =</span> <span class="fu">max</span>(dat<span class="sc">$</span>z_air_temp_mean[dat<span class="sc">$</span>site_name <span class="sc">==</span> myriv]),</span>
<span id="cb61-6"><a href="#cb61-6" aria-hidden="true" tabindex="-1"></a>                <span class="at">length.out =</span> np)</span>
<span id="cb61-7"><a href="#cb61-7" aria-hidden="true" tabindex="-1"></a>  x_flow <span class="ot">&lt;-</span> <span class="fu">seq</span>(<span class="at">from =</span> <span class="fu">min</span>(dat<span class="sc">$</span>z_Yield_mm_log[dat<span class="sc">$</span>site_name <span class="sc">==</span> myriv]),</span>
<span id="cb61-8"><a href="#cb61-8" aria-hidden="true" tabindex="-1"></a>                <span class="at">to =</span> <span class="fu">max</span>(dat<span class="sc">$</span>z_Yield_mm_log[dat<span class="sc">$</span>site_name <span class="sc">==</span> myriv]),</span>
<span id="cb61-9"><a href="#cb61-9" aria-hidden="true" tabindex="-1"></a>                <span class="at">length.out =</span> np)</span>
<span id="cb61-10"><a href="#cb61-10" aria-hidden="true" tabindex="-1"></a>  pred_df <span class="ot">&lt;-</span> <span class="fu">expand_grid</span>(x_temp, x_flow)</span>
<span id="cb61-11"><a href="#cb61-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-12"><a href="#cb61-12" aria-hidden="true" tabindex="-1"></a>  <span class="co"># predict from model</span></span>
<span id="cb61-13"><a href="#cb61-13" aria-hidden="true" tabindex="-1"></a>  pred_df<span class="sc">$</span>pred <span class="ot">&lt;-</span> param.summary[<span class="fu">paste</span>(<span class="st">"B.site["</span>, code, <span class="st">",1]"</span>, <span class="at">sep =</span> <span class="st">""</span>),<span class="dv">1</span>] <span class="sc">+</span> param.summary[<span class="fu">paste</span>(<span class="st">"B.site["</span>, code, <span class="st">",2]"</span>, <span class="at">sep =</span> <span class="st">""</span>),<span class="dv">1</span>]<span class="sc">*</span>pred_df<span class="sc">$</span>x_temp <span class="sc">+</span> param.summary[<span class="fu">paste</span>(<span class="st">"B.site["</span>, code, <span class="st">",3]"</span>, <span class="at">sep =</span> <span class="st">""</span>),<span class="dv">1</span>]<span class="sc">*</span>pred_df<span class="sc">$</span>x_flow <span class="sc">+</span> param.summary[<span class="fu">paste</span>(<span class="st">"B.site["</span>, code, <span class="st">",4]"</span>, <span class="at">sep =</span> <span class="st">""</span>),<span class="dv">1</span>]<span class="sc">*</span>pred_df<span class="sc">$</span>x_temp<span class="sc">*</span>pred_df<span class="sc">$</span>x_flow</span>
<span id="cb61-14"><a href="#cb61-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-15"><a href="#cb61-15" aria-hidden="true" tabindex="-1"></a>  <span class="co"># lines </span></span>
<span id="cb61-16"><a href="#cb61-16" aria-hidden="true" tabindex="-1"></a>  p1 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(pred_df, <span class="fu">aes</span>(<span class="at">x =</span> x_temp, <span class="at">y =</span> pred, <span class="at">color =</span> x_flow, <span class="at">group =</span> x_flow)) <span class="sc">+</span></span>
<span id="cb61-17"><a href="#cb61-17" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_line</span>() <span class="sc">+</span></span>
<span id="cb61-18"><a href="#cb61-18" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_color_distiller</span>(<span class="at">palette =</span> <span class="st">"BrBG"</span>, <span class="at">direction =</span> <span class="sc">+</span><span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb61-19"><a href="#cb61-19" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme_bw</span>() <span class="sc">+</span> <span class="fu">theme</span>(<span class="at">panel.grid =</span> <span class="fu">element_blank</span>()) <span class="sc">+</span></span>
<span id="cb61-20"><a href="#cb61-20" aria-hidden="true" tabindex="-1"></a>    <span class="fu">labs</span>(<span class="at">color =</span> <span class="st">"Flow"</span>) <span class="sc">+</span> <span class="fu">xlab</span>(<span class="st">"Air temperature"</span>) <span class="sc">+</span> <span class="fu">ylab</span>(<span class="st">"Water temperature"</span>) <span class="sc">+</span> <span class="fu">ylim</span>(<span class="dv">0</span>,<span class="dv">20</span>) <span class="co">#+</span></span>
<span id="cb61-21"><a href="#cb61-21" aria-hidden="true" tabindex="-1"></a>    <span class="co">#geom_point(dat %&gt;% filter(site_name == myriv), mapping = aes(x = z_air_temp_mean, y = tempc_mean, group = NA), color = "black", size = 0.2, shape = 16) </span></span>
<span id="cb61-22"><a href="#cb61-22" aria-hidden="true" tabindex="-1"></a> <span class="co"># heatmap</span></span>
<span id="cb61-23"><a href="#cb61-23" aria-hidden="true" tabindex="-1"></a>  p2 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(pred_df, <span class="fu">aes</span>(<span class="at">x =</span> x_temp, <span class="at">y =</span> x_flow)) <span class="sc">+</span></span>
<span id="cb61-24"><a href="#cb61-24" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_tile</span>(<span class="fu">aes</span>(<span class="at">fill =</span> pred)) <span class="sc">+</span></span>
<span id="cb61-25"><a href="#cb61-25" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_fill_distiller</span>(<span class="at">palette =</span> <span class="st">"Spectral"</span>, <span class="at">limits =</span> <span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">20</span>)) <span class="sc">+</span></span>
<span id="cb61-26"><a href="#cb61-26" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme_bw</span>() <span class="sc">+</span> <span class="fu">theme</span>(<span class="at">panel.grid =</span> <span class="fu">element_blank</span>()) <span class="sc">+</span></span>
<span id="cb61-27"><a href="#cb61-27" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_x_continuous</span>(<span class="at">expand =</span> <span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">0</span>)) <span class="sc">+</span> <span class="fu">scale_y_continuous</span>(<span class="at">expand =</span> <span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">0</span>)) <span class="sc">+</span></span>
<span id="cb61-28"><a href="#cb61-28" aria-hidden="true" tabindex="-1"></a>    <span class="fu">labs</span>(<span class="at">fill =</span> <span class="st">"Water</span><span class="sc">\n</span><span class="st">temp."</span>) <span class="sc">+</span> <span class="fu">xlab</span>(<span class="st">"Air temperature"</span>) <span class="sc">+</span> <span class="fu">ylab</span>(<span class="st">"Flow"</span>) <span class="co">#+ </span></span>
<span id="cb61-29"><a href="#cb61-29" aria-hidden="true" tabindex="-1"></a>    <span class="co">#geom_point(data = dat %&gt;% filter(site_name == myriv), aes(x = z_air_temp_mean, y = z_Yield_mm_log, color = tempc_mean)) +</span></span>
<span id="cb61-30"><a href="#cb61-30" aria-hidden="true" tabindex="-1"></a>    <span class="co">#scale_color_distiller(palette = "Spectral", limits = c(0,20)) </span></span>
<span id="cb61-31"><a href="#cb61-31" aria-hidden="true" tabindex="-1"></a>  <span class="co"># combine</span></span>
<span id="cb61-32"><a href="#cb61-32" aria-hidden="true" tabindex="-1"></a>  egg<span class="sc">::</span><span class="fu">ggarrange</span>(p1, p2, <span class="at">nrow =</span> <span class="dv">1</span>)</span>
<span id="cb61-33"><a href="#cb61-33" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p><em>Interpretation of these plots (specifically, stream temperature outcome) is complicated by the ~large effects of lagged air temperature variables and temporal autocorrelation</em></p>
<div class="tabset-margin-container"></div><div class="panel-tabset">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-3-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-3-1" role="tab" aria-controls="tabset-3-1" aria-selected="true">Grizzly Creek</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-3-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-3-2" role="tab" aria-controls="tabset-3-2" aria-selected="false">Grouse Creek</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-3-3-tab" data-bs-toggle="tab" data-bs-target="#tabset-3-3" role="tab" aria-controls="tabset-3-3" aria-selected="false">Leidy Creek Mouth</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-3-4-tab" data-bs-toggle="tab" data-bs-target="#tabset-3-4" role="tab" aria-controls="tabset-3-4" aria-selected="false">NF Spread Creek Lower</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-3-5-tab" data-bs-toggle="tab" data-bs-target="#tabset-3-5" role="tab" aria-controls="tabset-3-5" aria-selected="false">NF Spread Creek Upper</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-3-6-tab" data-bs-toggle="tab" data-bs-target="#tabset-3-6" role="tab" aria-controls="tabset-3-6" aria-selected="false">Pacific Creek</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-3-7-tab" data-bs-toggle="tab" data-bs-target="#tabset-3-7" role="tab" aria-controls="tabset-3-7" aria-selected="false">Rock Creek</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-3-8-tab" data-bs-toggle="tab" data-bs-target="#tabset-3-8" role="tab" aria-controls="tabset-3-8" aria-selected="false">SF Spread Creek Lower</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-3-9-tab" data-bs-toggle="tab" data-bs-target="#tabset-3-9" role="tab" aria-controls="tabset-3-9" aria-selected="false">SF Spread Creek Upper</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-3-10-tab" data-bs-toggle="tab" data-bs-target="#tabset-3-10" role="tab" aria-controls="tabset-3-10" aria-selected="false">Spread Creek Dam</a></li></ul>
<div class="tab-content">
<div id="tabset-3-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-3-1-tab">
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb62"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb62-1"><a href="#cb62-1" aria-hidden="true" tabindex="-1"></a><span class="fu">margplot</span>(<span class="dv">1</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="ModelTemp-EcoDrought_files/figure-html/unnamed-chunk-44-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</div>
<div id="tabset-3-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-3-2-tab">
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb63"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb63-1"><a href="#cb63-1" aria-hidden="true" tabindex="-1"></a><span class="fu">margplot</span>(<span class="dv">2</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="ModelTemp-EcoDrought_files/figure-html/unnamed-chunk-45-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</div>
<div id="tabset-3-3" class="tab-pane" role="tabpanel" aria-labelledby="tabset-3-3-tab">
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb64"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb64-1"><a href="#cb64-1" aria-hidden="true" tabindex="-1"></a><span class="fu">margplot</span>(<span class="dv">3</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="ModelTemp-EcoDrought_files/figure-html/unnamed-chunk-46-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</div>
<div id="tabset-3-4" class="tab-pane" role="tabpanel" aria-labelledby="tabset-3-4-tab">
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb65"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb65-1"><a href="#cb65-1" aria-hidden="true" tabindex="-1"></a><span class="fu">margplot</span>(<span class="dv">5</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="ModelTemp-EcoDrought_files/figure-html/unnamed-chunk-47-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</div>
<div id="tabset-3-5" class="tab-pane" role="tabpanel" aria-labelledby="tabset-3-5-tab">
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb66"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb66-1"><a href="#cb66-1" aria-hidden="true" tabindex="-1"></a><span class="fu">margplot</span>(<span class="dv">6</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="ModelTemp-EcoDrought_files/figure-html/unnamed-chunk-48-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</div>
<div id="tabset-3-6" class="tab-pane" role="tabpanel" aria-labelledby="tabset-3-6-tab">
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb67"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb67-1"><a href="#cb67-1" aria-hidden="true" tabindex="-1"></a><span class="fu">margplot</span>(<span class="dv">7</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="ModelTemp-EcoDrought_files/figure-html/unnamed-chunk-49-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</div>
<div id="tabset-3-7" class="tab-pane" role="tabpanel" aria-labelledby="tabset-3-7-tab">
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb68"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb68-1"><a href="#cb68-1" aria-hidden="true" tabindex="-1"></a><span class="fu">margplot</span>(<span class="dv">8</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="ModelTemp-EcoDrought_files/figure-html/unnamed-chunk-50-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</div>
<div id="tabset-3-8" class="tab-pane" role="tabpanel" aria-labelledby="tabset-3-8-tab">
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb69"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb69-1"><a href="#cb69-1" aria-hidden="true" tabindex="-1"></a><span class="fu">margplot</span>(<span class="dv">9</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="ModelTemp-EcoDrought_files/figure-html/unnamed-chunk-51-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</div>
<div id="tabset-3-9" class="tab-pane" role="tabpanel" aria-labelledby="tabset-3-9-tab">
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb70"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb70-1"><a href="#cb70-1" aria-hidden="true" tabindex="-1"></a><span class="fu">margplot</span>(<span class="dv">10</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="ModelTemp-EcoDrought_files/figure-html/unnamed-chunk-52-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</div>
<div id="tabset-3-10" class="tab-pane" role="tabpanel" aria-labelledby="tabset-3-10-tab">
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb71"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb71-1"><a href="#cb71-1" aria-hidden="true" tabindex="-1"></a><span class="fu">margplot</span>(<span class="dv">11</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="ModelTemp-EcoDrought_files/figure-html/unnamed-chunk-53-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</div>
</div>
</div>
</section>
<section id="site-level-effects-by-covs" class="level4" data-number="6.5.2.2">
<h4 data-number="6.5.2.2" class="anchored" data-anchor-id="site-level-effects-by-covs"><span class="header-section-number">6.5.2.2</span> Site-level effects by covs</h4>
<p>Are temp and flow effects correlated? <em>Yes…do we need to model this correlation?</em></p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb72"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb72-1"><a href="#cb72-1" aria-hidden="true" tabindex="-1"></a>ggfit <span class="sc">%&gt;%</span></span>
<span id="cb72-2"><a href="#cb72-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(Parameter <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"B.site[1,2]"</span>, <span class="st">"B.site[2,2]"</span>, <span class="st">"B.site[3,2]"</span>, <span class="st">"B.site[4,2]"</span>, <span class="st">"B.site[5,2]"</span>,</span>
<span id="cb72-3"><a href="#cb72-3" aria-hidden="true" tabindex="-1"></a>                          <span class="st">"B.site[6,2]"</span>, <span class="st">"B.site[7,2]"</span>, <span class="st">"B.site[8,2]"</span>, <span class="st">"B.site[9,2]"</span>, <span class="st">"B.site[10,2]"</span>, <span class="st">"B.site[11,2]"</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb72-4"><a href="#cb72-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Parameter =</span> <span class="fu">factor</span>(Parameter, <span class="at">levels =</span> <span class="fu">c</span>(<span class="st">"B.site[1,2]"</span>, <span class="st">"B.site[2,2]"</span>, <span class="st">"B.site[3,2]"</span>, <span class="st">"B.site[4,2]"</span>, <span class="st">"B.site[5,2]"</span>,</span>
<span id="cb72-5"><a href="#cb72-5" aria-hidden="true" tabindex="-1"></a>                          <span class="st">"B.site[6,2]"</span>, <span class="st">"B.site[7,2]"</span>, <span class="st">"B.site[8,2]"</span>, <span class="st">"B.site[9,2]"</span>, <span class="st">"B.site[10,2]"</span>, <span class="st">"B.site[11,2]"</span>))) <span class="sc">%&gt;%</span></span>
<span id="cb72-6"><a href="#cb72-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(Parameter) <span class="sc">%&gt;%</span> </span>
<span id="cb72-7"><a href="#cb72-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="at">tempeff =</span> <span class="fu">mean</span>(value)) <span class="sc">%&gt;%</span></span>
<span id="cb72-8"><a href="#cb72-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span></span>
<span id="cb72-9"><a href="#cb72-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">site_name =</span> mysites<span class="sc">$</span>site_name) <span class="sc">%&gt;%</span></span>
<span id="cb72-10"><a href="#cb72-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span>Parameter) <span class="sc">%&gt;%</span></span>
<span id="cb72-11"><a href="#cb72-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(ggfit <span class="sc">%&gt;%</span></span>
<span id="cb72-12"><a href="#cb72-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(Parameter <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"B.site[1,3]"</span>, <span class="st">"B.site[2,3]"</span>, <span class="st">"B.site[3,3]"</span>, <span class="st">"B.site[4,3]"</span>, <span class="st">"B.site[5,3]"</span>,</span>
<span id="cb72-13"><a href="#cb72-13" aria-hidden="true" tabindex="-1"></a>                          <span class="st">"B.site[6,3]"</span>, <span class="st">"B.site[7,3]"</span>, <span class="st">"B.site[8,3]"</span>, <span class="st">"B.site[9,3]"</span>, <span class="st">"B.site[10,3]"</span>, <span class="st">"B.site[11,3]"</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb72-14"><a href="#cb72-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Parameter =</span> <span class="fu">factor</span>(Parameter, <span class="at">levels =</span> <span class="fu">c</span>(<span class="st">"B.site[1,3]"</span>, <span class="st">"B.site[2,3]"</span>, <span class="st">"B.site[3,3]"</span>, <span class="st">"B.site[4,3]"</span>, <span class="st">"B.site[5,3]"</span>,</span>
<span id="cb72-15"><a href="#cb72-15" aria-hidden="true" tabindex="-1"></a>                          <span class="st">"B.site[6,3]"</span>, <span class="st">"B.site[7,3]"</span>, <span class="st">"B.site[8,3]"</span>, <span class="st">"B.site[9,3]"</span>, <span class="st">"B.site[10,3]"</span>, <span class="st">"B.site[11,3]"</span>))) <span class="sc">%&gt;%</span></span>
<span id="cb72-16"><a href="#cb72-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(Parameter) <span class="sc">%&gt;%</span> </span>
<span id="cb72-17"><a href="#cb72-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="at">floweff =</span> <span class="fu">mean</span>(value)) <span class="sc">%&gt;%</span></span>
<span id="cb72-18"><a href="#cb72-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span></span>
<span id="cb72-19"><a href="#cb72-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">site_name =</span> mysites<span class="sc">$</span>site_name) <span class="sc">%&gt;%</span></span>
<span id="cb72-20"><a href="#cb72-20" aria-hidden="true" tabindex="-1"></a>    <span class="fu">select</span>(<span class="sc">-</span>Parameter)) <span class="sc">%&gt;%</span></span>
<span id="cb72-21"><a href="#cb72-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> tempeff, <span class="at">y =</span> floweff)) <span class="sc">+</span> <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb72-22"><a href="#cb72-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="at">method =</span> <span class="st">"lm"</span>) <span class="sc">+</span></span>
<span id="cb72-23"><a href="#cb72-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="st">"Temperature effect"</span>) <span class="sc">+</span> <span class="fu">ylab</span>(<span class="st">"Flow effect"</span>) <span class="sc">+</span></span>
<span id="cb72-24"><a href="#cb72-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>() <span class="sc">+</span> ggpubr<span class="sc">::</span><span class="fu">stat_cor</span>(<span class="at">label.y.npc =</span> <span class="st">"bottom"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="ModelTemp-EcoDrought_files/figure-html/unnamed-chunk-54-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p><em>Note that for these 11 sites, catchment area and elevation are correlated</em></p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb73"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb73-1"><a href="#cb73-1" aria-hidden="true" tabindex="-1"></a>dat <span class="sc">%&gt;%</span> <span class="fu">group_by</span>(site_name) <span class="sc">%&gt;%</span> <span class="fu">summarize</span>(<span class="at">area_sqmi =</span> <span class="fu">unique</span>(area_sqmi), <span class="at">elev_ft =</span> <span class="fu">unique</span>(elev_ft)) <span class="sc">%&gt;%</span> <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> elev_ft, <span class="at">y =</span> <span class="fu">log</span>(area_sqmi))) <span class="sc">+</span> <span class="fu">geom_point</span>() <span class="sc">+</span> <span class="fu">geom_smooth</span>(<span class="at">method =</span> <span class="st">"lm"</span>) <span class="sc">+</span> <span class="fu">theme_bw</span>() <span class="sc">+</span> ggpubr<span class="sc">::</span><span class="fu">stat_cor</span>(<span class="at">label.x.npc =</span> <span class="st">"center"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="ModelTemp-EcoDrought_files/figure-html/unnamed-chunk-55-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb74"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb74-1"><a href="#cb74-1" aria-hidden="true" tabindex="-1"></a>temp.pars <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"B.site[1,2]"</span>, <span class="st">"B.site[2,2]"</span>, <span class="st">"B.site[3,2]"</span>, <span class="st">"B.site[4,2]"</span>, <span class="st">"B.site[5,2]"</span>, <span class="st">"B.site[6,2]"</span>, <span class="st">"B.site[7,2]"</span>, <span class="st">"B.site[8,2]"</span>, <span class="st">"B.site[9,2]"</span>, <span class="st">"B.site[10,2]"</span>, <span class="st">"B.site[11,2]"</span>)</span>
<span id="cb74-2"><a href="#cb74-2" aria-hidden="true" tabindex="-1"></a>flow.pars <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"B.site[1,3]"</span>, <span class="st">"B.site[2,3]"</span>, <span class="st">"B.site[3,3]"</span>, <span class="st">"B.site[4,3]"</span>, <span class="st">"B.site[5,3]"</span>, <span class="st">"B.site[6,3]"</span>, <span class="st">"B.site[7,3]"</span>, <span class="st">"B.site[8,3]"</span>, <span class="st">"B.site[9,3]"</span>, <span class="st">"B.site[10,3]"</span>, <span class="st">"B.site[11,3]"</span>)</span>
<span id="cb74-3"><a href="#cb74-3" aria-hidden="true" tabindex="-1"></a>int.pars <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"B.site[1,4]"</span>, <span class="st">"B.site[2,4]"</span>, <span class="st">"B.site[3,4]"</span>, <span class="st">"B.site[4,4]"</span>, <span class="st">"B.site[5,4]"</span>, <span class="st">"B.site[6,4]"</span>, <span class="st">"B.site[7,4]"</span>, <span class="st">"B.site[8,4]"</span>, <span class="st">"B.site[9,4]"</span>, <span class="st">"B.site[10,4]"</span>, <span class="st">"B.site[11,4]"</span>)</span>
<span id="cb74-4"><a href="#cb74-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb74-5"><a href="#cb74-5" aria-hidden="true" tabindex="-1"></a><span class="co"># get mean and 95% credible intervals for random effect parameters</span></span>
<span id="cb74-6"><a href="#cb74-6" aria-hidden="true" tabindex="-1"></a>mytib <span class="ot">&lt;-</span> sitecodes <span class="sc">%&gt;%</span></span>
<span id="cb74-7"><a href="#cb74-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">temp.mean =</span> param.summary[temp.pars,<span class="dv">1</span>],</span>
<span id="cb74-8"><a href="#cb74-8" aria-hidden="true" tabindex="-1"></a>         <span class="at">temp.low =</span> param.summary[temp.pars,<span class="dv">3</span>],</span>
<span id="cb74-9"><a href="#cb74-9" aria-hidden="true" tabindex="-1"></a>         <span class="at">temp.high =</span> param.summary[temp.pars,<span class="dv">7</span>],</span>
<span id="cb74-10"><a href="#cb74-10" aria-hidden="true" tabindex="-1"></a>         <span class="at">flow.mean =</span> param.summary[flow.pars,<span class="dv">1</span>],</span>
<span id="cb74-11"><a href="#cb74-11" aria-hidden="true" tabindex="-1"></a>         <span class="at">flow.low =</span> param.summary[flow.pars,<span class="dv">3</span>],</span>
<span id="cb74-12"><a href="#cb74-12" aria-hidden="true" tabindex="-1"></a>         <span class="at">flow.high =</span> param.summary[flow.pars,<span class="dv">7</span>],</span>
<span id="cb74-13"><a href="#cb74-13" aria-hidden="true" tabindex="-1"></a>         <span class="at">int.mean =</span> param.summary[int.pars,<span class="dv">1</span>],</span>
<span id="cb74-14"><a href="#cb74-14" aria-hidden="true" tabindex="-1"></a>         <span class="at">int.low =</span> param.summary[int.pars,<span class="dv">3</span>],</span>
<span id="cb74-15"><a href="#cb74-15" aria-hidden="true" tabindex="-1"></a>         <span class="at">int.high =</span> param.summary[int.pars,<span class="dv">7</span>],</span>
<span id="cb74-16"><a href="#cb74-16" aria-hidden="true" tabindex="-1"></a>         <span class="at">area_log =</span> jags.data<span class="sc">$</span>area</span>
<span id="cb74-17"><a href="#cb74-17" aria-hidden="true" tabindex="-1"></a>         )</span>
<span id="cb74-18"><a href="#cb74-18" aria-hidden="true" tabindex="-1"></a>mytib</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 11 × 12
   site_name site_code temp.mean temp.low temp.high flow.mean flow.low flow.high
   &lt;chr&gt;         &lt;dbl&gt;     &lt;dbl&gt;    &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;    &lt;dbl&gt;     &lt;dbl&gt;
 1 Grizzly …         1      1.63     1.41      1.84    0.283  -0.00646    0.601 
 2 Grouse C…         2      1.63     1.47      1.78    0.182   0.00721    0.353 
 3 Leidy Cr…         3      1.47     1.33      1.62   -0.0494 -0.174      0.0755
 4 Leidy Cr…         4      1.19     1.04      1.33    0.394  -0.188      1.03  
 5 NF Sprea…         5      1.69     1.53      1.84   -0.0936 -0.202      0.0192
 6 NF Sprea…         6      1.66     1.43      1.92    0.373   0.169      0.596 
 7 Pacific …         7      2.19     1.89      2.47   -0.510  -0.773     -0.257 
 8 Rock Cre…         8      1.35     1.19      1.51    0.271   0.110      0.426 
 9 SF Sprea…         9      1.88     1.71      2.03   -0.0220 -0.149      0.118 
10 SF Sprea…        10      1.96     1.74      2.20    0.0991 -0.117      0.341 
11 Spread C…        11      2.27     2.08      2.46   -0.454  -0.650     -0.267 
# ℹ 4 more variables: int.mean &lt;dbl&gt;, int.low &lt;dbl&gt;, int.high &lt;dbl&gt;,
#   area_log &lt;dbl&gt;</code></pre>
</div>
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb76"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb76-1"><a href="#cb76-1" aria-hidden="true" tabindex="-1"></a>nsims <span class="ot">&lt;-</span> <span class="dv">100</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>Temperature effect: stream temperature sensitivity to air temperature is greater in larger catchments (presumably b/c hillslope/groundwater controls on temp are proportionally much weaker). Also, in larger catchments, water has been exposed to air for longer and thus has had more time to equilibrate with local environmental conditions. But interestingly, no effect of mean summer yield, a proxy for relative groundwater contributions to stream flow.</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb77"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb77-1"><a href="#cb77-1" aria-hidden="true" tabindex="-1"></a>xseq <span class="ot">&lt;-</span> <span class="fu">seq</span>(<span class="at">from =</span> <span class="fu">min</span>(jags.data<span class="sc">$</span>area), <span class="at">to =</span> <span class="fu">max</span>(jags.data<span class="sc">$</span>area), <span class="at">length.out =</span> nsims)</span>
<span id="cb77-2"><a href="#cb77-2" aria-hidden="true" tabindex="-1"></a>preds <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="at">data =</span> <span class="cn">NA</span>, <span class="at">nrow =</span> <span class="fu">dim</span>(Mcmcdat)[<span class="dv">1</span>], <span class="at">ncol =</span> nsims)</span>
<span id="cb77-3"><a href="#cb77-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb77-4"><a href="#cb77-4" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (j <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">dim</span>(Mcmcdat)[<span class="dv">1</span>]) {</span>
<span id="cb77-5"><a href="#cb77-5" aria-hidden="true" tabindex="-1"></a>  preds[j,] <span class="ot">&lt;-</span> <span class="fu">unlist</span>(Mcmcdat[j,<span class="st">"alpha.0[2]"</span>]) <span class="sc">+</span> <span class="fu">unlist</span>(Mcmcdat[j,<span class="st">"alpha.1[2]"</span>])<span class="sc">*</span>xseq</span>
<span id="cb77-6"><a href="#cb77-6" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb77-7"><a href="#cb77-7" aria-hidden="true" tabindex="-1"></a>ymean <span class="ot">&lt;-</span> <span class="fu">apply</span>(preds, <span class="dv">2</span>, mean)</span>
<span id="cb77-8"><a href="#cb77-8" aria-hidden="true" tabindex="-1"></a>ylow <span class="ot">&lt;-</span> <span class="fu">apply</span>(preds, <span class="dv">2</span>, quantile, <span class="at">probs =</span> <span class="fl">0.025</span>)</span>
<span id="cb77-9"><a href="#cb77-9" aria-hidden="true" tabindex="-1"></a>yhigh <span class="ot">&lt;-</span> <span class="fu">apply</span>(preds, <span class="dv">2</span>, quantile, <span class="at">probs =</span> <span class="fl">0.975</span>)</span>
<span id="cb77-10"><a href="#cb77-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb77-11"><a href="#cb77-11" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb77-12"><a href="#cb77-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_ribbon</span>(<span class="fu">aes</span>(<span class="at">x =</span> xseq, <span class="at">ymin =</span> ylow, <span class="at">ymax =</span> yhigh), <span class="at">fill =</span> <span class="st">"grey"</span>) <span class="sc">+</span></span>
<span id="cb77-13"><a href="#cb77-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">x =</span> xseq, <span class="at">y =</span> ymean), <span class="at">color =</span> <span class="st">"black"</span>, <span class="at">linewidth =</span> <span class="dv">1</span>, <span class="at">lineend =</span> <span class="st">"round"</span>) <span class="sc">+</span></span>
<span id="cb77-14"><a href="#cb77-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_errorbar</span>(<span class="fu">aes</span>(<span class="at">x =</span> mytib<span class="sc">$</span>area_log, <span class="at">ymin =</span> mytib<span class="sc">$</span>temp.low, <span class="at">ymax =</span> mytib<span class="sc">$</span>temp.high), <span class="at">width =</span> <span class="fl">0.1</span>) <span class="sc">+</span></span>
<span id="cb77-15"><a href="#cb77-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">x =</span> mytib<span class="sc">$</span>area_log, <span class="at">y =</span> mytib<span class="sc">$</span>temp.mean), <span class="at">size =</span> <span class="dv">2</span>, <span class="at">shape =</span> <span class="dv">21</span>, <span class="at">fill =</span> <span class="st">"white"</span>) <span class="sc">+</span></span>
<span id="cb77-16"><a href="#cb77-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>() <span class="sc">+</span> <span class="fu">theme</span>(<span class="at">panel.grid =</span> <span class="fu">element_blank</span>()) <span class="sc">+</span></span>
<span id="cb77-17"><a href="#cb77-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="st">"Catchment area (log scale)"</span>) <span class="sc">+</span> <span class="fu">ylab</span>(<span class="st">"Temperature effect (posterior mean)"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="ModelTemp-EcoDrought_files/figure-html/unnamed-chunk-57-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>Flow effect: in small catchments, increased flow has a warming effect on stream temperature, whereas in large catchments, increased flow has a cooling effect on stream temperature. In small catchments, where proportional contributions from groundwater to streamflow are relatively high, increased flows during snowmelt/runoff warm stream temperatures as snowmelt temperature is warmer than groundwater temperature (???). But in larger catchments where volumetric groundwater contributions are ~low relative to discharge, increased flows during snowmelt cool stream temps as snowmelt temps are colder than ambient air temperatures (which more strongly influence stream temps relative to smaller streams).</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb78"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb78-1"><a href="#cb78-1" aria-hidden="true" tabindex="-1"></a>xseq <span class="ot">&lt;-</span> <span class="fu">seq</span>(<span class="at">from =</span> <span class="fu">min</span>(jags.data<span class="sc">$</span>area), <span class="at">to =</span> <span class="fu">max</span>(jags.data<span class="sc">$</span>area), <span class="at">length.out =</span> nsims)</span>
<span id="cb78-2"><a href="#cb78-2" aria-hidden="true" tabindex="-1"></a>preds <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="at">data =</span> <span class="cn">NA</span>, <span class="at">nrow =</span> <span class="fu">dim</span>(Mcmcdat)[<span class="dv">1</span>], <span class="at">ncol =</span> nsims)</span>
<span id="cb78-3"><a href="#cb78-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb78-4"><a href="#cb78-4" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (j <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">dim</span>(Mcmcdat)[<span class="dv">1</span>]) {</span>
<span id="cb78-5"><a href="#cb78-5" aria-hidden="true" tabindex="-1"></a>  preds[j,] <span class="ot">&lt;-</span> <span class="fu">unlist</span>(Mcmcdat[j,<span class="st">"alpha.0[3]"</span>]) <span class="sc">+</span> <span class="fu">unlist</span>(Mcmcdat[j,<span class="st">"alpha.1[3]"</span>])<span class="sc">*</span>xseq</span>
<span id="cb78-6"><a href="#cb78-6" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb78-7"><a href="#cb78-7" aria-hidden="true" tabindex="-1"></a>ymean <span class="ot">&lt;-</span> <span class="fu">apply</span>(preds, <span class="dv">2</span>, mean)</span>
<span id="cb78-8"><a href="#cb78-8" aria-hidden="true" tabindex="-1"></a>ylow <span class="ot">&lt;-</span> <span class="fu">apply</span>(preds, <span class="dv">2</span>, quantile, <span class="at">probs =</span> <span class="fl">0.025</span>)</span>
<span id="cb78-9"><a href="#cb78-9" aria-hidden="true" tabindex="-1"></a>yhigh <span class="ot">&lt;-</span> <span class="fu">apply</span>(preds, <span class="dv">2</span>, quantile, <span class="at">probs =</span> <span class="fl">0.975</span>)</span>
<span id="cb78-10"><a href="#cb78-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb78-11"><a href="#cb78-11" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb78-12"><a href="#cb78-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_ribbon</span>(<span class="fu">aes</span>(<span class="at">x =</span> xseq, <span class="at">ymin =</span> ylow, <span class="at">ymax =</span> yhigh), <span class="at">fill =</span> <span class="st">"grey"</span>) <span class="sc">+</span></span>
<span id="cb78-13"><a href="#cb78-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">x =</span> xseq, <span class="at">y =</span> ymean), <span class="at">color =</span> <span class="st">"black"</span>, <span class="at">linewidth =</span> <span class="dv">1</span>, <span class="at">lineend =</span> <span class="st">"round"</span>) <span class="sc">+</span></span>
<span id="cb78-14"><a href="#cb78-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_errorbar</span>(<span class="fu">aes</span>(<span class="at">x =</span> mytib<span class="sc">$</span>area_log, <span class="at">ymin =</span> mytib<span class="sc">$</span>flow.low, <span class="at">ymax =</span> mytib<span class="sc">$</span>flow.high), <span class="at">width =</span> <span class="fl">0.1</span>) <span class="sc">+</span></span>
<span id="cb78-15"><a href="#cb78-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">x =</span> mytib<span class="sc">$</span>area_log, <span class="at">y =</span> mytib<span class="sc">$</span>flow.mean), <span class="at">size =</span> <span class="dv">2</span>, <span class="at">shape =</span> <span class="dv">21</span>, <span class="at">fill =</span> <span class="st">"white"</span>) <span class="sc">+</span></span>
<span id="cb78-16"><a href="#cb78-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>() <span class="sc">+</span> <span class="fu">theme</span>(<span class="at">panel.grid =</span> <span class="fu">element_blank</span>()) <span class="sc">+</span></span>
<span id="cb78-17"><a href="#cb78-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="st">"Catchment area (log scale)"</span>) <span class="sc">+</span> <span class="fu">ylab</span>(<span class="st">"Flow effect (posterior mean)"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="ModelTemp-EcoDrought_files/figure-html/unnamed-chunk-58-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>Temp-flow interaction: <em>not sure what this means…</em></p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb79"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb79-1"><a href="#cb79-1" aria-hidden="true" tabindex="-1"></a>xseq <span class="ot">&lt;-</span> <span class="fu">seq</span>(<span class="at">from =</span> <span class="fu">min</span>(jags.data<span class="sc">$</span>area), <span class="at">to =</span> <span class="fu">max</span>(jags.data<span class="sc">$</span>area), <span class="at">length.out =</span> nsims)</span>
<span id="cb79-2"><a href="#cb79-2" aria-hidden="true" tabindex="-1"></a>preds <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="at">data =</span> <span class="cn">NA</span>, <span class="at">nrow =</span> <span class="fu">dim</span>(Mcmcdat)[<span class="dv">1</span>], <span class="at">ncol =</span> nsims)</span>
<span id="cb79-3"><a href="#cb79-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb79-4"><a href="#cb79-4" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (j <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">dim</span>(Mcmcdat)[<span class="dv">1</span>]) {</span>
<span id="cb79-5"><a href="#cb79-5" aria-hidden="true" tabindex="-1"></a>  preds[j,] <span class="ot">&lt;-</span> <span class="fu">unlist</span>(Mcmcdat[j,<span class="st">"alpha.0[4]"</span>]) <span class="sc">+</span> <span class="fu">unlist</span>(Mcmcdat[j,<span class="st">"alpha.1[4]"</span>])<span class="sc">*</span>xseq</span>
<span id="cb79-6"><a href="#cb79-6" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb79-7"><a href="#cb79-7" aria-hidden="true" tabindex="-1"></a>ymean <span class="ot">&lt;-</span> <span class="fu">apply</span>(preds, <span class="dv">2</span>, mean)</span>
<span id="cb79-8"><a href="#cb79-8" aria-hidden="true" tabindex="-1"></a>ylow <span class="ot">&lt;-</span> <span class="fu">apply</span>(preds, <span class="dv">2</span>, quantile, <span class="at">probs =</span> <span class="fl">0.025</span>)</span>
<span id="cb79-9"><a href="#cb79-9" aria-hidden="true" tabindex="-1"></a>yhigh <span class="ot">&lt;-</span> <span class="fu">apply</span>(preds, <span class="dv">2</span>, quantile, <span class="at">probs =</span> <span class="fl">0.975</span>)</span>
<span id="cb79-10"><a href="#cb79-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb79-11"><a href="#cb79-11" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb79-12"><a href="#cb79-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_ribbon</span>(<span class="fu">aes</span>(<span class="at">x =</span> xseq, <span class="at">ymin =</span> ylow, <span class="at">ymax =</span> yhigh), <span class="at">fill =</span> <span class="st">"grey"</span>) <span class="sc">+</span></span>
<span id="cb79-13"><a href="#cb79-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">x =</span> xseq, <span class="at">y =</span> ymean), <span class="at">color =</span> <span class="st">"black"</span>, <span class="at">linewidth =</span> <span class="dv">1</span>, <span class="at">lineend =</span> <span class="st">"round"</span>) <span class="sc">+</span></span>
<span id="cb79-14"><a href="#cb79-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_errorbar</span>(<span class="fu">aes</span>(<span class="at">x =</span> mytib<span class="sc">$</span>area_log, <span class="at">ymin =</span> mytib<span class="sc">$</span>int.low, <span class="at">ymax =</span> mytib<span class="sc">$</span>int.high), <span class="at">width =</span> <span class="fl">0.1</span>) <span class="sc">+</span></span>
<span id="cb79-15"><a href="#cb79-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">x =</span> mytib<span class="sc">$</span>area_log, <span class="at">y =</span> mytib<span class="sc">$</span>int.mean), <span class="at">size =</span> <span class="dv">2</span>, <span class="at">shape =</span> <span class="dv">21</span>, <span class="at">fill =</span> <span class="st">"white"</span>) <span class="sc">+</span></span>
<span id="cb79-16"><a href="#cb79-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>() <span class="sc">+</span> <span class="fu">theme</span>(<span class="at">panel.grid =</span> <span class="fu">element_blank</span>()) <span class="sc">+</span></span>
<span id="cb79-17"><a href="#cb79-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="st">"Catchment area (log scale)"</span>) <span class="sc">+</span> <span class="fu">ylab</span>(<span class="st">"Temp-Flow interaction (posterior mean)"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="ModelTemp-EcoDrought_files/figure-html/unnamed-chunk-59-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb80"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb80-1"><a href="#cb80-1" aria-hidden="true" tabindex="-1"></a>x_temp <span class="ot">&lt;-</span> <span class="fu">seq</span>(<span class="at">from =</span> <span class="fu">min</span>(dat<span class="sc">$</span>z_air_temp_mean), <span class="at">to =</span> <span class="fu">max</span>(dat<span class="sc">$</span>z_air_temp_mean), <span class="at">length.out =</span> nsims)</span>
<span id="cb80-2"><a href="#cb80-2" aria-hidden="true" tabindex="-1"></a>x_flow <span class="ot">&lt;-</span> <span class="fu">seq</span>(<span class="at">from =</span> <span class="fu">min</span>(dat<span class="sc">$</span>z_Yield_mm_log), <span class="at">to =</span> <span class="fu">max</span>(dat<span class="sc">$</span>z_Yield_mm_log), <span class="at">length.out =</span> nsims)</span>
<span id="cb80-3"><a href="#cb80-3" aria-hidden="true" tabindex="-1"></a>pred_df_sm <span class="ot">&lt;-</span> <span class="fu">expand_grid</span>(x_temp, x_flow)</span>
<span id="cb80-4"><a href="#cb80-4" aria-hidden="true" tabindex="-1"></a>pred_df_lg <span class="ot">&lt;-</span> <span class="fu">expand_grid</span>(x_temp, x_flow)</span>
<span id="cb80-5"><a href="#cb80-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb80-6"><a href="#cb80-6" aria-hidden="true" tabindex="-1"></a><span class="co"># small basins</span></span>
<span id="cb80-7"><a href="#cb80-7" aria-hidden="true" tabindex="-1"></a>te <span class="ot">&lt;-</span> param.summary[<span class="st">"alpha.0[2]"</span>,<span class="dv">1</span>] <span class="sc">+</span> param.summary[<span class="st">"alpha.1[2]"</span>,<span class="dv">1</span>]<span class="sc">*</span><span class="fu">min</span>(jags.data<span class="sc">$</span>area)</span>
<span id="cb80-8"><a href="#cb80-8" aria-hidden="true" tabindex="-1"></a>fe <span class="ot">&lt;-</span> param.summary[<span class="st">"alpha.0[3]"</span>,<span class="dv">1</span>] <span class="sc">+</span> param.summary[<span class="st">"alpha.1[3]"</span>,<span class="dv">1</span>]<span class="sc">*</span><span class="fu">min</span>(jags.data<span class="sc">$</span>area)</span>
<span id="cb80-9"><a href="#cb80-9" aria-hidden="true" tabindex="-1"></a>tfe <span class="ot">&lt;-</span> param.summary[<span class="st">"alpha.0[4]"</span>,<span class="dv">1</span>] <span class="sc">+</span> param.summary[<span class="st">"alpha.1[4]"</span>,<span class="dv">1</span>]<span class="sc">*</span><span class="fu">min</span>(jags.data<span class="sc">$</span>area)</span>
<span id="cb80-10"><a href="#cb80-10" aria-hidden="true" tabindex="-1"></a>pred_df_sm<span class="sc">$</span>pred <span class="ot">&lt;-</span> te<span class="sc">*</span>pred_df_sm<span class="sc">$</span>x_temp <span class="sc">+</span> fe<span class="sc">*</span>pred_df_sm<span class="sc">$</span>x_flow <span class="sc">+</span> tfe<span class="sc">*</span>pred_df_sm<span class="sc">$</span>x_temp<span class="sc">*</span>pred_df_sm<span class="sc">$</span>x_flow</span>
<span id="cb80-11"><a href="#cb80-11" aria-hidden="true" tabindex="-1"></a><span class="co"># large basins</span></span>
<span id="cb80-12"><a href="#cb80-12" aria-hidden="true" tabindex="-1"></a>te <span class="ot">&lt;-</span> param.summary[<span class="st">"alpha.0[2]"</span>,<span class="dv">1</span>] <span class="sc">+</span> param.summary[<span class="st">"alpha.1[2]"</span>,<span class="dv">1</span>]<span class="sc">*</span><span class="fu">max</span>(jags.data<span class="sc">$</span>area)</span>
<span id="cb80-13"><a href="#cb80-13" aria-hidden="true" tabindex="-1"></a>fe <span class="ot">&lt;-</span> param.summary[<span class="st">"alpha.0[3]"</span>,<span class="dv">1</span>] <span class="sc">+</span> param.summary[<span class="st">"alpha.1[3]"</span>,<span class="dv">1</span>]<span class="sc">*</span><span class="fu">max</span>(jags.data<span class="sc">$</span>area)</span>
<span id="cb80-14"><a href="#cb80-14" aria-hidden="true" tabindex="-1"></a>tfe <span class="ot">&lt;-</span> param.summary[<span class="st">"alpha.0[4]"</span>,<span class="dv">1</span>] <span class="sc">+</span> param.summary[<span class="st">"alpha.1[4]"</span>,<span class="dv">1</span>]<span class="sc">*</span><span class="fu">max</span>(jags.data<span class="sc">$</span>area)</span>
<span id="cb80-15"><a href="#cb80-15" aria-hidden="true" tabindex="-1"></a>pred_df_lg<span class="sc">$</span>pred <span class="ot">&lt;-</span> te<span class="sc">*</span>pred_df_lg<span class="sc">$</span>x_temp <span class="sc">+</span> fe<span class="sc">*</span>pred_df_lg<span class="sc">$</span>x_flow <span class="sc">+</span> tfe<span class="sc">*</span>pred_df_lg<span class="sc">$</span>x_temp<span class="sc">*</span>pred_df_lg<span class="sc">$</span>x_flow</span>
<span id="cb80-16"><a href="#cb80-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb80-17"><a href="#cb80-17" aria-hidden="true" tabindex="-1"></a><span class="co"># plot</span></span>
<span id="cb80-18"><a href="#cb80-18" aria-hidden="true" tabindex="-1"></a>p1sm <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(pred_df_sm, <span class="fu">aes</span>(<span class="at">x =</span> x_temp, <span class="at">y =</span> pred, <span class="at">color =</span> x_flow, <span class="at">group =</span> x_flow)) <span class="sc">+</span></span>
<span id="cb80-19"><a href="#cb80-19" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_line</span>() <span class="sc">+</span></span>
<span id="cb80-20"><a href="#cb80-20" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_color_distiller</span>(<span class="at">palette =</span> <span class="st">"BrBG"</span>, <span class="at">direction =</span> <span class="sc">+</span><span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb80-21"><a href="#cb80-21" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme_bw</span>() <span class="sc">+</span> <span class="fu">theme</span>(<span class="at">panel.grid =</span> <span class="fu">element_blank</span>()) <span class="sc">+</span></span>
<span id="cb80-22"><a href="#cb80-22" aria-hidden="true" tabindex="-1"></a>    <span class="fu">labs</span>(<span class="at">color =</span> <span class="st">"Flow"</span>) <span class="sc">+</span> <span class="fu">xlab</span>(<span class="st">"Air temperature"</span>) <span class="sc">+</span> <span class="fu">ylab</span>(<span class="st">"Water temperature (deviation)"</span>) <span class="sc">+</span> <span class="fu">ylim</span>(<span class="sc">-</span><span class="dv">7</span>,<span class="dv">7</span>)</span>
<span id="cb80-23"><a href="#cb80-23" aria-hidden="true" tabindex="-1"></a>p2sm <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(pred_df_sm, <span class="fu">aes</span>(<span class="at">x =</span> x_temp, <span class="at">y =</span> x_flow)) <span class="sc">+</span></span>
<span id="cb80-24"><a href="#cb80-24" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_tile</span>(<span class="fu">aes</span>(<span class="at">fill =</span> pred)) <span class="sc">+</span></span>
<span id="cb80-25"><a href="#cb80-25" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_fill_distiller</span>(<span class="at">palette =</span> <span class="st">"Spectral"</span>, <span class="at">limits =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="dv">7</span>,<span class="dv">7</span>)) <span class="sc">+</span></span>
<span id="cb80-26"><a href="#cb80-26" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme_bw</span>() <span class="sc">+</span> <span class="fu">theme</span>(<span class="at">panel.grid =</span> <span class="fu">element_blank</span>()) <span class="sc">+</span></span>
<span id="cb80-27"><a href="#cb80-27" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_x_continuous</span>(<span class="at">expand =</span> <span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">0</span>)) <span class="sc">+</span> <span class="fu">scale_y_continuous</span>(<span class="at">expand =</span> <span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">0</span>)) <span class="sc">+</span></span>
<span id="cb80-28"><a href="#cb80-28" aria-hidden="true" tabindex="-1"></a>    <span class="fu">labs</span>(<span class="at">fill =</span> <span class="st">"Water</span><span class="sc">\n</span><span class="st">temp.</span><span class="sc">\n</span><span class="st">dev."</span>) <span class="sc">+</span> <span class="fu">xlab</span>(<span class="st">"Air temperature"</span>) <span class="sc">+</span> <span class="fu">ylab</span>(<span class="st">"Flow"</span>)</span>
<span id="cb80-29"><a href="#cb80-29" aria-hidden="true" tabindex="-1"></a><span class="co"># plot</span></span>
<span id="cb80-30"><a href="#cb80-30" aria-hidden="true" tabindex="-1"></a>p1lg <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(pred_df_lg, <span class="fu">aes</span>(<span class="at">x =</span> x_temp, <span class="at">y =</span> pred, <span class="at">color =</span> x_flow, <span class="at">group =</span> x_flow)) <span class="sc">+</span></span>
<span id="cb80-31"><a href="#cb80-31" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_line</span>() <span class="sc">+</span></span>
<span id="cb80-32"><a href="#cb80-32" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_color_distiller</span>(<span class="at">palette =</span> <span class="st">"BrBG"</span>, <span class="at">direction =</span> <span class="sc">+</span><span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb80-33"><a href="#cb80-33" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme_bw</span>() <span class="sc">+</span> <span class="fu">theme</span>(<span class="at">panel.grid =</span> <span class="fu">element_blank</span>()) <span class="sc">+</span></span>
<span id="cb80-34"><a href="#cb80-34" aria-hidden="true" tabindex="-1"></a>    <span class="fu">labs</span>(<span class="at">color =</span> <span class="st">"Flow"</span>) <span class="sc">+</span> <span class="fu">xlab</span>(<span class="st">"Air temperature"</span>) <span class="sc">+</span> <span class="fu">ylab</span>(<span class="st">"Water temperature (deviation)"</span>) <span class="sc">+</span> <span class="fu">ylim</span>(<span class="sc">-</span><span class="dv">7</span>,<span class="dv">7</span>)</span>
<span id="cb80-35"><a href="#cb80-35" aria-hidden="true" tabindex="-1"></a>p2lg <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(pred_df_lg, <span class="fu">aes</span>(<span class="at">x =</span> x_temp, <span class="at">y =</span> x_flow)) <span class="sc">+</span></span>
<span id="cb80-36"><a href="#cb80-36" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_tile</span>(<span class="fu">aes</span>(<span class="at">fill =</span> pred)) <span class="sc">+</span></span>
<span id="cb80-37"><a href="#cb80-37" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_fill_distiller</span>(<span class="at">palette =</span> <span class="st">"Spectral"</span>, <span class="at">limits =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="dv">7</span>,<span class="dv">7</span>)) <span class="sc">+</span></span>
<span id="cb80-38"><a href="#cb80-38" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme_bw</span>() <span class="sc">+</span> <span class="fu">theme</span>(<span class="at">panel.grid =</span> <span class="fu">element_blank</span>()) <span class="sc">+</span></span>
<span id="cb80-39"><a href="#cb80-39" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_x_continuous</span>(<span class="at">expand =</span> <span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">0</span>)) <span class="sc">+</span> <span class="fu">scale_y_continuous</span>(<span class="at">expand =</span> <span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">0</span>)) <span class="sc">+</span></span>
<span id="cb80-40"><a href="#cb80-40" aria-hidden="true" tabindex="-1"></a>    <span class="fu">labs</span>(<span class="at">fill =</span> <span class="st">"Water</span><span class="sc">\n</span><span class="st">temp.</span><span class="sc">\n</span><span class="st">dev."</span>) <span class="sc">+</span> <span class="fu">xlab</span>(<span class="st">"Air temperature"</span>) <span class="sc">+</span> <span class="fu">ylab</span>(<span class="st">"Flow"</span>)</span>
<span id="cb80-41"><a href="#cb80-41" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb80-42"><a href="#cb80-42" aria-hidden="true" tabindex="-1"></a>egg<span class="sc">::</span><span class="fu">ggarrange</span>(p1sm, p2sm, p1lg, p2lg, <span class="at">ncol =</span> <span class="dv">2</span>, <span class="at">nrow =</span> <span class="dv">2</span>, <span class="at">labels =</span> <span class="fu">c</span>(<span class="st">"small"</span>, <span class="st">"small"</span>, <span class="st">"large"</span>, <span class="st">"large"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="ModelTemp-EcoDrought_files/figure-html/unnamed-chunk-60-1.png" class="img-fluid figure-img" width="768"></p>
</figure>
</div>
</div>
</div>
<p>Temp effect - old</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb81"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb81-1"><a href="#cb81-1" aria-hidden="true" tabindex="-1"></a>mydf <span class="ot">&lt;-</span> ggfit <span class="sc">%&gt;%</span></span>
<span id="cb81-2"><a href="#cb81-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(Parameter <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"B.site[1,2]"</span>, <span class="st">"B.site[2,2]"</span>, <span class="st">"B.site[3,2]"</span>, <span class="st">"B.site[4,2]"</span>, <span class="st">"B.site[5,2]"</span>,</span>
<span id="cb81-3"><a href="#cb81-3" aria-hidden="true" tabindex="-1"></a>                          <span class="st">"B.site[6,2]"</span>, <span class="st">"B.site[7,2]"</span>, <span class="st">"B.site[8,2]"</span>, <span class="st">"B.site[9,2]"</span>, <span class="st">"B.site[10,2]"</span>, <span class="st">"B.site[11,2]"</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb81-4"><a href="#cb81-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Parameter =</span> <span class="fu">factor</span>(Parameter, <span class="at">levels =</span> <span class="fu">c</span>(<span class="st">"B.site[1,2]"</span>, <span class="st">"B.site[2,2]"</span>, <span class="st">"B.site[3,2]"</span>, <span class="st">"B.site[4,2]"</span>, <span class="st">"B.site[5,2]"</span>,</span>
<span id="cb81-5"><a href="#cb81-5" aria-hidden="true" tabindex="-1"></a>                          <span class="st">"B.site[6,2]"</span>, <span class="st">"B.site[7,2]"</span>, <span class="st">"B.site[8,2]"</span>, <span class="st">"B.site[9,2]"</span>, <span class="st">"B.site[10,2]"</span>, <span class="st">"B.site[11,2]"</span>))) <span class="sc">%&gt;%</span></span>
<span id="cb81-6"><a href="#cb81-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(Parameter) <span class="sc">%&gt;%</span> </span>
<span id="cb81-7"><a href="#cb81-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="at">mean =</span> <span class="fu">mean</span>(value)) <span class="sc">%&gt;%</span></span>
<span id="cb81-8"><a href="#cb81-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span></span>
<span id="cb81-9"><a href="#cb81-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">site_name =</span> mysites<span class="sc">$</span>site_name) <span class="sc">%&gt;%</span></span>
<span id="cb81-10"><a href="#cb81-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(dat <span class="sc">%&gt;%</span> <span class="fu">group_by</span>(site_name) <span class="sc">%&gt;%</span> <span class="fu">summarize</span>(<span class="at">area_sqmi =</span> <span class="fu">unique</span>(area_sqmi))) <span class="sc">%&gt;%</span> </span>
<span id="cb81-11"><a href="#cb81-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(dat <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="at">month =</span> <span class="fu">month</span>(date)) <span class="sc">%&gt;%</span> <span class="fu">filter</span>(month <span class="sc">%in%</span> <span class="fu">c</span>(<span class="dv">7</span><span class="sc">:</span><span class="dv">9</span>)) <span class="sc">%&gt;%</span> <span class="fu">group_by</span>(site_name) <span class="sc">%&gt;%</span> <span class="fu">summarize</span>(<span class="at">meanSummYield =</span> <span class="fu">mean</span>(Yield_mm, <span class="at">na.rm =</span> <span class="cn">TRUE</span>))) <span class="sc">%&gt;%</span></span>
<span id="cb81-12"><a href="#cb81-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">z_area =</span> <span class="fu">scale</span>(area_sqmi), <span class="at">z_yield =</span> <span class="fu">scale</span>(meanSummYield))</span>
<span id="cb81-13"><a href="#cb81-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-14"><a href="#cb81-14" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(<span class="fu">lm</span>(mean <span class="sc">~</span> z_area <span class="sc">+</span> z_yield, <span class="at">data =</span> mydf))</span>
<span id="cb81-15"><a href="#cb81-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-16"><a href="#cb81-16" aria-hidden="true" tabindex="-1"></a>p1 <span class="ot">&lt;-</span> mydf <span class="sc">%&gt;%</span></span>
<span id="cb81-17"><a href="#cb81-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> <span class="fu">log</span>(area_sqmi), <span class="at">y =</span> mean)) <span class="sc">+</span></span>
<span id="cb81-18"><a href="#cb81-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span> <span class="fu">geom_smooth</span>(<span class="at">method =</span> <span class="st">"lm"</span>) <span class="sc">+</span> <span class="fu">theme_bw</span>() <span class="sc">+</span></span>
<span id="cb81-19"><a href="#cb81-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="st">"Catchment area (log scale)"</span>) <span class="sc">+</span> <span class="fu">ylab</span>(<span class="st">"Temperature effect (posterior mean)"</span>) <span class="sc">+</span> ggpubr<span class="sc">::</span><span class="fu">stat_cor</span>()</span>
<span id="cb81-20"><a href="#cb81-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-21"><a href="#cb81-21" aria-hidden="true" tabindex="-1"></a>p2 <span class="ot">&lt;-</span> mydf <span class="sc">%&gt;%</span></span>
<span id="cb81-22"><a href="#cb81-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> <span class="fu">log</span>(meanSummYield), <span class="at">y =</span> mean)) <span class="sc">+</span></span>
<span id="cb81-23"><a href="#cb81-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span> <span class="fu">geom_smooth</span>(<span class="at">method =</span> <span class="st">"lm"</span>) <span class="sc">+</span> <span class="fu">theme_bw</span>() <span class="sc">+</span></span>
<span id="cb81-24"><a href="#cb81-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="st">"Mean summer yield (log scale)"</span>) <span class="sc">+</span> <span class="fu">ylab</span>(<span class="st">"Temperature effect (posterior mean)"</span>) <span class="sc">+</span> ggpubr<span class="sc">::</span><span class="fu">stat_cor</span>()</span>
<span id="cb81-25"><a href="#cb81-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-26"><a href="#cb81-26" aria-hidden="true" tabindex="-1"></a>ggpubr<span class="sc">::</span><span class="fu">ggarrange</span>(p1, p2, <span class="at">nrow =</span> <span class="dv">1</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>Flow effect - old</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb82"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb82-1"><a href="#cb82-1" aria-hidden="true" tabindex="-1"></a>mydf <span class="ot">&lt;-</span> ggfit <span class="sc">%&gt;%</span></span>
<span id="cb82-2"><a href="#cb82-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(Parameter <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"B.site[1,3]"</span>, <span class="st">"B.site[2,3]"</span>, <span class="st">"B.site[3,3]"</span>, <span class="st">"B.site[4,3]"</span>, <span class="st">"B.site[5,3]"</span>,</span>
<span id="cb82-3"><a href="#cb82-3" aria-hidden="true" tabindex="-1"></a>                          <span class="st">"B.site[6,3]"</span>, <span class="st">"B.site[7,3]"</span>, <span class="st">"B.site[8,3]"</span>, <span class="st">"B.site[9,3]"</span>, <span class="st">"B.site[10,3]"</span>, <span class="st">"B.site[11,3]"</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb82-4"><a href="#cb82-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Parameter =</span> <span class="fu">factor</span>(Parameter, <span class="at">levels =</span> <span class="fu">c</span>(<span class="st">"B.site[1,3]"</span>, <span class="st">"B.site[2,3]"</span>, <span class="st">"B.site[3,3]"</span>, <span class="st">"B.site[4,3]"</span>, <span class="st">"B.site[5,3]"</span>,</span>
<span id="cb82-5"><a href="#cb82-5" aria-hidden="true" tabindex="-1"></a>                          <span class="st">"B.site[6,3]"</span>, <span class="st">"B.site[7,3]"</span>, <span class="st">"B.site[8,3]"</span>, <span class="st">"B.site[9,3]"</span>, <span class="st">"B.site[10,3]"</span>, <span class="st">"B.site[11,3]"</span>))) <span class="sc">%&gt;%</span></span>
<span id="cb82-6"><a href="#cb82-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(Parameter) <span class="sc">%&gt;%</span> </span>
<span id="cb82-7"><a href="#cb82-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="at">mean =</span> <span class="fu">mean</span>(value)) <span class="sc">%&gt;%</span></span>
<span id="cb82-8"><a href="#cb82-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span></span>
<span id="cb82-9"><a href="#cb82-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">site_name =</span> mysites<span class="sc">$</span>site_name) <span class="sc">%&gt;%</span></span>
<span id="cb82-10"><a href="#cb82-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(dat <span class="sc">%&gt;%</span> <span class="fu">group_by</span>(site_name) <span class="sc">%&gt;%</span> <span class="fu">summarize</span>(<span class="at">area_sqmi =</span> <span class="fu">unique</span>(area_sqmi))) <span class="sc">%&gt;%</span> </span>
<span id="cb82-11"><a href="#cb82-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(dat <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="at">month =</span> <span class="fu">month</span>(date)) <span class="sc">%&gt;%</span> <span class="fu">filter</span>(month <span class="sc">%in%</span> <span class="fu">c</span>(<span class="dv">7</span><span class="sc">:</span><span class="dv">9</span>)) <span class="sc">%&gt;%</span> <span class="fu">group_by</span>(site_name) <span class="sc">%&gt;%</span> <span class="fu">summarize</span>(<span class="at">meanSummYield =</span> <span class="fu">mean</span>(Yield_mm, <span class="at">na.rm =</span> <span class="cn">TRUE</span>))) <span class="sc">%&gt;%</span></span>
<span id="cb82-12"><a href="#cb82-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">z_area =</span> <span class="fu">scale</span>(area_sqmi), <span class="at">z_yield =</span> <span class="fu">scale</span>(meanSummYield))</span>
<span id="cb82-13"><a href="#cb82-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-14"><a href="#cb82-14" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(<span class="fu">lm</span>(mean <span class="sc">~</span> z_area <span class="sc">+</span> z_yield, <span class="at">data =</span> mydf))</span>
<span id="cb82-15"><a href="#cb82-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-16"><a href="#cb82-16" aria-hidden="true" tabindex="-1"></a>p1 <span class="ot">&lt;-</span> mydf <span class="sc">%&gt;%</span></span>
<span id="cb82-17"><a href="#cb82-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> <span class="fu">log</span>(area_sqmi), <span class="at">y =</span> mean)) <span class="sc">+</span></span>
<span id="cb82-18"><a href="#cb82-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span> <span class="fu">geom_smooth</span>(<span class="at">method =</span> <span class="st">"lm"</span>) <span class="sc">+</span> <span class="fu">theme_bw</span>() <span class="sc">+</span></span>
<span id="cb82-19"><a href="#cb82-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="st">"Catchment area (log scale)"</span>) <span class="sc">+</span> <span class="fu">ylab</span>(<span class="st">"Flow effect (posterior mean)"</span>) <span class="sc">+</span> ggpubr<span class="sc">::</span><span class="fu">stat_cor</span>(<span class="at">label.y.npc =</span> <span class="st">"bottom"</span>)</span>
<span id="cb82-20"><a href="#cb82-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-21"><a href="#cb82-21" aria-hidden="true" tabindex="-1"></a>p2 <span class="ot">&lt;-</span> mydf <span class="sc">%&gt;%</span></span>
<span id="cb82-22"><a href="#cb82-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> <span class="fu">log</span>(meanSummYield), <span class="at">y =</span> mean)) <span class="sc">+</span></span>
<span id="cb82-23"><a href="#cb82-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span> <span class="fu">geom_smooth</span>(<span class="at">method =</span> <span class="st">"lm"</span>) <span class="sc">+</span> <span class="fu">theme_bw</span>() <span class="sc">+</span></span>
<span id="cb82-24"><a href="#cb82-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="st">"Mean summer yield (log scale)"</span>) <span class="sc">+</span> <span class="fu">ylab</span>(<span class="st">"Flow effect (posterior mean)"</span>) <span class="sc">+</span> ggpubr<span class="sc">::</span><span class="fu">stat_cor</span>(<span class="at">label.y.npc =</span> <span class="st">"bottom"</span>)</span>
<span id="cb82-25"><a href="#cb82-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-26"><a href="#cb82-26" aria-hidden="true" tabindex="-1"></a>ggpubr<span class="sc">::</span><span class="fu">ggarrange</span>(p1, p2, <span class="at">nrow =</span> <span class="dv">1</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>What does this mean with respect to the effects of (streamflow) drought on spatial variation in stream temperature across river networks?</p>
<ul>
<li>Superficially, during dry years, stream temperatures will warm in larger, lower-elevation rivers (as water temp becomes more responsive to air temp?), while stream temperatures cool in smaller, headwater streams as (cold) groundwater contributions account for an increasingly larger proportion of volumetric discharge.</li>
<li>Thus, drought amplifies spatial variability in stream temperature along gradients of stream size (and elevation?)</li>
</ul>
<p>But what about variation in groundwater availability among headwater streams? And what about spatial variation in the strength of the interaction between flow and temperature? Perhaps dry years amplify spatial variation in water temperature in multiple dimensions: (1) increased divergence in temperature between small and large streams (as discussed above), but also (2) increased divergence in temperature among headwater systems that differ in groundwater availability.</p>


<!-- -->

</section>
</section>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
  window.document.addEventListener("DOMContentLoaded", function (event) {
    // Ensure there is a toggle, if there isn't float one in the top right
    if (window.document.querySelector('.quarto-color-scheme-toggle') === null) {
      const a = window.document.createElement('a');
      a.classList.add('top-right');
      a.classList.add('quarto-color-scheme-toggle');
      a.href = "";
      a.onclick = function() { try { window.quartoToggleColorScheme(); } catch {} return false; };
      const i = window.document.createElement("i");
      i.classList.add('bi');
      a.appendChild(i);
      window.document.body.appendChild(a);
    }
    setColorSchemeToggle(hasAlternateSentinel())
    const icon = "";
    const anchorJS = new window.AnchorJS();
    anchorJS.options = {
      placement: 'right',
      icon: icon
    };
    anchorJS.add('.anchored');
    const isCodeAnnotation = (el) => {
      for (const clz of el.classList) {
        if (clz.startsWith('code-annotation-')) {                     
          return true;
        }
      }
      return false;
    }
    const onCopySuccess = function(e) {
      // button target
      const button = e.trigger;
      // don't keep focus
      button.blur();
      // flash "checked"
      button.classList.add('code-copy-button-checked');
      var currentTitle = button.getAttribute("title");
      button.setAttribute("title", "Copied!");
      let tooltip;
      if (window.bootstrap) {
        button.setAttribute("data-bs-toggle", "tooltip");
        button.setAttribute("data-bs-placement", "left");
        button.setAttribute("data-bs-title", "Copied!");
        tooltip = new bootstrap.Tooltip(button, 
          { trigger: "manual", 
            customClass: "code-copy-button-tooltip",
            offset: [0, -8]});
        tooltip.show();    
      }
      setTimeout(function() {
        if (tooltip) {
          tooltip.hide();
          button.removeAttribute("data-bs-title");
          button.removeAttribute("data-bs-toggle");
          button.removeAttribute("data-bs-placement");
        }
        button.setAttribute("title", currentTitle);
        button.classList.remove('code-copy-button-checked');
      }, 1000);
      // clear code selection
      e.clearSelection();
    }
    const getTextToCopy = function(trigger) {
        const codeEl = trigger.previousElementSibling.cloneNode(true);
        for (const childEl of codeEl.children) {
          if (isCodeAnnotation(childEl)) {
            childEl.remove();
          }
        }
        return codeEl.innerText;
    }
    const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
      text: getTextToCopy
    });
    clipboard.on('success', onCopySuccess);
    if (window.document.getElementById('quarto-embedded-source-code-modal')) {
      const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
        text: getTextToCopy,
        container: window.document.getElementById('quarto-embedded-source-code-modal')
      });
      clipboardModal.on('success', onCopySuccess);
    }
    const viewSource = window.document.getElementById('quarto-view-source') ||
                       window.document.getElementById('quarto-code-tools-source');
    if (viewSource) {
      const sourceUrl = viewSource.getAttribute("data-quarto-source-url");
      viewSource.addEventListener("click", function(e) {
        if (sourceUrl) {
          // rstudio viewer pane
          if (/\bcapabilities=\b/.test(window.location)) {
            window.open(sourceUrl);
          } else {
            window.location.href = sourceUrl;
          }
        } else {
          const modal = new bootstrap.Modal(document.getElementById('quarto-embedded-source-code-modal'));
          modal.show();
        }
        return false;
      });
    }
    function toggleCodeHandler(show) {
      return function(e) {
        const detailsSrc = window.document.querySelectorAll(".cell > details > .sourceCode");
        for (let i=0; i<detailsSrc.length; i++) {
          const details = detailsSrc[i].parentElement;
          if (show) {
            details.open = true;
          } else {
            details.removeAttribute("open");
          }
        }
        const cellCodeDivs = window.document.querySelectorAll(".cell > .sourceCode");
        const fromCls = show ? "hidden" : "unhidden";
        const toCls = show ? "unhidden" : "hidden";
        for (let i=0; i<cellCodeDivs.length; i++) {
          const codeDiv = cellCodeDivs[i];
          if (codeDiv.classList.contains(fromCls)) {
            codeDiv.classList.remove(fromCls);
            codeDiv.classList.add(toCls);
          } 
        }
        return false;
      }
    }
    const hideAllCode = window.document.getElementById("quarto-hide-all-code");
    if (hideAllCode) {
      hideAllCode.addEventListener("click", toggleCodeHandler(false));
    }
    const showAllCode = window.document.getElementById("quarto-show-all-code");
    if (showAllCode) {
      showAllCode.addEventListener("click", toggleCodeHandler(true));
    }
      var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
      var mailtoRegex = new RegExp(/^mailto:/);
        var filterRegex = new RegExp('/' + window.location.host + '/');
      var isInternal = (href) => {
          return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
      }
      // Inspect non-navigation links and adorn them if external
     var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
      for (var i=0; i<links.length; i++) {
        const link = links[i];
        if (!isInternal(link.href)) {
          // undo the damage that might have been done by quarto-nav.js in the case of
          // links that we want to consider external
          if (link.dataset.originalHref !== undefined) {
            link.href = link.dataset.originalHref;
          }
        }
      }
    function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
      const config = {
        allowHTML: true,
        maxWidth: 500,
        delay: 100,
        arrow: false,
        appendTo: function(el) {
            return el.parentElement;
        },
        interactive: true,
        interactiveBorder: 10,
        theme: 'quarto',
        placement: 'bottom-start',
      };
      if (contentFn) {
        config.content = contentFn;
      }
      if (onTriggerFn) {
        config.onTrigger = onTriggerFn;
      }
      if (onUntriggerFn) {
        config.onUntrigger = onUntriggerFn;
      }
      window.tippy(el, config); 
    }
    const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
    for (var i=0; i<noterefs.length; i++) {
      const ref = noterefs[i];
      tippyHover(ref, function() {
        // use id or data attribute instead here
        let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
        try { href = new URL(href).hash; } catch {}
        const id = href.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note) {
          return note.innerHTML;
        } else {
          return "";
        }
      });
    }
    const xrefs = window.document.querySelectorAll('a.quarto-xref');
    const processXRef = (id, note) => {
      // Strip column container classes
      const stripColumnClz = (el) => {
        el.classList.remove("page-full", "page-columns");
        if (el.children) {
          for (const child of el.children) {
            stripColumnClz(child);
          }
        }
      }
      stripColumnClz(note)
      if (id === null || id.startsWith('sec-')) {
        // Special case sections, only their first couple elements
        const container = document.createElement("div");
        if (note.children && note.children.length > 2) {
          container.appendChild(note.children[0].cloneNode(true));
          for (let i = 1; i < note.children.length; i++) {
            const child = note.children[i];
            if (child.tagName === "P" && child.innerText === "") {
              continue;
            } else {
              container.appendChild(child.cloneNode(true));
              break;
            }
          }
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(container);
          }
          return container.innerHTML
        } else {
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(note);
          }
          return note.innerHTML;
        }
      } else {
        // Remove any anchor links if they are present
        const anchorLink = note.querySelector('a.anchorjs-link');
        if (anchorLink) {
          anchorLink.remove();
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        if (note.classList.contains("callout")) {
          return note.outerHTML;
        } else {
          return note.innerHTML;
        }
      }
    }
    for (var i=0; i<xrefs.length; i++) {
      const xref = xrefs[i];
      tippyHover(xref, undefined, function(instance) {
        instance.disable();
        let url = xref.getAttribute('href');
        let hash = undefined; 
        if (url.startsWith('#')) {
          hash = url;
        } else {
          try { hash = new URL(url).hash; } catch {}
        }
        if (hash) {
          const id = hash.replace(/^#\/?/, "");
          const note = window.document.getElementById(id);
          if (note !== null) {
            try {
              const html = processXRef(id, note.cloneNode(true));
              instance.setContent(html);
            } finally {
              instance.enable();
              instance.show();
            }
          } else {
            // See if we can fetch this
            fetch(url.split('#')[0])
            .then(res => res.text())
            .then(html => {
              const parser = new DOMParser();
              const htmlDoc = parser.parseFromString(html, "text/html");
              const note = htmlDoc.getElementById(id);
              if (note !== null) {
                const html = processXRef(id, note);
                instance.setContent(html);
              } 
            }).finally(() => {
              instance.enable();
              instance.show();
            });
          }
        } else {
          // See if we can fetch a full url (with no hash to target)
          // This is a special case and we should probably do some content thinning / targeting
          fetch(url)
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.querySelector('main.content');
            if (note !== null) {
              // This should only happen for chapter cross references
              // (since there is no id in the URL)
              // remove the first header
              if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
                note.children[0].remove();
              }
              const html = processXRef(null, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      }, function(instance) {
      });
    }
        let selectedAnnoteEl;
        const selectorForAnnotation = ( cell, annotation) => {
          let cellAttr = 'data-code-cell="' + cell + '"';
          let lineAttr = 'data-code-annotation="' +  annotation + '"';
          const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
          return selector;
        }
        const selectCodeLines = (annoteEl) => {
          const doc = window.document;
          const targetCell = annoteEl.getAttribute("data-target-cell");
          const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
          const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
          const lines = annoteSpan.getAttribute("data-code-lines").split(",");
          const lineIds = lines.map((line) => {
            return targetCell + "-" + line;
          })
          let top = null;
          let height = null;
          let parent = null;
          if (lineIds.length > 0) {
              //compute the position of the single el (top and bottom and make a div)
              const el = window.document.getElementById(lineIds[0]);
              top = el.offsetTop;
              height = el.offsetHeight;
              parent = el.parentElement.parentElement;
            if (lineIds.length > 1) {
              const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
              const bottom = lastEl.offsetTop + lastEl.offsetHeight;
              height = bottom - top;
            }
            if (top !== null && height !== null && parent !== null) {
              // cook up a div (if necessary) and position it 
              let div = window.document.getElementById("code-annotation-line-highlight");
              if (div === null) {
                div = window.document.createElement("div");
                div.setAttribute("id", "code-annotation-line-highlight");
                div.style.position = 'absolute';
                parent.appendChild(div);
              }
              div.style.top = top - 2 + "px";
              div.style.height = height + 4 + "px";
              div.style.left = 0;
              let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
              if (gutterDiv === null) {
                gutterDiv = window.document.createElement("div");
                gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
                gutterDiv.style.position = 'absolute';
                const codeCell = window.document.getElementById(targetCell);
                const gutter = codeCell.querySelector('.code-annotation-gutter');
                gutter.appendChild(gutterDiv);
              }
              gutterDiv.style.top = top - 2 + "px";
              gutterDiv.style.height = height + 4 + "px";
            }
            selectedAnnoteEl = annoteEl;
          }
        };
        const unselectCodeLines = () => {
          const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
          elementsIds.forEach((elId) => {
            const div = window.document.getElementById(elId);
            if (div) {
              div.remove();
            }
          });
          selectedAnnoteEl = undefined;
        };
          // Handle positioning of the toggle
      window.addEventListener(
        "resize",
        throttle(() => {
          elRect = undefined;
          if (selectedAnnoteEl) {
            selectCodeLines(selectedAnnoteEl);
          }
        }, 10)
      );
      function throttle(fn, ms) {
      let throttle = false;
      let timer;
        return (...args) => {
          if(!throttle) { // first call gets through
              fn.apply(this, args);
              throttle = true;
          } else { // all the others get throttled
              if(timer) clearTimeout(timer); // cancel #2
              timer = setTimeout(() => {
                fn.apply(this, args);
                timer = throttle = false;
              }, ms);
          }
        };
      }
        // Attach click handler to the DT
        const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
        for (const annoteDlNode of annoteDls) {
          annoteDlNode.addEventListener('click', (event) => {
            const clickedEl = event.target;
            if (clickedEl !== selectedAnnoteEl) {
              unselectCodeLines();
              const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
              if (activeEl) {
                activeEl.classList.remove('code-annotation-active');
              }
              selectCodeLines(clickedEl);
              clickedEl.classList.add('code-annotation-active');
            } else {
              // Unselect the line
              unselectCodeLines();
              clickedEl.classList.remove('code-annotation-active');
            }
          });
        }
    const findCites = (el) => {
      const parentEl = el.parentElement;
      if (parentEl) {
        const cites = parentEl.dataset.cites;
        if (cites) {
          return {
            el,
            cites: cites.split(' ')
          };
        } else {
          return findCites(el.parentElement)
        }
      } else {
        return undefined;
      }
    };
    var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
    for (var i=0; i<bibliorefs.length; i++) {
      const ref = bibliorefs[i];
      const citeInfo = findCites(ref);
      if (citeInfo) {
        tippyHover(citeInfo.el, function() {
          var popup = window.document.createElement('div');
          citeInfo.cites.forEach(function(cite) {
            var citeDiv = window.document.createElement('div');
            citeDiv.classList.add('hanging-indent');
            citeDiv.classList.add('csl-entry');
            var biblioDiv = window.document.getElementById('ref-' + cite);
            if (biblioDiv) {
              citeDiv.innerHTML = biblioDiv.innerHTML;
            }
            popup.appendChild(citeDiv);
          });
          return popup.innerHTML;
        });
      }
    }
  });
  </script>
<nav class="page-navigation">
  <div class="nav-page nav-page-previous">
      <a href="./ModelTemp-Letcher.html" class="pagination-link" aria-label="ModelTemp - Letcher et al. (2016)">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">ModelTemp - Letcher et al.&nbsp;(2016)</span></span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
  </div>
</nav><div class="modal fade" id="quarto-embedded-source-code-modal" tabindex="-1" aria-labelledby="quarto-embedded-source-code-modal-label" aria-hidden="true"><div class="modal-dialog modal-dialog-scrollable"><div class="modal-content"><div class="modal-header"><h5 class="modal-title" id="quarto-embedded-source-code-modal-label">Source Code</h5><button class="btn-close" data-bs-dismiss="modal"></button></div><div class="modal-body"><div class="">
<div class="sourceCode" id="cb83" data-shortcodes="false"><pre class="sourceCode markdown code-with-copy"><code class="sourceCode markdown"><span id="cb83-1"><a href="#cb83-1" aria-hidden="true" tabindex="-1"></a><span class="co">---</span></span>
<span id="cb83-2"><a href="#cb83-2" aria-hidden="true" tabindex="-1"></a><span class="an">title:</span><span class="co"> "ModelTemp - EcoDrought"</span></span>
<span id="cb83-3"><a href="#cb83-3" aria-hidden="true" tabindex="-1"></a><span class="co">---</span></span>
<span id="cb83-4"><a href="#cb83-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb83-5"><a href="#cb83-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb83-6"><a href="#cb83-6" aria-hidden="true" tabindex="-1"></a>**Purpose:** fit hierarchical stream temp model to EcoDrought data.</span>
<span id="cb83-7"><a href="#cb83-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb83-8"><a href="#cb83-8" aria-hidden="true" tabindex="-1"></a><span class="in">```{r include=FALSE}</span></span>
<span id="cb83-9"><a href="#cb83-9" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb83-10"><a href="#cb83-10" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(R2jags)</span>
<span id="cb83-11"><a href="#cb83-11" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(MCMCvis)</span>
<span id="cb83-12"><a href="#cb83-12" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(loo)</span>
<span id="cb83-13"><a href="#cb83-13" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(HDInterval)</span>
<span id="cb83-14"><a href="#cb83-14" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(scales)</span>
<span id="cb83-15"><a href="#cb83-15" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggmcmc)</span>
<span id="cb83-16"><a href="#cb83-16" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(GGally)</span>
<span id="cb83-17"><a href="#cb83-17" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(beepr)</span>
<span id="cb83-18"><a href="#cb83-18" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb83-19"><a href="#cb83-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb83-20"><a href="#cb83-20" aria-hidden="true" tabindex="-1"></a>Notes:</span>
<span id="cb83-21"><a href="#cb83-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb83-22"><a href="#cb83-22" aria-hidden="true" tabindex="-1"></a><span class="ss">* </span>Consider bringing in additional data from NWIS to fill in middle-upper end of catchment size spectrum (Snake: Blackrock, Cache, Granite...bigger rivers? (Hoback, Gros Ventre, Greys...where to draw the line?))</span>
<span id="cb83-23"><a href="#cb83-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb83-24"><a href="#cb83-24" aria-hidden="true" tabindex="-1"></a><span class="fu">## Load data</span></span>
<span id="cb83-25"><a href="#cb83-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb83-26"><a href="#cb83-26" aria-hidden="true" tabindex="-1"></a>Also set flow = NA to 0. Probably should change this to latent variable in model, especially when expanding to sites where flow data is more rare</span>
<span id="cb83-29"><a href="#cb83-29" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb83-30"><a href="#cb83-30" aria-hidden="true" tabindex="-1"></a>dat <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(<span class="st">"data/EcoDrought_FlowTempData_formatted.csv"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb83-31"><a href="#cb83-31" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(basin <span class="sc">==</span> <span class="st">"Snake River"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb83-32"><a href="#cb83-32" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">rowNum =</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">nrow</span>(.),</span>
<span id="cb83-33"><a href="#cb83-33" aria-hidden="true" tabindex="-1"></a>         <span class="at">site_code =</span> <span class="fu">as.numeric</span>(<span class="fu">as.factor</span>(site_name)),</span>
<span id="cb83-34"><a href="#cb83-34" aria-hidden="true" tabindex="-1"></a>         <span class="at">year_code =</span> year <span class="sc">-</span> <span class="fu">min</span>(year) <span class="sc">+</span> <span class="dv">1</span>) <span class="sc">%&gt;%</span></span>
<span id="cb83-35"><a href="#cb83-35" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(tempc_mean)) <span class="sc">%&gt;%</span></span>
<span id="cb83-36"><a href="#cb83-36" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">z_Yield_mm_log =</span> <span class="fu">ifelse</span>(<span class="fu">is.na</span>(z_Yield_mm_log), <span class="dv">0</span>, z_Yield_mm_log))</span>
<span id="cb83-37"><a href="#cb83-37" aria-hidden="true" tabindex="-1"></a>dat</span>
<span id="cb83-38"><a href="#cb83-38" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb83-39"><a href="#cb83-39" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb83-40"><a href="#cb83-40" aria-hidden="true" tabindex="-1"></a>Drop sites without any flow or water temp observations and re-do site and year codes</span>
<span id="cb83-43"><a href="#cb83-43" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb83-44"><a href="#cb83-44" aria-hidden="true" tabindex="-1"></a>dropsites <span class="ot">&lt;-</span> <span class="fu">unlist</span>(dat <span class="sc">%&gt;%</span> </span>
<span id="cb83-45"><a href="#cb83-45" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(site_name) <span class="sc">%&gt;%</span> </span>
<span id="cb83-46"><a href="#cb83-46" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="at">numt =</span> <span class="fu">sum</span>(<span class="sc">!</span><span class="fu">is.na</span>(tempc_mean)), </span>
<span id="cb83-47"><a href="#cb83-47" aria-hidden="true" tabindex="-1"></a>            <span class="at">numf =</span> <span class="fu">sum</span>(<span class="sc">!</span><span class="fu">is.na</span>(z_Yield_mm_log))) <span class="sc">%&gt;%</span> </span>
<span id="cb83-48"><a href="#cb83-48" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span></span>
<span id="cb83-49"><a href="#cb83-49" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(numt <span class="sc">==</span> <span class="dv">0</span> <span class="sc">|</span> numf <span class="sc">==</span> <span class="dv">0</span>) <span class="sc">%&gt;%</span></span>
<span id="cb83-50"><a href="#cb83-50" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(site_name))</span>
<span id="cb83-51"><a href="#cb83-51" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb83-52"><a href="#cb83-52" aria-hidden="true" tabindex="-1"></a>dat <span class="ot">&lt;-</span> dat <span class="sc">%&gt;%</span> </span>
<span id="cb83-53"><a href="#cb83-53" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span>site_name <span class="sc">%in%</span> dropsites) <span class="sc">%&gt;%</span></span>
<span id="cb83-54"><a href="#cb83-54" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">rowNum =</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">nrow</span>(.),</span>
<span id="cb83-55"><a href="#cb83-55" aria-hidden="true" tabindex="-1"></a>         <span class="at">site_code =</span> <span class="fu">as.numeric</span>(<span class="fu">as.factor</span>(site_name)),</span>
<span id="cb83-56"><a href="#cb83-56" aria-hidden="true" tabindex="-1"></a>         <span class="at">year_code =</span> year <span class="sc">-</span> <span class="fu">min</span>(year) <span class="sc">+</span> <span class="dv">1</span>)</span>
<span id="cb83-57"><a href="#cb83-57" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb83-58"><a href="#cb83-58" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb83-59"><a href="#cb83-59" aria-hidden="true" tabindex="-1"></a>View site codes</span>
<span id="cb83-62"><a href="#cb83-62" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb83-63"><a href="#cb83-63" aria-hidden="true" tabindex="-1"></a>dat <span class="sc">%&gt;%</span> <span class="fu">group_by</span>(site_name) <span class="sc">%&gt;%</span> <span class="fu">summarize</span>(<span class="at">site_code =</span> <span class="fu">unique</span>(site_code)) <span class="sc">%&gt;%</span> <span class="fu">ungroup</span>()</span>
<span id="cb83-64"><a href="#cb83-64" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb83-65"><a href="#cb83-65" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb83-66"><a href="#cb83-66" aria-hidden="true" tabindex="-1"></a>Any missing data? *Need to put a prior on flow*</span>
<span id="cb83-69"><a href="#cb83-69" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb83-70"><a href="#cb83-70" aria-hidden="true" tabindex="-1"></a><span class="fu">any</span>(<span class="fu">is.na</span>(dat<span class="sc">$</span>z_air_temp_mean))</span>
<span id="cb83-71"><a href="#cb83-71" aria-hidden="true" tabindex="-1"></a><span class="fu">any</span>(<span class="fu">is.na</span>(dat<span class="sc">$</span>z_air_temp_mean_lag1))</span>
<span id="cb83-72"><a href="#cb83-72" aria-hidden="true" tabindex="-1"></a><span class="fu">any</span>(<span class="fu">is.na</span>(dat<span class="sc">$</span>z_air_temp_mean_lag2))</span>
<span id="cb83-73"><a href="#cb83-73" aria-hidden="true" tabindex="-1"></a><span class="fu">any</span>(<span class="fu">is.na</span>(dat<span class="sc">$</span>z_Yield_mm_log))</span>
<span id="cb83-74"><a href="#cb83-74" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb83-75"><a href="#cb83-75" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb83-76"><a href="#cb83-76" aria-hidden="true" tabindex="-1"></a>View data</span>
<span id="cb83-77"><a href="#cb83-77" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb83-78"><a href="#cb83-78" aria-hidden="true" tabindex="-1"></a>::: panel-tabset</span>
<span id="cb83-79"><a href="#cb83-79" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb83-80"><a href="#cb83-80" aria-hidden="true" tabindex="-1"></a><span class="fu">#### Distributions</span></span>
<span id="cb83-83"><a href="#cb83-83" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb83-84"><a href="#cb83-84" aria-hidden="true" tabindex="-1"></a>ggpubr<span class="sc">::</span><span class="fu">ggarrange</span>(dat <span class="sc">%&gt;%</span> <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> air_temp_mean, <span class="at">color =</span> site_name)) <span class="sc">+</span> <span class="fu">geom_density</span>() <span class="sc">+</span> <span class="fu">theme_bw</span>(),</span>
<span id="cb83-85"><a href="#cb83-85" aria-hidden="true" tabindex="-1"></a>                  dat <span class="sc">%&gt;%</span> <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> flow_mean_log, <span class="at">color =</span> site_name)) <span class="sc">+</span> <span class="fu">geom_density</span>() <span class="sc">+</span> <span class="fu">theme_bw</span>(),</span>
<span id="cb83-86"><a href="#cb83-86" aria-hidden="true" tabindex="-1"></a>                  dat <span class="sc">%&gt;%</span> <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> Yield_mm_log, <span class="at">color =</span> site_name)) <span class="sc">+</span> <span class="fu">geom_density</span>() <span class="sc">+</span> <span class="fu">theme_bw</span>(),</span>
<span id="cb83-87"><a href="#cb83-87" aria-hidden="true" tabindex="-1"></a>                  <span class="at">common.legend =</span> <span class="cn">TRUE</span>, <span class="at">legend =</span> <span class="st">"right"</span>, <span class="at">ncol =</span> <span class="dv">1</span>)</span>
<span id="cb83-88"><a href="#cb83-88" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb83-89"><a href="#cb83-89" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb83-90"><a href="#cb83-90" aria-hidden="true" tabindex="-1"></a><span class="fu">#### Air temp</span></span>
<span id="cb83-93"><a href="#cb83-93" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb83-94"><a href="#cb83-94" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(dat, <span class="fu">aes</span>(yday, z_air_temp_mean))<span class="sc">+</span></span>
<span id="cb83-95"><a href="#cb83-95" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">color =</span> <span class="fu">factor</span>(year))) <span class="sc">+</span></span>
<span id="cb83-96"><a href="#cb83-96" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_grid</span>(year <span class="sc">~</span> site_name)</span>
<span id="cb83-97"><a href="#cb83-97" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb83-98"><a href="#cb83-98" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb83-99"><a href="#cb83-99" aria-hidden="true" tabindex="-1"></a><span class="fu">#### Water temp</span></span>
<span id="cb83-102"><a href="#cb83-102" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb83-103"><a href="#cb83-103" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(dat, <span class="fu">aes</span>(yday, tempc_mean))<span class="sc">+</span></span>
<span id="cb83-104"><a href="#cb83-104" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">color =</span> <span class="fu">factor</span>(year)))<span class="sc">+</span></span>
<span id="cb83-105"><a href="#cb83-105" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_grid</span>(year <span class="sc">~</span> site_name)</span>
<span id="cb83-106"><a href="#cb83-106" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb83-107"><a href="#cb83-107" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb83-108"><a href="#cb83-108" aria-hidden="true" tabindex="-1"></a><span class="fu">#### Flow (log and std)</span></span>
<span id="cb83-111"><a href="#cb83-111" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb83-112"><a href="#cb83-112" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(dat, <span class="fu">aes</span>(yday, z_Yield_mm_log))<span class="sc">+</span></span>
<span id="cb83-113"><a href="#cb83-113" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">color =</span> <span class="fu">factor</span>(year)))<span class="sc">+</span></span>
<span id="cb83-114"><a href="#cb83-114" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_grid</span>(year <span class="sc">~</span> site_name)</span>
<span id="cb83-115"><a href="#cb83-115" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb83-116"><a href="#cb83-116" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb83-117"><a href="#cb83-117" aria-hidden="true" tabindex="-1"></a><span class="fu">#### Tw ~ Ta + F</span></span>
<span id="cb83-120"><a href="#cb83-120" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb83-121"><a href="#cb83-121" aria-hidden="true" tabindex="-1"></a>dat <span class="sc">%&gt;%</span> <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> z_air_temp_mean, <span class="at">y =</span> tempc_mean, <span class="at">color =</span> z_Yield_mm_log)) <span class="sc">+</span> <span class="fu">geom_point</span>(<span class="at">size =</span> <span class="fl">0.2</span>) <span class="sc">+</span> <span class="fu">facet_wrap</span>(<span class="sc">~</span>site_name) <span class="sc">+</span> <span class="fu">theme_bw</span>()</span>
<span id="cb83-122"><a href="#cb83-122" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb83-123"><a href="#cb83-123" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb83-124"><a href="#cb83-124" aria-hidden="true" tabindex="-1"></a><span class="fu">#### Ta ~ F</span></span>
<span id="cb83-127"><a href="#cb83-127" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb83-128"><a href="#cb83-128" aria-hidden="true" tabindex="-1"></a>dat <span class="sc">%&gt;%</span> <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> z_air_temp_mean, <span class="at">y =</span> z_Yield_mm_log, <span class="at">colour =</span> tempc_mean)) <span class="sc">+</span> <span class="fu">geom_point</span>(<span class="at">size =</span> <span class="fl">0.2</span>) <span class="sc">+</span> <span class="fu">facet_wrap</span>(<span class="sc">~</span>site_name) <span class="sc">+</span> <span class="fu">theme_bw</span>() <span class="sc">+</span> ggpubr<span class="sc">::</span><span class="fu">stat_cor</span>()</span>
<span id="cb83-129"><a href="#cb83-129" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb83-130"><a href="#cb83-130" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb83-131"><a href="#cb83-131" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb83-132"><a href="#cb83-132" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb83-133"><a href="#cb83-133" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb83-134"><a href="#cb83-134" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb83-135"><a href="#cb83-135" aria-hidden="true" tabindex="-1"></a><span class="fu">## Specify JAGS model</span></span>
<span id="cb83-136"><a href="#cb83-136" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb83-137"><a href="#cb83-137" aria-hidden="true" tabindex="-1"></a>Specify hierarchical model following Letcher et al. (2016). MODIFIED:</span>
<span id="cb83-138"><a href="#cb83-138" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb83-139"><a href="#cb83-139" aria-hidden="true" tabindex="-1"></a><span class="ss">* </span>add prior on covariates to deal with missing values</span>
<span id="cb83-140"><a href="#cb83-140" aria-hidden="true" tabindex="-1"></a><span class="ss">* </span>calculate Bayesian R^2 and RMSE</span>
<span id="cb83-141"><a href="#cb83-141" aria-hidden="true" tabindex="-1"></a><span class="ss">* </span>remove the year trends (same as for Hocking et al 2018)</span>
<span id="cb83-142"><a href="#cb83-142" aria-hidden="true" tabindex="-1"></a><span class="ss">* </span>add catchment covariate effects on random effects parameters</span>
<span id="cb83-143"><a href="#cb83-143" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb83-146"><a href="#cb83-146" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb83-147"><a href="#cb83-147" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"model {</span></span>
<span id="cb83-148"><a href="#cb83-148" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb83-149"><a href="#cb83-149" aria-hidden="true" tabindex="-1"></a><span class="st">    ###----------------- LIKELIHOOD -----------------###</span></span>
<span id="cb83-150"><a href="#cb83-150" aria-hidden="true" tabindex="-1"></a><span class="st">    </span></span>
<span id="cb83-151"><a href="#cb83-151" aria-hidden="true" tabindex="-1"></a><span class="st">    # Days without an observation on the previous day (first observation in a series)</span></span>
<span id="cb83-152"><a href="#cb83-152" aria-hidden="true" tabindex="-1"></a><span class="st">    # No autoregressive term</span></span>
<span id="cb83-153"><a href="#cb83-153" aria-hidden="true" tabindex="-1"></a><span class="st">    </span></span>
<span id="cb83-154"><a href="#cb83-154" aria-hidden="true" tabindex="-1"></a><span class="st">    for (i in 1:nFirstObsRows){</span></span>
<span id="cb83-155"><a href="#cb83-155" aria-hidden="true" tabindex="-1"></a><span class="st">      temp[firstObsRows[i]] ~ dnorm(stream.mu[firstObsRows[i]], pow(sigma, -2)) </span></span>
<span id="cb83-156"><a href="#cb83-156" aria-hidden="true" tabindex="-1"></a><span class="st">      stream.mu[firstObsRows[i]] &lt;- trend[firstObsRows[i]]</span></span>
<span id="cb83-157"><a href="#cb83-157" aria-hidden="true" tabindex="-1"></a><span class="st">      trend[firstObsRows[i]] &lt;- inprod(B.0[], X.0[firstObsRows[i], ]) + </span></span>
<span id="cb83-158"><a href="#cb83-158" aria-hidden="true" tabindex="-1"></a><span class="st">                                inprod(B.site[site[firstObsRows[i]], ], X.site[firstObsRows[i], ]) + </span></span>
<span id="cb83-159"><a href="#cb83-159" aria-hidden="true" tabindex="-1"></a><span class="st">                                inprod(B.year[year[firstObsRows[i]], ], X.year[firstObsRows[i], ])</span></span>
<span id="cb83-160"><a href="#cb83-160" aria-hidden="true" tabindex="-1"></a><span class="st">      #X.site[firstObsRows[i], ] ~ dnorm(0, pow(1, -2))</span></span>
<span id="cb83-161"><a href="#cb83-161" aria-hidden="true" tabindex="-1"></a><span class="st">      }</span></span>
<span id="cb83-162"><a href="#cb83-162" aria-hidden="true" tabindex="-1"></a><span class="st">    </span></span>
<span id="cb83-163"><a href="#cb83-163" aria-hidden="true" tabindex="-1"></a><span class="st">    # Days with an observation on the previous dat (all days following the first day)</span></span>
<span id="cb83-164"><a href="#cb83-164" aria-hidden="true" tabindex="-1"></a><span class="st">    # Includes autoregressive term (ar1)</span></span>
<span id="cb83-165"><a href="#cb83-165" aria-hidden="true" tabindex="-1"></a><span class="st">    </span></span>
<span id="cb83-166"><a href="#cb83-166" aria-hidden="true" tabindex="-1"></a><span class="st">    for (i in 1:nEvalRows){ </span></span>
<span id="cb83-167"><a href="#cb83-167" aria-hidden="true" tabindex="-1"></a><span class="st">      temp[evalRows[i]] ~ dnorm(stream.mu[evalRows[i]], pow(sigma, -2))</span></span>
<span id="cb83-168"><a href="#cb83-168" aria-hidden="true" tabindex="-1"></a><span class="st">      stream.mu[evalRows[i]] &lt;- trend[evalRows[i]] + ar1[site[evalRows[i]]] * (temp[evalRows[i]-1] - trend[ evalRows[i]-1 ])</span></span>
<span id="cb83-169"><a href="#cb83-169" aria-hidden="true" tabindex="-1"></a><span class="st">      trend[evalRows[i]] &lt;- inprod(B.0[], X.0[evalRows[i], ]) + </span></span>
<span id="cb83-170"><a href="#cb83-170" aria-hidden="true" tabindex="-1"></a><span class="st">                            inprod(B.site[site[evalRows[i]], ], X.site[evalRows[i], ]) + </span></span>
<span id="cb83-171"><a href="#cb83-171" aria-hidden="true" tabindex="-1"></a><span class="st">                            inprod(B.year[year[evalRows[i]], ], X.year[evalRows[i], ])</span></span>
<span id="cb83-172"><a href="#cb83-172" aria-hidden="true" tabindex="-1"></a><span class="st">      #X.site[evalRows[i], ] ~ dnorm(0, pow(1, -2))</span></span>
<span id="cb83-173"><a href="#cb83-173" aria-hidden="true" tabindex="-1"></a><span class="st">      }</span></span>
<span id="cb83-174"><a href="#cb83-174" aria-hidden="true" tabindex="-1"></a><span class="st">    </span></span>
<span id="cb83-175"><a href="#cb83-175" aria-hidden="true" tabindex="-1"></a><span class="st">    </span></span>
<span id="cb83-176"><a href="#cb83-176" aria-hidden="true" tabindex="-1"></a><span class="st">    ###----------------- PRIORS ---------------------###</span></span>
<span id="cb83-177"><a href="#cb83-177" aria-hidden="true" tabindex="-1"></a><span class="st">    </span></span>
<span id="cb83-178"><a href="#cb83-178" aria-hidden="true" tabindex="-1"></a><span class="st">    # ar1, hierarchical by site</span></span>
<span id="cb83-179"><a href="#cb83-179" aria-hidden="true" tabindex="-1"></a><span class="st">    for (i in 1:nsites){</span></span>
<span id="cb83-180"><a href="#cb83-180" aria-hidden="true" tabindex="-1"></a><span class="st">      ar1[i] ~ dnorm(ar1Mean, pow(ar1SD, -2)) T(-1,1)       </span></span>
<span id="cb83-181"><a href="#cb83-181" aria-hidden="true" tabindex="-1"></a><span class="st">    }</span></span>
<span id="cb83-182"><a href="#cb83-182" aria-hidden="true" tabindex="-1"></a><span class="st">    ar1Mean ~ dunif(-1, 1) </span></span>
<span id="cb83-183"><a href="#cb83-183" aria-hidden="true" tabindex="-1"></a><span class="st">    ar1SD ~ dunif(0, 2)</span></span>
<span id="cb83-184"><a href="#cb83-184" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb83-185"><a href="#cb83-185" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb83-186"><a href="#cb83-186" aria-hidden="true" tabindex="-1"></a><span class="st">    # model variance</span></span>
<span id="cb83-187"><a href="#cb83-187" aria-hidden="true" tabindex="-1"></a><span class="st">    sigma ~ dunif(0, 100)</span></span>
<span id="cb83-188"><a href="#cb83-188" aria-hidden="true" tabindex="-1"></a><span class="st">    </span></span>
<span id="cb83-189"><a href="#cb83-189" aria-hidden="true" tabindex="-1"></a><span class="st">    </span></span>
<span id="cb83-190"><a href="#cb83-190" aria-hidden="true" tabindex="-1"></a><span class="st">    # fixed effect coefficients</span></span>
<span id="cb83-191"><a href="#cb83-191" aria-hidden="true" tabindex="-1"></a><span class="st">    for (k in 1:Kfixed) {</span></span>
<span id="cb83-192"><a href="#cb83-192" aria-hidden="true" tabindex="-1"></a><span class="st">      B.0[k] ~ dnorm(0, 0.001)</span></span>
<span id="cb83-193"><a href="#cb83-193" aria-hidden="true" tabindex="-1"></a><span class="st">      }</span></span>
<span id="cb83-194"><a href="#cb83-194" aria-hidden="true" tabindex="-1"></a><span class="st">      </span></span>
<span id="cb83-195"><a href="#cb83-195" aria-hidden="true" tabindex="-1"></a><span class="st">    # random effect coefficients (by site)</span></span>
<span id="cb83-196"><a href="#cb83-196" aria-hidden="true" tabindex="-1"></a><span class="st">    for (k in 1:Krandom) {</span></span>
<span id="cb83-197"><a href="#cb83-197" aria-hidden="true" tabindex="-1"></a><span class="st">      sigma.B.site[k] ~ dunif(0, 100)</span></span>
<span id="cb83-198"><a href="#cb83-198" aria-hidden="true" tabindex="-1"></a><span class="st">      alpha.0[k] ~ dnorm(0, pow(10, -2))</span></span>
<span id="cb83-199"><a href="#cb83-199" aria-hidden="true" tabindex="-1"></a><span class="st">      alpha.1[k] ~ dnorm(0, pow(10, -2))</span></span>
<span id="cb83-200"><a href="#cb83-200" aria-hidden="true" tabindex="-1"></a><span class="st">      for (i in 1:nsites) {</span></span>
<span id="cb83-201"><a href="#cb83-201" aria-hidden="true" tabindex="-1"></a><span class="st">        B.site[i,k] ~ dnorm(mu.B.site[i,k], pow(sigma.B.site[k], -2))</span></span>
<span id="cb83-202"><a href="#cb83-202" aria-hidden="true" tabindex="-1"></a><span class="st">        mu.B.site[i,k] &lt;- alpha.0[k] + alpha.1[k] * area[i]</span></span>
<span id="cb83-203"><a href="#cb83-203" aria-hidden="true" tabindex="-1"></a><span class="st">      }</span></span>
<span id="cb83-204"><a href="#cb83-204" aria-hidden="true" tabindex="-1"></a><span class="st">    }</span></span>
<span id="cb83-205"><a href="#cb83-205" aria-hidden="true" tabindex="-1"></a><span class="st">    </span></span>
<span id="cb83-206"><a href="#cb83-206" aria-hidden="true" tabindex="-1"></a><span class="st">    # YEAR EFFECTS</span></span>
<span id="cb83-207"><a href="#cb83-207" aria-hidden="true" tabindex="-1"></a><span class="st">    for(l in 1:L) {</span></span>
<span id="cb83-208"><a href="#cb83-208" aria-hidden="true" tabindex="-1"></a><span class="st">      sigma.b.year[l] ~ dunif(0, 100)</span></span>
<span id="cb83-209"><a href="#cb83-209" aria-hidden="true" tabindex="-1"></a><span class="st">      for(t in 1:Ti){</span></span>
<span id="cb83-210"><a href="#cb83-210" aria-hidden="true" tabindex="-1"></a><span class="st">        B.year[t, l] ~ dnorm(0, pow(sigma.b.year[l], -2))</span></span>
<span id="cb83-211"><a href="#cb83-211" aria-hidden="true" tabindex="-1"></a><span class="st">        }</span></span>
<span id="cb83-212"><a href="#cb83-212" aria-hidden="true" tabindex="-1"></a><span class="st">      }</span></span>
<span id="cb83-213"><a href="#cb83-213" aria-hidden="true" tabindex="-1"></a><span class="st">    </span></span>
<span id="cb83-214"><a href="#cb83-214" aria-hidden="true" tabindex="-1"></a><span class="st">    # # YEAR EFFECTS</span></span>
<span id="cb83-215"><a href="#cb83-215" aria-hidden="true" tabindex="-1"></a><span class="st">    # # Priors for random effects of year</span></span>
<span id="cb83-216"><a href="#cb83-216" aria-hidden="true" tabindex="-1"></a><span class="st">    # for (t in 1:Ti) { # Ti years</span></span>
<span id="cb83-217"><a href="#cb83-217" aria-hidden="true" tabindex="-1"></a><span class="st">    #   B.year[t, 1:L] ~ dmnorm(mu.year[ ], tau.B.year[ , ])</span></span>
<span id="cb83-218"><a href="#cb83-218" aria-hidden="true" tabindex="-1"></a><span class="st">    #   }</span></span>
<span id="cb83-219"><a href="#cb83-219" aria-hidden="true" tabindex="-1"></a><span class="st">    #   </span></span>
<span id="cb83-220"><a href="#cb83-220" aria-hidden="true" tabindex="-1"></a><span class="st">    # mu.year[1] &lt;- 0</span></span>
<span id="cb83-221"><a href="#cb83-221" aria-hidden="true" tabindex="-1"></a><span class="st">    # </span></span>
<span id="cb83-222"><a href="#cb83-222" aria-hidden="true" tabindex="-1"></a><span class="st">    # for (l in 2:L) {</span></span>
<span id="cb83-223"><a href="#cb83-223" aria-hidden="true" tabindex="-1"></a><span class="st">    #   mu.year[l] ~ dnorm(0, 0.0001)</span></span>
<span id="cb83-224"><a href="#cb83-224" aria-hidden="true" tabindex="-1"></a><span class="st">    #   }</span></span>
<span id="cb83-225"><a href="#cb83-225" aria-hidden="true" tabindex="-1"></a><span class="st">    #   </span></span>
<span id="cb83-226"><a href="#cb83-226" aria-hidden="true" tabindex="-1"></a><span class="st">    # # Prior on multivariate normal std deviation</span></span>
<span id="cb83-227"><a href="#cb83-227" aria-hidden="true" tabindex="-1"></a><span class="st">    # tau.B.year[1:L, 1:L] ~ dwish(W.year[ , ], df.year)</span></span>
<span id="cb83-228"><a href="#cb83-228" aria-hidden="true" tabindex="-1"></a><span class="st">    # df.year &lt;- L + 1</span></span>
<span id="cb83-229"><a href="#cb83-229" aria-hidden="true" tabindex="-1"></a><span class="st">    # sigma.B.year[1:L, 1:L] &lt;- inverse(tau.B.year[ , ])</span></span>
<span id="cb83-230"><a href="#cb83-230" aria-hidden="true" tabindex="-1"></a><span class="st">    # for (l in 1:L) {</span></span>
<span id="cb83-231"><a href="#cb83-231" aria-hidden="true" tabindex="-1"></a><span class="st">    #   for (l.prime in 1:L) {</span></span>
<span id="cb83-232"><a href="#cb83-232" aria-hidden="true" tabindex="-1"></a><span class="st">    #     rho.B.year[l, l.prime] &lt;- sigma.B.year[l, l.prime]/sqrt(sigma.B.year[l, l]*sigma.B.year[l.prime, l.prime])</span></span>
<span id="cb83-233"><a href="#cb83-233" aria-hidden="true" tabindex="-1"></a><span class="st">    #     }</span></span>
<span id="cb83-234"><a href="#cb83-234" aria-hidden="true" tabindex="-1"></a><span class="st">    #   sigma.b.year[l] &lt;- sqrt(sigma.B.year[l, l])</span></span>
<span id="cb83-235"><a href="#cb83-235" aria-hidden="true" tabindex="-1"></a><span class="st">    # }</span></span>
<span id="cb83-236"><a href="#cb83-236" aria-hidden="true" tabindex="-1"></a><span class="st">    </span></span>
<span id="cb83-237"><a href="#cb83-237" aria-hidden="true" tabindex="-1"></a><span class="st">    </span></span>
<span id="cb83-238"><a href="#cb83-238" aria-hidden="true" tabindex="-1"></a><span class="st">    ###----------------- DERIVED VALUES -------------###</span></span>
<span id="cb83-239"><a href="#cb83-239" aria-hidden="true" tabindex="-1"></a><span class="st">    #residuals[1] &lt;- 0 # hold the place. Not sure if this is necessary...</span></span>
<span id="cb83-240"><a href="#cb83-240" aria-hidden="true" tabindex="-1"></a><span class="st">    for (i in 1:n) {</span></span>
<span id="cb83-241"><a href="#cb83-241" aria-hidden="true" tabindex="-1"></a><span class="st">      residuals[i] &lt;- temp[i] - stream.mu[i]</span></span>
<span id="cb83-242"><a href="#cb83-242" aria-hidden="true" tabindex="-1"></a><span class="st">    }</span></span>
<span id="cb83-243"><a href="#cb83-243" aria-hidden="true" tabindex="-1"></a><span class="st">    </span></span>
<span id="cb83-244"><a href="#cb83-244" aria-hidden="true" tabindex="-1"></a><span class="st">    # variance of model predictions (fixed + random effects)</span></span>
<span id="cb83-245"><a href="#cb83-245" aria-hidden="true" tabindex="-1"></a><span class="st">    var_fit &lt;- (sd(stream.mu))^2</span></span>
<span id="cb83-246"><a href="#cb83-246" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb83-247"><a href="#cb83-247" aria-hidden="true" tabindex="-1"></a><span class="st">    # residual variance</span></span>
<span id="cb83-248"><a href="#cb83-248" aria-hidden="true" tabindex="-1"></a><span class="st">    var_res &lt;- (sd(residuals))^2</span></span>
<span id="cb83-249"><a href="#cb83-249" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb83-250"><a href="#cb83-250" aria-hidden="true" tabindex="-1"></a><span class="st">    # calculate Bayesian R^2</span></span>
<span id="cb83-251"><a href="#cb83-251" aria-hidden="true" tabindex="-1"></a><span class="st">    R2 &lt;- var_fit / (var_fit + var_res)</span></span>
<span id="cb83-252"><a href="#cb83-252" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb83-253"><a href="#cb83-253" aria-hidden="true" tabindex="-1"></a><span class="st">    # Root mean squared error</span></span>
<span id="cb83-254"><a href="#cb83-254" aria-hidden="true" tabindex="-1"></a><span class="st">    rmse &lt;- sqrt(mean(residuals[]^2))</span></span>
<span id="cb83-255"><a href="#cb83-255" aria-hidden="true" tabindex="-1"></a><span class="st">    </span></span>
<span id="cb83-256"><a href="#cb83-256" aria-hidden="true" tabindex="-1"></a><span class="st">    }"</span>, <span class="at">file =</span> <span class="st">"JAGS models/DailyTempModelJAGS_Letcher_hierarchical_modified.txt"</span>)</span>
<span id="cb83-257"><a href="#cb83-257" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb83-258"><a href="#cb83-258" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb83-259"><a href="#cb83-259" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb83-260"><a href="#cb83-260" aria-hidden="true" tabindex="-1"></a>Specify model following Letcher et al. (2016). MODIFIED</span>
<span id="cb83-263"><a href="#cb83-263" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb83-264"><a href="#cb83-264" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"model {</span></span>
<span id="cb83-265"><a href="#cb83-265" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb83-266"><a href="#cb83-266" aria-hidden="true" tabindex="-1"></a><span class="st">    ###----------------- LIKELIHOOD -----------------###</span></span>
<span id="cb83-267"><a href="#cb83-267" aria-hidden="true" tabindex="-1"></a><span class="st">    </span></span>
<span id="cb83-268"><a href="#cb83-268" aria-hidden="true" tabindex="-1"></a><span class="st">    # Days without an observation on the previous day (first observation in a series)</span></span>
<span id="cb83-269"><a href="#cb83-269" aria-hidden="true" tabindex="-1"></a><span class="st">    # No autoregressive term</span></span>
<span id="cb83-270"><a href="#cb83-270" aria-hidden="true" tabindex="-1"></a><span class="st">    </span></span>
<span id="cb83-271"><a href="#cb83-271" aria-hidden="true" tabindex="-1"></a><span class="st">    for (i in 1:n){</span></span>
<span id="cb83-272"><a href="#cb83-272" aria-hidden="true" tabindex="-1"></a><span class="st">      temp[i] ~ dnorm(stream.mu[i], pow(sigma, -2)) </span></span>
<span id="cb83-273"><a href="#cb83-273" aria-hidden="true" tabindex="-1"></a><span class="st">      stream.mu[i] &lt;- trend[i]</span></span>
<span id="cb83-274"><a href="#cb83-274" aria-hidden="true" tabindex="-1"></a><span class="st">      trend[i] &lt;- inprod(B.site[site[i], ], X.site[i, ])</span></span>
<span id="cb83-275"><a href="#cb83-275" aria-hidden="true" tabindex="-1"></a><span class="st">      </span></span>
<span id="cb83-276"><a href="#cb83-276" aria-hidden="true" tabindex="-1"></a><span class="st">      #flow[firstObsRows[i]] ~ dnorm(0, pow(10, -2))</span></span>
<span id="cb83-277"><a href="#cb83-277" aria-hidden="true" tabindex="-1"></a><span class="st">      }</span></span>
<span id="cb83-278"><a href="#cb83-278" aria-hidden="true" tabindex="-1"></a><span class="st">    </span></span>
<span id="cb83-279"><a href="#cb83-279" aria-hidden="true" tabindex="-1"></a><span class="st">    # for (i in 1:nFirstObsRows){</span></span>
<span id="cb83-280"><a href="#cb83-280" aria-hidden="true" tabindex="-1"></a><span class="st">    #   temp[firstObsRows[i]] ~ dnorm(stream.mu[firstObsRows[i]], pow(sigma, -2)) </span></span>
<span id="cb83-281"><a href="#cb83-281" aria-hidden="true" tabindex="-1"></a><span class="st">    #   stream.mu[firstObsRows[i]] &lt;- trend[firstObsRows[i]]</span></span>
<span id="cb83-282"><a href="#cb83-282" aria-hidden="true" tabindex="-1"></a><span class="st">    #   trend[firstObsRows[i]] &lt;- inprod(B.0[], X.0[firstObsRows[i], ]) + inprod(B.site[site[firstObsRows[i]], ], X.site[firstObsRows[i], ]) #+ inprod(B.year[year[firstObsRows[i]], ], X.year[firstObsRows[i], ])</span></span>
<span id="cb83-283"><a href="#cb83-283" aria-hidden="true" tabindex="-1"></a><span class="st">    #   </span></span>
<span id="cb83-284"><a href="#cb83-284" aria-hidden="true" tabindex="-1"></a><span class="st">    #   #flow[firstObsRows[i]] ~ dnorm(0, pow(10, -2))</span></span>
<span id="cb83-285"><a href="#cb83-285" aria-hidden="true" tabindex="-1"></a><span class="st">    #   }</span></span>
<span id="cb83-286"><a href="#cb83-286" aria-hidden="true" tabindex="-1"></a><span class="st">    # </span></span>
<span id="cb83-287"><a href="#cb83-287" aria-hidden="true" tabindex="-1"></a><span class="st">    # # Days with an observation on the previous dat (all days following the first day)</span></span>
<span id="cb83-288"><a href="#cb83-288" aria-hidden="true" tabindex="-1"></a><span class="st">    # # Includes autoregressive term (ar1)</span></span>
<span id="cb83-289"><a href="#cb83-289" aria-hidden="true" tabindex="-1"></a><span class="st">    # </span></span>
<span id="cb83-290"><a href="#cb83-290" aria-hidden="true" tabindex="-1"></a><span class="st">    # for (i in 1:nEvalRows){ </span></span>
<span id="cb83-291"><a href="#cb83-291" aria-hidden="true" tabindex="-1"></a><span class="st">    #   temp[evalRows[i]] ~ dnorm(stream.mu[evalRows[i]], pow(sigma, -2))</span></span>
<span id="cb83-292"><a href="#cb83-292" aria-hidden="true" tabindex="-1"></a><span class="st">    #   stream.mu[evalRows[i]] &lt;- trend[evalRows[i]] + ar1[site[evalRows[i]]] * (temp[evalRows[i]-1] - trend[ evalRows[i]-1 ])</span></span>
<span id="cb83-293"><a href="#cb83-293" aria-hidden="true" tabindex="-1"></a><span class="st">    #   trend[evalRows[i]]  &lt;- inprod(B.0[], X.0[evalRows[i], ]) + inprod(B.site[site[evalRows[i]], ], X.site[evalRows[i], ]) #+ inprod(B.year[year[evalRows[i]], ], X.year[evalRows[i], ])</span></span>
<span id="cb83-294"><a href="#cb83-294" aria-hidden="true" tabindex="-1"></a><span class="st">    #   </span></span>
<span id="cb83-295"><a href="#cb83-295" aria-hidden="true" tabindex="-1"></a><span class="st">    #   #flow[evalRows[i]] ~ dnorm(0, pow(10, -2))</span></span>
<span id="cb83-296"><a href="#cb83-296" aria-hidden="true" tabindex="-1"></a><span class="st">    #   }</span></span>
<span id="cb83-297"><a href="#cb83-297" aria-hidden="true" tabindex="-1"></a><span class="st">    </span></span>
<span id="cb83-298"><a href="#cb83-298" aria-hidden="true" tabindex="-1"></a><span class="st">    </span></span>
<span id="cb83-299"><a href="#cb83-299" aria-hidden="true" tabindex="-1"></a><span class="st">    ###----------------- PRIORS ---------------------###</span></span>
<span id="cb83-300"><a href="#cb83-300" aria-hidden="true" tabindex="-1"></a><span class="st">    </span></span>
<span id="cb83-301"><a href="#cb83-301" aria-hidden="true" tabindex="-1"></a><span class="st">    # # ar1, hierarchical by site</span></span>
<span id="cb83-302"><a href="#cb83-302" aria-hidden="true" tabindex="-1"></a><span class="st">    # for (i in 1:nSite){</span></span>
<span id="cb83-303"><a href="#cb83-303" aria-hidden="true" tabindex="-1"></a><span class="st">    #   ar1[i] ~ dnorm(ar1Mean, pow(ar1SD,-2) ) T(-1,1)       </span></span>
<span id="cb83-304"><a href="#cb83-304" aria-hidden="true" tabindex="-1"></a><span class="st">    # }</span></span>
<span id="cb83-305"><a href="#cb83-305" aria-hidden="true" tabindex="-1"></a><span class="st">    # ar1Mean ~ dunif( -1,1 ) </span></span>
<span id="cb83-306"><a href="#cb83-306" aria-hidden="true" tabindex="-1"></a><span class="st">    # ar1SD ~ dunif( 0, 2 )</span></span>
<span id="cb83-307"><a href="#cb83-307" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb83-308"><a href="#cb83-308" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb83-309"><a href="#cb83-309" aria-hidden="true" tabindex="-1"></a><span class="st">    # model variance</span></span>
<span id="cb83-310"><a href="#cb83-310" aria-hidden="true" tabindex="-1"></a><span class="st">    sigma ~ dunif(0, 100)</span></span>
<span id="cb83-311"><a href="#cb83-311" aria-hidden="true" tabindex="-1"></a><span class="st">    </span></span>
<span id="cb83-312"><a href="#cb83-312" aria-hidden="true" tabindex="-1"></a><span class="st">    </span></span>
<span id="cb83-313"><a href="#cb83-313" aria-hidden="true" tabindex="-1"></a><span class="st">    # fixed effect coefficients</span></span>
<span id="cb83-314"><a href="#cb83-314" aria-hidden="true" tabindex="-1"></a><span class="st">    for (k in 1:nFixedCovs) {</span></span>
<span id="cb83-315"><a href="#cb83-315" aria-hidden="true" tabindex="-1"></a><span class="st">      B.0[k] ~ dnorm(0, pow(100, -2))</span></span>
<span id="cb83-316"><a href="#cb83-316" aria-hidden="true" tabindex="-1"></a><span class="st">      }</span></span>
<span id="cb83-317"><a href="#cb83-317" aria-hidden="true" tabindex="-1"></a><span class="st">    </span></span>
<span id="cb83-318"><a href="#cb83-318" aria-hidden="true" tabindex="-1"></a><span class="st">    </span></span>
<span id="cb83-319"><a href="#cb83-319" aria-hidden="true" tabindex="-1"></a><span class="st">    # SITE EFFECTS</span></span>
<span id="cb83-320"><a href="#cb83-320" aria-hidden="true" tabindex="-1"></a><span class="st">    for (k in 1:nRandCovs) {</span></span>
<span id="cb83-321"><a href="#cb83-321" aria-hidden="true" tabindex="-1"></a><span class="st">      for (i in 1:nSite) {</span></span>
<span id="cb83-322"><a href="#cb83-322" aria-hidden="true" tabindex="-1"></a><span class="st">        B.site[i,k] ~ dnorm(0, pow(10, -2))   </span></span>
<span id="cb83-323"><a href="#cb83-323" aria-hidden="true" tabindex="-1"></a><span class="st">      }</span></span>
<span id="cb83-324"><a href="#cb83-324" aria-hidden="true" tabindex="-1"></a><span class="st">    }</span></span>
<span id="cb83-325"><a href="#cb83-325" aria-hidden="true" tabindex="-1"></a><span class="st">    </span></span>
<span id="cb83-326"><a href="#cb83-326" aria-hidden="true" tabindex="-1"></a><span class="st">      </span></span>
<span id="cb83-327"><a href="#cb83-327" aria-hidden="true" tabindex="-1"></a><span class="st">    # # YEAR EFFECTS</span></span>
<span id="cb83-328"><a href="#cb83-328" aria-hidden="true" tabindex="-1"></a><span class="st">    # # Priors for random effects of year</span></span>
<span id="cb83-329"><a href="#cb83-329" aria-hidden="true" tabindex="-1"></a><span class="st">    # for (t in 1:Ti) { # Ti years</span></span>
<span id="cb83-330"><a href="#cb83-330" aria-hidden="true" tabindex="-1"></a><span class="st">    #   B.year[t, 1:L] ~ dmnorm(mu.year[ ], tau.B.year[ , ])</span></span>
<span id="cb83-331"><a href="#cb83-331" aria-hidden="true" tabindex="-1"></a><span class="st">    #   }</span></span>
<span id="cb83-332"><a href="#cb83-332" aria-hidden="true" tabindex="-1"></a><span class="st">    # </span></span>
<span id="cb83-333"><a href="#cb83-333" aria-hidden="true" tabindex="-1"></a><span class="st">    # mu.year[1] &lt;- 0</span></span>
<span id="cb83-334"><a href="#cb83-334" aria-hidden="true" tabindex="-1"></a><span class="st">    # </span></span>
<span id="cb83-335"><a href="#cb83-335" aria-hidden="true" tabindex="-1"></a><span class="st">    # for (l in 2:L) {</span></span>
<span id="cb83-336"><a href="#cb83-336" aria-hidden="true" tabindex="-1"></a><span class="st">    #   mu.year[l] ~ dnorm(0, 0.0001)</span></span>
<span id="cb83-337"><a href="#cb83-337" aria-hidden="true" tabindex="-1"></a><span class="st">    #   }</span></span>
<span id="cb83-338"><a href="#cb83-338" aria-hidden="true" tabindex="-1"></a><span class="st">    # </span></span>
<span id="cb83-339"><a href="#cb83-339" aria-hidden="true" tabindex="-1"></a><span class="st">    # # Prior on multivariate normal std deviation</span></span>
<span id="cb83-340"><a href="#cb83-340" aria-hidden="true" tabindex="-1"></a><span class="st">    # tau.B.year[1:L, 1:L] ~ dwish(W.year[ , ], df.year)</span></span>
<span id="cb83-341"><a href="#cb83-341" aria-hidden="true" tabindex="-1"></a><span class="st">    # df.year &lt;- L + 1</span></span>
<span id="cb83-342"><a href="#cb83-342" aria-hidden="true" tabindex="-1"></a><span class="st">    # sigma.B.year[1:L, 1:L] &lt;- inverse(tau.B.year[ , ])</span></span>
<span id="cb83-343"><a href="#cb83-343" aria-hidden="true" tabindex="-1"></a><span class="st">    # for (l in 1:L) {</span></span>
<span id="cb83-344"><a href="#cb83-344" aria-hidden="true" tabindex="-1"></a><span class="st">    #   for (l.prime in 1:L) {</span></span>
<span id="cb83-345"><a href="#cb83-345" aria-hidden="true" tabindex="-1"></a><span class="st">    #     rho.B.year[l, l.prime] &lt;- sigma.B.year[l, l.prime]/sqrt(sigma.B.year[l, l]*sigma.B.year[l.prime, l.prime])</span></span>
<span id="cb83-346"><a href="#cb83-346" aria-hidden="true" tabindex="-1"></a><span class="st">    #     }</span></span>
<span id="cb83-347"><a href="#cb83-347" aria-hidden="true" tabindex="-1"></a><span class="st">    #   sigma.b.year[l] &lt;- sqrt(sigma.B.year[l, l])</span></span>
<span id="cb83-348"><a href="#cb83-348" aria-hidden="true" tabindex="-1"></a><span class="st">    # }</span></span>
<span id="cb83-349"><a href="#cb83-349" aria-hidden="true" tabindex="-1"></a><span class="st">    </span></span>
<span id="cb83-350"><a href="#cb83-350" aria-hidden="true" tabindex="-1"></a><span class="st">    </span></span>
<span id="cb83-351"><a href="#cb83-351" aria-hidden="true" tabindex="-1"></a><span class="st">    ###----------------- DERIVED VALUES -------------###</span></span>
<span id="cb83-352"><a href="#cb83-352" aria-hidden="true" tabindex="-1"></a><span class="st">    </span></span>
<span id="cb83-353"><a href="#cb83-353" aria-hidden="true" tabindex="-1"></a><span class="st">    # residuals</span></span>
<span id="cb83-354"><a href="#cb83-354" aria-hidden="true" tabindex="-1"></a><span class="st">    # residuals[1] &lt;- 0 # hold the place. Not sure if this is necessary...</span></span>
<span id="cb83-355"><a href="#cb83-355" aria-hidden="true" tabindex="-1"></a><span class="st">    for (i in 1:n) {</span></span>
<span id="cb83-356"><a href="#cb83-356" aria-hidden="true" tabindex="-1"></a><span class="st">      residuals[i] &lt;- temp[i] - stream.mu[i]</span></span>
<span id="cb83-357"><a href="#cb83-357" aria-hidden="true" tabindex="-1"></a><span class="st">    }</span></span>
<span id="cb83-358"><a href="#cb83-358" aria-hidden="true" tabindex="-1"></a><span class="st">    </span></span>
<span id="cb83-359"><a href="#cb83-359" aria-hidden="true" tabindex="-1"></a><span class="st">    # variance of model predictions (fixed + random effects)</span></span>
<span id="cb83-360"><a href="#cb83-360" aria-hidden="true" tabindex="-1"></a><span class="st">    var_fit &lt;- (sd(stream.mu))^2 </span></span>
<span id="cb83-361"><a href="#cb83-361" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb83-362"><a href="#cb83-362" aria-hidden="true" tabindex="-1"></a><span class="st">    # residual variance</span></span>
<span id="cb83-363"><a href="#cb83-363" aria-hidden="true" tabindex="-1"></a><span class="st">    var_res &lt;- (sd(residuals))^2</span></span>
<span id="cb83-364"><a href="#cb83-364" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb83-365"><a href="#cb83-365" aria-hidden="true" tabindex="-1"></a><span class="st">    # calculate Bayesian R^2</span></span>
<span id="cb83-366"><a href="#cb83-366" aria-hidden="true" tabindex="-1"></a><span class="st">    R2 &lt;- var_fit / (var_fit + var_res)</span></span>
<span id="cb83-367"><a href="#cb83-367" aria-hidden="true" tabindex="-1"></a><span class="st">    </span></span>
<span id="cb83-368"><a href="#cb83-368" aria-hidden="true" tabindex="-1"></a><span class="st">    # Root mean squared error</span></span>
<span id="cb83-369"><a href="#cb83-369" aria-hidden="true" tabindex="-1"></a><span class="st">    rmse &lt;- sqrt(mean(residuals[]^2))</span></span>
<span id="cb83-370"><a href="#cb83-370" aria-hidden="true" tabindex="-1"></a><span class="st">    </span></span>
<span id="cb83-371"><a href="#cb83-371" aria-hidden="true" tabindex="-1"></a><span class="st">    }"</span>, <span class="at">file =</span> <span class="st">"DailyTempModelJAGS_mod.txt"</span>)</span>
<span id="cb83-372"><a href="#cb83-372" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb83-373"><a href="#cb83-373" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb83-374"><a href="#cb83-374" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb83-375"><a href="#cb83-375" aria-hidden="true" tabindex="-1"></a><span class="fu">## Organize objects</span></span>
<span id="cb83-376"><a href="#cb83-376" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb83-377"><a href="#cb83-377" aria-hidden="true" tabindex="-1"></a>Get first observation indices and check that nFirstRowObs equals the number of unique site-years: **must be TRUE!**</span>
<span id="cb83-380"><a href="#cb83-380" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb83-381"><a href="#cb83-381" aria-hidden="true" tabindex="-1"></a><span class="co"># row indices for first observation in each site-year</span></span>
<span id="cb83-382"><a href="#cb83-382" aria-hidden="true" tabindex="-1"></a>firstObsRows <span class="ot">&lt;-</span> <span class="fu">unlist</span>(dat <span class="sc">%&gt;%</span> </span>
<span id="cb83-383"><a href="#cb83-383" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(siteYear) <span class="sc">%&gt;%</span></span>
<span id="cb83-384"><a href="#cb83-384" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="at">index =</span> rowNum[<span class="fu">min</span>(<span class="fu">which</span>(<span class="sc">!</span><span class="fu">is.na</span>(tempc_mean)))]) <span class="sc">%&gt;%</span></span>
<span id="cb83-385"><a href="#cb83-385" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb83-386"><a href="#cb83-386" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(index))</span>
<span id="cb83-387"><a href="#cb83-387" aria-hidden="true" tabindex="-1"></a>nFirstObsRows <span class="ot">&lt;-</span> <span class="fu">length</span>(firstObsRows)</span>
<span id="cb83-388"><a href="#cb83-388" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb83-389"><a href="#cb83-389" aria-hidden="true" tabindex="-1"></a><span class="co"># does the number of first observations match the number of site years?</span></span>
<span id="cb83-390"><a href="#cb83-390" aria-hidden="true" tabindex="-1"></a>nFirstObsRows <span class="sc">==</span> <span class="fu">length</span>(<span class="fu">unique</span>(dat<span class="sc">$</span>siteYear))</span>
<span id="cb83-391"><a href="#cb83-391" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb83-392"><a href="#cb83-392" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb83-393"><a href="#cb83-393" aria-hidden="true" tabindex="-1"></a>Get row indices for all other observations</span>
<span id="cb83-396"><a href="#cb83-396" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb83-397"><a href="#cb83-397" aria-hidden="true" tabindex="-1"></a>evalRows <span class="ot">&lt;-</span> <span class="fu">unlist</span>(dat <span class="sc">%&gt;%</span> <span class="fu">filter</span>(<span class="sc">!</span>rowNum <span class="sc">%in%</span> firstObsRows) <span class="sc">%&gt;%</span> <span class="fu">select</span>(rowNum))</span>
<span id="cb83-398"><a href="#cb83-398" aria-hidden="true" tabindex="-1"></a>nEvalRows <span class="ot">&lt;-</span> <span class="fu">length</span>(evalRows)</span>
<span id="cb83-399"><a href="#cb83-399" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb83-400"><a href="#cb83-400" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb83-401"><a href="#cb83-401" aria-hidden="true" tabindex="-1"></a>Fixed and random effect data</span>
<span id="cb83-404"><a href="#cb83-404" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb83-405"><a href="#cb83-405" aria-hidden="true" tabindex="-1"></a>data.random <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">intercept =</span> <span class="dv">1</span>,</span>
<span id="cb83-406"><a href="#cb83-406" aria-hidden="true" tabindex="-1"></a>                          <span class="at">airTemp =</span> dat<span class="sc">$</span>z_air_temp_mean, </span>
<span id="cb83-407"><a href="#cb83-407" aria-hidden="true" tabindex="-1"></a>                          <span class="at">flow =</span>  dat<span class="sc">$</span>z_Yield_mm_log,</span>
<span id="cb83-408"><a href="#cb83-408" aria-hidden="true" tabindex="-1"></a>                          <span class="at">airFlow =</span> dat<span class="sc">$</span>z_air_temp_mean <span class="sc">*</span> dat<span class="sc">$</span>z_Yield_mm_log)</span>
<span id="cb83-409"><a href="#cb83-409" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb83-410"><a href="#cb83-410" aria-hidden="true" tabindex="-1"></a>data.fixed <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">airTempLag1 =</span> dat<span class="sc">$</span>z_air_temp_mean_lag1,</span>
<span id="cb83-411"><a href="#cb83-411" aria-hidden="true" tabindex="-1"></a>                         <span class="at">airTempLag2 =</span> dat<span class="sc">$</span>z_air_temp_mean_lag2) </span>
<span id="cb83-412"><a href="#cb83-412" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb83-413"><a href="#cb83-413" aria-hidden="true" tabindex="-1"></a>data.random.years <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">intercept.year =</span> <span class="fu">rep</span>(<span class="dv">1</span>, <span class="at">length.out =</span> <span class="fu">dim</span>(data.fixed)[<span class="dv">1</span>])<span class="co">#, </span></span>
<span id="cb83-414"><a href="#cb83-414" aria-hidden="true" tabindex="-1"></a>                                <span class="co">#dOY  = dat$yday, </span></span>
<span id="cb83-415"><a href="#cb83-415" aria-hidden="true" tabindex="-1"></a>                                <span class="co">#dOY2 = dat$yday^2,</span></span>
<span id="cb83-416"><a href="#cb83-416" aria-hidden="true" tabindex="-1"></a>                                <span class="co">#dOY3 = dat$yday^3</span></span>
<span id="cb83-417"><a href="#cb83-417" aria-hidden="true" tabindex="-1"></a>                                )</span>
<span id="cb83-418"><a href="#cb83-418" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb83-419"><a href="#cb83-419" aria-hidden="true" tabindex="-1"></a>data.random.covs <span class="ot">&lt;-</span> <span class="fu">log</span>(dat <span class="sc">%&gt;%</span> <span class="fu">group_by</span>(site_code) <span class="sc">%&gt;%</span> <span class="fu">summarize</span>(<span class="at">area_sqmi =</span> <span class="fu">unique</span>(area_sqmi)) <span class="sc">%&gt;%</span> <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span> <span class="fu">arrange</span>(site_code) <span class="sc">%&gt;%</span> <span class="fu">pull</span>(area_sqmi))</span>
<span id="cb83-420"><a href="#cb83-420" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb83-421"><a href="#cb83-421" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb83-422"><a href="#cb83-422" aria-hidden="true" tabindex="-1"></a>Misc. objects</span>
<span id="cb83-425"><a href="#cb83-425" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb83-426"><a href="#cb83-426" aria-hidden="true" tabindex="-1"></a>Ti <span class="ot">&lt;-</span> <span class="fu">length</span>(<span class="fu">unique</span>(dat<span class="sc">$</span>year))</span>
<span id="cb83-427"><a href="#cb83-427" aria-hidden="true" tabindex="-1"></a>L <span class="ot">&lt;-</span> <span class="fu">dim</span>(data.random.years)[<span class="dv">2</span>]</span>
<span id="cb83-428"><a href="#cb83-428" aria-hidden="true" tabindex="-1"></a>W.year <span class="ot">&lt;-</span> <span class="fu">diag</span>(L)</span>
<span id="cb83-429"><a href="#cb83-429" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb83-430"><a href="#cb83-430" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb83-431"><a href="#cb83-431" aria-hidden="true" tabindex="-1"></a>Combine data in list</span>
<span id="cb83-434"><a href="#cb83-434" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb83-435"><a href="#cb83-435" aria-hidden="true" tabindex="-1"></a><span class="co"># combine data in a list</span></span>
<span id="cb83-436"><a href="#cb83-436" aria-hidden="true" tabindex="-1"></a>jags.data <span class="ot">&lt;-</span> <span class="fu">list</span>(<span class="st">"temp"</span> <span class="ot">=</span> dat<span class="sc">$</span>tempc_mean,</span>
<span id="cb83-437"><a href="#cb83-437" aria-hidden="true" tabindex="-1"></a>                  <span class="st">"nFirstObsRows"</span> <span class="ot">=</span> nFirstObsRows,</span>
<span id="cb83-438"><a href="#cb83-438" aria-hidden="true" tabindex="-1"></a>                  <span class="st">"firstObsRows"</span> <span class="ot">=</span> firstObsRows,</span>
<span id="cb83-439"><a href="#cb83-439" aria-hidden="true" tabindex="-1"></a>                  <span class="st">"nEvalRows"</span> <span class="ot">=</span> nEvalRows,</span>
<span id="cb83-440"><a href="#cb83-440" aria-hidden="true" tabindex="-1"></a>                  <span class="st">"evalRows"</span> <span class="ot">=</span> evalRows,</span>
<span id="cb83-441"><a href="#cb83-441" aria-hidden="true" tabindex="-1"></a>                  <span class="st">"X.0"</span> <span class="ot">=</span> <span class="fu">as.matrix</span>(data.fixed),</span>
<span id="cb83-442"><a href="#cb83-442" aria-hidden="true" tabindex="-1"></a>                  <span class="st">"X.site"</span> <span class="ot">=</span> <span class="fu">as.matrix</span>(data.random),</span>
<span id="cb83-443"><a href="#cb83-443" aria-hidden="true" tabindex="-1"></a>                  <span class="st">"X.year"</span> <span class="ot">=</span> <span class="fu">as.matrix</span>(data.random.years),</span>
<span id="cb83-444"><a href="#cb83-444" aria-hidden="true" tabindex="-1"></a>                  <span class="st">"Kfixed"</span> <span class="ot">=</span> <span class="fu">dim</span>(data.fixed)[<span class="dv">2</span>],</span>
<span id="cb83-445"><a href="#cb83-445" aria-hidden="true" tabindex="-1"></a>                  <span class="st">"Krandom"</span> <span class="ot">=</span> <span class="fu">dim</span>(data.random)[<span class="dv">2</span>],</span>
<span id="cb83-446"><a href="#cb83-446" aria-hidden="true" tabindex="-1"></a>                  <span class="st">"nsites"</span> <span class="ot">=</span> <span class="fu">length</span>(<span class="fu">unique</span>(dat<span class="sc">$</span>site_name)),</span>
<span id="cb83-447"><a href="#cb83-447" aria-hidden="true" tabindex="-1"></a>                  <span class="st">"Ti"</span> <span class="ot">=</span> Ti,</span>
<span id="cb83-448"><a href="#cb83-448" aria-hidden="true" tabindex="-1"></a>                  <span class="st">"L"</span> <span class="ot">=</span> L,</span>
<span id="cb83-449"><a href="#cb83-449" aria-hidden="true" tabindex="-1"></a>                  <span class="st">"W.year"</span> <span class="ot">=</span> W.year,</span>
<span id="cb83-450"><a href="#cb83-450" aria-hidden="true" tabindex="-1"></a>                  <span class="st">"n"</span> <span class="ot">=</span> <span class="fu">dim</span>(dat)[<span class="dv">1</span>],</span>
<span id="cb83-451"><a href="#cb83-451" aria-hidden="true" tabindex="-1"></a>                  <span class="st">"year"</span> <span class="ot">=</span> dat<span class="sc">$</span>year_code,</span>
<span id="cb83-452"><a href="#cb83-452" aria-hidden="true" tabindex="-1"></a>                  <span class="st">"site"</span> <span class="ot">=</span> dat<span class="sc">$</span>site_code,</span>
<span id="cb83-453"><a href="#cb83-453" aria-hidden="true" tabindex="-1"></a>                  <span class="st">"area"</span> <span class="ot">=</span> data.random.covs</span>
<span id="cb83-454"><a href="#cb83-454" aria-hidden="true" tabindex="-1"></a>                  )</span>
<span id="cb83-455"><a href="#cb83-455" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb83-456"><a href="#cb83-456" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb83-457"><a href="#cb83-457" aria-hidden="true" tabindex="-1"></a>Parameters to monitor</span>
<span id="cb83-460"><a href="#cb83-460" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb83-461"><a href="#cb83-461" aria-hidden="true" tabindex="-1"></a>jags.params <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"residuals"</span>,</span>
<span id="cb83-462"><a href="#cb83-462" aria-hidden="true" tabindex="-1"></a>                 <span class="st">"deviance"</span>,</span>
<span id="cb83-463"><a href="#cb83-463" aria-hidden="true" tabindex="-1"></a>                 <span class="st">"sigma"</span>,</span>
<span id="cb83-464"><a href="#cb83-464" aria-hidden="true" tabindex="-1"></a>                 <span class="st">"B.0"</span>,</span>
<span id="cb83-465"><a href="#cb83-465" aria-hidden="true" tabindex="-1"></a>                 <span class="st">"B.site"</span>,</span>
<span id="cb83-466"><a href="#cb83-466" aria-hidden="true" tabindex="-1"></a>                 <span class="st">"B.year"</span>,</span>
<span id="cb83-467"><a href="#cb83-467" aria-hidden="true" tabindex="-1"></a>                 <span class="st">"rho.B.year"</span>,</span>
<span id="cb83-468"><a href="#cb83-468" aria-hidden="true" tabindex="-1"></a>                 <span class="st">"mu.year"</span>,</span>
<span id="cb83-469"><a href="#cb83-469" aria-hidden="true" tabindex="-1"></a>                 <span class="st">"sigma.b.year"</span>,</span>
<span id="cb83-470"><a href="#cb83-470" aria-hidden="true" tabindex="-1"></a>                 <span class="st">"stream.mu"</span>,</span>
<span id="cb83-471"><a href="#cb83-471" aria-hidden="true" tabindex="-1"></a>                 <span class="st">"ar1"</span> ,</span>
<span id="cb83-472"><a href="#cb83-472" aria-hidden="true" tabindex="-1"></a>                 <span class="st">"ar1Mean"</span>,</span>
<span id="cb83-473"><a href="#cb83-473" aria-hidden="true" tabindex="-1"></a>                 <span class="st">"ar1SD"</span>,</span>
<span id="cb83-474"><a href="#cb83-474" aria-hidden="true" tabindex="-1"></a>                 <span class="st">"temp"</span>,</span>
<span id="cb83-475"><a href="#cb83-475" aria-hidden="true" tabindex="-1"></a>                 <span class="st">"sigma.B.site"</span>,</span>
<span id="cb83-476"><a href="#cb83-476" aria-hidden="true" tabindex="-1"></a>                 <span class="st">"R2"</span>,</span>
<span id="cb83-477"><a href="#cb83-477" aria-hidden="true" tabindex="-1"></a>                 <span class="st">"rmse"</span>,</span>
<span id="cb83-478"><a href="#cb83-478" aria-hidden="true" tabindex="-1"></a>                 <span class="st">"alpha.0"</span>,</span>
<span id="cb83-479"><a href="#cb83-479" aria-hidden="true" tabindex="-1"></a>                 <span class="st">"alpha.1"</span></span>
<span id="cb83-480"><a href="#cb83-480" aria-hidden="true" tabindex="-1"></a>                 )</span>
<span id="cb83-481"><a href="#cb83-481" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb83-482"><a href="#cb83-482" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb83-483"><a href="#cb83-483" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb83-484"><a href="#cb83-484" aria-hidden="true" tabindex="-1"></a><span class="fu">## Fit model</span></span>
<span id="cb83-485"><a href="#cb83-485" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb83-488"><a href="#cb83-488" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb83-489"><a href="#cb83-489" aria-hidden="true" tabindex="-1"></a>fit_ed <span class="ot">&lt;-</span> <span class="fu">jags.parallel</span>(<span class="at">data =</span> jags.data, <span class="at">inits =</span> <span class="cn">NULL</span>, <span class="at">parameters.to.save =</span> jags.params, </span>
<span id="cb83-490"><a href="#cb83-490" aria-hidden="true" tabindex="-1"></a>                        <span class="at">model.file =</span> <span class="st">"JAGS models/DailyTempModelJAGS_Letcher_hierarchical_modified.txt"</span>,</span>
<span id="cb83-491"><a href="#cb83-491" aria-hidden="true" tabindex="-1"></a>                        <span class="at">n.chains =</span> <span class="dv">10</span>, <span class="at">n.thin =</span> <span class="dv">10</span>, <span class="at">n.burnin =</span> <span class="dv">1000</span>, <span class="at">n.iter =</span> <span class="dv">3000</span>, <span class="at">DIC =</span> <span class="cn">TRUE</span>)</span>
<span id="cb83-492"><a href="#cb83-492" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb83-493"><a href="#cb83-493" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb83-494"><a href="#cb83-494" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb83-495"><a href="#cb83-495" aria-hidden="true" tabindex="-1"></a><span class="fu">#### Save model ouput</span></span>
<span id="cb83-496"><a href="#cb83-496" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb83-497"><a href="#cb83-497" aria-hidden="true" tabindex="-1"></a>Save to file</span>
<span id="cb83-498"><a href="#cb83-498" aria-hidden="true" tabindex="-1"></a><span class="in">```{r eval=FALSE}</span></span>
<span id="cb83-499"><a href="#cb83-499" aria-hidden="true" tabindex="-1"></a><span class="fu">saveRDS</span>(fit_ed, <span class="st">"Model objects/LetcherTempModel_EcoDrought_hierarchical.RDS"</span>)</span>
<span id="cb83-500"><a href="#cb83-500" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb83-501"><a href="#cb83-501" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb83-502"><a href="#cb83-502" aria-hidden="true" tabindex="-1"></a>Read in fitted model object</span>
<span id="cb83-505"><a href="#cb83-505" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb83-506"><a href="#cb83-506" aria-hidden="true" tabindex="-1"></a>fit_ed <span class="ot">&lt;-</span> <span class="fu">readRDS</span>(<span class="st">"Model objects/LetcherTempModel_EcoDrought_hierarchical.RDS"</span>)</span>
<span id="cb83-507"><a href="#cb83-507" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb83-508"><a href="#cb83-508" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb83-509"><a href="#cb83-509" aria-hidden="true" tabindex="-1"></a>Get MCMC samples and summary</span>
<span id="cb83-512"><a href="#cb83-512" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb83-513"><a href="#cb83-513" aria-hidden="true" tabindex="-1"></a>top_mod <span class="ot">&lt;-</span> fit_ed</span>
<span id="cb83-514"><a href="#cb83-514" aria-hidden="true" tabindex="-1"></a><span class="co"># generate MCMC samples and store as an array</span></span>
<span id="cb83-515"><a href="#cb83-515" aria-hidden="true" tabindex="-1"></a>modelout <span class="ot">&lt;-</span> top_mod<span class="sc">$</span>BUGSoutput</span>
<span id="cb83-516"><a href="#cb83-516" aria-hidden="true" tabindex="-1"></a>McmcList <span class="ot">&lt;-</span> <span class="fu">vector</span>(<span class="st">"list"</span>, <span class="at">length =</span> <span class="fu">dim</span>(modelout<span class="sc">$</span>sims.array)[<span class="dv">2</span>])</span>
<span id="cb83-517"><a href="#cb83-517" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(McmcList)) { McmcList[[i]] <span class="ot">=</span> <span class="fu">as.mcmc</span>(modelout<span class="sc">$</span>sims.array[,i,]) }</span>
<span id="cb83-518"><a href="#cb83-518" aria-hidden="true" tabindex="-1"></a><span class="co"># rbind MCMC samples from 10 chains </span></span>
<span id="cb83-519"><a href="#cb83-519" aria-hidden="true" tabindex="-1"></a>Mcmcdat <span class="ot">&lt;-</span> <span class="fu">rbind</span>(McmcList[[<span class="dv">1</span>]], McmcList[[<span class="dv">2</span>]], McmcList[[<span class="dv">3</span>]], McmcList[[<span class="dv">4</span>]], McmcList[[<span class="dv">5</span>]], McmcList[[<span class="dv">6</span>]], McmcList[[<span class="dv">7</span>]], McmcList[[<span class="dv">8</span>]], McmcList[[<span class="dv">9</span>]], McmcList[[<span class="dv">10</span>]])</span>
<span id="cb83-520"><a href="#cb83-520" aria-hidden="true" tabindex="-1"></a>param.summary <span class="ot">&lt;-</span> modelout<span class="sc">$</span>summary</span>
<span id="cb83-521"><a href="#cb83-521" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(param.summary)</span>
<span id="cb83-522"><a href="#cb83-522" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb83-523"><a href="#cb83-523" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb83-524"><a href="#cb83-524" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb83-525"><a href="#cb83-525" aria-hidden="true" tabindex="-1"></a><span class="fu">#### Check convergence</span></span>
<span id="cb83-526"><a href="#cb83-526" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb83-527"><a href="#cb83-527" aria-hidden="true" tabindex="-1"></a>Any problematic R-hat values (&gt;1.05)?</span>
<span id="cb83-530"><a href="#cb83-530" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb83-531"><a href="#cb83-531" aria-hidden="true" tabindex="-1"></a>top_mod<span class="sc">$</span>BUGSoutput<span class="sc">$</span>summary[,<span class="dv">8</span>][top_mod<span class="sc">$</span>BUGSoutput<span class="sc">$</span>summary[,<span class="dv">8</span>] <span class="sc">&gt;</span> <span class="fl">1.05</span>]</span>
<span id="cb83-532"><a href="#cb83-532" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb83-533"><a href="#cb83-533" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb83-534"><a href="#cb83-534" aria-hidden="true" tabindex="-1"></a>View traceplots</span>
<span id="cb83-537"><a href="#cb83-537" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb83-538"><a href="#cb83-538" aria-hidden="true" tabindex="-1"></a><span class="fu">MCMCtrace</span>(top_mod, <span class="at">ind =</span> <span class="cn">TRUE</span>, </span>
<span id="cb83-539"><a href="#cb83-539" aria-hidden="true" tabindex="-1"></a>          <span class="at">params =</span> <span class="fu">c</span>(<span class="st">"B.0"</span>, <span class="st">"B.site"</span>, <span class="st">"B.year"</span>, </span>
<span id="cb83-540"><a href="#cb83-540" aria-hidden="true" tabindex="-1"></a>                     <span class="st">"ar1"</span>, <span class="st">"alpha.0"</span>, <span class="st">"alpha.1"</span>,</span>
<span id="cb83-541"><a href="#cb83-541" aria-hidden="true" tabindex="-1"></a>                     <span class="st">"sigma"</span>), <span class="at">pdf =</span> <span class="cn">FALSE</span>)</span>
<span id="cb83-542"><a href="#cb83-542" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb83-543"><a href="#cb83-543" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb83-544"><a href="#cb83-544" aria-hidden="true" tabindex="-1"></a>Convert to ggs object</span>
<span id="cb83-547"><a href="#cb83-547" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb83-548"><a href="#cb83-548" aria-hidden="true" tabindex="-1"></a>ggfit <span class="ot">&lt;-</span> <span class="fu">ggs</span>(<span class="fu">as.mcmc</span>(top_mod), <span class="at">keep_original_order =</span> <span class="cn">TRUE</span>)</span>
<span id="cb83-549"><a href="#cb83-549" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(ggfit)</span>
<span id="cb83-550"><a href="#cb83-550" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb83-551"><a href="#cb83-551" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb83-552"><a href="#cb83-552" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb83-553"><a href="#cb83-553" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb83-554"><a href="#cb83-554" aria-hidden="true" tabindex="-1"></a><span class="fu">### Goodness of fit</span></span>
<span id="cb83-555"><a href="#cb83-555" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb83-556"><a href="#cb83-556" aria-hidden="true" tabindex="-1"></a>Format observed and predicted values</span>
<span id="cb83-559"><a href="#cb83-559" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb83-560"><a href="#cb83-560" aria-hidden="true" tabindex="-1"></a>Mcmcdat <span class="ot">&lt;-</span> <span class="fu">as_tibble</span>(Mcmcdat)</span>
<span id="cb83-561"><a href="#cb83-561" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb83-562"><a href="#cb83-562" aria-hidden="true" tabindex="-1"></a><span class="co"># subset expected and observed MCMC samples</span></span>
<span id="cb83-563"><a href="#cb83-563" aria-hidden="true" tabindex="-1"></a>ppdat_exp <span class="ot">&lt;-</span> <span class="fu">as.matrix</span>(Mcmcdat[,<span class="fu">startsWith</span>(<span class="fu">names</span>(Mcmcdat), <span class="st">"stream.mu["</span>)])</span>
<span id="cb83-564"><a href="#cb83-564" aria-hidden="true" tabindex="-1"></a>ppdat_obs <span class="ot">&lt;-</span> <span class="fu">as.matrix</span>(Mcmcdat[,<span class="fu">startsWith</span>(<span class="fu">names</span>(Mcmcdat), <span class="st">"temp["</span>)])</span>
<span id="cb83-565"><a href="#cb83-565" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb83-566"><a href="#cb83-566" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb83-567"><a href="#cb83-567" aria-hidden="true" tabindex="-1"></a>Bayesian p-value</span>
<span id="cb83-570"><a href="#cb83-570" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb83-571"><a href="#cb83-571" aria-hidden="true" tabindex="-1"></a><span class="fu">sum</span>(ppdat_exp <span class="sc">&gt;</span> ppdat_obs) <span class="sc">/</span> (<span class="fu">dim</span>(ppdat_obs)[<span class="dv">1</span>]<span class="sc">*</span><span class="fu">dim</span>(ppdat_obs)[<span class="dv">2</span>])</span>
<span id="cb83-572"><a href="#cb83-572" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb83-573"><a href="#cb83-573" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb83-574"><a href="#cb83-574" aria-hidden="true" tabindex="-1"></a>PP-check, global</span>
<span id="cb83-577"><a href="#cb83-577" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb83-578"><a href="#cb83-578" aria-hidden="true" tabindex="-1"></a>ppdat_obs_mean <span class="ot">&lt;-</span> <span class="fu">apply</span>(ppdat_obs, <span class="dv">2</span>, mean)</span>
<span id="cb83-579"><a href="#cb83-579" aria-hidden="true" tabindex="-1"></a>ppdat_exp_mean <span class="ot">&lt;-</span> <span class="fu">apply</span>(ppdat_exp, <span class="dv">2</span>, mean)</span>
<span id="cb83-580"><a href="#cb83-580" aria-hidden="true" tabindex="-1"></a><span class="fu">tibble</span>(<span class="at">obs =</span> ppdat_obs_mean, <span class="at">exp =</span> ppdat_exp_mean) <span class="sc">%&gt;%</span> </span>
<span id="cb83-581"><a href="#cb83-581" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> obs, <span class="at">y =</span> exp)) <span class="sc">+</span> </span>
<span id="cb83-582"><a href="#cb83-582" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">alpha =</span> <span class="fl">0.1</span>) <span class="sc">+</span> </span>
<span id="cb83-583"><a href="#cb83-583" aria-hidden="true" tabindex="-1"></a>  <span class="co"># geom_smooth(method = "lm") +</span></span>
<span id="cb83-584"><a href="#cb83-584" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_abline</span>(<span class="at">intercept =</span> <span class="dv">0</span>, <span class="at">slope =</span> <span class="dv">1</span>, <span class="at">color =</span> <span class="st">"red"</span>) <span class="sc">+</span> </span>
<span id="cb83-585"><a href="#cb83-585" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>() <span class="sc">+</span> <span class="fu">theme</span>(<span class="at">panel.grid =</span> <span class="fu">element_blank</span>()) <span class="sc">+</span></span>
<span id="cb83-586"><a href="#cb83-586" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="st">"Observed"</span>) <span class="sc">+</span> <span class="fu">ylab</span>(<span class="st">"Predicted (mean)"</span>)</span>
<span id="cb83-587"><a href="#cb83-587" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb83-588"><a href="#cb83-588" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb83-589"><a href="#cb83-589" aria-hidden="true" tabindex="-1"></a>PP-check by river and year</span>
<span id="cb83-590"><a href="#cb83-590" aria-hidden="true" tabindex="-1"></a><span class="in">```{r fig.height=10, fig.width=10}</span></span>
<span id="cb83-591"><a href="#cb83-591" aria-hidden="true" tabindex="-1"></a><span class="fu">tibble</span>(<span class="at">obs =</span> ppdat_obs_mean, <span class="at">exp =</span> ppdat_exp_mean, <span class="at">site =</span> dat<span class="sc">$</span>site_name, <span class="at">year =</span> dat<span class="sc">$</span>year) <span class="sc">%&gt;%</span> </span>
<span id="cb83-592"><a href="#cb83-592" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> obs, <span class="at">y =</span> exp)) <span class="sc">+</span> </span>
<span id="cb83-593"><a href="#cb83-593" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">alpha =</span> <span class="fl">0.1</span>) <span class="sc">+</span> </span>
<span id="cb83-594"><a href="#cb83-594" aria-hidden="true" tabindex="-1"></a>  <span class="co"># geom_smooth(method = "lm") +</span></span>
<span id="cb83-595"><a href="#cb83-595" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_abline</span>(<span class="at">intercept =</span> <span class="dv">0</span>, <span class="at">slope =</span> <span class="dv">1</span>, <span class="at">color =</span> <span class="st">"red"</span>) <span class="sc">+</span> </span>
<span id="cb83-596"><a href="#cb83-596" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>() <span class="sc">+</span> <span class="fu">theme</span>(<span class="at">panel.grid =</span> <span class="fu">element_blank</span>()) <span class="sc">+</span></span>
<span id="cb83-597"><a href="#cb83-597" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="st">"Observed"</span>) <span class="sc">+</span> <span class="fu">ylab</span>(<span class="st">"Predicted (mean)"</span>) <span class="sc">+</span></span>
<span id="cb83-598"><a href="#cb83-598" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_grid</span>(year <span class="sc">~</span> site)</span>
<span id="cb83-599"><a href="#cb83-599" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb83-600"><a href="#cb83-600" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb83-601"><a href="#cb83-601" aria-hidden="true" tabindex="-1"></a>RMSE</span>
<span id="cb83-604"><a href="#cb83-604" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb83-605"><a href="#cb83-605" aria-hidden="true" tabindex="-1"></a><span class="fu">mean</span>(<span class="fu">unlist</span>(ggfit <span class="sc">%&gt;%</span> <span class="fu">filter</span>(Parameter <span class="sc">==</span> <span class="st">"rmse"</span>) <span class="sc">%&gt;%</span> <span class="fu">select</span>(value)))</span>
<span id="cb83-606"><a href="#cb83-606" aria-hidden="true" tabindex="-1"></a><span class="fu">ggs_density</span>(ggfit, <span class="st">"rmse"</span>) <span class="sc">+</span> <span class="fu">theme_bw</span>()</span>
<span id="cb83-607"><a href="#cb83-607" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb83-608"><a href="#cb83-608" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb83-609"><a href="#cb83-609" aria-hidden="true" tabindex="-1"></a>R-squared</span>
<span id="cb83-612"><a href="#cb83-612" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb83-613"><a href="#cb83-613" aria-hidden="true" tabindex="-1"></a><span class="fu">mean</span>(<span class="fu">unlist</span>(ggfit <span class="sc">%&gt;%</span> <span class="fu">filter</span>(Parameter <span class="sc">==</span> <span class="st">"R2"</span>) <span class="sc">%&gt;%</span> <span class="fu">select</span>(value)))</span>
<span id="cb83-614"><a href="#cb83-614" aria-hidden="true" tabindex="-1"></a><span class="fu">ggs_density</span>(ggfit, <span class="st">"R2"</span>) <span class="sc">+</span> <span class="fu">theme_bw</span>()</span>
<span id="cb83-615"><a href="#cb83-615" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb83-616"><a href="#cb83-616" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb83-617"><a href="#cb83-617" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb83-618"><a href="#cb83-618" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb83-619"><a href="#cb83-619" aria-hidden="true" tabindex="-1"></a><span class="fu">## Plot model output</span></span>
<span id="cb83-620"><a href="#cb83-620" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb83-623"><a href="#cb83-623" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb83-624"><a href="#cb83-624" aria-hidden="true" tabindex="-1"></a>myparams <span class="ot">&lt;-</span> <span class="fu">unique</span>(ggfit<span class="sc">$</span>Parameter)</span>
<span id="cb83-625"><a href="#cb83-625" aria-hidden="true" tabindex="-1"></a>mysites <span class="ot">&lt;-</span> <span class="fu">c</span>(dat <span class="sc">%&gt;%</span> <span class="fu">group_by</span>(site_name) <span class="sc">%&gt;%</span> <span class="fu">summarize</span>(<span class="at">site_code =</span> <span class="fu">unique</span>(site_code)) <span class="sc">%&gt;%</span> <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span> <span class="fu">select</span>(site_name))</span>
<span id="cb83-626"><a href="#cb83-626" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb83-627"><a href="#cb83-627" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb83-628"><a href="#cb83-628" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb83-629"><a href="#cb83-629" aria-hidden="true" tabindex="-1"></a><span class="fu">### Dot plots</span></span>
<span id="cb83-630"><a href="#cb83-630" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb83-631"><a href="#cb83-631" aria-hidden="true" tabindex="-1"></a>::: panel-tabset</span>
<span id="cb83-632"><a href="#cb83-632" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb83-633"><a href="#cb83-633" aria-hidden="true" tabindex="-1"></a><span class="fu">##### Fixed effects</span></span>
<span id="cb83-636"><a href="#cb83-636" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb83-637"><a href="#cb83-637" aria-hidden="true" tabindex="-1"></a><span class="fu">ggs_caterpillar</span>(ggfit, <span class="at">family =</span> <span class="st">"B.0"</span>, <span class="at">sort =</span> <span class="cn">FALSE</span>) <span class="sc">+</span></span>
<span id="cb83-638"><a href="#cb83-638" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_discrete</span>(<span class="at">labels =</span> <span class="fu">rev</span>(<span class="fu">c</span>(<span class="st">"Air temp, lag 1"</span>, <span class="st">"Air temp, lag 2"</span>)), <span class="at">limits =</span> rev) <span class="sc">+</span> </span>
<span id="cb83-639"><a href="#cb83-639" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylab</span>(<span class="st">"Fixed effects"</span>) <span class="sc">+</span></span>
<span id="cb83-640"><a href="#cb83-640" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>()</span>
<span id="cb83-641"><a href="#cb83-641" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb83-642"><a href="#cb83-642" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb83-643"><a href="#cb83-643" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb83-644"><a href="#cb83-644" aria-hidden="true" tabindex="-1"></a><span class="fu">##### Site intercepts</span></span>
<span id="cb83-647"><a href="#cb83-647" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb83-648"><a href="#cb83-648" aria-hidden="true" tabindex="-1"></a>ggfit <span class="sc">%&gt;%</span></span>
<span id="cb83-649"><a href="#cb83-649" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(Parameter <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"B.site[1,1]"</span>, <span class="st">"B.site[2,1]"</span>, <span class="st">"B.site[3,1]"</span>, <span class="st">"B.site[4,1]"</span>, <span class="st">"B.site[5,1]"</span>,</span>
<span id="cb83-650"><a href="#cb83-650" aria-hidden="true" tabindex="-1"></a>                          <span class="st">"B.site[6,1]"</span>, <span class="st">"B.site[7,1]"</span>, <span class="st">"B.site[8,1]"</span>, <span class="st">"B.site[9,1]"</span>, <span class="st">"B.site[10,1]"</span>, <span class="st">"B.site[11,1]"</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb83-651"><a href="#cb83-651" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Parameter =</span> <span class="fu">factor</span>(Parameter, <span class="at">levels =</span> <span class="fu">c</span>(<span class="st">"B.site[1,1]"</span>, <span class="st">"B.site[2,1]"</span>, <span class="st">"B.site[3,1]"</span>, <span class="st">"B.site[4,1]"</span>, <span class="st">"B.site[5,1]"</span>,</span>
<span id="cb83-652"><a href="#cb83-652" aria-hidden="true" tabindex="-1"></a>                                                  <span class="st">"B.site[6,1]"</span>, <span class="st">"B.site[7,1]"</span>, <span class="st">"B.site[8,1]"</span>, <span class="st">"B.site[9,1]"</span>, <span class="st">"B.site[10,1]"</span>, <span class="st">"B.site[11,1]"</span>))) <span class="sc">%&gt;%</span></span>
<span id="cb83-653"><a href="#cb83-653" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggs_caterpillar</span>(<span class="at">sort =</span> <span class="cn">FALSE</span>) <span class="sc">+</span></span>
<span id="cb83-654"><a href="#cb83-654" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_discrete</span>(<span class="at">labels =</span> <span class="fu">rev</span>(mysites<span class="sc">$</span>site_name), <span class="at">limits =</span> rev) <span class="sc">+</span> </span>
<span id="cb83-655"><a href="#cb83-655" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylab</span>(<span class="st">"Intercepts"</span>) <span class="sc">+</span></span>
<span id="cb83-656"><a href="#cb83-656" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>()</span>
<span id="cb83-657"><a href="#cb83-657" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb83-658"><a href="#cb83-658" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb83-659"><a href="#cb83-659" aria-hidden="true" tabindex="-1"></a><span class="fu">##### Site slopes - temp</span></span>
<span id="cb83-662"><a href="#cb83-662" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb83-663"><a href="#cb83-663" aria-hidden="true" tabindex="-1"></a>ggfit <span class="sc">%&gt;%</span></span>
<span id="cb83-664"><a href="#cb83-664" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(Parameter <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"B.site[1,2]"</span>, <span class="st">"B.site[2,2]"</span>, <span class="st">"B.site[3,2]"</span>, <span class="st">"B.site[4,2]"</span>, <span class="st">"B.site[5,2]"</span>,</span>
<span id="cb83-665"><a href="#cb83-665" aria-hidden="true" tabindex="-1"></a>                          <span class="st">"B.site[6,2]"</span>, <span class="st">"B.site[7,2]"</span>, <span class="st">"B.site[8,2]"</span>, <span class="st">"B.site[9,2]"</span>, <span class="st">"B.site[10,2]"</span>, <span class="st">"B.site[11,2]"</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb83-666"><a href="#cb83-666" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Parameter =</span> <span class="fu">factor</span>(Parameter, <span class="at">levels =</span> <span class="fu">c</span>(<span class="st">"B.site[1,2]"</span>, <span class="st">"B.site[2,2]"</span>, <span class="st">"B.site[3,2]"</span>, <span class="st">"B.site[4,2]"</span>, <span class="st">"B.site[5,2]"</span>,</span>
<span id="cb83-667"><a href="#cb83-667" aria-hidden="true" tabindex="-1"></a>                          <span class="st">"B.site[6,2]"</span>, <span class="st">"B.site[7,2]"</span>, <span class="st">"B.site[8,2]"</span>, <span class="st">"B.site[9,2]"</span>, <span class="st">"B.site[10,2]"</span>, <span class="st">"B.site[11,2]"</span>))) <span class="sc">%&gt;%</span></span>
<span id="cb83-668"><a href="#cb83-668" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggs_caterpillar</span>(<span class="at">sort =</span> <span class="cn">FALSE</span>) <span class="sc">+</span></span>
<span id="cb83-669"><a href="#cb83-669" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_discrete</span>(<span class="at">labels =</span> <span class="fu">rev</span>(mysites<span class="sc">$</span>site_name), <span class="at">limits =</span> rev) <span class="sc">+</span> </span>
<span id="cb83-670"><a href="#cb83-670" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylab</span>(<span class="st">"Slopes, temperature effect"</span>) <span class="sc">+</span></span>
<span id="cb83-671"><a href="#cb83-671" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>()</span>
<span id="cb83-672"><a href="#cb83-672" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb83-673"><a href="#cb83-673" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb83-674"><a href="#cb83-674" aria-hidden="true" tabindex="-1"></a><span class="fu">##### Site slopes - flow</span></span>
<span id="cb83-677"><a href="#cb83-677" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb83-678"><a href="#cb83-678" aria-hidden="true" tabindex="-1"></a>ggfit <span class="sc">%&gt;%</span></span>
<span id="cb83-679"><a href="#cb83-679" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(Parameter <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"B.site[1,3]"</span>, <span class="st">"B.site[2,3]"</span>, <span class="st">"B.site[3,3]"</span>, <span class="st">"B.site[4,3]"</span>, <span class="st">"B.site[5,3]"</span>,</span>
<span id="cb83-680"><a href="#cb83-680" aria-hidden="true" tabindex="-1"></a>                          <span class="st">"B.site[6,3]"</span>, <span class="st">"B.site[7,3]"</span>, <span class="st">"B.site[8,3]"</span>, <span class="st">"B.site[9,3]"</span>, <span class="st">"B.site[10,3]"</span>, <span class="st">"B.site[11,3]"</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb83-681"><a href="#cb83-681" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Parameter =</span> <span class="fu">factor</span>(Parameter, <span class="at">levels =</span> <span class="fu">c</span>(<span class="st">"B.site[1,3]"</span>, <span class="st">"B.site[2,3]"</span>, <span class="st">"B.site[3,3]"</span>, <span class="st">"B.site[4,3]"</span>, <span class="st">"B.site[5,3]"</span>,</span>
<span id="cb83-682"><a href="#cb83-682" aria-hidden="true" tabindex="-1"></a>                          <span class="st">"B.site[6,3]"</span>, <span class="st">"B.site[7,3]"</span>, <span class="st">"B.site[8,3]"</span>, <span class="st">"B.site[9,3]"</span>, <span class="st">"B.site[10,3]"</span>, <span class="st">"B.site[11,3]"</span>))) <span class="sc">%&gt;%</span></span>
<span id="cb83-683"><a href="#cb83-683" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggs_caterpillar</span>(<span class="at">sort =</span> <span class="cn">FALSE</span>) <span class="sc">+</span></span>
<span id="cb83-684"><a href="#cb83-684" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_discrete</span>(<span class="at">labels =</span> <span class="fu">rev</span>(mysites<span class="sc">$</span>site_name), <span class="at">limits =</span> rev) <span class="sc">+</span> </span>
<span id="cb83-685"><a href="#cb83-685" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylab</span>(<span class="st">"Slopes, flow effect"</span>) <span class="sc">+</span></span>
<span id="cb83-686"><a href="#cb83-686" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>() <span class="sc">+</span> <span class="fu">geom_vline</span>(<span class="at">xintercept =</span> <span class="dv">0</span>, <span class="at">linetype =</span> <span class="st">"dashed"</span>)</span>
<span id="cb83-687"><a href="#cb83-687" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb83-688"><a href="#cb83-688" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb83-689"><a href="#cb83-689" aria-hidden="true" tabindex="-1"></a><span class="fu">##### Site slopes - temp x flow</span></span>
<span id="cb83-692"><a href="#cb83-692" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb83-693"><a href="#cb83-693" aria-hidden="true" tabindex="-1"></a>ggfit <span class="sc">%&gt;%</span></span>
<span id="cb83-694"><a href="#cb83-694" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(Parameter <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"B.site[1,4]"</span>, <span class="st">"B.site[2,4]"</span>, <span class="st">"B.site[3,4]"</span>, <span class="st">"B.site[4,4]"</span>, <span class="st">"B.site[5,4]"</span>,</span>
<span id="cb83-695"><a href="#cb83-695" aria-hidden="true" tabindex="-1"></a>                          <span class="st">"B.site[6,4]"</span>, <span class="st">"B.site[7,4]"</span>, <span class="st">"B.site[8,4]"</span>, <span class="st">"B.site[9,4]"</span>, <span class="st">"B.site[10,4]"</span>, <span class="st">"B.site[11,4]"</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb83-696"><a href="#cb83-696" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Parameter =</span> <span class="fu">factor</span>(Parameter, <span class="at">levels =</span> <span class="fu">c</span>(<span class="st">"B.site[1,4]"</span>, <span class="st">"B.site[2,4]"</span>, <span class="st">"B.site[3,4]"</span>, <span class="st">"B.site[4,4]"</span>, <span class="st">"B.site[5,4]"</span>,</span>
<span id="cb83-697"><a href="#cb83-697" aria-hidden="true" tabindex="-1"></a>                          <span class="st">"B.site[6,4]"</span>, <span class="st">"B.site[7,4]"</span>, <span class="st">"B.site[8,4]"</span>, <span class="st">"B.site[9,4]"</span>, <span class="st">"B.site[10,4]"</span>, <span class="st">"B.site[11,4]"</span>))) <span class="sc">%&gt;%</span></span>
<span id="cb83-698"><a href="#cb83-698" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggs_caterpillar</span>(<span class="at">sort =</span> <span class="cn">FALSE</span>) <span class="sc">+</span></span>
<span id="cb83-699"><a href="#cb83-699" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_discrete</span>(<span class="at">labels =</span> <span class="fu">rev</span>(mysites<span class="sc">$</span>site_name), <span class="at">limits =</span> rev) <span class="sc">+</span> </span>
<span id="cb83-700"><a href="#cb83-700" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylab</span>(<span class="st">"Slopes, temp-flow interaction"</span>) <span class="sc">+</span></span>
<span id="cb83-701"><a href="#cb83-701" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>() <span class="sc">+</span> <span class="fu">geom_vline</span>(<span class="at">xintercept =</span> <span class="dv">0</span>, <span class="at">linetype =</span> <span class="st">"dashed"</span>)</span>
<span id="cb83-702"><a href="#cb83-702" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb83-703"><a href="#cb83-703" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb83-704"><a href="#cb83-704" aria-hidden="true" tabindex="-1"></a><span class="fu">##### Autoregressive terms</span></span>
<span id="cb83-707"><a href="#cb83-707" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb83-708"><a href="#cb83-708" aria-hidden="true" tabindex="-1"></a><span class="fu">ggs_caterpillar</span>(ggfit <span class="sc">%&gt;%</span> <span class="fu">filter</span>(Parameter <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"ar1[1]"</span>, <span class="st">"ar1[2]"</span>, <span class="st">"ar1[3]"</span>, <span class="st">"ar1[4]"</span>, <span class="st">"ar1[5]"</span>,</span>
<span id="cb83-709"><a href="#cb83-709" aria-hidden="true" tabindex="-1"></a>                          <span class="st">"ar1[6]"</span>, <span class="st">"ar1[7]"</span>, <span class="st">"ar1[8]"</span>, <span class="st">"ar1[9]"</span>, <span class="st">"ar1[10]"</span>, <span class="st">"ar1[11]"</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb83-710"><a href="#cb83-710" aria-hidden="true" tabindex="-1"></a>                  <span class="fu">mutate</span>(<span class="at">Parameter =</span> <span class="fu">factor</span>(Parameter, <span class="at">levels =</span> <span class="fu">c</span>(<span class="st">"ar1[1]"</span>, <span class="st">"ar1[2]"</span>, <span class="st">"ar1[3]"</span>, <span class="st">"ar1[4]"</span>, <span class="st">"ar1[5]"</span>,</span>
<span id="cb83-711"><a href="#cb83-711" aria-hidden="true" tabindex="-1"></a>                          <span class="st">"ar1[6]"</span>, <span class="st">"ar1[7]"</span>, <span class="st">"ar1[8]"</span>, <span class="st">"ar1[9]"</span>, <span class="st">"ar1[10]"</span>, <span class="st">"ar1[11]"</span>))),</span>
<span id="cb83-712"><a href="#cb83-712" aria-hidden="true" tabindex="-1"></a>                <span class="at">sort =</span> <span class="cn">FALSE</span>) <span class="sc">+</span> <span class="fu">scale_y_discrete</span>(<span class="at">labels =</span> <span class="fu">rev</span>(mysites<span class="sc">$</span>site_name), <span class="at">limits =</span> rev) <span class="sc">+</span> <span class="fu">theme_bw</span>() </span>
<span id="cb83-713"><a href="#cb83-713" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb83-714"><a href="#cb83-714" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb83-715"><a href="#cb83-715" aria-hidden="true" tabindex="-1"></a><span class="fu">##### Year effects (offsets)</span></span>
<span id="cb83-718"><a href="#cb83-718" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb83-719"><a href="#cb83-719" aria-hidden="true" tabindex="-1"></a>ggfit <span class="sc">%&gt;%</span></span>
<span id="cb83-720"><a href="#cb83-720" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(Parameter <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"B.year[1,1]"</span>, <span class="st">"B.year[2,1]"</span>, <span class="st">"B.year[3,1]"</span>, <span class="st">"B.year[4,1]"</span>, <span class="st">"B.year[5,1]"</span>,</span>
<span id="cb83-721"><a href="#cb83-721" aria-hidden="true" tabindex="-1"></a>                          <span class="st">"B.year[6,1]"</span>, <span class="st">"B.year[7,1]"</span>, <span class="st">"B.year[8,1]"</span>, <span class="st">"B.year[9,1]"</span>, <span class="st">"B.year[10,1]"</span>, </span>
<span id="cb83-722"><a href="#cb83-722" aria-hidden="true" tabindex="-1"></a>                          <span class="st">"B.year[11,1]"</span>, <span class="st">"B.year[12,1]"</span>, <span class="st">"B.year[13,1]"</span>, <span class="st">"B.year[14,1]"</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb83-723"><a href="#cb83-723" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Parameter =</span> <span class="fu">factor</span>(Parameter, <span class="at">levels =</span> <span class="fu">c</span>(<span class="st">"B.year[1,1]"</span>, <span class="st">"B.year[2,1]"</span>, <span class="st">"B.year[3,1]"</span>, <span class="st">"B.year[4,1]"</span>, <span class="st">"B.year[5,1]"</span>,</span>
<span id="cb83-724"><a href="#cb83-724" aria-hidden="true" tabindex="-1"></a>                          <span class="st">"B.year[6,1]"</span>, <span class="st">"B.year[7,1]"</span>, <span class="st">"B.year[8,1]"</span>, <span class="st">"B.year[9,1]"</span>, <span class="st">"B.year[10,1]"</span>, </span>
<span id="cb83-725"><a href="#cb83-725" aria-hidden="true" tabindex="-1"></a>                          <span class="st">"B.year[11,1]"</span>, <span class="st">"B.year[12,1]"</span>, <span class="st">"B.year[13,1]"</span>, <span class="st">"B.year[14,1]"</span>))) <span class="sc">%&gt;%</span></span>
<span id="cb83-726"><a href="#cb83-726" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggs_caterpillar</span>(<span class="at">sort =</span> <span class="cn">FALSE</span>) <span class="sc">+</span></span>
<span id="cb83-727"><a href="#cb83-727" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_discrete</span>(<span class="at">labels =</span> <span class="fu">rev</span>(<span class="fu">sort</span>(<span class="fu">unique</span>(dat<span class="sc">$</span>year))), <span class="at">limits =</span> rev) <span class="sc">+</span> </span>
<span id="cb83-728"><a href="#cb83-728" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylab</span>(<span class="st">"Year effects, offsets to intercepts"</span>) <span class="sc">+</span></span>
<span id="cb83-729"><a href="#cb83-729" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>() <span class="sc">+</span> <span class="fu">geom_vline</span>(<span class="at">xintercept =</span> <span class="dv">0</span>, <span class="at">linetype =</span> <span class="st">"dashed"</span>)</span>
<span id="cb83-730"><a href="#cb83-730" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb83-731"><a href="#cb83-731" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb83-732"><a href="#cb83-732" aria-hidden="true" tabindex="-1"></a><span class="fu">##### Catchment area effects</span></span>
<span id="cb83-735"><a href="#cb83-735" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb83-736"><a href="#cb83-736" aria-hidden="true" tabindex="-1"></a><span class="fu">ggs_caterpillar</span>(ggfit, <span class="at">family =</span> <span class="st">"alpha.1"</span>, <span class="at">sort =</span> <span class="cn">FALSE</span>) <span class="sc">+</span></span>
<span id="cb83-737"><a href="#cb83-737" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_discrete</span>(<span class="at">labels =</span> <span class="fu">rev</span>(<span class="fu">c</span>(<span class="st">"Intercepts"</span>, <span class="st">"Temp eff."</span>, <span class="st">"Flow eff."</span>, <span class="st">"Temp-Flow int."</span>)), <span class="at">limits =</span> rev) <span class="sc">+</span> </span>
<span id="cb83-738"><a href="#cb83-738" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylab</span>(<span class="st">"Catchment size effects"</span>) <span class="sc">+</span></span>
<span id="cb83-739"><a href="#cb83-739" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>() <span class="sc">+</span> <span class="fu">geom_vline</span>(<span class="at">xintercept =</span> <span class="dv">0</span>, <span class="at">linetype =</span> <span class="st">"dashed"</span>)</span>
<span id="cb83-740"><a href="#cb83-740" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb83-741"><a href="#cb83-741" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb83-742"><a href="#cb83-742" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb83-743"><a href="#cb83-743" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb83-744"><a href="#cb83-744" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb83-745"><a href="#cb83-745" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb83-746"><a href="#cb83-746" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb83-747"><a href="#cb83-747" aria-hidden="true" tabindex="-1"></a><span class="fu">### Marginal efffects</span></span>
<span id="cb83-748"><a href="#cb83-748" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb83-749"><a href="#cb83-749" aria-hidden="true" tabindex="-1"></a><span class="fu">#### Temp-flow by site</span></span>
<span id="cb83-750"><a href="#cb83-750" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb83-751"><a href="#cb83-751" aria-hidden="true" tabindex="-1"></a>Site names and codes</span>
<span id="cb83-754"><a href="#cb83-754" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb83-755"><a href="#cb83-755" aria-hidden="true" tabindex="-1"></a>sitecodes <span class="ot">&lt;-</span> dat <span class="sc">%&gt;%</span> <span class="fu">group_by</span>(site_name) <span class="sc">%&gt;%</span> <span class="fu">summarize</span>(<span class="at">site_code =</span> <span class="fu">unique</span>(site_code)) <span class="sc">%&gt;%</span> <span class="fu">ungroup</span>()</span>
<span id="cb83-756"><a href="#cb83-756" aria-hidden="true" tabindex="-1"></a>sitecodes</span>
<span id="cb83-757"><a href="#cb83-757" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb83-758"><a href="#cb83-758" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb83-759"><a href="#cb83-759" aria-hidden="true" tabindex="-1"></a>Plotting function</span>
<span id="cb83-762"><a href="#cb83-762" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb83-763"><a href="#cb83-763" aria-hidden="true" tabindex="-1"></a>margplot <span class="ot">&lt;-</span> <span class="cf">function</span>(code) {</span>
<span id="cb83-764"><a href="#cb83-764" aria-hidden="true" tabindex="-1"></a>  np <span class="ot">&lt;-</span> <span class="dv">100</span></span>
<span id="cb83-765"><a href="#cb83-765" aria-hidden="true" tabindex="-1"></a>  myriv <span class="ot">&lt;-</span> sitecodes<span class="sc">$</span>site_name[code]</span>
<span id="cb83-766"><a href="#cb83-766" aria-hidden="true" tabindex="-1"></a>  x_temp <span class="ot">&lt;-</span> <span class="fu">seq</span>(<span class="at">from =</span> <span class="fu">min</span>(dat<span class="sc">$</span>z_air_temp_mean[dat<span class="sc">$</span>site_name <span class="sc">==</span> myriv]),</span>
<span id="cb83-767"><a href="#cb83-767" aria-hidden="true" tabindex="-1"></a>                <span class="at">to =</span> <span class="fu">max</span>(dat<span class="sc">$</span>z_air_temp_mean[dat<span class="sc">$</span>site_name <span class="sc">==</span> myriv]),</span>
<span id="cb83-768"><a href="#cb83-768" aria-hidden="true" tabindex="-1"></a>                <span class="at">length.out =</span> np)</span>
<span id="cb83-769"><a href="#cb83-769" aria-hidden="true" tabindex="-1"></a>  x_flow <span class="ot">&lt;-</span> <span class="fu">seq</span>(<span class="at">from =</span> <span class="fu">min</span>(dat<span class="sc">$</span>z_Yield_mm_log[dat<span class="sc">$</span>site_name <span class="sc">==</span> myriv]),</span>
<span id="cb83-770"><a href="#cb83-770" aria-hidden="true" tabindex="-1"></a>                <span class="at">to =</span> <span class="fu">max</span>(dat<span class="sc">$</span>z_Yield_mm_log[dat<span class="sc">$</span>site_name <span class="sc">==</span> myriv]),</span>
<span id="cb83-771"><a href="#cb83-771" aria-hidden="true" tabindex="-1"></a>                <span class="at">length.out =</span> np)</span>
<span id="cb83-772"><a href="#cb83-772" aria-hidden="true" tabindex="-1"></a>  pred_df <span class="ot">&lt;-</span> <span class="fu">expand_grid</span>(x_temp, x_flow)</span>
<span id="cb83-773"><a href="#cb83-773" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb83-774"><a href="#cb83-774" aria-hidden="true" tabindex="-1"></a>  <span class="co"># predict from model</span></span>
<span id="cb83-775"><a href="#cb83-775" aria-hidden="true" tabindex="-1"></a>  pred_df<span class="sc">$</span>pred <span class="ot">&lt;-</span> param.summary[<span class="fu">paste</span>(<span class="st">"B.site["</span>, code, <span class="st">",1]"</span>, <span class="at">sep =</span> <span class="st">""</span>),<span class="dv">1</span>] <span class="sc">+</span> param.summary[<span class="fu">paste</span>(<span class="st">"B.site["</span>, code, <span class="st">",2]"</span>, <span class="at">sep =</span> <span class="st">""</span>),<span class="dv">1</span>]<span class="sc">*</span>pred_df<span class="sc">$</span>x_temp <span class="sc">+</span> param.summary[<span class="fu">paste</span>(<span class="st">"B.site["</span>, code, <span class="st">",3]"</span>, <span class="at">sep =</span> <span class="st">""</span>),<span class="dv">1</span>]<span class="sc">*</span>pred_df<span class="sc">$</span>x_flow <span class="sc">+</span> param.summary[<span class="fu">paste</span>(<span class="st">"B.site["</span>, code, <span class="st">",4]"</span>, <span class="at">sep =</span> <span class="st">""</span>),<span class="dv">1</span>]<span class="sc">*</span>pred_df<span class="sc">$</span>x_temp<span class="sc">*</span>pred_df<span class="sc">$</span>x_flow</span>
<span id="cb83-776"><a href="#cb83-776" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb83-777"><a href="#cb83-777" aria-hidden="true" tabindex="-1"></a>  <span class="co"># lines </span></span>
<span id="cb83-778"><a href="#cb83-778" aria-hidden="true" tabindex="-1"></a>  p1 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(pred_df, <span class="fu">aes</span>(<span class="at">x =</span> x_temp, <span class="at">y =</span> pred, <span class="at">color =</span> x_flow, <span class="at">group =</span> x_flow)) <span class="sc">+</span></span>
<span id="cb83-779"><a href="#cb83-779" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_line</span>() <span class="sc">+</span></span>
<span id="cb83-780"><a href="#cb83-780" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_color_distiller</span>(<span class="at">palette =</span> <span class="st">"BrBG"</span>, <span class="at">direction =</span> <span class="sc">+</span><span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb83-781"><a href="#cb83-781" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme_bw</span>() <span class="sc">+</span> <span class="fu">theme</span>(<span class="at">panel.grid =</span> <span class="fu">element_blank</span>()) <span class="sc">+</span></span>
<span id="cb83-782"><a href="#cb83-782" aria-hidden="true" tabindex="-1"></a>    <span class="fu">labs</span>(<span class="at">color =</span> <span class="st">"Flow"</span>) <span class="sc">+</span> <span class="fu">xlab</span>(<span class="st">"Air temperature"</span>) <span class="sc">+</span> <span class="fu">ylab</span>(<span class="st">"Water temperature"</span>) <span class="sc">+</span> <span class="fu">ylim</span>(<span class="dv">0</span>,<span class="dv">20</span>) <span class="co">#+</span></span>
<span id="cb83-783"><a href="#cb83-783" aria-hidden="true" tabindex="-1"></a>    <span class="co">#geom_point(dat %&gt;% filter(site_name == myriv), mapping = aes(x = z_air_temp_mean, y = tempc_mean, group = NA), color = "black", size = 0.2, shape = 16) </span></span>
<span id="cb83-784"><a href="#cb83-784" aria-hidden="true" tabindex="-1"></a> <span class="co"># heatmap</span></span>
<span id="cb83-785"><a href="#cb83-785" aria-hidden="true" tabindex="-1"></a>  p2 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(pred_df, <span class="fu">aes</span>(<span class="at">x =</span> x_temp, <span class="at">y =</span> x_flow)) <span class="sc">+</span></span>
<span id="cb83-786"><a href="#cb83-786" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_tile</span>(<span class="fu">aes</span>(<span class="at">fill =</span> pred)) <span class="sc">+</span></span>
<span id="cb83-787"><a href="#cb83-787" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_fill_distiller</span>(<span class="at">palette =</span> <span class="st">"Spectral"</span>, <span class="at">limits =</span> <span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">20</span>)) <span class="sc">+</span></span>
<span id="cb83-788"><a href="#cb83-788" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme_bw</span>() <span class="sc">+</span> <span class="fu">theme</span>(<span class="at">panel.grid =</span> <span class="fu">element_blank</span>()) <span class="sc">+</span></span>
<span id="cb83-789"><a href="#cb83-789" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_x_continuous</span>(<span class="at">expand =</span> <span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">0</span>)) <span class="sc">+</span> <span class="fu">scale_y_continuous</span>(<span class="at">expand =</span> <span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">0</span>)) <span class="sc">+</span></span>
<span id="cb83-790"><a href="#cb83-790" aria-hidden="true" tabindex="-1"></a>    <span class="fu">labs</span>(<span class="at">fill =</span> <span class="st">"Water</span><span class="sc">\n</span><span class="st">temp."</span>) <span class="sc">+</span> <span class="fu">xlab</span>(<span class="st">"Air temperature"</span>) <span class="sc">+</span> <span class="fu">ylab</span>(<span class="st">"Flow"</span>) <span class="co">#+ </span></span>
<span id="cb83-791"><a href="#cb83-791" aria-hidden="true" tabindex="-1"></a>    <span class="co">#geom_point(data = dat %&gt;% filter(site_name == myriv), aes(x = z_air_temp_mean, y = z_Yield_mm_log, color = tempc_mean)) +</span></span>
<span id="cb83-792"><a href="#cb83-792" aria-hidden="true" tabindex="-1"></a>    <span class="co">#scale_color_distiller(palette = "Spectral", limits = c(0,20)) </span></span>
<span id="cb83-793"><a href="#cb83-793" aria-hidden="true" tabindex="-1"></a>  <span class="co"># combine</span></span>
<span id="cb83-794"><a href="#cb83-794" aria-hidden="true" tabindex="-1"></a>  egg<span class="sc">::</span><span class="fu">ggarrange</span>(p1, p2, <span class="at">nrow =</span> <span class="dv">1</span>)</span>
<span id="cb83-795"><a href="#cb83-795" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb83-796"><a href="#cb83-796" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb83-797"><a href="#cb83-797" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb83-798"><a href="#cb83-798" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb83-799"><a href="#cb83-799" aria-hidden="true" tabindex="-1"></a>*Interpretation of these plots (specifically, stream temperature outcome) is complicated by the ~large effects of lagged air temperature variables and temporal autocorrelation*</span>
<span id="cb83-800"><a href="#cb83-800" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb83-801"><a href="#cb83-801" aria-hidden="true" tabindex="-1"></a>::: panel-tabset</span>
<span id="cb83-802"><a href="#cb83-802" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb83-803"><a href="#cb83-803" aria-hidden="true" tabindex="-1"></a><span class="fu">##### Grizzly Creek</span></span>
<span id="cb83-806"><a href="#cb83-806" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb83-807"><a href="#cb83-807" aria-hidden="true" tabindex="-1"></a><span class="fu">margplot</span>(<span class="dv">1</span>)</span>
<span id="cb83-808"><a href="#cb83-808" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb83-809"><a href="#cb83-809" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb83-810"><a href="#cb83-810" aria-hidden="true" tabindex="-1"></a><span class="fu">##### Grouse Creek</span></span>
<span id="cb83-813"><a href="#cb83-813" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb83-814"><a href="#cb83-814" aria-hidden="true" tabindex="-1"></a><span class="fu">margplot</span>(<span class="dv">2</span>)</span>
<span id="cb83-815"><a href="#cb83-815" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb83-816"><a href="#cb83-816" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb83-817"><a href="#cb83-817" aria-hidden="true" tabindex="-1"></a><span class="fu">##### Leidy Creek Mouth</span></span>
<span id="cb83-820"><a href="#cb83-820" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb83-821"><a href="#cb83-821" aria-hidden="true" tabindex="-1"></a><span class="fu">margplot</span>(<span class="dv">3</span>)</span>
<span id="cb83-822"><a href="#cb83-822" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb83-823"><a href="#cb83-823" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb83-824"><a href="#cb83-824" aria-hidden="true" tabindex="-1"></a><span class="fu">##### NF Spread Creek Lower</span></span>
<span id="cb83-827"><a href="#cb83-827" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb83-828"><a href="#cb83-828" aria-hidden="true" tabindex="-1"></a><span class="fu">margplot</span>(<span class="dv">5</span>)</span>
<span id="cb83-829"><a href="#cb83-829" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb83-830"><a href="#cb83-830" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb83-831"><a href="#cb83-831" aria-hidden="true" tabindex="-1"></a><span class="fu">##### NF Spread Creek Upper</span></span>
<span id="cb83-834"><a href="#cb83-834" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb83-835"><a href="#cb83-835" aria-hidden="true" tabindex="-1"></a><span class="fu">margplot</span>(<span class="dv">6</span>)</span>
<span id="cb83-836"><a href="#cb83-836" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb83-837"><a href="#cb83-837" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb83-838"><a href="#cb83-838" aria-hidden="true" tabindex="-1"></a><span class="fu">##### Pacific Creek</span></span>
<span id="cb83-841"><a href="#cb83-841" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb83-842"><a href="#cb83-842" aria-hidden="true" tabindex="-1"></a><span class="fu">margplot</span>(<span class="dv">7</span>)</span>
<span id="cb83-843"><a href="#cb83-843" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb83-844"><a href="#cb83-844" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb83-845"><a href="#cb83-845" aria-hidden="true" tabindex="-1"></a><span class="fu">##### Rock Creek</span></span>
<span id="cb83-848"><a href="#cb83-848" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb83-849"><a href="#cb83-849" aria-hidden="true" tabindex="-1"></a><span class="fu">margplot</span>(<span class="dv">8</span>)</span>
<span id="cb83-850"><a href="#cb83-850" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb83-851"><a href="#cb83-851" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb83-852"><a href="#cb83-852" aria-hidden="true" tabindex="-1"></a><span class="fu">##### SF Spread Creek Lower</span></span>
<span id="cb83-855"><a href="#cb83-855" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb83-856"><a href="#cb83-856" aria-hidden="true" tabindex="-1"></a><span class="fu">margplot</span>(<span class="dv">9</span>)</span>
<span id="cb83-857"><a href="#cb83-857" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb83-858"><a href="#cb83-858" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb83-859"><a href="#cb83-859" aria-hidden="true" tabindex="-1"></a><span class="fu">##### SF Spread Creek Upper</span></span>
<span id="cb83-862"><a href="#cb83-862" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb83-863"><a href="#cb83-863" aria-hidden="true" tabindex="-1"></a><span class="fu">margplot</span>(<span class="dv">10</span>)</span>
<span id="cb83-864"><a href="#cb83-864" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb83-865"><a href="#cb83-865" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb83-866"><a href="#cb83-866" aria-hidden="true" tabindex="-1"></a><span class="fu">##### Spread Creek Dam</span></span>
<span id="cb83-869"><a href="#cb83-869" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb83-870"><a href="#cb83-870" aria-hidden="true" tabindex="-1"></a><span class="fu">margplot</span>(<span class="dv">11</span>)</span>
<span id="cb83-871"><a href="#cb83-871" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb83-872"><a href="#cb83-872" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb83-873"><a href="#cb83-873" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb83-874"><a href="#cb83-874" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb83-875"><a href="#cb83-875" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb83-876"><a href="#cb83-876" aria-hidden="true" tabindex="-1"></a><span class="fu">#### Site-level effects by covs</span></span>
<span id="cb83-877"><a href="#cb83-877" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb83-878"><a href="#cb83-878" aria-hidden="true" tabindex="-1"></a>Are temp and flow effects correlated? *Yes...do we need to model this correlation?*</span>
<span id="cb83-881"><a href="#cb83-881" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb83-882"><a href="#cb83-882" aria-hidden="true" tabindex="-1"></a>ggfit <span class="sc">%&gt;%</span></span>
<span id="cb83-883"><a href="#cb83-883" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(Parameter <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"B.site[1,2]"</span>, <span class="st">"B.site[2,2]"</span>, <span class="st">"B.site[3,2]"</span>, <span class="st">"B.site[4,2]"</span>, <span class="st">"B.site[5,2]"</span>,</span>
<span id="cb83-884"><a href="#cb83-884" aria-hidden="true" tabindex="-1"></a>                          <span class="st">"B.site[6,2]"</span>, <span class="st">"B.site[7,2]"</span>, <span class="st">"B.site[8,2]"</span>, <span class="st">"B.site[9,2]"</span>, <span class="st">"B.site[10,2]"</span>, <span class="st">"B.site[11,2]"</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb83-885"><a href="#cb83-885" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Parameter =</span> <span class="fu">factor</span>(Parameter, <span class="at">levels =</span> <span class="fu">c</span>(<span class="st">"B.site[1,2]"</span>, <span class="st">"B.site[2,2]"</span>, <span class="st">"B.site[3,2]"</span>, <span class="st">"B.site[4,2]"</span>, <span class="st">"B.site[5,2]"</span>,</span>
<span id="cb83-886"><a href="#cb83-886" aria-hidden="true" tabindex="-1"></a>                          <span class="st">"B.site[6,2]"</span>, <span class="st">"B.site[7,2]"</span>, <span class="st">"B.site[8,2]"</span>, <span class="st">"B.site[9,2]"</span>, <span class="st">"B.site[10,2]"</span>, <span class="st">"B.site[11,2]"</span>))) <span class="sc">%&gt;%</span></span>
<span id="cb83-887"><a href="#cb83-887" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(Parameter) <span class="sc">%&gt;%</span> </span>
<span id="cb83-888"><a href="#cb83-888" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="at">tempeff =</span> <span class="fu">mean</span>(value)) <span class="sc">%&gt;%</span></span>
<span id="cb83-889"><a href="#cb83-889" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span></span>
<span id="cb83-890"><a href="#cb83-890" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">site_name =</span> mysites<span class="sc">$</span>site_name) <span class="sc">%&gt;%</span></span>
<span id="cb83-891"><a href="#cb83-891" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span>Parameter) <span class="sc">%&gt;%</span></span>
<span id="cb83-892"><a href="#cb83-892" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(ggfit <span class="sc">%&gt;%</span></span>
<span id="cb83-893"><a href="#cb83-893" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(Parameter <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"B.site[1,3]"</span>, <span class="st">"B.site[2,3]"</span>, <span class="st">"B.site[3,3]"</span>, <span class="st">"B.site[4,3]"</span>, <span class="st">"B.site[5,3]"</span>,</span>
<span id="cb83-894"><a href="#cb83-894" aria-hidden="true" tabindex="-1"></a>                          <span class="st">"B.site[6,3]"</span>, <span class="st">"B.site[7,3]"</span>, <span class="st">"B.site[8,3]"</span>, <span class="st">"B.site[9,3]"</span>, <span class="st">"B.site[10,3]"</span>, <span class="st">"B.site[11,3]"</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb83-895"><a href="#cb83-895" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Parameter =</span> <span class="fu">factor</span>(Parameter, <span class="at">levels =</span> <span class="fu">c</span>(<span class="st">"B.site[1,3]"</span>, <span class="st">"B.site[2,3]"</span>, <span class="st">"B.site[3,3]"</span>, <span class="st">"B.site[4,3]"</span>, <span class="st">"B.site[5,3]"</span>,</span>
<span id="cb83-896"><a href="#cb83-896" aria-hidden="true" tabindex="-1"></a>                          <span class="st">"B.site[6,3]"</span>, <span class="st">"B.site[7,3]"</span>, <span class="st">"B.site[8,3]"</span>, <span class="st">"B.site[9,3]"</span>, <span class="st">"B.site[10,3]"</span>, <span class="st">"B.site[11,3]"</span>))) <span class="sc">%&gt;%</span></span>
<span id="cb83-897"><a href="#cb83-897" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(Parameter) <span class="sc">%&gt;%</span> </span>
<span id="cb83-898"><a href="#cb83-898" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="at">floweff =</span> <span class="fu">mean</span>(value)) <span class="sc">%&gt;%</span></span>
<span id="cb83-899"><a href="#cb83-899" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span></span>
<span id="cb83-900"><a href="#cb83-900" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">site_name =</span> mysites<span class="sc">$</span>site_name) <span class="sc">%&gt;%</span></span>
<span id="cb83-901"><a href="#cb83-901" aria-hidden="true" tabindex="-1"></a>    <span class="fu">select</span>(<span class="sc">-</span>Parameter)) <span class="sc">%&gt;%</span></span>
<span id="cb83-902"><a href="#cb83-902" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> tempeff, <span class="at">y =</span> floweff)) <span class="sc">+</span> <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb83-903"><a href="#cb83-903" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="at">method =</span> <span class="st">"lm"</span>) <span class="sc">+</span></span>
<span id="cb83-904"><a href="#cb83-904" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="st">"Temperature effect"</span>) <span class="sc">+</span> <span class="fu">ylab</span>(<span class="st">"Flow effect"</span>) <span class="sc">+</span></span>
<span id="cb83-905"><a href="#cb83-905" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>() <span class="sc">+</span> ggpubr<span class="sc">::</span><span class="fu">stat_cor</span>(<span class="at">label.y.npc =</span> <span class="st">"bottom"</span>)</span>
<span id="cb83-906"><a href="#cb83-906" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb83-907"><a href="#cb83-907" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb83-908"><a href="#cb83-908" aria-hidden="true" tabindex="-1"></a>*Note that for these 11 sites, catchment area and elevation are correlated*</span>
<span id="cb83-911"><a href="#cb83-911" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb83-912"><a href="#cb83-912" aria-hidden="true" tabindex="-1"></a>dat <span class="sc">%&gt;%</span> <span class="fu">group_by</span>(site_name) <span class="sc">%&gt;%</span> <span class="fu">summarize</span>(<span class="at">area_sqmi =</span> <span class="fu">unique</span>(area_sqmi), <span class="at">elev_ft =</span> <span class="fu">unique</span>(elev_ft)) <span class="sc">%&gt;%</span> <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> elev_ft, <span class="at">y =</span> <span class="fu">log</span>(area_sqmi))) <span class="sc">+</span> <span class="fu">geom_point</span>() <span class="sc">+</span> <span class="fu">geom_smooth</span>(<span class="at">method =</span> <span class="st">"lm"</span>) <span class="sc">+</span> <span class="fu">theme_bw</span>() <span class="sc">+</span> ggpubr<span class="sc">::</span><span class="fu">stat_cor</span>(<span class="at">label.x.npc =</span> <span class="st">"center"</span>)</span>
<span id="cb83-913"><a href="#cb83-913" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb83-914"><a href="#cb83-914" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb83-915"><a href="#cb83-915" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb83-918"><a href="#cb83-918" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb83-919"><a href="#cb83-919" aria-hidden="true" tabindex="-1"></a>temp.pars <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"B.site[1,2]"</span>, <span class="st">"B.site[2,2]"</span>, <span class="st">"B.site[3,2]"</span>, <span class="st">"B.site[4,2]"</span>, <span class="st">"B.site[5,2]"</span>, <span class="st">"B.site[6,2]"</span>, <span class="st">"B.site[7,2]"</span>, <span class="st">"B.site[8,2]"</span>, <span class="st">"B.site[9,2]"</span>, <span class="st">"B.site[10,2]"</span>, <span class="st">"B.site[11,2]"</span>)</span>
<span id="cb83-920"><a href="#cb83-920" aria-hidden="true" tabindex="-1"></a>flow.pars <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"B.site[1,3]"</span>, <span class="st">"B.site[2,3]"</span>, <span class="st">"B.site[3,3]"</span>, <span class="st">"B.site[4,3]"</span>, <span class="st">"B.site[5,3]"</span>, <span class="st">"B.site[6,3]"</span>, <span class="st">"B.site[7,3]"</span>, <span class="st">"B.site[8,3]"</span>, <span class="st">"B.site[9,3]"</span>, <span class="st">"B.site[10,3]"</span>, <span class="st">"B.site[11,3]"</span>)</span>
<span id="cb83-921"><a href="#cb83-921" aria-hidden="true" tabindex="-1"></a>int.pars <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"B.site[1,4]"</span>, <span class="st">"B.site[2,4]"</span>, <span class="st">"B.site[3,4]"</span>, <span class="st">"B.site[4,4]"</span>, <span class="st">"B.site[5,4]"</span>, <span class="st">"B.site[6,4]"</span>, <span class="st">"B.site[7,4]"</span>, <span class="st">"B.site[8,4]"</span>, <span class="st">"B.site[9,4]"</span>, <span class="st">"B.site[10,4]"</span>, <span class="st">"B.site[11,4]"</span>)</span>
<span id="cb83-922"><a href="#cb83-922" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb83-923"><a href="#cb83-923" aria-hidden="true" tabindex="-1"></a><span class="co"># get mean and 95% credible intervals for random effect parameters</span></span>
<span id="cb83-924"><a href="#cb83-924" aria-hidden="true" tabindex="-1"></a>mytib <span class="ot">&lt;-</span> sitecodes <span class="sc">%&gt;%</span></span>
<span id="cb83-925"><a href="#cb83-925" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">temp.mean =</span> param.summary[temp.pars,<span class="dv">1</span>],</span>
<span id="cb83-926"><a href="#cb83-926" aria-hidden="true" tabindex="-1"></a>         <span class="at">temp.low =</span> param.summary[temp.pars,<span class="dv">3</span>],</span>
<span id="cb83-927"><a href="#cb83-927" aria-hidden="true" tabindex="-1"></a>         <span class="at">temp.high =</span> param.summary[temp.pars,<span class="dv">7</span>],</span>
<span id="cb83-928"><a href="#cb83-928" aria-hidden="true" tabindex="-1"></a>         <span class="at">flow.mean =</span> param.summary[flow.pars,<span class="dv">1</span>],</span>
<span id="cb83-929"><a href="#cb83-929" aria-hidden="true" tabindex="-1"></a>         <span class="at">flow.low =</span> param.summary[flow.pars,<span class="dv">3</span>],</span>
<span id="cb83-930"><a href="#cb83-930" aria-hidden="true" tabindex="-1"></a>         <span class="at">flow.high =</span> param.summary[flow.pars,<span class="dv">7</span>],</span>
<span id="cb83-931"><a href="#cb83-931" aria-hidden="true" tabindex="-1"></a>         <span class="at">int.mean =</span> param.summary[int.pars,<span class="dv">1</span>],</span>
<span id="cb83-932"><a href="#cb83-932" aria-hidden="true" tabindex="-1"></a>         <span class="at">int.low =</span> param.summary[int.pars,<span class="dv">3</span>],</span>
<span id="cb83-933"><a href="#cb83-933" aria-hidden="true" tabindex="-1"></a>         <span class="at">int.high =</span> param.summary[int.pars,<span class="dv">7</span>],</span>
<span id="cb83-934"><a href="#cb83-934" aria-hidden="true" tabindex="-1"></a>         <span class="at">area_log =</span> jags.data<span class="sc">$</span>area</span>
<span id="cb83-935"><a href="#cb83-935" aria-hidden="true" tabindex="-1"></a>         )</span>
<span id="cb83-936"><a href="#cb83-936" aria-hidden="true" tabindex="-1"></a>mytib</span>
<span id="cb83-937"><a href="#cb83-937" aria-hidden="true" tabindex="-1"></a>nsims <span class="ot">&lt;-</span> <span class="dv">100</span></span>
<span id="cb83-938"><a href="#cb83-938" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb83-939"><a href="#cb83-939" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb83-940"><a href="#cb83-940" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb83-941"><a href="#cb83-941" aria-hidden="true" tabindex="-1"></a>Temperature effect: stream temperature sensitivity to air temperature is greater in larger catchments (presumably b/c hillslope/groundwater controls on temp are proportionally much weaker). Also, in larger catchments, water has been exposed to air for longer and thus has had more time to equilibrate with local environmental conditions. But interestingly, no effect of mean summer yield, a proxy for relative groundwater contributions to stream flow. </span>
<span id="cb83-944"><a href="#cb83-944" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb83-945"><a href="#cb83-945" aria-hidden="true" tabindex="-1"></a>xseq <span class="ot">&lt;-</span> <span class="fu">seq</span>(<span class="at">from =</span> <span class="fu">min</span>(jags.data<span class="sc">$</span>area), <span class="at">to =</span> <span class="fu">max</span>(jags.data<span class="sc">$</span>area), <span class="at">length.out =</span> nsims)</span>
<span id="cb83-946"><a href="#cb83-946" aria-hidden="true" tabindex="-1"></a>preds <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="at">data =</span> <span class="cn">NA</span>, <span class="at">nrow =</span> <span class="fu">dim</span>(Mcmcdat)[<span class="dv">1</span>], <span class="at">ncol =</span> nsims)</span>
<span id="cb83-947"><a href="#cb83-947" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb83-948"><a href="#cb83-948" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (j <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">dim</span>(Mcmcdat)[<span class="dv">1</span>]) {</span>
<span id="cb83-949"><a href="#cb83-949" aria-hidden="true" tabindex="-1"></a>  preds[j,] <span class="ot">&lt;-</span> <span class="fu">unlist</span>(Mcmcdat[j,<span class="st">"alpha.0[2]"</span>]) <span class="sc">+</span> <span class="fu">unlist</span>(Mcmcdat[j,<span class="st">"alpha.1[2]"</span>])<span class="sc">*</span>xseq</span>
<span id="cb83-950"><a href="#cb83-950" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb83-951"><a href="#cb83-951" aria-hidden="true" tabindex="-1"></a>ymean <span class="ot">&lt;-</span> <span class="fu">apply</span>(preds, <span class="dv">2</span>, mean)</span>
<span id="cb83-952"><a href="#cb83-952" aria-hidden="true" tabindex="-1"></a>ylow <span class="ot">&lt;-</span> <span class="fu">apply</span>(preds, <span class="dv">2</span>, quantile, <span class="at">probs =</span> <span class="fl">0.025</span>)</span>
<span id="cb83-953"><a href="#cb83-953" aria-hidden="true" tabindex="-1"></a>yhigh <span class="ot">&lt;-</span> <span class="fu">apply</span>(preds, <span class="dv">2</span>, quantile, <span class="at">probs =</span> <span class="fl">0.975</span>)</span>
<span id="cb83-954"><a href="#cb83-954" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb83-955"><a href="#cb83-955" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb83-956"><a href="#cb83-956" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_ribbon</span>(<span class="fu">aes</span>(<span class="at">x =</span> xseq, <span class="at">ymin =</span> ylow, <span class="at">ymax =</span> yhigh), <span class="at">fill =</span> <span class="st">"grey"</span>) <span class="sc">+</span></span>
<span id="cb83-957"><a href="#cb83-957" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">x =</span> xseq, <span class="at">y =</span> ymean), <span class="at">color =</span> <span class="st">"black"</span>, <span class="at">linewidth =</span> <span class="dv">1</span>, <span class="at">lineend =</span> <span class="st">"round"</span>) <span class="sc">+</span></span>
<span id="cb83-958"><a href="#cb83-958" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_errorbar</span>(<span class="fu">aes</span>(<span class="at">x =</span> mytib<span class="sc">$</span>area_log, <span class="at">ymin =</span> mytib<span class="sc">$</span>temp.low, <span class="at">ymax =</span> mytib<span class="sc">$</span>temp.high), <span class="at">width =</span> <span class="fl">0.1</span>) <span class="sc">+</span></span>
<span id="cb83-959"><a href="#cb83-959" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">x =</span> mytib<span class="sc">$</span>area_log, <span class="at">y =</span> mytib<span class="sc">$</span>temp.mean), <span class="at">size =</span> <span class="dv">2</span>, <span class="at">shape =</span> <span class="dv">21</span>, <span class="at">fill =</span> <span class="st">"white"</span>) <span class="sc">+</span></span>
<span id="cb83-960"><a href="#cb83-960" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>() <span class="sc">+</span> <span class="fu">theme</span>(<span class="at">panel.grid =</span> <span class="fu">element_blank</span>()) <span class="sc">+</span></span>
<span id="cb83-961"><a href="#cb83-961" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="st">"Catchment area (log scale)"</span>) <span class="sc">+</span> <span class="fu">ylab</span>(<span class="st">"Temperature effect (posterior mean)"</span>)</span>
<span id="cb83-962"><a href="#cb83-962" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb83-963"><a href="#cb83-963" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb83-964"><a href="#cb83-964" aria-hidden="true" tabindex="-1"></a>Flow effect: in small catchments, increased flow has a warming effect on stream temperature, whereas in large catchments, increased flow has a cooling effect on stream temperature. In small catchments, where proportional contributions from groundwater to streamflow are relatively high, increased flows during snowmelt/runoff warm stream temperatures as snowmelt temperature is warmer than groundwater temperature (???). But in larger catchments where volumetric groundwater contributions are ~low relative to discharge, increased flows during snowmelt cool stream temps as snowmelt temps are colder than ambient air temperatures (which more strongly influence stream temps relative to smaller streams).</span>
<span id="cb83-967"><a href="#cb83-967" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb83-968"><a href="#cb83-968" aria-hidden="true" tabindex="-1"></a>xseq <span class="ot">&lt;-</span> <span class="fu">seq</span>(<span class="at">from =</span> <span class="fu">min</span>(jags.data<span class="sc">$</span>area), <span class="at">to =</span> <span class="fu">max</span>(jags.data<span class="sc">$</span>area), <span class="at">length.out =</span> nsims)</span>
<span id="cb83-969"><a href="#cb83-969" aria-hidden="true" tabindex="-1"></a>preds <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="at">data =</span> <span class="cn">NA</span>, <span class="at">nrow =</span> <span class="fu">dim</span>(Mcmcdat)[<span class="dv">1</span>], <span class="at">ncol =</span> nsims)</span>
<span id="cb83-970"><a href="#cb83-970" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb83-971"><a href="#cb83-971" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (j <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">dim</span>(Mcmcdat)[<span class="dv">1</span>]) {</span>
<span id="cb83-972"><a href="#cb83-972" aria-hidden="true" tabindex="-1"></a>  preds[j,] <span class="ot">&lt;-</span> <span class="fu">unlist</span>(Mcmcdat[j,<span class="st">"alpha.0[3]"</span>]) <span class="sc">+</span> <span class="fu">unlist</span>(Mcmcdat[j,<span class="st">"alpha.1[3]"</span>])<span class="sc">*</span>xseq</span>
<span id="cb83-973"><a href="#cb83-973" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb83-974"><a href="#cb83-974" aria-hidden="true" tabindex="-1"></a>ymean <span class="ot">&lt;-</span> <span class="fu">apply</span>(preds, <span class="dv">2</span>, mean)</span>
<span id="cb83-975"><a href="#cb83-975" aria-hidden="true" tabindex="-1"></a>ylow <span class="ot">&lt;-</span> <span class="fu">apply</span>(preds, <span class="dv">2</span>, quantile, <span class="at">probs =</span> <span class="fl">0.025</span>)</span>
<span id="cb83-976"><a href="#cb83-976" aria-hidden="true" tabindex="-1"></a>yhigh <span class="ot">&lt;-</span> <span class="fu">apply</span>(preds, <span class="dv">2</span>, quantile, <span class="at">probs =</span> <span class="fl">0.975</span>)</span>
<span id="cb83-977"><a href="#cb83-977" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb83-978"><a href="#cb83-978" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb83-979"><a href="#cb83-979" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_ribbon</span>(<span class="fu">aes</span>(<span class="at">x =</span> xseq, <span class="at">ymin =</span> ylow, <span class="at">ymax =</span> yhigh), <span class="at">fill =</span> <span class="st">"grey"</span>) <span class="sc">+</span></span>
<span id="cb83-980"><a href="#cb83-980" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">x =</span> xseq, <span class="at">y =</span> ymean), <span class="at">color =</span> <span class="st">"black"</span>, <span class="at">linewidth =</span> <span class="dv">1</span>, <span class="at">lineend =</span> <span class="st">"round"</span>) <span class="sc">+</span></span>
<span id="cb83-981"><a href="#cb83-981" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_errorbar</span>(<span class="fu">aes</span>(<span class="at">x =</span> mytib<span class="sc">$</span>area_log, <span class="at">ymin =</span> mytib<span class="sc">$</span>flow.low, <span class="at">ymax =</span> mytib<span class="sc">$</span>flow.high), <span class="at">width =</span> <span class="fl">0.1</span>) <span class="sc">+</span></span>
<span id="cb83-982"><a href="#cb83-982" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">x =</span> mytib<span class="sc">$</span>area_log, <span class="at">y =</span> mytib<span class="sc">$</span>flow.mean), <span class="at">size =</span> <span class="dv">2</span>, <span class="at">shape =</span> <span class="dv">21</span>, <span class="at">fill =</span> <span class="st">"white"</span>) <span class="sc">+</span></span>
<span id="cb83-983"><a href="#cb83-983" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>() <span class="sc">+</span> <span class="fu">theme</span>(<span class="at">panel.grid =</span> <span class="fu">element_blank</span>()) <span class="sc">+</span></span>
<span id="cb83-984"><a href="#cb83-984" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="st">"Catchment area (log scale)"</span>) <span class="sc">+</span> <span class="fu">ylab</span>(<span class="st">"Flow effect (posterior mean)"</span>)</span>
<span id="cb83-985"><a href="#cb83-985" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb83-986"><a href="#cb83-986" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb83-987"><a href="#cb83-987" aria-hidden="true" tabindex="-1"></a>Temp-flow interaction: *not sure what this means...*</span>
<span id="cb83-990"><a href="#cb83-990" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb83-991"><a href="#cb83-991" aria-hidden="true" tabindex="-1"></a>xseq <span class="ot">&lt;-</span> <span class="fu">seq</span>(<span class="at">from =</span> <span class="fu">min</span>(jags.data<span class="sc">$</span>area), <span class="at">to =</span> <span class="fu">max</span>(jags.data<span class="sc">$</span>area), <span class="at">length.out =</span> nsims)</span>
<span id="cb83-992"><a href="#cb83-992" aria-hidden="true" tabindex="-1"></a>preds <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="at">data =</span> <span class="cn">NA</span>, <span class="at">nrow =</span> <span class="fu">dim</span>(Mcmcdat)[<span class="dv">1</span>], <span class="at">ncol =</span> nsims)</span>
<span id="cb83-993"><a href="#cb83-993" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb83-994"><a href="#cb83-994" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (j <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">dim</span>(Mcmcdat)[<span class="dv">1</span>]) {</span>
<span id="cb83-995"><a href="#cb83-995" aria-hidden="true" tabindex="-1"></a>  preds[j,] <span class="ot">&lt;-</span> <span class="fu">unlist</span>(Mcmcdat[j,<span class="st">"alpha.0[4]"</span>]) <span class="sc">+</span> <span class="fu">unlist</span>(Mcmcdat[j,<span class="st">"alpha.1[4]"</span>])<span class="sc">*</span>xseq</span>
<span id="cb83-996"><a href="#cb83-996" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb83-997"><a href="#cb83-997" aria-hidden="true" tabindex="-1"></a>ymean <span class="ot">&lt;-</span> <span class="fu">apply</span>(preds, <span class="dv">2</span>, mean)</span>
<span id="cb83-998"><a href="#cb83-998" aria-hidden="true" tabindex="-1"></a>ylow <span class="ot">&lt;-</span> <span class="fu">apply</span>(preds, <span class="dv">2</span>, quantile, <span class="at">probs =</span> <span class="fl">0.025</span>)</span>
<span id="cb83-999"><a href="#cb83-999" aria-hidden="true" tabindex="-1"></a>yhigh <span class="ot">&lt;-</span> <span class="fu">apply</span>(preds, <span class="dv">2</span>, quantile, <span class="at">probs =</span> <span class="fl">0.975</span>)</span>
<span id="cb83-1000"><a href="#cb83-1000" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb83-1001"><a href="#cb83-1001" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb83-1002"><a href="#cb83-1002" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_ribbon</span>(<span class="fu">aes</span>(<span class="at">x =</span> xseq, <span class="at">ymin =</span> ylow, <span class="at">ymax =</span> yhigh), <span class="at">fill =</span> <span class="st">"grey"</span>) <span class="sc">+</span></span>
<span id="cb83-1003"><a href="#cb83-1003" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">x =</span> xseq, <span class="at">y =</span> ymean), <span class="at">color =</span> <span class="st">"black"</span>, <span class="at">linewidth =</span> <span class="dv">1</span>, <span class="at">lineend =</span> <span class="st">"round"</span>) <span class="sc">+</span></span>
<span id="cb83-1004"><a href="#cb83-1004" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_errorbar</span>(<span class="fu">aes</span>(<span class="at">x =</span> mytib<span class="sc">$</span>area_log, <span class="at">ymin =</span> mytib<span class="sc">$</span>int.low, <span class="at">ymax =</span> mytib<span class="sc">$</span>int.high), <span class="at">width =</span> <span class="fl">0.1</span>) <span class="sc">+</span></span>
<span id="cb83-1005"><a href="#cb83-1005" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">x =</span> mytib<span class="sc">$</span>area_log, <span class="at">y =</span> mytib<span class="sc">$</span>int.mean), <span class="at">size =</span> <span class="dv">2</span>, <span class="at">shape =</span> <span class="dv">21</span>, <span class="at">fill =</span> <span class="st">"white"</span>) <span class="sc">+</span></span>
<span id="cb83-1006"><a href="#cb83-1006" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>() <span class="sc">+</span> <span class="fu">theme</span>(<span class="at">panel.grid =</span> <span class="fu">element_blank</span>()) <span class="sc">+</span></span>
<span id="cb83-1007"><a href="#cb83-1007" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="st">"Catchment area (log scale)"</span>) <span class="sc">+</span> <span class="fu">ylab</span>(<span class="st">"Temp-Flow interaction (posterior mean)"</span>)</span>
<span id="cb83-1008"><a href="#cb83-1008" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb83-1009"><a href="#cb83-1009" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb83-1010"><a href="#cb83-1010" aria-hidden="true" tabindex="-1"></a><span class="in">```{r fig.width=8, fig.height=7}</span></span>
<span id="cb83-1011"><a href="#cb83-1011" aria-hidden="true" tabindex="-1"></a>x_temp <span class="ot">&lt;-</span> <span class="fu">seq</span>(<span class="at">from =</span> <span class="fu">min</span>(dat<span class="sc">$</span>z_air_temp_mean), <span class="at">to =</span> <span class="fu">max</span>(dat<span class="sc">$</span>z_air_temp_mean), <span class="at">length.out =</span> nsims)</span>
<span id="cb83-1012"><a href="#cb83-1012" aria-hidden="true" tabindex="-1"></a>x_flow <span class="ot">&lt;-</span> <span class="fu">seq</span>(<span class="at">from =</span> <span class="fu">min</span>(dat<span class="sc">$</span>z_Yield_mm_log), <span class="at">to =</span> <span class="fu">max</span>(dat<span class="sc">$</span>z_Yield_mm_log), <span class="at">length.out =</span> nsims)</span>
<span id="cb83-1013"><a href="#cb83-1013" aria-hidden="true" tabindex="-1"></a>pred_df_sm <span class="ot">&lt;-</span> <span class="fu">expand_grid</span>(x_temp, x_flow)</span>
<span id="cb83-1014"><a href="#cb83-1014" aria-hidden="true" tabindex="-1"></a>pred_df_lg <span class="ot">&lt;-</span> <span class="fu">expand_grid</span>(x_temp, x_flow)</span>
<span id="cb83-1015"><a href="#cb83-1015" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb83-1016"><a href="#cb83-1016" aria-hidden="true" tabindex="-1"></a><span class="co"># small basins</span></span>
<span id="cb83-1017"><a href="#cb83-1017" aria-hidden="true" tabindex="-1"></a>te <span class="ot">&lt;-</span> param.summary[<span class="st">"alpha.0[2]"</span>,<span class="dv">1</span>] <span class="sc">+</span> param.summary[<span class="st">"alpha.1[2]"</span>,<span class="dv">1</span>]<span class="sc">*</span><span class="fu">min</span>(jags.data<span class="sc">$</span>area)</span>
<span id="cb83-1018"><a href="#cb83-1018" aria-hidden="true" tabindex="-1"></a>fe <span class="ot">&lt;-</span> param.summary[<span class="st">"alpha.0[3]"</span>,<span class="dv">1</span>] <span class="sc">+</span> param.summary[<span class="st">"alpha.1[3]"</span>,<span class="dv">1</span>]<span class="sc">*</span><span class="fu">min</span>(jags.data<span class="sc">$</span>area)</span>
<span id="cb83-1019"><a href="#cb83-1019" aria-hidden="true" tabindex="-1"></a>tfe <span class="ot">&lt;-</span> param.summary[<span class="st">"alpha.0[4]"</span>,<span class="dv">1</span>] <span class="sc">+</span> param.summary[<span class="st">"alpha.1[4]"</span>,<span class="dv">1</span>]<span class="sc">*</span><span class="fu">min</span>(jags.data<span class="sc">$</span>area)</span>
<span id="cb83-1020"><a href="#cb83-1020" aria-hidden="true" tabindex="-1"></a>pred_df_sm<span class="sc">$</span>pred <span class="ot">&lt;-</span> te<span class="sc">*</span>pred_df_sm<span class="sc">$</span>x_temp <span class="sc">+</span> fe<span class="sc">*</span>pred_df_sm<span class="sc">$</span>x_flow <span class="sc">+</span> tfe<span class="sc">*</span>pred_df_sm<span class="sc">$</span>x_temp<span class="sc">*</span>pred_df_sm<span class="sc">$</span>x_flow</span>
<span id="cb83-1021"><a href="#cb83-1021" aria-hidden="true" tabindex="-1"></a><span class="co"># large basins</span></span>
<span id="cb83-1022"><a href="#cb83-1022" aria-hidden="true" tabindex="-1"></a>te <span class="ot">&lt;-</span> param.summary[<span class="st">"alpha.0[2]"</span>,<span class="dv">1</span>] <span class="sc">+</span> param.summary[<span class="st">"alpha.1[2]"</span>,<span class="dv">1</span>]<span class="sc">*</span><span class="fu">max</span>(jags.data<span class="sc">$</span>area)</span>
<span id="cb83-1023"><a href="#cb83-1023" aria-hidden="true" tabindex="-1"></a>fe <span class="ot">&lt;-</span> param.summary[<span class="st">"alpha.0[3]"</span>,<span class="dv">1</span>] <span class="sc">+</span> param.summary[<span class="st">"alpha.1[3]"</span>,<span class="dv">1</span>]<span class="sc">*</span><span class="fu">max</span>(jags.data<span class="sc">$</span>area)</span>
<span id="cb83-1024"><a href="#cb83-1024" aria-hidden="true" tabindex="-1"></a>tfe <span class="ot">&lt;-</span> param.summary[<span class="st">"alpha.0[4]"</span>,<span class="dv">1</span>] <span class="sc">+</span> param.summary[<span class="st">"alpha.1[4]"</span>,<span class="dv">1</span>]<span class="sc">*</span><span class="fu">max</span>(jags.data<span class="sc">$</span>area)</span>
<span id="cb83-1025"><a href="#cb83-1025" aria-hidden="true" tabindex="-1"></a>pred_df_lg<span class="sc">$</span>pred <span class="ot">&lt;-</span> te<span class="sc">*</span>pred_df_lg<span class="sc">$</span>x_temp <span class="sc">+</span> fe<span class="sc">*</span>pred_df_lg<span class="sc">$</span>x_flow <span class="sc">+</span> tfe<span class="sc">*</span>pred_df_lg<span class="sc">$</span>x_temp<span class="sc">*</span>pred_df_lg<span class="sc">$</span>x_flow</span>
<span id="cb83-1026"><a href="#cb83-1026" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb83-1027"><a href="#cb83-1027" aria-hidden="true" tabindex="-1"></a><span class="co"># plot</span></span>
<span id="cb83-1028"><a href="#cb83-1028" aria-hidden="true" tabindex="-1"></a>p1sm <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(pred_df_sm, <span class="fu">aes</span>(<span class="at">x =</span> x_temp, <span class="at">y =</span> pred, <span class="at">color =</span> x_flow, <span class="at">group =</span> x_flow)) <span class="sc">+</span></span>
<span id="cb83-1029"><a href="#cb83-1029" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_line</span>() <span class="sc">+</span></span>
<span id="cb83-1030"><a href="#cb83-1030" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_color_distiller</span>(<span class="at">palette =</span> <span class="st">"BrBG"</span>, <span class="at">direction =</span> <span class="sc">+</span><span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb83-1031"><a href="#cb83-1031" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme_bw</span>() <span class="sc">+</span> <span class="fu">theme</span>(<span class="at">panel.grid =</span> <span class="fu">element_blank</span>()) <span class="sc">+</span></span>
<span id="cb83-1032"><a href="#cb83-1032" aria-hidden="true" tabindex="-1"></a>    <span class="fu">labs</span>(<span class="at">color =</span> <span class="st">"Flow"</span>) <span class="sc">+</span> <span class="fu">xlab</span>(<span class="st">"Air temperature"</span>) <span class="sc">+</span> <span class="fu">ylab</span>(<span class="st">"Water temperature (deviation)"</span>) <span class="sc">+</span> <span class="fu">ylim</span>(<span class="sc">-</span><span class="dv">7</span>,<span class="dv">7</span>)</span>
<span id="cb83-1033"><a href="#cb83-1033" aria-hidden="true" tabindex="-1"></a>p2sm <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(pred_df_sm, <span class="fu">aes</span>(<span class="at">x =</span> x_temp, <span class="at">y =</span> x_flow)) <span class="sc">+</span></span>
<span id="cb83-1034"><a href="#cb83-1034" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_tile</span>(<span class="fu">aes</span>(<span class="at">fill =</span> pred)) <span class="sc">+</span></span>
<span id="cb83-1035"><a href="#cb83-1035" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_fill_distiller</span>(<span class="at">palette =</span> <span class="st">"Spectral"</span>, <span class="at">limits =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="dv">7</span>,<span class="dv">7</span>)) <span class="sc">+</span></span>
<span id="cb83-1036"><a href="#cb83-1036" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme_bw</span>() <span class="sc">+</span> <span class="fu">theme</span>(<span class="at">panel.grid =</span> <span class="fu">element_blank</span>()) <span class="sc">+</span></span>
<span id="cb83-1037"><a href="#cb83-1037" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_x_continuous</span>(<span class="at">expand =</span> <span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">0</span>)) <span class="sc">+</span> <span class="fu">scale_y_continuous</span>(<span class="at">expand =</span> <span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">0</span>)) <span class="sc">+</span></span>
<span id="cb83-1038"><a href="#cb83-1038" aria-hidden="true" tabindex="-1"></a>    <span class="fu">labs</span>(<span class="at">fill =</span> <span class="st">"Water</span><span class="sc">\n</span><span class="st">temp.</span><span class="sc">\n</span><span class="st">dev."</span>) <span class="sc">+</span> <span class="fu">xlab</span>(<span class="st">"Air temperature"</span>) <span class="sc">+</span> <span class="fu">ylab</span>(<span class="st">"Flow"</span>)</span>
<span id="cb83-1039"><a href="#cb83-1039" aria-hidden="true" tabindex="-1"></a><span class="co"># plot</span></span>
<span id="cb83-1040"><a href="#cb83-1040" aria-hidden="true" tabindex="-1"></a>p1lg <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(pred_df_lg, <span class="fu">aes</span>(<span class="at">x =</span> x_temp, <span class="at">y =</span> pred, <span class="at">color =</span> x_flow, <span class="at">group =</span> x_flow)) <span class="sc">+</span></span>
<span id="cb83-1041"><a href="#cb83-1041" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_line</span>() <span class="sc">+</span></span>
<span id="cb83-1042"><a href="#cb83-1042" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_color_distiller</span>(<span class="at">palette =</span> <span class="st">"BrBG"</span>, <span class="at">direction =</span> <span class="sc">+</span><span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb83-1043"><a href="#cb83-1043" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme_bw</span>() <span class="sc">+</span> <span class="fu">theme</span>(<span class="at">panel.grid =</span> <span class="fu">element_blank</span>()) <span class="sc">+</span></span>
<span id="cb83-1044"><a href="#cb83-1044" aria-hidden="true" tabindex="-1"></a>    <span class="fu">labs</span>(<span class="at">color =</span> <span class="st">"Flow"</span>) <span class="sc">+</span> <span class="fu">xlab</span>(<span class="st">"Air temperature"</span>) <span class="sc">+</span> <span class="fu">ylab</span>(<span class="st">"Water temperature (deviation)"</span>) <span class="sc">+</span> <span class="fu">ylim</span>(<span class="sc">-</span><span class="dv">7</span>,<span class="dv">7</span>)</span>
<span id="cb83-1045"><a href="#cb83-1045" aria-hidden="true" tabindex="-1"></a>p2lg <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(pred_df_lg, <span class="fu">aes</span>(<span class="at">x =</span> x_temp, <span class="at">y =</span> x_flow)) <span class="sc">+</span></span>
<span id="cb83-1046"><a href="#cb83-1046" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_tile</span>(<span class="fu">aes</span>(<span class="at">fill =</span> pred)) <span class="sc">+</span></span>
<span id="cb83-1047"><a href="#cb83-1047" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_fill_distiller</span>(<span class="at">palette =</span> <span class="st">"Spectral"</span>, <span class="at">limits =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="dv">7</span>,<span class="dv">7</span>)) <span class="sc">+</span></span>
<span id="cb83-1048"><a href="#cb83-1048" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme_bw</span>() <span class="sc">+</span> <span class="fu">theme</span>(<span class="at">panel.grid =</span> <span class="fu">element_blank</span>()) <span class="sc">+</span></span>
<span id="cb83-1049"><a href="#cb83-1049" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_x_continuous</span>(<span class="at">expand =</span> <span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">0</span>)) <span class="sc">+</span> <span class="fu">scale_y_continuous</span>(<span class="at">expand =</span> <span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">0</span>)) <span class="sc">+</span></span>
<span id="cb83-1050"><a href="#cb83-1050" aria-hidden="true" tabindex="-1"></a>    <span class="fu">labs</span>(<span class="at">fill =</span> <span class="st">"Water</span><span class="sc">\n</span><span class="st">temp.</span><span class="sc">\n</span><span class="st">dev."</span>) <span class="sc">+</span> <span class="fu">xlab</span>(<span class="st">"Air temperature"</span>) <span class="sc">+</span> <span class="fu">ylab</span>(<span class="st">"Flow"</span>)</span>
<span id="cb83-1051"><a href="#cb83-1051" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb83-1052"><a href="#cb83-1052" aria-hidden="true" tabindex="-1"></a>egg<span class="sc">::</span><span class="fu">ggarrange</span>(p1sm, p2sm, p1lg, p2lg, <span class="at">ncol =</span> <span class="dv">2</span>, <span class="at">nrow =</span> <span class="dv">2</span>, <span class="at">labels =</span> <span class="fu">c</span>(<span class="st">"small"</span>, <span class="st">"small"</span>, <span class="st">"large"</span>, <span class="st">"large"</span>))</span>
<span id="cb83-1053"><a href="#cb83-1053" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb83-1054"><a href="#cb83-1054" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb83-1055"><a href="#cb83-1055" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb83-1056"><a href="#cb83-1056" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb83-1057"><a href="#cb83-1057" aria-hidden="true" tabindex="-1"></a>Temp effect - old</span>
<span id="cb83-1058"><a href="#cb83-1058" aria-hidden="true" tabindex="-1"></a><span class="in">```{r eval = FALSE}</span></span>
<span id="cb83-1059"><a href="#cb83-1059" aria-hidden="true" tabindex="-1"></a>mydf <span class="ot">&lt;-</span> ggfit <span class="sc">%&gt;%</span></span>
<span id="cb83-1060"><a href="#cb83-1060" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(Parameter <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"B.site[1,2]"</span>, <span class="st">"B.site[2,2]"</span>, <span class="st">"B.site[3,2]"</span>, <span class="st">"B.site[4,2]"</span>, <span class="st">"B.site[5,2]"</span>,</span>
<span id="cb83-1061"><a href="#cb83-1061" aria-hidden="true" tabindex="-1"></a>                          <span class="st">"B.site[6,2]"</span>, <span class="st">"B.site[7,2]"</span>, <span class="st">"B.site[8,2]"</span>, <span class="st">"B.site[9,2]"</span>, <span class="st">"B.site[10,2]"</span>, <span class="st">"B.site[11,2]"</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb83-1062"><a href="#cb83-1062" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Parameter =</span> <span class="fu">factor</span>(Parameter, <span class="at">levels =</span> <span class="fu">c</span>(<span class="st">"B.site[1,2]"</span>, <span class="st">"B.site[2,2]"</span>, <span class="st">"B.site[3,2]"</span>, <span class="st">"B.site[4,2]"</span>, <span class="st">"B.site[5,2]"</span>,</span>
<span id="cb83-1063"><a href="#cb83-1063" aria-hidden="true" tabindex="-1"></a>                          <span class="st">"B.site[6,2]"</span>, <span class="st">"B.site[7,2]"</span>, <span class="st">"B.site[8,2]"</span>, <span class="st">"B.site[9,2]"</span>, <span class="st">"B.site[10,2]"</span>, <span class="st">"B.site[11,2]"</span>))) <span class="sc">%&gt;%</span></span>
<span id="cb83-1064"><a href="#cb83-1064" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(Parameter) <span class="sc">%&gt;%</span> </span>
<span id="cb83-1065"><a href="#cb83-1065" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="at">mean =</span> <span class="fu">mean</span>(value)) <span class="sc">%&gt;%</span></span>
<span id="cb83-1066"><a href="#cb83-1066" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span></span>
<span id="cb83-1067"><a href="#cb83-1067" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">site_name =</span> mysites<span class="sc">$</span>site_name) <span class="sc">%&gt;%</span></span>
<span id="cb83-1068"><a href="#cb83-1068" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(dat <span class="sc">%&gt;%</span> <span class="fu">group_by</span>(site_name) <span class="sc">%&gt;%</span> <span class="fu">summarize</span>(<span class="at">area_sqmi =</span> <span class="fu">unique</span>(area_sqmi))) <span class="sc">%&gt;%</span> </span>
<span id="cb83-1069"><a href="#cb83-1069" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(dat <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="at">month =</span> <span class="fu">month</span>(date)) <span class="sc">%&gt;%</span> <span class="fu">filter</span>(month <span class="sc">%in%</span> <span class="fu">c</span>(<span class="dv">7</span><span class="sc">:</span><span class="dv">9</span>)) <span class="sc">%&gt;%</span> <span class="fu">group_by</span>(site_name) <span class="sc">%&gt;%</span> <span class="fu">summarize</span>(<span class="at">meanSummYield =</span> <span class="fu">mean</span>(Yield_mm, <span class="at">na.rm =</span> <span class="cn">TRUE</span>))) <span class="sc">%&gt;%</span></span>
<span id="cb83-1070"><a href="#cb83-1070" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">z_area =</span> <span class="fu">scale</span>(area_sqmi), <span class="at">z_yield =</span> <span class="fu">scale</span>(meanSummYield))</span>
<span id="cb83-1071"><a href="#cb83-1071" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb83-1072"><a href="#cb83-1072" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(<span class="fu">lm</span>(mean <span class="sc">~</span> z_area <span class="sc">+</span> z_yield, <span class="at">data =</span> mydf))</span>
<span id="cb83-1073"><a href="#cb83-1073" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb83-1074"><a href="#cb83-1074" aria-hidden="true" tabindex="-1"></a>p1 <span class="ot">&lt;-</span> mydf <span class="sc">%&gt;%</span></span>
<span id="cb83-1075"><a href="#cb83-1075" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> <span class="fu">log</span>(area_sqmi), <span class="at">y =</span> mean)) <span class="sc">+</span></span>
<span id="cb83-1076"><a href="#cb83-1076" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span> <span class="fu">geom_smooth</span>(<span class="at">method =</span> <span class="st">"lm"</span>) <span class="sc">+</span> <span class="fu">theme_bw</span>() <span class="sc">+</span></span>
<span id="cb83-1077"><a href="#cb83-1077" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="st">"Catchment area (log scale)"</span>) <span class="sc">+</span> <span class="fu">ylab</span>(<span class="st">"Temperature effect (posterior mean)"</span>) <span class="sc">+</span> ggpubr<span class="sc">::</span><span class="fu">stat_cor</span>()</span>
<span id="cb83-1078"><a href="#cb83-1078" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb83-1079"><a href="#cb83-1079" aria-hidden="true" tabindex="-1"></a>p2 <span class="ot">&lt;-</span> mydf <span class="sc">%&gt;%</span></span>
<span id="cb83-1080"><a href="#cb83-1080" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> <span class="fu">log</span>(meanSummYield), <span class="at">y =</span> mean)) <span class="sc">+</span></span>
<span id="cb83-1081"><a href="#cb83-1081" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span> <span class="fu">geom_smooth</span>(<span class="at">method =</span> <span class="st">"lm"</span>) <span class="sc">+</span> <span class="fu">theme_bw</span>() <span class="sc">+</span></span>
<span id="cb83-1082"><a href="#cb83-1082" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="st">"Mean summer yield (log scale)"</span>) <span class="sc">+</span> <span class="fu">ylab</span>(<span class="st">"Temperature effect (posterior mean)"</span>) <span class="sc">+</span> ggpubr<span class="sc">::</span><span class="fu">stat_cor</span>()</span>
<span id="cb83-1083"><a href="#cb83-1083" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb83-1084"><a href="#cb83-1084" aria-hidden="true" tabindex="-1"></a>ggpubr<span class="sc">::</span><span class="fu">ggarrange</span>(p1, p2, <span class="at">nrow =</span> <span class="dv">1</span>)</span>
<span id="cb83-1085"><a href="#cb83-1085" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb83-1086"><a href="#cb83-1086" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb83-1087"><a href="#cb83-1087" aria-hidden="true" tabindex="-1"></a>Flow effect - old</span>
<span id="cb83-1088"><a href="#cb83-1088" aria-hidden="true" tabindex="-1"></a><span class="in">```{r eval = FALSE}</span></span>
<span id="cb83-1089"><a href="#cb83-1089" aria-hidden="true" tabindex="-1"></a>mydf <span class="ot">&lt;-</span> ggfit <span class="sc">%&gt;%</span></span>
<span id="cb83-1090"><a href="#cb83-1090" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(Parameter <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"B.site[1,3]"</span>, <span class="st">"B.site[2,3]"</span>, <span class="st">"B.site[3,3]"</span>, <span class="st">"B.site[4,3]"</span>, <span class="st">"B.site[5,3]"</span>,</span>
<span id="cb83-1091"><a href="#cb83-1091" aria-hidden="true" tabindex="-1"></a>                          <span class="st">"B.site[6,3]"</span>, <span class="st">"B.site[7,3]"</span>, <span class="st">"B.site[8,3]"</span>, <span class="st">"B.site[9,3]"</span>, <span class="st">"B.site[10,3]"</span>, <span class="st">"B.site[11,3]"</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb83-1092"><a href="#cb83-1092" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Parameter =</span> <span class="fu">factor</span>(Parameter, <span class="at">levels =</span> <span class="fu">c</span>(<span class="st">"B.site[1,3]"</span>, <span class="st">"B.site[2,3]"</span>, <span class="st">"B.site[3,3]"</span>, <span class="st">"B.site[4,3]"</span>, <span class="st">"B.site[5,3]"</span>,</span>
<span id="cb83-1093"><a href="#cb83-1093" aria-hidden="true" tabindex="-1"></a>                          <span class="st">"B.site[6,3]"</span>, <span class="st">"B.site[7,3]"</span>, <span class="st">"B.site[8,3]"</span>, <span class="st">"B.site[9,3]"</span>, <span class="st">"B.site[10,3]"</span>, <span class="st">"B.site[11,3]"</span>))) <span class="sc">%&gt;%</span></span>
<span id="cb83-1094"><a href="#cb83-1094" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(Parameter) <span class="sc">%&gt;%</span> </span>
<span id="cb83-1095"><a href="#cb83-1095" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="at">mean =</span> <span class="fu">mean</span>(value)) <span class="sc">%&gt;%</span></span>
<span id="cb83-1096"><a href="#cb83-1096" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span></span>
<span id="cb83-1097"><a href="#cb83-1097" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">site_name =</span> mysites<span class="sc">$</span>site_name) <span class="sc">%&gt;%</span></span>
<span id="cb83-1098"><a href="#cb83-1098" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(dat <span class="sc">%&gt;%</span> <span class="fu">group_by</span>(site_name) <span class="sc">%&gt;%</span> <span class="fu">summarize</span>(<span class="at">area_sqmi =</span> <span class="fu">unique</span>(area_sqmi))) <span class="sc">%&gt;%</span> </span>
<span id="cb83-1099"><a href="#cb83-1099" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(dat <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="at">month =</span> <span class="fu">month</span>(date)) <span class="sc">%&gt;%</span> <span class="fu">filter</span>(month <span class="sc">%in%</span> <span class="fu">c</span>(<span class="dv">7</span><span class="sc">:</span><span class="dv">9</span>)) <span class="sc">%&gt;%</span> <span class="fu">group_by</span>(site_name) <span class="sc">%&gt;%</span> <span class="fu">summarize</span>(<span class="at">meanSummYield =</span> <span class="fu">mean</span>(Yield_mm, <span class="at">na.rm =</span> <span class="cn">TRUE</span>))) <span class="sc">%&gt;%</span></span>
<span id="cb83-1100"><a href="#cb83-1100" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">z_area =</span> <span class="fu">scale</span>(area_sqmi), <span class="at">z_yield =</span> <span class="fu">scale</span>(meanSummYield))</span>
<span id="cb83-1101"><a href="#cb83-1101" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb83-1102"><a href="#cb83-1102" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(<span class="fu">lm</span>(mean <span class="sc">~</span> z_area <span class="sc">+</span> z_yield, <span class="at">data =</span> mydf))</span>
<span id="cb83-1103"><a href="#cb83-1103" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb83-1104"><a href="#cb83-1104" aria-hidden="true" tabindex="-1"></a>p1 <span class="ot">&lt;-</span> mydf <span class="sc">%&gt;%</span></span>
<span id="cb83-1105"><a href="#cb83-1105" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> <span class="fu">log</span>(area_sqmi), <span class="at">y =</span> mean)) <span class="sc">+</span></span>
<span id="cb83-1106"><a href="#cb83-1106" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span> <span class="fu">geom_smooth</span>(<span class="at">method =</span> <span class="st">"lm"</span>) <span class="sc">+</span> <span class="fu">theme_bw</span>() <span class="sc">+</span></span>
<span id="cb83-1107"><a href="#cb83-1107" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="st">"Catchment area (log scale)"</span>) <span class="sc">+</span> <span class="fu">ylab</span>(<span class="st">"Flow effect (posterior mean)"</span>) <span class="sc">+</span> ggpubr<span class="sc">::</span><span class="fu">stat_cor</span>(<span class="at">label.y.npc =</span> <span class="st">"bottom"</span>)</span>
<span id="cb83-1108"><a href="#cb83-1108" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb83-1109"><a href="#cb83-1109" aria-hidden="true" tabindex="-1"></a>p2 <span class="ot">&lt;-</span> mydf <span class="sc">%&gt;%</span></span>
<span id="cb83-1110"><a href="#cb83-1110" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> <span class="fu">log</span>(meanSummYield), <span class="at">y =</span> mean)) <span class="sc">+</span></span>
<span id="cb83-1111"><a href="#cb83-1111" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span> <span class="fu">geom_smooth</span>(<span class="at">method =</span> <span class="st">"lm"</span>) <span class="sc">+</span> <span class="fu">theme_bw</span>() <span class="sc">+</span></span>
<span id="cb83-1112"><a href="#cb83-1112" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="st">"Mean summer yield (log scale)"</span>) <span class="sc">+</span> <span class="fu">ylab</span>(<span class="st">"Flow effect (posterior mean)"</span>) <span class="sc">+</span> ggpubr<span class="sc">::</span><span class="fu">stat_cor</span>(<span class="at">label.y.npc =</span> <span class="st">"bottom"</span>)</span>
<span id="cb83-1113"><a href="#cb83-1113" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb83-1114"><a href="#cb83-1114" aria-hidden="true" tabindex="-1"></a>ggpubr<span class="sc">::</span><span class="fu">ggarrange</span>(p1, p2, <span class="at">nrow =</span> <span class="dv">1</span>)</span>
<span id="cb83-1115"><a href="#cb83-1115" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb83-1116"><a href="#cb83-1116" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb83-1117"><a href="#cb83-1117" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb83-1118"><a href="#cb83-1118" aria-hidden="true" tabindex="-1"></a>What does this mean with respect to the effects of (streamflow) drought on spatial variation in stream temperature across river networks? </span>
<span id="cb83-1119"><a href="#cb83-1119" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb83-1120"><a href="#cb83-1120" aria-hidden="true" tabindex="-1"></a><span class="ss">* </span>Superficially, during dry years, stream temperatures will warm in larger, lower-elevation rivers (as water temp becomes more responsive to air temp?), while stream temperatures cool in smaller, headwater streams as (cold) groundwater contributions account for an increasingly larger proportion of volumetric discharge.</span>
<span id="cb83-1121"><a href="#cb83-1121" aria-hidden="true" tabindex="-1"></a><span class="ss">* </span>Thus, drought amplifies spatial variability in stream temperature along gradients of stream size (and elevation?)</span>
<span id="cb83-1122"><a href="#cb83-1122" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb83-1123"><a href="#cb83-1123" aria-hidden="true" tabindex="-1"></a>But what about variation in groundwater availability among headwater streams? And what about spatial variation in the strength of the interaction between flow and temperature? Perhaps dry years amplify spatial variation in water temperature in multiple dimensions: (1) increased divergence in temperature between small and large streams (as discussed above), but also (2) increased divergence in temperature among headwater systems that differ in groundwater availability. </span>
</code><button title="Copy to Clipboard" class="code-copy-button" data-in-quarto-modal=""><i class="bi"></i></button></pre></div>
</div></div></div></div></div>
</div> <!-- /content -->




</body></html>